{"file_contents":{"server/scripts/test-rag.ts":{"content":"import 'dotenv/config';\nimport { initializeRagSystem, testRagSystem, generateRagAnswer, getRagStats } from '../services/rag';\n\nasync function main() {\n  try {\n    console.log('ðŸš€ Starting RAG System Test...\\n');\n\n    // Check if OPENAI_API_KEY is set\n    if (!process.env.OPENAI_API_KEY) {\n      throw new Error('OPENAI_API_KEY environment variable is required');\n    }\n\n    // Initialize the RAG system\n    console.log('ðŸ“š Initializing RAG system and loading data...');\n    await initializeRagSystem();\n    console.log('âœ… RAG system initialized successfully!\\n');\n\n    // Get statistics\n    console.log('ðŸ“Š Getting system statistics...');\n    const stats = await getRagStats();\n    console.log('Vector Store Statistics:', stats);\n    console.log('');\n\n    // Test the system\n    console.log('ðŸ§ª Testing RAG system...');\n    await testRagSystem();\n    console.log('');\n\n    // Test some sample queries\n    const testQueries = [\n      \"What is an ADU and how can it be used for elder care?\",\n      \"How much does it typically cost to build an ADU?\",\n      \"What are the zoning requirements for ADUs?\",\n      \"How can I make an ADU accessible for someone with mobility issues?\",\n      \"What are the maintenance responsibilities for an ADU?\"\n    ];\n\n    console.log('ðŸ” Testing sample queries...\\n');\n\n    for (const query of testQueries) {\n      console.log(`Query: ${query}`);\n      console.log('â”€'.repeat(50));\n\n      const response = await generateRagAnswer(query);\n\n      console.log(`Answer: ${response.answer.substring(0, 200)}...`);\n      console.log(`Confidence: ${(response.confidence * 100).toFixed(1)}%`);\n      console.log(`Sources: ${response.sources.length}`);\n      console.log('');\n    }\n\n    console.log('ðŸŽ‰ RAG system test completed successfully!');\n\n  } catch (error) {\n    console.error('âŒ Error during RAG system test:', error);\n    process.exit(1);\n  }\n}\n\nmain();\n","size_bytes":1902},"client/src/pages/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Heart,\n  Award,\n  BookOpen,\n  Clock,\n  MapPin,\n  Calendar,\n  Users,\n  MessageSquare,\n  Star,\n  CheckCircle,\n  Phone,\n  AlertCircle,\n  Coffee,\n  Sunrise,\n  Moon,\n  Activity,\n  Target,\n  Bookmark,\n  TrendingUp,\n  User,\n  Shield,\n  Smile,\n} from \"lucide-react\";\n\nimport { useAuth } from \"@/hooks/useAuth\";\nimport MainLayout from \"@/components/MainLayout\";\n\nexport default function Dashboard() {\n  const { user, isLoading } = useAuth();\n  const [currentTipIndex, setCurrentTipIndex] = useState(0);\n\n  // Daily wellness tips specifically for caregivers\n  const wellnessTips = [\n    {\n      icon: Coffee,\n      title: \"Morning Self-Care\",\n      content: \"Take 5 minutes each morning for yourself before starting caregiving tasks. Deep breathing or a warm cup of tea can set a positive tone for your day.\",\n      category: \"Mindfulness\"\n    },\n    {\n      icon: Phone,\n      title: \"Stay Connected\",\n      content: \"Call a friend or family member today. Social connection is crucial for caregiver mental health and reduces feelings of isolation.\",\n      category: \"Social Support\"\n    },\n    {\n      icon: Activity,\n      title: \"Movement Break\",\n      content: \"Take a 10-minute walk or do gentle stretches. Physical activity helps reduce caregiver stress and improves your energy levels.\",\n      category: \"Physical Health\"\n    },\n    {\n      icon: Moon,\n      title: \"Evening Routine\",\n      content: \"Create a calming bedtime routine. Good sleep is essential for caregivers to maintain patience and emotional resilience.\",\n      category: \"Rest\"\n    },\n    {\n      icon: Heart,\n      title: \"Practice Gratitude\",\n      content: \"Write down three things you're grateful for today. This simple practice can improve mood and reduce caregiver burnout.\",\n      category: \"Mental Health\"\n    }\n  ];\n\n  const currentTip = wellnessTips[currentTipIndex];\n\n  const nextTip = () => {\n    setCurrentTipIndex((prev) => (prev + 1) % wellnessTips.length);\n  };\n\n  const previousTip = () => {\n    setCurrentTipIndex((prev) => (prev - 1 + wellnessTips.length) % wellnessTips.length);\n  };\n\n  // Fetch real user dashboard statistics\n  const { data: userStats = {\n    postsCreated: 0,\n    helpfulVotes: 0,\n    commentsPosted: 0,\n    daysActive: 0\n  }, isLoading: statsLoading } = useQuery<{\n    postsCreated: number;\n    helpfulVotes: number;\n    commentsPosted: number;\n    daysActive: number;\n  }>({\n    queryKey: [\"/api/user/dashboard-stats\"],\n    enabled: !!user, // Only fetch if user is logged in\n  });\n\n  // Keep other mock data for features not yet implemented\n  const additionalStats = {\n    achievementsEarned: 5,\n    bookmarkedPosts: 8\n  };\n\n  // Recent achievements\n  const achievements = [\n    { name: \"Helpful Community Member\", description: \"Received 25+ helpful votes\", icon: Heart, earned: true },\n    { name: \"Active Contributor\", description: \"Posted 10+ discussions\", icon: MessageSquare, earned: true },\n    { name: \"Supportive Friend\", description: \"Helped 5+ caregivers\", icon: Users, earned: true },\n    { name: \"Knowledge Seeker\", description: \"Bookmarked 10+ posts\", icon: BookOpen, earned: false },\n    { name: \"Community Builder\", description: \"Active for 60+ days\", icon: Award, earned: false }\n  ];\n\n  // Local resources - would be personalized based on user location\n  const localResources = [\n    {\n      name: \"Elder Care Support Group\",\n      type: \"Support Group\",\n      location: \"Community Center\",\n      nextMeeting: \"Thursday 7:00 PM\",\n      distance: \"2.3 miles\"\n    },\n    {\n      name: \"Caregiver Respite Services\",\n      type: \"Respite Care\",\n      location: \"Lutheran Family Services\",\n      nextMeeting: \"Call for availability\",\n      distance: \"4.1 miles\"\n    },\n    {\n      name: \"Medicare Workshop\",\n      type: \"Educational Event\",\n      location: \"Public Library\",\n      nextMeeting: \"Next Tuesday 2:00 PM\",\n      distance: \"1.8 miles\"\n    }\n  ];\n\n  // Emergency contacts template\n  const emergencyContacts = [\n    { label: \"Primary Care Doctor\", placeholder: \"Dr. Smith - (555) 123-4567\" },\n    { label: \"Emergency Contact\", placeholder: \"Family member - (555) 987-6543\" },\n    { label: \"Pharmacy\", placeholder: \"CVS Pharmacy - (555) 456-7890\" },\n    { label: \"Insurance\", placeholder: \"Blue Cross - (800) 555-0123\" }\n  ];\n\n  if (isLoading) {\n    return (\n      <MainLayout>\n        <div className=\"h-screen flex items-center justify-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div>\n        {/* Welcome Section */}\n        <div className=\"mb-8 bg-gradient-to-r from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-100\">\n          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">\n            Welcome back, {user?.firstName || 'Sarah'}\n          </h1>\n          <p className=\"text-gray-600\">\n            Your personalized dashboard for support, wellness, and community connection\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Left Column */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Daily Wellness Tip */}\n            <Card className=\"border-l-4 border-l-askEdithTeal\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                    <currentTip.icon className=\"w-5 h-5 text-askEdithTeal\" />\n                    Daily Wellness Tip\n                  </CardTitle>\n                  <Badge variant=\"secondary\">{currentTip.category}</Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <h3 className=\"font-semibold text-gray-800 mb-2\">{currentTip.title}</h3>\n                <p className=\"text-gray-600 mb-4\">{currentTip.content}</p>\n                <div className=\"flex justify-between items-center\">\n                  <div className=\"flex gap-2\">\n                    <Button variant=\"outline\" size=\"sm\" onClick={previousTip}>\n                      Previous\n                    </Button>\n                    <Button variant=\"outline\" size=\"sm\" onClick={nextTip}>\n                      Next Tip\n                    </Button>\n                  </div>\n                  <span className=\"text-sm text-gray-500\">\n                    {currentTipIndex + 1} of {wellnessTips.length}\n                  </span>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Your Progress */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                  <Smile className=\"w-5 h-5 text-askEdithTeal\" />\n                  Your Community Impact\n                </CardTitle>\n                <CardDescription>\n                  See how you're making a difference in the caregiver community\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div className=\"text-center bg-amber-50 p-4 rounded-lg border border-amber-100\">\n                    <div className=\"text-2xl font-bold text-amber-600\">\n                      {statsLoading ? \"...\" : userStats.postsCreated}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Posts Created</div>\n                  </div>\n                  <div className=\"text-center bg-orange-50 p-4 rounded-lg border border-orange-100\">\n                    <div className=\"text-2xl font-bold text-orange-600\">\n                      {statsLoading ? \"...\" : userStats.helpfulVotes}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Helpful Votes</div>\n                  </div>\n                  <div className=\"text-center bg-amber-50 p-4 rounded-lg border border-amber-100\">\n                    <div className=\"text-2xl font-bold text-amber-600\">\n                      {statsLoading ? \"...\" : userStats.commentsPosted}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Comments</div>\n                  </div>\n                  <div className=\"text-center bg-orange-50 p-4 rounded-lg border border-orange-100\">\n                    <div className=\"text-2xl font-bold text-orange-600\">\n                      {statsLoading ? \"...\" : userStats.daysActive}\n                    </div>\n                    <div className=\"text-sm text-gray-600\">Days Active</div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Achievements */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                  <Award className=\"w-5 h-5 text-askEdithTeal\" />\n                  Your Achievements\n                </CardTitle>\n                <CardDescription>\n                  Recognition for your contributions to the community\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {achievements.map((achievement, index) => (\n                    <div key={index} className={`flex items-center gap-3 p-3 rounded-lg ${achievement.earned ? 'bg-teal-50 border border-teal-200' : 'bg-gray-50 border border-gray-200'}`}>\n                      <achievement.icon className={`w-6 h-6 ${achievement.earned ? 'text-teal-600' : 'text-gray-400'}`} />\n                      <div className=\"flex-1\">\n                        <div className={`font-medium ${achievement.earned ? 'text-gray-800' : 'text-gray-500'}`}>\n                          {achievement.name}\n                        </div>\n                        <div className={`text-sm ${achievement.earned ? 'text-gray-600' : 'text-gray-400'}`}>\n                          {achievement.description}\n                        </div>\n                      </div>\n                      {achievement.earned && (\n                        <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Right Column */}\n          <div className=\"space-y-6\">\n            {/* Quick Actions */}\n            <Card className=\"bg-gradient-to-br from-teal-50 to-cyan-50 border-teal-100\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                  <Target className=\"w-5 h-5 text-teal-600\" />\n                  Quick Actions\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <Link href=\"/ask-question\">\n                  <Button className=\"w-full bg-teal-25 hover:bg-teal-50 text-gray-700 border-teal-100\" variant=\"outline\" style={{ backgroundColor: '#f0fdfa' }}>\n                    <MessageSquare className=\"w-4 h-4 mr-2\" />\n                    Ask a Question\n                  </Button>\n                </Link>\n                <Link href=\"/expert-directory\">\n                  <Button className=\"w-full bg-cyan-25 hover:bg-cyan-50 text-gray-700 border-cyan-100\" variant=\"outline\" style={{ backgroundColor: '#ecfeff' }}>\n                    <Users className=\"w-4 h-4 mr-2\" />\n                    Find Experts\n                  </Button>\n                </Link>\n                <Link href=\"/my-bookings\">\n                  <Button className=\"w-full bg-teal-50 hover:bg-teal-100 text-gray-700 border-teal-100\" variant=\"outline\">\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    My Bookings\n                  </Button>\n                </Link>\n                <Link href=\"/bookmarks\">\n                  <Button className=\"w-full bg-teal-25 hover:bg-teal-50 text-gray-700 border-teal-100\" variant=\"outline\" style={{ backgroundColor: '#f0fdfa' }}>\n                    <Bookmark className=\"w-4 h-4 mr-2\" />\n                    My Bookmarks ({additionalStats.bookmarkedPosts})\n                  </Button>\n                </Link>\n                {user?.expertVerification?.verificationStatus === 'verified' && (\n                  <>\n                    <div className=\"pt-2 mt-2 border-t border-gray-200\">\n                      <p className=\"text-sm font-medium text-gray-600 mb-2\">Expert Tools</p>\n                    </div>\n                    <Link href=\"/expert/availability\">\n                      <Button className=\"w-full bg-amber-50 hover:bg-amber-100 text-gray-700 border-amber-200\" variant=\"outline\">\n                        <Clock className=\"w-4 h-4 mr-2\" />\n                        Manage Availability\n                      </Button>\n                    </Link>\n                  </>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Local Resources */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                  <MapPin className=\"w-5 h-5 text-askEdithTeal\" />\n                  Local Resources\n                </CardTitle>\n                <CardDescription>\n                  Support services in your area\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {localResources.map((resource, index) => (\n                  <div key={index} className=\"p-3 bg-amber-50 border border-amber-200 rounded-lg hover:bg-amber-100 transition-colors\">\n                    <div className=\"font-medium text-gray-800\">{resource.name}</div>\n                    <div className=\"text-sm text-amber-700 font-medium\">{resource.type}</div>\n                    <div className=\"text-sm text-gray-600 mt-1\">\n                      {resource.nextMeeting} â€¢ {resource.distance}\n                    </div>\n                  </div>\n                ))}\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full mt-3\">\n                  View All Resources\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Emergency Contacts */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-gray-700\">\n                  <Shield className=\"w-5 h-5 text-askEdithTeal\" />\n                  Emergency Contacts\n                </CardTitle>\n                <CardDescription>\n                  Keep important numbers handy\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {emergencyContacts.map((contact, index) => (\n                  <div key={index} className=\"space-y-1\">\n                    <label className=\"text-sm font-medium text-gray-700\">\n                      {contact.label}\n                    </label>\n                    <input\n                      type=\"text\"\n                      placeholder={contact.placeholder}\n                      className=\"w-full px-3 py-2 text-sm border border-gray-200 rounded-md focus:ring-2 focus:ring-askEdithTeal focus:border-transparent\"\n                    />\n                  </div>\n                ))}\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full mt-3\">\n                  Save Contacts\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Caregiver Burnout Warning */}\n            <Card className=\"border-l-4 border-l-orange-400\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-orange-700\">\n                  <AlertCircle className=\"w-5 h-5\" />\n                  Burnout Check\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-gray-600 mb-3\">\n                  Remember: Taking care of yourself isn't selfishâ€”it's necessary.\n                </p>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                    <span>I've taken breaks today</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <AlertCircle className=\"w-4 h-4 text-orange-500\" />\n                    <span>I feel overwhelmed lately</span>\n                  </div>\n                </div>\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full mt-3\">\n                  Take Burnout Assessment\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </MainLayout>\n  );\n}","size_bytes":17175},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/EmailAnswerForm.tsx":{"content":"import React, { useState } from \"react\";\nimport { Mail, Loader2, Check, AlertCircle } from \"lucide-react\";\n\ninterface EmailAnswerFormProps {\n  question: string;\n  answer: string;\n  onEmailSent?: () => void;\n}\n\nexport function EmailAnswerForm({\n  question,\n  answer,\n  onEmailSent,\n}: EmailAnswerFormProps) {\n  const [firstName, setFirstName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [status, setStatus] = useState<\"idle\" | \"success\" | \"error\">(\"idle\");\n  const [errorMessage, setErrorMessage] = useState(\"\");\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!firstName.trim() || !email.trim()) {\n      setErrorMessage(\"Please fill in all fields\");\n      setStatus(\"error\");\n      return;\n    }\n\n    if (!email.includes(\"@\") || !email.includes(\".\")) {\n      setErrorMessage(\"Please enter a valid email address\");\n      setStatus(\"error\");\n      return;\n    }\n\n    setIsLoading(true);\n    setStatus(\"idle\");\n    setErrorMessage(\"\");\n\n    try {\n      const response = await fetch(\"/api/email-answer\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          firstName: firstName.trim(),\n          email: email.trim(),\n          question: question.trim(),\n          answer: answer.trim(),\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.message || \"Failed to send email\");\n      }\n\n      setStatus(\"success\");\n      setFirstName(\"\");\n      setEmail(\"\");\n      onEmailSent?.();\n    } catch (error) {\n      console.error(\"Email sending error:\", error);\n      setErrorMessage(\n        error instanceof Error ? error.message : \"Failed to send email\",\n      );\n      setStatus(\"error\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (status === \"success\") {\n    return (\n      <div className=\"bg-green-50 border border-green-200 rounded-lg p-6\">\n        <div className=\"flex items-center\">\n          <Check className=\"h-5 w-5 text-green-600 mr-3\" />\n          <div>\n            <h3 className=\"text-green-800 font-medium\">\n              Email sent successfully!\n            </h3>\n            <p className=\"text-green-700 text-sm mt-1\">\n              The answer has been sent to your email address.\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-6\">\n      <div className=\"flex items-center mb-4\">\n        <Mail className=\"h-5 w-5 text-blue-600 mr-2\" />\n        <h3 className=\"text-blue-900 font-medium\">\n          AskEdith Please Email me this answer\n        </h3>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <div>\n          <label\n            htmlFor=\"firstName\"\n            className=\"block text-sm font-medium text-gray-700 mb-1\"\n          >\n            First Name\n          </label>\n          <input\n            type=\"text\"\n            id=\"firstName\"\n            value={firstName}\n            onChange={(e) => setFirstName(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            placeholder=\"Enter your first name\"\n            disabled={isLoading}\n            required\n          />\n        </div>\n\n        <div>\n          <label\n            htmlFor=\"email\"\n            className=\"block text-sm font-medium text-gray-700 mb-1\"\n          >\n            Email Address\n          </label>\n          <input\n            type=\"email\"\n            id=\"email\"\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            placeholder=\"Enter your email address\"\n            disabled={isLoading}\n            required\n          />\n        </div>\n\n        {status === \"error\" && (\n          <div className=\"flex items-center text-red-600 text-sm\">\n            <AlertCircle className=\"h-4 w-4 mr-2\" />\n            {errorMessage}\n          </div>\n        )}\n\n        <button\n          type=\"submit\"\n          disabled={isLoading || !firstName.trim() || !email.trim()}\n          className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n        >\n          {isLoading ? (\n            <>\n              <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n              Sending...\n            </>\n          ) : (\n            \"Please Send\"\n          )}\n        </button>\n      </form>\n    </div>\n  );\n}\n","size_bytes":4782},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/pages/home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport CategoryCard from \"@/components/CategoryCard\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport DOMPurify from \"dompurify\";\n\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  MessageSquare,\n  Users,\n  Heart,\n  Award,\n  Shield,\n  UserCheck,\n  CheckCircle,\n  Clock,\n  Building,\n  Building2,\n  Home,\n  Landmark,\n  Scale,\n  Activity,\n  DollarSign,\n  Plus,\n  Search,\n  Compass,\n  MessageCircle,\n  ArrowUp,\n  Calendar,\n  ChevronDown,\n  ChevronRight,\n  ChevronUp,\n  Flag,\n  ArrowRight,\n  ArrowRightFromLine,\n  CornerDownRight,\n  TrendingUp,\n  Star,\n} from \"lucide-react\";\n\nimport PostCard from \"@/components/PostCard\";\nimport NewPostModal from \"@/components/NewPostModal\";\nimport DynamicDiscussionTopicsSidebar from \"@/components/DynamicDiscussionTopicsSidebar\";\nimport { getCategoryIcon } from \"@/lib/categories\";\nimport MainLayout from \"@/components/MainLayout\";\n\n// Import category images\nimport governmentImg from \"@assets/Government.jpg\";\nimport careAtHomeImg from \"@assets/care_at_home.jpg\";\nimport healthCareImg from \"@assets/health_care.jpg\";\nimport seniorLivingImg from \"@assets/new_senior_living_image.png\";\nimport professionalsImg from \"@assets/professionals.jpg\";\nimport payingForCareImg from \"@assets/paying_for_care.jpg\";\n\n// Map category slugs to images\nconst categoryImages: Record<string, string> = {\n  \"government-resources\": governmentImg,\n  \"home-care\": careAtHomeImg,\n  \"hospital-rehab\": healthCareImg,\n  \"family-finances\": payingForCareImg,\n  professionals: professionalsImg,\n  \"senior-living\": seniorLivingImg,\n  \"paying-for-care\": payingForCareImg,\n};\n\ninterface Category {\n  id: string | number;\n  slug: string;\n  name: string;\n  description?: string;\n  icon?: string;\n  postCount?: number;\n  color?: string;\n}\n\ninterface Post {\n  id: number;\n  title: string;\n  content: string;\n  helpfulVotes: number;\n  commentCount: number;\n  isResolved: boolean;\n  createdAt: string;\n  author: {\n    id: string;\n    firstName: string;\n    lastName: string;\n    profileImageUrl?: string;\n    city?: string;\n    state?: string;\n  };\n  category: {\n    id: number;\n    name: string;\n    slug: string;\n    color: string;\n  };\n  expertVerification?: {\n    id: number;\n    userId: string;\n    profession: string;\n    credentials?: string;\n    verificationStatus: string;\n    verifiedAt?: string;\n    createdAt?: string;\n    expertiseArea?: string;\n    professionalTitle?: string;\n    company?: string;\n    website?: string;\n    linkedinUrl?: string;\n    profileImageUrl?: string;\n    bio?: string;\n    yearsExperience?: number;\n    licenseNumber?: string;\n    verifiedBy?: string;\n    featuredExpert: boolean;\n    updatedAt?: string;\n    blogUrl?: string;\n    booksUrl?: string;\n    articlesUrl?: string;\n    companyAddress?: string;\n    companyWebsite?: string;\n    companyEmail?: string;\n    licenseFileUrl?: string;\n    stripePaymentIntentId?: string;\n    verificationFeeStatus?: string;\n    verificationFeePaidAt?: string;\n    consultationRate?: number;\n    consultationEnabled?: boolean;\n    availabilitySchedule?: string;\n  };\n}\n\nexport default function HomePage() {\n  const [showSignup, setShowSignup] = useState(false);\n  const [showNewPostModal, setShowNewPostModal] = useState(false);\n  const [showNewTopicModal, setShowNewTopicModal] = useState(false);\n  const [sortBy, setSortBy] = useState<\"hot\" | \"new\" | \"top\">(\"top\");\n  const [selectedCategory, setSelectedCategory] = useState<{\n    id: number;\n    name: string;\n  } | null>(null);\n  const [expandedSocialTab, setExpandedSocialTab] = useState<string | null>(\n    null,\n  );\n  const [searchQuery, setSearchQuery] = useState<string | null>(null);\n\n  // Debug logging\n  useEffect(() => {\n    console.log(\"HomePage rendered with selectedCategory:\", selectedCategory);\n    console.log(\"HomePage rendered with expandedSocialTab:\", expandedSocialTab);\n  }, [selectedCategory, expandedSocialTab]);\n\n  // Fetch categories and posts\n  const { data: fetchedCategories } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n    staleTime: 10 * 60 * 1000,\n  });\n\n  const { data: recentPosts } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\", sortBy, selectedCategory?.id],\n    queryFn: async () => {\n      let url = `/api/posts?sortBy=${sortBy}`;\n      if (selectedCategory) {\n        url += `&categoryId=${selectedCategory.id}`;\n      }\n      console.log(\"Fetching posts with URL:\", url);\n      const response = await fetch(url);\n      if (!response.ok) throw new Error(\"Failed to fetch posts\");\n      const data = await response.json();\n      console.log(\"Received posts:\", data.length);\n      return data;\n    },\n    staleTime: 2 * 60 * 1000,\n    enabled: !searchQuery,\n  });\n\n  const { data: searchResults, isLoading: isSearching } = useQuery<Post[]>({\n    queryKey: [\"/api/posts/search\", searchQuery],\n    queryFn: async () => {\n      if (!searchQuery) return [];\n      const response = await fetch(`/api/posts/search?q=${encodeURIComponent(searchQuery)}`);\n      if (!response.ok) throw new Error(\"Failed to search posts\");\n      return response.json();\n    },\n    enabled: !!searchQuery,\n    staleTime: 1 * 60 * 1000,\n  });\n\n  const handleSearch = (query: string) => {\n    setSearchQuery(query);\n    setSelectedCategory(null);\n  };\n\n  const handleClearSearch = () => {\n    setSearchQuery(null);\n  };\n\n  const postsToDisplay = searchQuery ? searchResults : recentPosts;\n\n  // Fetch actual categories from database\n  const { data: dbCategories = [] } = useQuery<Category[]>({\n    queryKey: [\"/api/categories/level/0\"],\n    retry: false,\n  });\n\n  // Fetch social media embeds based on expanded tab\n  const { data: socialMediaEmbeds = [] } = useQuery({\n    queryKey: [\"/api/social-media-embeds\", expandedSocialTab],\n    enabled: !!expandedSocialTab,\n    queryFn: async () => {\n      const response = await fetch(\n        `/api/social-media-embeds/${expandedSocialTab}`,\n      );\n      if (!response.ok) throw new Error(\"Failed to fetch social media embeds\");\n      return response.json();\n    },\n  });\n\n  // Map database categories to display format with appropriate icons\n  const getIconForCategory = (slug: string) => {\n    switch (slug) {\n      case \"government-resources\":\n        return Landmark;\n      case \"home-care\":\n        return Home;\n      case \"hospital-rehab\":\n        return Activity;\n      case \"health-conditions\":\n        return Heart;\n      case \"family-finances\":\n        return DollarSign;\n      case \"professionals\":\n        return UserCheck;\n      case \"senior-living\":\n        return Building;\n      case \"paying-for-senior-living\":\n        return DollarSign;\n      case \"retirement-living-wellness\":\n        return Heart;\n      case \"authors-bloggers-podcasters\":\n        return MessageSquare;\n      case \"books-retirement-directories\":\n        return Building2;\n      case \"helpful-associations\":\n        return Users;\n      default:\n        return Compass;\n    }\n  };\n\n  const getColorForCategory = (slug: string) => {\n    switch (slug) {\n      case \"government-resources\":\n        return \"bg-blue-500\";\n      case \"home-care\":\n        return \"bg-emerald-400\";\n      case \"hospital-rehab\":\n        return \"bg-pink-400\";\n      case \"health-conditions\":\n        return \"bg-red-400\";\n      case \"family-finances\":\n        return \"bg-green-400\";\n      case \"professionals\":\n        return \"bg-blue-400\";\n      case \"senior-living\":\n        return \"bg-orange-400\";\n      case \"paying-for-senior-living\":\n        return \"bg-green-500\";\n      case \"retirement-living-wellness\":\n        return \"bg-purple-400\";\n      case \"authors-bloggers-podcasters\":\n        return \"bg-yellow-400\";\n      case \"books-retirement-directories\":\n        return \"bg-indigo-400\";\n      case \"helpful-associations\":\n        return \"bg-teal-400\";\n      default:\n        return \"bg-gray-400\";\n    }\n  };\n\n  // Transform database categories for display (show first 6)\n  const categories = (dbCategories as any[])?.slice(0, 6).map((cat: any) => ({\n    id: cat.id,\n    name: cat.name,\n    slug: cat.slug,\n    description: cat.description,\n    icon: getIconForCategory(cat.slug),\n    color: getColorForCategory(cat.slug),\n    postCount: cat.postCount || 0,\n  }));\n\n  return (\n    <MainLayout showSidebar={false} sortBy={sortBy} onSortChange={setSortBy} onSearch={handleSearch}>\n      <div className=\"grid lg:grid-cols-12 gap-16\">\n        {/* Dynamic Topics Sidebar - 25% width (3/12) */}\n        <div className=\"lg:col-span-3\">\n          <DynamicDiscussionTopicsSidebar\n            onCategoryClick={(id, name) => {\n              console.log(\"Category clicked:\", id, name);\n              setSelectedCategory({ id, name });\n            }}\n            selectedCategoryId={selectedCategory?.id}\n          />\n\n          <div className=\"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 mt-6\">\n            <h4 className=\"font-semibold text-gray-900 mb-3\">ðŸ’¡ Quick Tips</h4>\n            <div className=\"space-y-3 text-sm text-gray-600\">\n              <div className=\"flex items-start space-x-2\">\n                <Heart className=\"w-4 h-4 mt-0.5 text-pink-500 flex-shrink-0\" />\n                <span>Use clear, descriptive titles for better responses</span>\n              </div>\n              <div className=\"flex items-start space-x-2\">\n                <Users className=\"w-4 h-4 mt-0.5 text-purple-500 flex-shrink-0\" />\n                <span>\n                  Share your location (state/region) for local resources\n                </span>\n              </div>\n              <div className=\"flex items-start space-x-2\">\n                <Shield className=\"w-4 h-4 mt-0.5 text-teal-500 flex-shrink-0\" />\n                <span>Remember to protect personal information</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Main Content - 55% width (7/12) */}\n        <div className=\"lg:col-span-7\">\n          {/* Recent Discussions */}\n          <div className=\"mb-24\">\n            <div className=\"mb-6 ml-3\">\n              <div className=\"mb-4\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  {searchQuery ? (\n                    <>\n                      <div>\n                        <h3 className=\"text-lg font-semibold text-gray-900\">Search Results for</h3>\n                        <div className=\"text-sm font-normal text-gray-700\">{searchQuery}</div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        onClick={handleClearSearch}\n                        className=\"h-8 px-3 text-sm font-medium\"\n                        data-testid=\"clear-search-button\"\n                      >\n                        Clear Search\n                      </Button>\n                    </>\n                  ) : (\n                    <h3 className=\"text-lg font-semibold text-gray-900\">\n                      {selectedCategory ? (\n                        `${selectedCategory.name} Discussions`\n                      ) : (\n                        `${sortBy === \"top\" ? \"Top\" : sortBy === \"new\" ? \"Recent\" : \"Hot\"} Discussions`\n                      )}\n                    </h3>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    onClick={() => {\n                      console.log(\"Today's News button clicked\");\n                      setExpandedSocialTab(\n                        expandedSocialTab === \"todaysnews\"\n                          ? null\n                          : \"todaysnews\",\n                      );\n                    }}\n                    size=\"default\"\n                    className=\"bg-[#0B666B] hover:bg-[#0B666B]/90 text-white border border-black\"\n                  >\n                    Today's News\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      console.log(\"LinkedIn button clicked\");\n                      setExpandedSocialTab(\n                        expandedSocialTab === \"linkedin\" ? null : \"linkedin\",\n                      );\n                    }}\n                    size=\"default\"\n                    className=\"bg-[#0B666B] hover:bg-[#0B666B]/90 text-white border border-black\"\n                  >\n                    LinkedIn\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      console.log(\"X Posts button clicked\");\n                      setExpandedSocialTab(\n                        expandedSocialTab === \"xposts\" ? null : \"xposts\",\n                      );\n                    }}\n                    size=\"default\"\n                    className=\"bg-[#0B666B] hover:bg-[#0B666B]/90 text-white border border-black\"\n                  >\n                    X Posts\n                  </Button>\n                </div>\n              </div>\n\n              {selectedCategory && (\n                <div className=\"mb-2\">\n                  <button\n                    onClick={() => setSelectedCategory(null)}\n                    className=\"text-sm text-gray-600 hover:text-gray-900 underline\"\n                  >\n                    Show All Discussions\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Social Media Accordion */}\n            {expandedSocialTab && (\n              <div className=\"mb-6 bg-white border border-gray-200 rounded-lg shadow-lg p-6 overflow-hidden\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-lg font-semibold\">\n                    {expandedSocialTab === \"todaysnews\" && \"Today's News\"}\n                    {expandedSocialTab === \"linkedin\" && \"LinkedIn Posts\"}\n                    {expandedSocialTab === \"xposts\" && \"X Posts\"}\n                  </h3>\n                  <button\n                    onClick={() => setExpandedSocialTab(null)}\n                    className=\"text-gray-500 hover:text-gray-700\"\n                  >\n                    <ChevronUp className=\"w-5 h-5\" />\n                  </button>\n                </div>\n\n                <div className=\"bg-gray-50 rounded-lg p-6\">\n                    {socialMediaEmbeds.length > 0 ? (\n                      <div className=\"grid grid-cols-1 gap-6\">\n                        {socialMediaEmbeds.map((embed: any) => (\n                          <div key={embed.id} className=\"space-y-2\">\n                            <h4 className=\"font-medium text-gray-700 mb-3\">\n                              {embed.name}\n                            </h4>\n                            {embed.embedCode ? (\n                              <div\n                                className=\"w-full iframe-container\"\n                                style={{\n                                  position: \"relative\",\n                                  width: \"100%\"\n                                }}\n                                dangerouslySetInnerHTML={{\n                                  __html: DOMPurify.sanitize(embed.embedCode, {\n                                    ALLOWED_TAGS: [\n                                      \"iframe\",\n                                      \"div\",\n                                      \"script\",\n                                      \"a\",\n                                      \"img\",\n                                      \"p\",\n                                      \"span\",\n                                      \"h1\",\n                                      \"h2\",\n                                      \"h3\",\n                                      \"h4\",\n                                      \"h5\",\n                                      \"h6\",\n                                    ],\n                                    ALLOWED_ATTR: [\n                                      \"src\",\n                                      \"href\",\n                                      \"width\",\n                                      \"height\",\n                                      \"frameborder\",\n                                      \"allowfullscreen\",\n                                      \"style\",\n                                      \"class\",\n                                      \"id\",\n                                      \"target\",\n                                      \"rel\",\n                                      \"alt\",\n                                    ],\n                                    ADD_TAGS: [\"script\"],\n                                    ADD_ATTR: [\n                                      \"allow\",\n                                      \"allowfullscreen\",\n                                      \"frameborder\",\n                                      \"scrolling\",\n                                    ],\n                                  }),\n                                }}\n                              />\n                            ) : (\n                              <div className=\"text-gray-400 text-sm italic\">\n                                No embed code added yet\n                              </div>\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center justify-center h-full\">\n                        <div className=\"text-center\">\n                          <p className=\"text-gray-500 mb-4\">\n                            No embed content available yet.\n                          </p>\n                          <p className=\"text-sm text-gray-400\">\n                            Admin can add test RSS.app embed code here\n                          </p>\n                        </div>\n                      </div>\n                    )}\n                </div>\n              </div>\n            )}\n\n            <div className=\"space-y-4\">\n              {isSearching ? (\n                <div className=\"text-center py-12\">\n                  <p className=\"text-gray-500\">Searching...</p>\n                </div>\n              ) : searchQuery && (!postsToDisplay || postsToDisplay.length === 0) ? (\n                <div className=\"text-center py-12\" data-testid=\"no-results-message\">\n                  <p className=\"text-gray-500 text-lg mb-2\">No results found for \"{searchQuery}\"</p>\n                  <p className=\"text-gray-400 text-sm\">Try different keywords or browse all discussions</p>\n                </div>\n              ) : Array.isArray(postsToDisplay) && postsToDisplay.length > 0 ? (\n                postsToDisplay.map((post) => (\n                  <PostCard key={post.id} post={post} />\n                ))\n              ) : (\n                <div className=\"text-center py-12\">\n                  <p className=\"text-gray-500\">No discussions yet</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Categories Section - Hidden for now */}\n          {false && (\n            <div className=\"mb-16\">\n              <div className=\"text-center mb-12\">\n                <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n                  Find Support in Your Area of Need\n                </h2>\n                <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n                  Connect with caregivers facing similar challenges. Our\n                  community is organized by care areas to help you find the most\n                  relevant support and advice.\n                </p>\n              </div>\n\n              {Array.isArray(dbCategories) && dbCategories.length > 0 && (\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto\">\n                  {(dbCategories as any[]).slice(0, 6).map((category: any) => (\n                    <CategoryCard\n                      key={category.id}\n                      category={category}\n                      categoryImage={categoryImages[category.slug]}\n                      onJoinClick={() => setShowNewPostModal(true)}\n                      onExploreClick={() =>\n                        (window.location.href = `/category/${category.slug}`)\n                      }\n                      compact={true}\n                    />\n                  ))}\n                </div>\n              )}\n\n              {/* And Much More Button */}\n              <div className=\"text-center mt-8\">\n                <Button\n                  variant=\"outline\"\n                  className=\"px-8 py-3 text-lg font-semibold border-askEdithTeal text-askEdithTeal hover:bg-askEdithTeal hover:text-white\"\n                  onClick={() => setShowNewPostModal(true)}\n                >\n                  And Much More\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Right Sidebar - 20% width (2/12) for Advertisers */}\n        <div className=\"lg:col-span-2\">\n          <div\n            className=\"bg-gray-50 rounded-xl border border-white shadow-sm p-4\"\n            style={{ minHeight: \"1176px\" }}\n          >\n            <div className=\"text-center text-gray-500 text-xs mb-4\">Ads</div>\n            {/* Future advertiser content will go here */}\n          </div>\n        </div>\n      </div>\n\n      {/* Bottom Hero Section - Hidden for now */}\n      {false && (\n        <section className=\"py-20\" style={{ backgroundColor: \"#487d7a\" }}>\n          <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n            <div className=\"mb-12\">\n              <h2 className=\"text-4xl font-bold text-white mb-4\">\n                You're Not Alone in This Journey\n              </h2>\n              <p className=\"text-xl text-white mb-8 max-w-2xl mx-auto\">\n                Join thousands of family caregivers who share resources, advice,\n                and support every day.\n              </p>\n              <div className=\"flex justify-center space-x-8 mb-8\">\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-white\">8,000+</div>\n                  <div className=\"text-white\">Active Members</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-white\">25,000+</div>\n                  <div className=\"text-white\">Questions Answered</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-white\">50+</div>\n                  <div className=\"text-white\">Expert Contributors</div>\n                </div>\n              </div>\n              <div className=\"space-y-3 text-white max-w-2xl mx-auto\">\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span>Get answers from experienced caregivers</span>\n                </div>\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span>Access vetted resources and expert advice</span>\n                </div>\n                <div className=\"flex items-center justify-center space-x-2\">\n                  <CheckCircle className=\"w-5 h-5\" />\n                  <span>Connect with others in your area</span>\n                </div>\n              </div>\n            </div>\n            <div className=\"space-x-4\">\n              <Button\n                size=\"lg\"\n                className=\"bg-white text-teal-700 hover:bg-gray-100 px-8\"\n                onClick={() => setShowNewPostModal(true)}\n              >\n                <MessageSquare className=\"w-5 h-5 mr-2\" />\n                Ask Your First Question\n              </Button>\n              <Button\n                size=\"lg\"\n                variant=\"outline\"\n                className=\"border-white text-white hover:bg-white hover:text-teal-700 px-8\"\n                onClick={() => setShowSignup(true)}\n              >\n                Join Our Community\n              </Button>\n            </div>\n          </div>\n        </section>\n      )}\n\n      {/* New Post Modal */}\n      {showNewPostModal && (\n        <NewPostModal\n          open={showNewPostModal}\n          onClose={() => setShowNewPostModal(false)}\n          mode=\"post\"\n        />\n      )}\n\n      {/* New Topic Modal */}\n      {showNewTopicModal && (\n        <NewPostModal\n          open={showNewTopicModal}\n          onClose={() => setShowNewTopicModal(false)}\n          mode=\"topic\"\n        />\n      )}\n    </MainLayout>\n  );\n}\n","size_bytes":24611},"client/src/components/DiscussionTopicsSidebar.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Compass,\n  ChevronDown,\n  ChevronRight,\n  Heart,\n  Users,\n  Shield,\n  Plus,\n} from \"lucide-react\";\n\ninterface Topic {\n  name: string;\n  count: number;\n  color: string;\n  subtopics: string[];\n}\n\ninterface TopicGroup {\n  groupName: string;\n  topics: Topic[];\n}\n\ninterface Forum {\n  id: number;\n  name: string;\n  slug: string;\n  postCount: number;\n}\n\ninterface CategoryHierarchyItem {\n  id: number;\n  name: string;\n  postCount: number;\n  children?: CategoryHierarchyItem[];\n}\n\nexport default function DiscussionTopicsSidebar() {\n  const [expandedTopics, setExpandedTopics] = useState<Record<string, boolean>>({});\n  const [expandedGroups, setExpandedGroups] = useState<Record<string, boolean>>({});\n\n  // Fetch dynamic data from database\n  const { data: discussionForums = [] } = useQuery<Forum[]>({\n    queryKey: ['/api/categories/level/0'],\n    retry: false,\n  });\n\n  const { data: categoryHierarchy = [] } = useQuery<CategoryHierarchyItem[]>({\n    queryKey: ['/api/categories/hierarchy'],\n    retry: false,\n  });\n\n  const toggleTopic = (topicName: string) => {\n    setExpandedTopics(prev => ({\n      ...prev,\n      [topicName]: !prev[topicName]\n    }));\n  };\n\n  const toggleGroup = (groupName: string) => {\n    setExpandedGroups(prev => ({\n      ...prev,\n      [groupName]: !prev[groupName]\n    }));\n  };\n\n  // Build topic groups from database data\n  const topicGroups: TopicGroup[] = discussionForums.map((forum: Forum) => {\n    const forumData = categoryHierarchy.find((item: CategoryHierarchyItem) => item.id === forum.id);\n    const mainTopics = forumData?.children || [];\n    \n    return {\n      groupName: forum.name,\n      topics: mainTopics.map((mainTopic: CategoryHierarchyItem) => ({\n        name: mainTopic.name,\n        count: mainTopic.postCount || 0,\n        color: getColorForTopic(mainTopic.name),\n        subtopics: (mainTopic.children || []).map((subTopic: CategoryHierarchyItem) => subTopic.name)\n      }))\n    };\n  });\n\n  // Helper function to assign colors based on topic names\n  function getColorForTopic(topicName: string): string {\n    const colorMap: Record<string, string> = {\n      \"Federal & State Resources\": \"bg-teal-100\",\n      \"Veteran Benefits\": \"bg-red-100\", \n      \"Medicare\": \"bg-blue-100\",\n      \"Medicaid\": \"bg-pink-100\",\n      \"Home Care Services\": \"bg-emerald-100\",\n      \"ADUs & Home Modifications\": \"bg-orange-100\",\n      \"Selling a Home\": \"bg-yellow-100\",\n      \"Senior Living Options\": \"bg-purple-100\",\n      \"Respite Care\": \"bg-indigo-100\",\n      \"Hospice Care\": \"bg-gray-100\"\n    };\n    return colorMap[topicName] || \"bg-gray-100\";\n  }\n\n  // Legacy hardcoded structure (keeping as fallback but shouldn't be used)\n  const legacyTopicGroups: TopicGroup[] = [\n    {\n      groupName: \"Government Resources\",\n      topics: [\n        {\n          name: \"Federal & State Resources\",\n          count: 98,\n          color: \"bg-teal-100\",\n          subtopics: [\"Area Agencies on Aging\", \"Long-Term Care Ombudsman\", \"Adult Protective Services\", \"Adult Day Centers\", \"Meals on Wheels\", \"Transportation\", \"Friendship Line\", \"Suicide Prevention Hotline\", \"Tax Filing Help\"]\n        },\n        {\n          name: \"Veteran Benefits\",\n          count: 45,\n          color: \"bg-red-100\",\n          subtopics: [\"VA Healthcare\", \"Disability Benefits\", \"Military Discounts\", \"Veteran Services\", \"GI Bill Benefits\"]\n        },\n        {\n          name: \"Medicare\",\n          count: 189,\n          color: \"bg-blue-100\",\n          subtopics: [\"Medicare Part A & B\", \"Medicare Part C\", \"Medicare Part D\"]\n        },\n        {\n          name: \"Medicaid\",\n          count: 112,\n          color: \"bg-pink-100\",\n          subtopics: [\"Qualifying for Medicaid\", \"Lookback Periods\", \"State Claims\", \"Filing Assistance\"]\n        }\n      ]\n    },\n    {\n      groupName: \"Home & Care Services\",\n      topics: [\n        {\n          name: \"Home Care\",\n          count: 156,\n          color: \"bg-emerald-100\",\n          subtopics: [\"Recommended Agencies\", \"Managing Home Care Aides\", \"Negotiating with Home Care Agencies\", \"Typical Contract Periods\"]\n        },\n        {\n          name: \"ADUs & Home Modifications\",\n          count: 34,\n          color: \"bg-green-100\",\n          subtopics: [\"Accessibility Modifications\", \"Safety Features\", \"ADU Construction\", \"Home Assessments\"]\n        },\n        {\n          name: \"Selling a Home\",\n          count: 28,\n          color: \"bg-yellow-100\",\n          subtopics: [\"Market Preparation\", \"Senior-Friendly Realtors\", \"Moving Assistance\", \"Estate Sales\"]\n        },\n        {\n          name: \"Senior Living\",\n          count: 134,\n          color: \"bg-orange-100\",\n          subtopics: [\"Senior Apartments\", \"Active Adult\", \"Independent Living\", \"Assisted Living\", \"Memory Care\", \"Life Plan Communities\", \"CCRCs\"]\n        },\n        {\n          name: \"Respite Care\",\n          count: 42,\n          color: \"bg-indigo-100\",\n          subtopics: [\"Adult Day Programs\", \"Overnight Respite\", \"Family Relief\", \"Caregiver Support\"]\n        },\n        {\n          name: \"Hospice\",\n          count: 38,\n          color: \"bg-purple-100\",\n          subtopics: [\"End-of-Life Planning\", \"Comfort Care\", \"Family Support\", \"Grief Resources\"]\n        }\n      ]\n    },\n    {\n      groupName: \"Financial Planning\",\n      topics: [\n        {\n          name: \"Paying for Senior Living\",\n          count: 89,\n          color: \"bg-purple-100\",\n          subtopics: [\"Cost Planning\", \"Financial Assessment\", \"Payment Options\", \"Veterans Benefits\"]\n        },\n        {\n          name: \"Long-Term Care Insurance\",\n          count: 67,\n          color: \"bg-blue-100\",\n          subtopics: [\"Understanding Policies\", \"Claims Assistance\", \"Elimination Periods in Policies\"]\n        },\n        {\n          name: \"Life Settlements\",\n          count: 23,\n          color: \"bg-amber-100\",\n          subtopics: [\"Policy Evaluation\", \"Settlement Process\", \"Tax Implications\", \"Buyer Selection\"]\n        }\n      ]\n    },\n    {\n      groupName: \"Professionals\",\n      topics: [\n        {\n          name: \"Elder Law Attorneys\",\n          count: 76,\n          color: \"bg-amber-100\",\n          subtopics: [\"Power of Attorney\", \"Trust & Estates\", \"Family Fights\", \"Guardianship\"]\n        },\n        {\n          name: \"Aging Life Care Professionals\",\n          count: 52,\n          color: \"bg-cyan-100\",\n          subtopics: [\"Care Management\", \"Assessment Services\", \"Resource Coordination\", \"Family Support\"]\n        },\n        {\n          name: \"Senior Living Finders\",\n          count: 34,\n          color: \"bg-emerald-100\",\n          subtopics: [\"Community Research\", \"Placement Services\", \"Tour Coordination\", \"Contract Negotiation\"]\n        },\n        {\n          name: \"Other Care Professionals\",\n          count: 89,\n          color: \"bg-blue-100\",\n          subtopics: [\"Geriatricians\", \"Social Workers\", \"Therapists\", \"Care Coordinators\"]\n        }\n      ]\n    },\n    {\n      groupName: \"Health Conditions\",\n      topics: [\n        {\n          name: \"Alzheimer's & Dementia\",\n          count: 203,\n          color: \"bg-purple-100\",\n          subtopics: [\"Early Signs & Diagnosis\", \"Memory Care Options\", \"Behavioral Management\", \"Family Support\", \"Legal Planning\", \"Safety Modifications\"]\n        },\n        {\n          name: \"Parkinsons\",\n          count: 87,\n          color: \"bg-red-100\",\n          subtopics: [\"Movement Disorders\", \"Medication Management\", \"Physical Therapy\", \"Support Groups\"]\n        },\n        {\n          name: \"Strokes & Heart Issues\",\n          count: 94,\n          color: \"bg-pink-100\",\n          subtopics: [\"Recovery Planning\", \"Rehabilitation\", \"Lifestyle Changes\", \"Prevention\"]\n        },\n        {\n          name: \"Other Diseases\",\n          count: 156,\n          color: \"bg-gray-100\",\n          subtopics: [\"Diabetes Management\", \"Arthritis Care\", \"Chronic Conditions\", \"Pain Management\"]\n        }\n      ]\n    }\n  ];\n\n  // Initialize all groups as open by default\n  useEffect(() => {\n    const initialGroupState: Record<string, boolean> = {};\n    topicGroups.forEach(group => {\n      initialGroupState[group.groupName] = true;\n    });\n    setExpandedGroups(initialGroupState);\n  }, []);\n\n  return (\n    <div className=\"sticky top-8\">\n      <div className=\"bg-white rounded-xl shadow-sm mb-6 overflow-hidden\">\n        <div className=\"p-4 mb-4 bg-[#0B666B]/90\">\n          <h3 className=\"text-lg font-semibold text-white mb-0 flex items-center\">\n            <Compass className=\"w-5 h-5 mr-2 text-white\" />\n            Discussion Forums\n          </h3>\n        </div>\n        <div className=\"px-6 pb-6\">\n          <div className=\"space-y-6\">\n            {topicGroups.map((group, groupIndex) => (\n              <div key={groupIndex} className=\"space-y-2\">\n                {/* Group Header */}\n                <div \n                  className=\"text-xs font-semibold text-gray-600 uppercase tracking-wide mb-3 bg-green-50 px-3 py-2 rounded-lg border-l-4 border-green-200 cursor-pointer hover:bg-green-100 transition-colors flex items-center justify-between\"\n                  onClick={() => toggleGroup(group.groupName)}\n                >\n                  <span>{group.groupName}</span>\n                  {expandedGroups[group.groupName] ? \n                    <ChevronDown className=\"w-4 h-4 text-gray-500\" /> :\n                    <ChevronRight className=\"w-4 h-4 text-gray-500\" />\n                  }\n                </div>\n                \n                {/* Topics in this group */}\n                {expandedGroups[group.groupName] && group.topics.map((topic, topicIndex) => (\n                  <div key={topicIndex} className=\"border-b border-gray-100 last:border-b-0\">\n                    <div \n                      className=\"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\"\n                      onClick={() => toggleTopic(topic.name)}\n                    >\n                      <div className=\"flex items-center space-x-3\">\n                        <div className={`w-3 h-3 rounded-full ${topic.color}`}></div>\n                        <span className=\"text-sm text-gray-700\">{topic.name}</span>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <span className=\"text-[11px] text-gray-500\">{topic.count}</span>\n                        {topic.subtopics.length > 0 && (\n                          expandedTopics[topic.name] ? \n                            <ChevronDown className=\"w-4 h-4 text-gray-400\" /> :\n                            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                        )}\n                      </div>\n                    </div>\n                    \n                    {expandedTopics[topic.name] && topic.subtopics.length > 0 && (\n                      <div className=\"ml-6 pb-3 space-y-1\">\n                        {topic.subtopics.map((subtopic, subIndex) => (\n                          <div key={subIndex} className=\"flex items-center p-2 text-xs text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded cursor-pointer transition-colors\">\n                            <div className=\"w-2 h-2 bg-gray-300 rounded-full mr-3\"></div>\n                            {subtopic}\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                ))}\n                \n                {/* Visual buffer between groups (except last group) */}\n                {groupIndex < topicGroups.length - 1 && (\n                  <div className=\"h-4\"></div>\n                )}\n              </div>\n            ))}\n            \n            {/* Create Your Own Forum Button */}\n            <div className=\"mt-4 pt-3 border-t border-gray-200\">\n              <button\n                className=\"w-full flex items-center justify-center py-3 px-4 text-sm font-medium text-teal-600 bg-teal-50 hover:bg-teal-100 rounded-lg transition-colors duration-150 group\"\n                onClick={() => {\n                  // TODO: Add modal or navigation to create forum functionality\n                  console.log('Create Your Own Forum clicked');\n                }}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Create Your Own Forum\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6\">\n        <h4 className=\"font-semibold text-gray-900 mb-3\">ðŸ’¡ Quick Tips</h4>\n        <div className=\"space-y-3 text-sm text-gray-600\">\n          <div className=\"flex items-start space-x-2\">\n            <Heart className=\"w-4 h-4 mt-0.5 text-pink-500 flex-shrink-0\" />\n            <span>Use clear, descriptive titles for better responses</span>\n          </div>\n          <div className=\"flex items-start space-x-2\">\n            <Users className=\"w-4 h-4 mt-0.5 text-purple-500 flex-shrink-0\" />\n            <span>Share your location (state/region) for local resources</span>\n          </div>\n          <div className=\"flex items-start space-x-2\">\n            <Shield className=\"w-4 h-4 mt-0.5 text-teal-500 flex-shrink-0\" />\n            <span>Remember to protect personal information</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":13378},"client/src/pages/ExpertProfile.tsx":{"content":"import { Calendar, MapPin, Award, ExternalLink, CheckCircle, Linkedin, Clock, Star } from \"lucide-react\";\nimport { Link, useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport ExpertBadge from \"@/components/ExpertBadge\";\nimport type { PostWithAuthorAndCategory } from \"@shared/schema\";\n\ninterface ExpertData {\n  id: string;\n  username: string;\n  firstName: string;\n  lastName: string;\n  profileImageUrl?: string;\n  bio?: string;\n  expertise?: string[];\n  hourlyRate: number;\n  stripeConnectAccountId?: string;\n  consultationEnabled: boolean;\n  profession?: string;\n  company?: string;\n  expertiseArea?: string;\n  credentials?: string;\n  linkedinUrl?: string;\n  verifiedAt?: string;\n  consultationRate?: number;\n  // Added fields for badge logic\n  role: string;\n  approved: string;\n  verificationStatus: string;\n  // Appointment booking fields\n  allowBooking?: boolean;\n  calendlyLink?: string;\n}\n\n// Determine expert status based on role, approval, and verification\nconst getExpertStatus = (expert: ExpertData) => {\n  if (expert.role !== 'expert') return null;\n  \n  if (expert.approved === 'no') {\n    return { type: 'waiting', label: 'Waiting for Approval', color: 'bg-orange-100 text-orange-700' };\n  }\n  \n  if (expert.approved === 'yes' && expert.verificationStatus === 'verified') {\n    return { type: 'verified', label: 'Verified Expert', color: 'bg-green-100 text-green-700' };\n  }\n  \n  if (expert.approved === 'yes') {\n    return { type: 'approved', label: 'Verified Expert', color: 'bg-blue-100 text-blue-700' };\n  }\n  \n  return null;\n};\n\nexport default function ExpertProfile() {\n  const [match, params] = useRoute('/expert/:id');\n  const expertId = params?.id;\n\n  const { data: expert, isLoading, error } = useQuery<ExpertData>({\n    queryKey: ['/api/experts', expertId, 'profile'],\n    enabled: !!expertId,\n  });\n\n  const { data: expertPosts } = useQuery<PostWithAuthorAndCategory[]>({\n    queryKey: ['/api/posts/user', expertId],\n    enabled: !!expertId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  if (error || !expert) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Expert Not Found</h2>\n          <p className=\"text-gray-600 mb-6\">The expert profile you're looking for doesn't exist.</p>\n          <Link href=\"/experts\">\n            <Button>Back to Expert Directory</Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const postCount = expertPosts?.length || 0;\n  const expertLevel = postCount >= 100 ? 'gold' : postCount >= 50 ? 'silver' : 'bronze';\n  const expertStatus = getExpertStatus(expert);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        \n        {/* Header */}\n        <div className=\"bg-white rounded-2xl shadow-sm p-8 mb-6\">\n          <div className=\"flex items-start space-x-6\">\n            <Avatar className=\"w-24 h-24\">\n              <AvatarImage src={expert.profileImageUrl} />\n              <AvatarFallback className=\"bg-teal-500 text-white text-2xl\">\n                {expert.firstName?.[0]}{expert.lastName?.[0]}\n              </AvatarFallback>\n            </Avatar>\n            \n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-3 mb-2\">\n                <h1 className=\"text-3xl font-bold text-gray-900\">\n                  {expert.firstName} {expert.lastName}\n                </h1>\n                {expertStatus && (\n                  <Badge \n                    className={`${expertStatus.color} flex items-center gap-1`}\n                    data-testid={`badge-expert-${expertStatus.type}`}\n                  >\n                    {expertStatus.type === 'verified' && <CheckCircle className=\"w-3 h-3\" />}\n                    {expertStatus.type === 'waiting' && <Clock className=\"w-3 h-3\" />}\n                    {expertStatus.type === 'approved' && <Star className=\"w-3 h-3\" />}\n                    {expertStatus.label}\n                  </Badge>\n                )}\n                <ExpertBadge level={expertLevel} postCount={postCount} />\n              </div>\n              \n              <p className=\"text-xl text-gray-700 mb-3\">{expert.profession}</p>\n              <p className=\"text-lg text-gray-600 mb-3\">{expert.company}</p>\n              \n              <div className=\"flex items-center gap-4 text-sm text-gray-500 mb-4\">\n                <span className=\"flex items-center gap-1\">\n                  <MapPin className=\"w-4 h-4\" />\n                  Location not specified\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <Award className=\"w-4 h-4\" />\n                  15+ years experience\n                </span>\n                <span>{postCount} community posts</span>\n              </div>\n              \n              <div className=\"flex items-center gap-3\">\n                {expert.allowBooking && \n                 expert.calendlyLink && \n                 expert.approved === 'yes' && \n                 expert.hourlyRate && (\n                  <Button \n                    className=\"bg-teal-600 hover:bg-teal-700 flex items-center gap-2\"\n                    asChild\n                    data-testid=\"button-book-consultation\"\n                  >\n                    <a \n                      href={expert.calendlyLink} \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                    >\n                      <Calendar className=\"w-4 h-4\" />\n                      Book Consultation - ${expert.hourlyRate}/hour\n                    </a>\n                  </Button>\n                )}\n                {expert.allowBooking && \n                 expert.calendlyLink && \n                 expert.approved === 'yes' && \n                 expert.verificationStatus === 'verified' && (\n                  <Button \n                    className=\"bg-teal-600 hover:bg-teal-700 flex items-center gap-2\"\n                    asChild\n                    data-testid=\"button-book-appointment\"\n                  >\n                    <a \n                      href={expert.calendlyLink} \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                    >\n                      <Calendar className=\"w-4 h-4\" />\n                      Book Appointment\n                    </a>\n                  </Button>\n                )}\n                {expert.linkedinUrl && (\n                  <Button variant=\"outline\" className=\"flex items-center gap-2\" asChild>\n                    <a href={expert.linkedinUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                      <Linkedin className=\"w-4 h-4\" />\n                      View LinkedIn Profile\n                    </a>\n                  </Button>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6\">\n          \n          {/* Left Column - Bio & Credentials */}\n          <div className=\"md:col-span-2 space-y-6\">\n            \n            {/* About */}\n            <Card className=\"p-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">About {expert.firstName} {expert.lastName}</h2>\n              <p className=\"text-gray-700 leading-relaxed\">{expert.bio}</p>\n            </Card>\n\n            {/* Expertise Areas */}\n            <Card className=\"p-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Areas of Expertise</h2>\n              <div className=\"flex flex-wrap gap-2\">\n                {expert.expertiseArea && (\n                  <Badge variant=\"secondary\" className=\"bg-teal-50 text-teal-700\">\n                    {expert.expertiseArea}\n                  </Badge>\n                )}\n              </div>\n            </Card>\n\n            {/* Recent Community Contributions */}\n            <Card className=\"p-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Recent Community Contributions</h2>\n              <div className=\"space-y-4\">\n                <div className=\"border-l-4 border-teal-500 pl-4\">\n                  <h3 className=\"font-medium text-gray-900\">Fall Prevention Strategies for Seniors</h3>\n                  <p className=\"text-sm text-gray-600 mt-1\">Comprehensive guide on home safety modifications and exercises to reduce fall risk...</p>\n                  <span className=\"text-xs text-gray-500\">2 days ago â€¢ 45 helpful votes</span>\n                </div>\n                <div className=\"border-l-4 border-teal-500 pl-4\">\n                  <h3 className=\"font-medium text-gray-900\">Managing Multiple Medications Safely</h3>\n                  <p className=\"text-sm text-gray-600 mt-1\">Tips for organizing pills, avoiding interactions, and working with your healthcare team...</p>\n                  <span className=\"text-xs text-gray-500\">1 week ago â€¢ 62 helpful votes</span>\n                </div>\n              </div>\n            </Card>\n          </div>\n\n          {/* Right Column - Quick Info */}\n          <div className=\"space-y-6\">\n            \n            {/* Credentials */}\n            <Card className=\"p-6\">\n              <h3 className=\"text-lg font-semibold text-teal-700 mb-3\">Credentials</h3>\n              <div className=\"text-gray-700\">\n                {expert.credentials?.split('\\n').map((credential, index) => (\n                  <div key={index}>\n                    <div className=\"text-sm py-1\">{credential}</div>\n                    {index < expert.credentials!.split('\\n').length - 1 && (\n                      <div className=\"border-b border-teal-700 my-1\" style={{ borderBottomWidth: '0.5px' }}></div>\n                    )}\n                  </div>\n                ))}\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2\">Verified {expert.verifiedAt ? new Date(expert.verifiedAt).toLocaleDateString() : 'Recently verified'}</p>\n            </Card>\n\n            {/* Consultation Info */}\n            {expert.consultationEnabled && (\n              <Card className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">Consultation Details</h3>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Rate:</span>\n                    <span className=\"font-medium\">${expert.hourlyRate}/hour</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Response time:</span>\n                    <span className=\"font-medium text-green-600\">Usually within 24 hours</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Consultations:</span>\n                    <span className=\"font-medium\">Video or Phone</span>\n                  </div>\n                </div>\n                {expert.calendlyLink ? (\n                  <Button \n                    className=\"w-full mt-4 bg-teal-600 hover:bg-teal-700\"\n                    asChild\n                    data-testid=\"button-schedule-consultation\"\n                  >\n                    <a \n                      href={expert.calendlyLink} \n                      target=\"_blank\" \n                      rel=\"noopener noreferrer\"\n                    >\n                      Schedule Consultation\n                    </a>\n                  </Button>\n                ) : (\n                  <Button \n                    className=\"w-full mt-4 bg-gray-400 cursor-not-allowed\" \n                    disabled\n                  >\n                    Calendly Link Not Available\n                  </Button>\n                )}\n              </Card>\n            )}\n\n            {/* Community Stats */}\n            <Card className=\"p-6\">\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">Community Impact</h3>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Posts this year:</span>\n                  <span className=\"font-medium\">{postCount}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Helpful votes:</span>\n                  <span className=\"font-medium\">2,847</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">People helped:</span>\n                  <span className=\"font-medium\">1,200+</span>\n                </div>\n              </div>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":13260},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/VoteButton.tsx":{"content":"import React, { useState } from 'react';\nimport { useMutation, useQueryClient, useQuery } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { ArrowUp, ArrowDown, Loader2 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface VoteButtonProps {\n  contentId: number;\n  contentType: 'post' | 'comment';\n  initialVotes: number;\n  initialUserVote?: 'up' | 'down' | null;\n  userId?: string; // If user is logged in\n  compact?: boolean;\n}\n\nexport function VoteButton({ \n  contentId, \n  contentType, \n  initialVotes, \n  initialUserVote = null,\n  userId,\n  compact = false \n}: VoteButtonProps) {\n  const [votes, setVotes] = useState(initialVotes);\n  const [userVote, setUserVote] = useState<'up' | 'down' | null>(initialUserVote);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch current user vote if authenticated\n  const { data: currentUserVote } = useQuery<{ voteType: 'up' | 'down' | null }>({\n    queryKey: [`/api/${contentType}s/${contentId}/vote`],\n    enabled: !!userId,\n    retry: false,\n  });\n\n  // Handle vote data when it changes\n  React.useEffect(() => {\n    if (currentUserVote?.voteType) {\n      setUserVote(currentUserVote.voteType);\n    }\n  }, [currentUserVote]);\n\n  const voteMutation = useMutation({\n    mutationFn: async (voteType: 'up' | 'down') => {\n      const response = await fetch(`/api/${contentType}s/${contentId}/vote`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ voteType }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to vote');\n      }\n\n      return response.json();\n    },\n    onMutate: async (voteType) => {\n      // Optimistic update\n      const oldVote = userVote;\n      const oldVotes = votes;\n      \n      let newVotes = oldVotes;\n      let newUserVote: 'up' | 'down' | null = voteType;\n\n      if (oldVote === voteType) {\n        // Removing vote (toggle off)\n        newUserVote = null;\n        newVotes = oldVotes + (voteType === 'up' ? -1 : 1);\n      } else if (oldVote && oldVote !== voteType) {\n        // Changing vote\n        newVotes = oldVotes + (voteType === 'up' ? 2 : -2);\n      } else {\n        // Adding new vote\n        newVotes = oldVotes + (voteType === 'up' ? 1 : -1);\n      }\n\n      setUserVote(newUserVote);\n      setVotes(Math.max(0, newVotes));\n\n      return { oldVote, oldVotes };\n    },\n    onError: (error: any, voteType, context) => {\n      // Revert optimistic update on error\n      if (context) {\n        setUserVote(context.oldVote);\n        setVotes(context.oldVotes);\n      }\n      \n      if (error.message?.includes('Unauthorized') || error.message?.includes('authentication')) {\n        toast({\n          title: \"Login Required\",\n          description: \"Please sign in to vote on content.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Vote Failed\",\n          description: error.message || \"Failed to record your vote. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onSuccess: (data) => {\n      // Update with server response\n      if (data) {\n        setVotes(data.helpfulVotes || votes);\n      }\n      \n      // Invalidate related queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [`/api/${contentType}s`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/${contentType}s/${contentId}`] });\n      \n      // Show success feedback for first vote\n      if (!initialUserVote && userVote) {\n        toast({\n          title: \"Vote Recorded\",\n          description: `Your ${userVote === 'up' ? 'upvote' : 'downvote'} has been recorded.`,\n          duration: 2000,\n        });\n      }\n    },\n  });\n\n  const handleVote = (voteType: 'up' | 'down') => {\n    if (!userId) {\n      toast({\n        title: \"Login Required\",\n        description: \"Please sign in to vote on content.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    voteMutation.mutate(voteType);\n  };\n\n  if (compact) {\n    return (\n      <div className=\"flex items-center space-x-1\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => handleVote('up')}\n          className={`h-6 w-6 p-0 ${userVote === 'up' ? 'text-green-600 bg-green-50' : 'text-gray-400 hover:text-green-600'}`}\n          disabled={voteMutation.isPending || !userId}\n        >\n          {voteMutation.isPending && voteMutation.variables === 'up' ? (\n            <Loader2 className=\"w-3 h-3 animate-spin\" />\n          ) : (\n            <ArrowUp className=\"w-3 h-3\" />\n          )}\n        </Button>\n        <span className=\"text-xs font-medium text-gray-600 min-w-[20px] text-center\">\n          {votes}\n        </span>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => handleVote('down')}\n          className={`h-6 w-6 p-0 ${userVote === 'down' ? 'text-red-600 bg-red-50' : 'text-gray-400 hover:text-red-600'}`}\n          disabled={voteMutation.isPending || !userId}\n        >\n          {voteMutation.isPending && voteMutation.variables === 'down' ? (\n            <Loader2 className=\"w-3 h-3 animate-spin\" />\n          ) : (\n            <ArrowDown className=\"w-3 h-3\" />\n          )}\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col items-center space-y-1 bg-gray-50 rounded-lg p-2\">\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={() => handleVote('up')}\n        className={`h-8 w-8 p-0 rounded-md transition-colors ${\n          userVote === 'up' \n            ? 'text-green-600 bg-green-100 hover:bg-green-200' \n            : 'text-gray-400 hover:text-green-600 hover:bg-green-50'\n        }`}\n        disabled={voteMutation.isPending || !userId}\n        title={!userId ? \"Login to vote\" : userVote === 'up' ? \"Remove upvote\" : \"Upvote\"}\n      >\n        {voteMutation.isPending && voteMutation.variables === 'up' ? (\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n        ) : (\n          <ArrowUp className=\"w-4 h-4\" />\n        )}\n      </Button>\n      \n      <span className=\"text-sm font-semibold text-gray-700 min-w-[24px] text-center\">\n        {votes}\n      </span>\n      \n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={() => handleVote('down')}\n        className={`h-8 w-8 p-0 rounded-md transition-colors ${\n          userVote === 'down' \n            ? 'text-red-600 bg-red-100 hover:bg-red-200' \n            : 'text-gray-400 hover:text-red-600 hover:bg-red-50'\n        }`}\n        disabled={voteMutation.isPending || !userId}\n        title={!userId ? \"Login to vote\" : userVote === 'down' ? \"Remove downvote\" : \"Downvote\"}\n      >\n        {voteMutation.isPending && voteMutation.variables === 'down' ? (\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n        ) : (\n          <ArrowDown className=\"w-4 h-4\" />\n        )}\n      </Button>\n      \n      {!userId && (\n        <p className=\"text-xs text-gray-500 text-center mt-2\">\n          Login to vote\n        </p>\n      )}\n    </div>\n  );\n}\n\n// Example usage in a post component\nexport function PostWithVoting({ post, user }: { post: any; user: any }) {\n  return (\n    <div className=\"bg-white rounded-lg shadow-sm border p-6\">\n      <div className=\"flex gap-4\">\n        {/* Vote component */}\n        <VoteButton\n          contentId={post.id}\n          contentType=\"post\"\n          initialVotes={post.helpfulVotes || 0}\n          initialUserVote={post.userVote}\n          userId={user?.id}\n        />\n        \n        {/* Post content */}\n        <div className=\"flex-1\">\n          <h3 className=\"font-semibold text-lg mb-2\">{post.title}</h3>\n          <p className=\"text-gray-700 mb-4\">{post.content}</p>\n          \n          <div className=\"flex items-center justify-between text-sm text-gray-500\">\n            <div className=\"flex items-center gap-4\">\n              <span>by {post.author?.communityName || post.author?.username}</span>\n              <span>{new Date(post.createdAt).toLocaleDateString()}</span>\n              <span>{post.commentCount || 0} comments</span>\n            </div>\n            \n            {/* Compact vote display for inline use */}\n            <VoteButton\n              contentId={post.id}\n              contentType=\"post\"\n              initialVotes={post.helpfulVotes || 0}\n              initialUserVote={post.userVote}\n              userId={user?.id}\n              compact\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8647},"server/services/calendarService.ts":{"content":"import { google } from 'googleapis';\nimport { OAuth2Client } from 'google-auth-library';\nimport { storage } from '../storage';\nimport type { CalendarIntegration, InsertCalendarIntegration } from '@shared/schema';\n\ninterface CalendarEvent {\n  id?: string;\n  summary: string;\n  description?: string;\n  start: {\n    dateTime: string;\n    timeZone: string;\n  };\n  end: {\n    dateTime: string;\n    timeZone: string;\n  };\n  attendees?: Array<{\n    email: string;\n    displayName?: string;\n  }>;\n  conferenceData?: {\n    createRequest: {\n      requestId: string;\n      conferenceSolutionKey: {\n        type: 'hangoutsMeet';\n      };\n    };\n  };\n}\n\nexport class CalendarService {\n  private oauth2Client: OAuth2Client;\n\n  constructor() {\n    this.oauth2Client = new google.auth.OAuth2(\n      process.env.GOOGLE_CLIENT_ID,\n      process.env.GOOGLE_CLIENT_SECRET,\n      process.env.GOOGLE_REDIRECT_URI || `${process.env.BASE_URL}/api/calendar/oauth/callback`\n    );\n  }\n\n  /**\n   * Generate OAuth URL for Google Calendar authorization\n   */\n  generateAuthUrl(expertId: string): string {\n    const scopes = [\n      'https://www.googleapis.com/auth/calendar',\n      'https://www.googleapis.com/auth/calendar.events'\n    ];\n\n    return this.oauth2Client.generateAuthUrl({\n      access_type: 'offline',\n      scope: scopes,\n      state: expertId, // Pass expertId through state parameter\n      prompt: 'consent' // Force consent screen to get refresh token\n    });\n  }\n\n  /**\n   * Exchange authorization code for tokens\n   */\n  async exchangeCodeForTokens(code: string, expertId: string): Promise<CalendarIntegration> {\n    try {\n      const { tokens } = await this.oauth2Client.getAccessToken(code);\n      \n      if (!tokens.access_token || !tokens.refresh_token) {\n        throw new Error('Failed to obtain necessary tokens from Google');\n      }\n\n      // Set credentials to get user info\n      this.oauth2Client.setCredentials(tokens);\n      \n      // Get primary calendar info\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n      const calendarList = await calendar.calendarList.list();\n      const primaryCalendar = calendarList.data.items?.find(cal => cal.primary);\n\n      if (!primaryCalendar) {\n        throw new Error('Could not access primary calendar');\n      }\n\n      // Create or update calendar integration\n      const integrationData: InsertCalendarIntegration = {\n        expertId,\n        provider: 'google',\n        accessToken: tokens.access_token,\n        refreshToken: tokens.refresh_token,\n        tokenExpiresAt: new Date(tokens.expiry_date || Date.now() + 3600000),\n        calendarId: primaryCalendar.id || 'primary',\n        calendarName: primaryCalendar.summary || 'Primary Calendar',\n        isActive: true,\n        lastSyncAt: new Date(),\n        syncErrors: null\n      };\n\n      return await storage.createOrUpdateCalendarIntegration(integrationData);\n    } catch (error) {\n      console.error('Error exchanging code for tokens:', error);\n      throw new Error('Failed to connect Google Calendar');\n    }\n  }\n\n  /**\n   * Refresh access token using refresh token\n   */\n  private async refreshAccessToken(integration: CalendarIntegration): Promise<string> {\n    try {\n      this.oauth2Client.setCredentials({\n        refresh_token: integration.refreshToken\n      });\n\n      const { credentials } = await this.oauth2Client.refreshAccessToken();\n      \n      if (!credentials.access_token) {\n        throw new Error('Failed to refresh access token');\n      }\n\n      // Update stored tokens\n      await storage.updateCalendarIntegration(integration.id, {\n        accessToken: credentials.access_token,\n        tokenExpiresAt: new Date(credentials.expiry_date || Date.now() + 3600000),\n        lastSyncAt: new Date()\n      });\n\n      return credentials.access_token;\n    } catch (error) {\n      console.error('Error refreshing access token:', error);\n      // Mark integration as inactive if refresh fails\n      await storage.updateCalendarIntegration(integration.id, {\n        isActive: false,\n        syncErrors: JSON.stringify({ error: 'Token refresh failed', timestamp: new Date() })\n      });\n      throw new Error('Calendar integration expired. Please reconnect.');\n    }\n  }\n\n  /**\n   * Get valid access token for expert\n   */\n  private async getValidAccessToken(expertId: string): Promise<{ token: string; integration: CalendarIntegration }> {\n    const integration = await storage.getCalendarIntegration(expertId);\n    \n    if (!integration || !integration.isActive) {\n      throw new Error('No active calendar integration found');\n    }\n\n    // Check if token is expired or about to expire (within 5 minutes)\n    const expiryBuffer = 5 * 60 * 1000; // 5 minutes\n    const now = new Date();\n    const expiryTime = new Date(integration.tokenExpiresAt);\n\n    if (expiryTime.getTime() - now.getTime() < expiryBuffer) {\n      const newToken = await this.refreshAccessToken(integration);\n      return { token: newToken, integration };\n    }\n\n    return { token: integration.accessToken, integration };\n  }\n\n  /**\n   * Create appointment event in Google Calendar\n   */\n  async createAppointmentEvent(\n    expertId: string,\n    appointment: {\n      id: number;\n      clientName: string;\n      clientEmail: string;\n      scheduledAt: Date;\n      duration: number;\n      notes?: string;\n    }\n  ): Promise<{ eventId: string; meetingLink?: string }> {\n    try {\n      const { token } = await this.getValidAccessToken(expertId);\n      \n      this.oauth2Client.setCredentials({ access_token: token });\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n\n      const startTime = new Date(appointment.scheduledAt);\n      const endTime = new Date(startTime.getTime() + appointment.duration * 60 * 1000);\n\n      const event: CalendarEvent = {\n        summary: `Consultation with ${appointment.clientName}`,\n        description: `\nConsultation appointment through CaregiversCommunity platform.\n\nClient: ${appointment.clientName}\nEmail: ${appointment.clientEmail}\nDuration: ${appointment.duration} minutes\n${appointment.notes ? `\\nNotes: ${appointment.notes}` : ''}\n\nAppointment ID: #${appointment.id}\n        `.trim(),\n        start: {\n          dateTime: startTime.toISOString(),\n          timeZone: 'America/New_York'\n        },\n        end: {\n          dateTime: endTime.toISOString(),\n          timeZone: 'America/New_York'\n        },\n        attendees: [\n          { email: appointment.clientEmail, displayName: appointment.clientName }\n        ],\n        conferenceData: {\n          createRequest: {\n            requestId: `appointment-${appointment.id}-${Date.now()}`,\n            conferenceSolutionKey: {\n              type: 'hangoutsMeet'\n            }\n          }\n        }\n      };\n\n      const response = await calendar.events.insert({\n        calendarId: 'primary',\n        resource: event,\n        conferenceDataVersion: 1, // Required for Meet links\n        sendUpdates: 'all' // Send invites to attendees\n      });\n\n      const meetingLink = response.data.conferenceData?.entryPoints?.[0]?.uri;\n\n      return {\n        eventId: response.data.id!,\n        meetingLink\n      };\n    } catch (error) {\n      console.error('Error creating calendar event:', error);\n      throw new Error('Failed to create calendar event');\n    }\n  }\n\n  /**\n   * Update appointment event in Google Calendar\n   */\n  async updateAppointmentEvent(\n    expertId: string,\n    eventId: string,\n    updates: {\n      scheduledAt?: Date;\n      duration?: number;\n      status?: string;\n    }\n  ): Promise<void> {\n    try {\n      const { token } = await this.getValidAccessToken(expertId);\n      \n      this.oauth2Client.setCredentials({ access_token: token });\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n\n      // Get existing event\n      const existingEvent = await calendar.events.get({\n        calendarId: 'primary',\n        eventId\n      });\n\n      if (!existingEvent.data) {\n        throw new Error('Event not found');\n      }\n\n      const event = existingEvent.data;\n\n      // Update fields if provided\n      if (updates.scheduledAt && updates.duration) {\n        const startTime = new Date(updates.scheduledAt);\n        const endTime = new Date(startTime.getTime() + updates.duration * 60 * 1000);\n        \n        event.start = {\n          dateTime: startTime.toISOString(),\n          timeZone: 'America/New_York'\n        };\n        event.end = {\n          dateTime: endTime.toISOString(),\n          timeZone: 'America/New_York'\n        };\n      }\n\n      if (updates.status === 'cancelled') {\n        event.status = 'cancelled';\n      }\n\n      await calendar.events.update({\n        calendarId: 'primary',\n        eventId,\n        resource: event,\n        sendUpdates: 'all'\n      });\n    } catch (error) {\n      console.error('Error updating calendar event:', error);\n      throw new Error('Failed to update calendar event');\n    }\n  }\n\n  /**\n   * Delete appointment event from Google Calendar\n   */\n  async deleteAppointmentEvent(expertId: string, eventId: string): Promise<void> {\n    try {\n      const { token } = await this.getValidAccessToken(expertId);\n      \n      this.oauth2Client.setCredentials({ access_token: token });\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n\n      await calendar.events.delete({\n        calendarId: 'primary',\n        eventId,\n        sendUpdates: 'all'\n      });\n    } catch (error) {\n      console.error('Error deleting calendar event:', error);\n      throw new Error('Failed to delete calendar event');\n    }\n  }\n\n  /**\n   * Check for calendar conflicts\n   */\n  async checkForConflicts(\n    expertId: string,\n    startTime: Date,\n    endTime: Date,\n    excludeEventId?: string\n  ): Promise<boolean> {\n    try {\n      const { token } = await this.getValidAccessToken(expertId);\n      \n      this.oauth2Client.setCredentials({ access_token: token });\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n\n      const response = await calendar.events.list({\n        calendarId: 'primary',\n        timeMin: startTime.toISOString(),\n        timeMax: endTime.toISOString(),\n        singleEvents: true,\n        orderBy: 'startTime'\n      });\n\n      const events = response.data.items || [];\n      \n      // Filter out cancelled events and the event we're checking against\n      const activeEvents = events.filter(event => \n        event.status !== 'cancelled' && \n        event.id !== excludeEventId\n      );\n\n      return activeEvents.length > 0;\n    } catch (error) {\n      console.error('Error checking for conflicts:', error);\n      // Return true (conflict) on error to be safe\n      return true;\n    }\n  }\n\n  /**\n   * Sync expert availability with calendar\n   */\n  async syncAvailability(expertId: string): Promise<void> {\n    try {\n      const { token, integration } = await this.getValidAccessToken(expertId);\n      \n      this.oauth2Client.setCredentials({ access_token: token });\n      const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n\n      // Get events for the next 30 days\n      const now = new Date();\n      const endDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\n\n      const response = await calendar.events.list({\n        calendarId: 'primary',\n        timeMin: now.toISOString(),\n        timeMax: endDate.toISOString(),\n        singleEvents: true,\n        orderBy: 'startTime'\n      });\n\n      const events = response.data.items || [];\n      \n      // Update sync timestamp\n      await storage.updateCalendarIntegration(integration.id, {\n        lastSyncAt: new Date(),\n        syncErrors: null\n      });\n\n      // TODO: Process events and update blocked time slots\n      // This would involve creating/updating blocked time slots based on calendar events\n      \n    } catch (error) {\n      console.error('Error syncing availability:', error);\n      const integration = await storage.getCalendarIntegration(expertId);\n      if (integration) {\n        await storage.updateCalendarIntegration(integration.id, {\n          syncErrors: JSON.stringify({ error: error.message, timestamp: new Date() })\n        });\n      }\n      throw new Error('Failed to sync calendar availability');\n    }\n  }\n\n  /**\n   * Disconnect calendar integration\n   */\n  async disconnectCalendar(expertId: string): Promise<void> {\n    try {\n      const integration = await storage.getCalendarIntegration(expertId);\n      if (integration) {\n        // Revoke tokens with Google\n        this.oauth2Client.setCredentials({\n          access_token: integration.accessToken,\n          refresh_token: integration.refreshToken\n        });\n\n        try {\n          await this.oauth2Client.revokeCredentials();\n        } catch (error) {\n          // Continue even if revocation fails\n          console.warn('Failed to revoke Google credentials:', error);\n        }\n\n        // Mark integration as inactive\n        await storage.updateCalendarIntegration(integration.id, {\n          isActive: false\n        });\n      }\n    } catch (error) {\n      console.error('Error disconnecting calendar:', error);\n      throw new Error('Failed to disconnect calendar');\n    }\n  }\n}\n\nexport const calendarService = new CalendarService();","size_bytes":13249},"client/src/pages/ForgotPassword.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Mail, ArrowLeft } from \"lucide-react\";\n\nexport default function ForgotPassword() {\n  const [email, setEmail] = useState(\"\");\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const { toast } = useToast();\n\n  const forgotPasswordMutation = useMutation({\n    mutationFn: (email: string) => \n      apiRequest(\"/api/forgot-password\", \"POST\", { email }),\n    onSuccess: () => {\n      setIsSubmitted(true);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send reset email\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    forgotPasswordMutation.mutate(email);\n  };\n\n  if (isSubmitted) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4\">\n              <Mail className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <CardTitle>Check Your Email</CardTitle>\n            <CardDescription className=\"mt-2\">\n              If an account exists with {email}, we've sent a password reset link to your email.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"text-center\">\n            <p className=\"text-sm text-gray-600 mb-6\">\n              The link will expire in 1 hour. If you don't see the email, check your spam folder.\n            </p>\n            <Link href=\"/auth\">\n              <Button variant=\"outline\" className=\"w-full\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Sign In\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <CardTitle>Forgot Password?</CardTitle>\n          <CardDescription>\n            Enter your email address and we'll send you a link to reset your password.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email Address</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"Enter your email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                disabled={forgotPasswordMutation.isPending}\n              />\n            </div>\n            \n            <Button \n              type=\"submit\" \n              className=\"w-full\"\n              disabled={forgotPasswordMutation.isPending}\n            >\n              {forgotPasswordMutation.isPending ? \"Sending...\" : \"Send Reset Link\"}\n            </Button>\n          </form>\n\n          <div className=\"mt-6 text-center text-sm\">\n            <span className=\"text-gray-600\">Remember your password? </span>\n            <Link href=\"/auth\" className=\"text-askEdithTeal hover:underline\">\n              Sign In\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":3919},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/services/rag/README.md":{"content":"# RAG (Retrieval-Augmented Generation) System\n\nThis directory contains a complete RAG system implementation using LangChain, OpenAI GPT-4o-mini, and PGVector for semantic search and answer generation.\n\n## Architecture\n\n```\nserver/services/rag/\nâ”œâ”€â”€ types.ts              # TypeScript interfaces and types\nâ”œâ”€â”€ embeddingService.ts   # OpenAI embeddings generation\nâ”œâ”€â”€ vectorStore.ts        # PGVector database operations\nâ”œâ”€â”€ ragService.ts         # Main RAG orchestration\nâ”œâ”€â”€ dataIngestion.ts      # CSV data processing\nâ”œâ”€â”€ index.ts             # Main exports and utilities\nâ””â”€â”€ README.md            # This file\n```\n\n## Features\n\n- **Semantic Search**: Vector similarity search using OpenAI embeddings\n- **Hybrid Search**: Combines vector similarity with keyword matching\n- **Context-Aware Answers**: Generates answers using relevant context from your CSV data\n- **Source Attribution**: Provides source information for generated answers\n- **Confidence Scoring**: Calculates confidence based on search relevance\n- **Batch Processing**: Efficient processing of large CSV datasets\n- **Admin Management**: API endpoints for system management\n\n## Setup\n\n### 1. Environment Variables\n\nAdd these to your `.env` file:\n\n```env\nOPENAI_API_KEY=your_openai_api_key_here\n```\n\n### 2. Database Setup\n\nUse Drizzle's migration system to create the required tables and indexes:\n\n```bash\nnpm run db:push\n```\n\nThis will create:\n- `qa_embeddings` table with PGVector support\n- Similarity search index for fast vector queries\n- Foreign key relationships with existing `qa_knowledge` table\n- Proper Drizzle schema integration\n\n### 3. Dependencies\n\nThe system uses these packages (already installed):\n\n```bash\nnpm install langchain @langchain/openai @langchain/community pgvector\n```\n\n## Usage\n\n### Basic Usage\n\n```typescript\nimport { generateRagAnswer, initializeRagSystem } from './services/rag';\n\n// First, ensure the database schema is up to date\n// npm run db:push\n\n// Initialize the system (one-time setup)\nawait initializeRagSystem();\n\n// Generate an answer\nconst response = await generateRagAnswer(\"What is an ADU?\");\nconsole.log(response.answer);\nconsole.log(`Confidence: ${response.confidence}`);\n```\n\n### API Endpoints\n\n#### RAG Search\n```http\nPOST /api/rag-search\nContent-Type: application/json\n\n{\n  \"query\": \"What is an ADU and how can it be used for elder care?\"\n}\n```\n\nResponse:\n```json\n{\n  \"answer\": \"An ADU (Accessory Dwelling Unit) is a smaller, self-contained living space...\",\n  \"confidence\": 0.85,\n  \"sources\": [\n    {\n      \"question\": \"What is an ADU, and how can it be used for elder care?\",\n      \"content\": \"An Accessory Dwelling Unit (ADU) is a smaller, self-contained...\",\n      \"score\": 0.92,\n      \"source\": \"improved_qa_results_database.csv\"\n    }\n  ],\n  \"totalSources\": 3\n}\n```\n\n#### Admin Endpoints\n\nInitialize RAG system:\n```http\nPOST /api/rag/initialize\nAuthorization: Bearer <admin_token>\n```\n\nGet system stats:\n```http\nGET /api/rag/stats\nAuthorization: Bearer <admin_token>\n```\n\nTest system:\n```http\nPOST /api/rag/test\nAuthorization: Bearer <admin_token>\n```\n\n### Testing\n\nRun the test script:\n\n```bash\nnpm run rag:test\n```\n\n## Configuration\n\n### Embedding Configuration\n\n```typescript\nconst embeddingConfig = {\n  model: 'text-embedding-3-small',  // OpenAI embedding model\n  dimension: 1536,                  // Vector dimension\n  chunkSize: 512,                   // Text chunk size\n  chunkOverlap: 50,                 // Chunk overlap\n};\n```\n\n### Search Configuration\n\n```typescript\nconst searchConfig = {\n  topK: 5,                          // Number of results to retrieve\n  similarityThreshold: 0.7,         // Minimum similarity score\n  includeMetadata: true,            // Include metadata in results\n};\n```\n\n## Data Processing\n\n### CSV Format\n\nThe system expects CSV files with these columns:\n\n```csv\nquestion_id,question,answer,category,section,processed_at\n1,\"What is an ADU?\",\"An ADU is...\",General,1.1,2025-07-29\n```\n\n### Supported Files\n\n- `data/retirement_qa_results.csv`\n- `data/improved_qa_results_database.csv`\n\n### Data Flow\n\n1. **CSV Parsing**: Parse and clean CSV data\n2. **Text Chunking**: Split long answers into manageable chunks\n3. **Embedding Generation**: Generate vector embeddings for each chunk\n4. **Vector Storage**: Store embeddings in PGVector database\n5. **Index Creation**: Create similarity search indexes\n\n## Performance\n\n### Optimization Features\n\n- **Batch Processing**: Process multiple embeddings simultaneously\n- **Caching**: Embedding generation caching\n- **Indexed Search**: Fast similarity search with PGVector indexes\n- **Hybrid Search**: Combines vector and keyword search for better results\n\n### Expected Performance\n\n- **Embedding Generation**: ~1000 chunks/minute\n- **Search Response**: <500ms for typical queries\n- **Memory Usage**: ~50MB for 10,000 chunks\n- **Storage**: ~15MB for 10,000 embeddings\n\n## Error Handling\n\nThe system includes comprehensive error handling:\n\n- **API Key Validation**: Checks for required environment variables\n- **Database Connection**: Graceful handling of connection issues\n- **Rate Limiting**: Respects OpenAI API rate limits\n- **Fallback Responses**: Provides helpful responses when search fails\n\n## Monitoring\n\n### Logging\n\nThe system logs:\n- Initialization progress\n- Data processing statistics\n- Search performance metrics\n- Error details\n\n### Statistics\n\nTrack system health with:\n- Total chunks processed\n- Average chunks per QA\n- Search success rates\n- Response times\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Missing OpenAI API Key**\n   ```\n   Error: OPENAI_API_KEY environment variable is required\n   ```\n   Solution: Add your OpenAI API key to `.env`\n\n2. **Database Connection Issues**\n   ```\n   Error: Failed to initialize vector store\n   ```\n   Solution: Check your DATABASE_URL and ensure PGVector extension is available\n\n3. **Memory Issues**\n   ```\n   Error: Out of memory during embedding generation\n   ```\n   Solution: Reduce batch size or process data in smaller chunks\n\n### Debug Mode\n\nEnable debug logging:\n\n```typescript\nprocess.env.DEBUG = 'rag:*';\n```\n\n## Security\n\n- **Admin-only Management**: System management requires admin privileges\n- **Input Validation**: All user inputs are validated and sanitized\n- **Rate Limiting**: Built-in rate limiting for API endpoints\n- **Error Sanitization**: Sensitive information is not exposed in error messages\n\n## Future Enhancements\n\n- **Multi-language Support**: Support for non-English content\n- **Advanced Filtering**: Filter by category, date, or source\n- **Real-time Updates**: Incremental updates without full reprocessing\n- **Analytics Dashboard**: Web interface for system monitoring\n- **Custom Models**: Support for custom embedding models\n","size_bytes":6749},"server/seed.ts":{"content":"// Create this file: server/seed.ts\n// Run this to initialize your database with real data\nimport 'dotenv/config';\nimport { db } from \"./db\";\nimport { categories, achievements, users } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\ninterface CategorySeed {\n  name: string;\n  description: string;\n  slug: string;\n  color: string;\n  icon: string;\n  level: number;\n  orderIndex: number;\n  isOfficial: boolean;\n  parentSlug?: string; // For building hierarchy\n}\n\ninterface AchievementSeed {\n  name: string;\n  description: string;\n  icon: string;\n  category: string;\n  points: number;\n  requirements: string;\n}\n\nconst defaultCategories: CategorySeed[] = [\n  // Level 0 - Main Forums\n  {\n    name: \"General Discussion\",\n    description: \"Open discussions about all aspects of caregiving\",\n    slug: \"general-discussion\",\n    color: \"#6B7280\",\n    icon: \"MessageCircle\",\n    level: 0,\n    orderIndex: 1,\n    isOfficial: true\n  },\n  {\n    name: \"Medical & Health\",\n    description: \"Medical questions, health management, and healthcare navigation\",\n    slug: \"medical-health\",\n    color: \"#EF4444\",\n    icon: \"Heart\",\n    level: 0,\n    orderIndex: 2,\n    isOfficial: true\n  },\n  {\n    name: \"Daily Living\",\n    description: \"Day-to-day caregiving challenges and solutions\",\n    slug: \"daily-living\",\n    color: \"#10B981\",\n    icon: \"Home\",\n    level: 0,\n    orderIndex: 3,\n    isOfficial: true\n  },\n  {\n    name: \"Legal & Financial\",\n    description: \"Legal matters, financial planning, and benefits\",\n    slug: \"legal-financial\",\n    color: \"#3B82F6\",\n    icon: \"Scale\",\n    level: 0,\n    orderIndex: 4,\n    isOfficial: true\n  },\n  {\n    name: \"Self-Care & Support\",\n    description: \"Taking care of yourself while caring for others\",\n    slug: \"self-care\",\n    color: \"#8B5CF6\",\n    icon: \"User\",\n    level: 0,\n    orderIndex: 5,\n    isOfficial: true\n  },\n  {\n    name: \"Resources & Tools\",\n    description: \"Helpful resources, tools, and recommendations\",\n    slug: \"resources-tools\",\n    color: \"#F59E0B\",\n    icon: \"Bookmark\",\n    level: 0,\n    orderIndex: 6,\n    isOfficial: true\n  },\n  {\n    name: \"Care Professionals\",\n    description: \"Connect with various care and retirement professionals\",\n    slug: \"care-professionals\",\n    color: \"#059669\",\n    icon: \"Users\",\n    level: 0,\n    orderIndex: 7,\n    isOfficial: true\n  },\n\n  // Level 1 - Medical & Health subcategories\n  {\n    name: \"Medication Management\",\n    description: \"Questions about medications, dosages, and drug interactions\",\n    slug: \"medication-management\",\n    color: \"#EF4444\",\n    icon: \"Pill\",\n    level: 1,\n    orderIndex: 1,\n    isOfficial: true,\n    parentSlug: \"medical-health\"\n  },\n  {\n    name: \"Doctor Appointments\",\n    description: \"Managing healthcare visits and communicating with providers\",\n    slug: \"doctor-appointments\",\n    color: \"#EF4444\",\n    icon: \"Calendar\",\n    level: 1,\n    orderIndex: 2,\n    isOfficial: true,\n    parentSlug: \"medical-health\"\n  },\n  {\n    name: \"Mental Health\",\n    description: \"Depression, anxiety, dementia, and cognitive health\",\n    slug: \"mental-health\",\n    color: \"#EF4444\",\n    icon: \"Brain\",\n    level: 1,\n    orderIndex: 3,\n    isOfficial: true,\n    parentSlug: \"medical-health\"\n  },\n  {\n    name: \"Chronic Conditions\",\n    description: \"Managing diabetes, heart disease, arthritis, and other conditions\",\n    slug: \"chronic-conditions\",\n    color: \"#EF4444\",\n    icon: \"Activity\",\n    level: 1,\n    orderIndex: 4,\n    isOfficial: true,\n    parentSlug: \"medical-health\"\n  },\n\n  // Level 1 - Daily Living subcategories\n  {\n    name: \"Personal Care\",\n    description: \"Bathing, dressing, grooming, and personal hygiene\",\n    slug: \"personal-care\",\n    color: \"#10B981\",\n    icon: \"User\",\n    level: 1,\n    orderIndex: 1,\n    isOfficial: true,\n    parentSlug: \"daily-living\"\n  },\n  {\n    name: \"Meal Planning & Nutrition\",\n    description: \"Cooking, eating challenges, and nutritional needs\",\n    slug: \"meal-nutrition\",\n    color: \"#10B981\",\n    icon: \"Utensils\",\n    level: 1,\n    orderIndex: 2,\n    isOfficial: true,\n    parentSlug: \"daily-living\"\n  },\n  {\n    name: \"Home Safety & Mobility\",\n    description: \"Fall prevention, assistive devices, and home modifications\",\n    slug: \"home-safety\",\n    color: \"#10B981\",\n    icon: \"Shield\",\n    level: 1,\n    orderIndex: 3,\n    isOfficial: true,\n    parentSlug: \"daily-living\"\n  },\n  {\n    name: \"Transportation\",\n    description: \"Getting around safely and independently\",\n    slug: \"transportation\",\n    color: \"#10B981\",\n    icon: \"Car\",\n    level: 1,\n    orderIndex: 4,\n    isOfficial: true,\n    parentSlug: \"daily-living\"\n  },\n\n  // Level 1 - Legal & Financial subcategories\n  {\n    name: \"Estate Planning\",\n    description: \"Wills, trusts, power of attorney, and advance directives\",\n    slug: \"estate-planning\",\n    color: \"#3B82F6\",\n    icon: \"FileText\",\n    level: 1,\n    orderIndex: 1,\n    isOfficial: true,\n    parentSlug: \"legal-financial\"\n  },\n  {\n    name: \"Insurance & Benefits\",\n    description: \"Medicare, Medicaid, social security, and insurance claims\",\n    slug: \"insurance-benefits\",\n    color: \"#3B82F6\",\n    icon: \"Shield\",\n    level: 1,\n    orderIndex: 2,\n    isOfficial: true,\n    parentSlug: \"legal-financial\"\n  },\n  {\n    name: \"Financial Planning\",\n    description: \"Budgeting for care, managing finances, and cost concerns\",\n    slug: \"financial-planning\",\n    color: \"#3B82F6\",\n    icon: \"DollarSign\",\n    level: 1,\n    orderIndex: 3,\n    isOfficial: true,\n    parentSlug: \"legal-financial\"\n  },\n\n  // Level 1 - Self-Care subcategories\n  {\n    name: \"Caregiver Stress\",\n    description: \"Managing burnout, stress, and emotional challenges\",\n    slug: \"caregiver-stress\",\n    color: \"#8B5CF6\",\n    icon: \"Heart\",\n    level: 1,\n    orderIndex: 1,\n    isOfficial: true,\n    parentSlug: \"self-care\"\n  },\n  {\n    name: \"Support Groups\",\n    description: \"Finding and connecting with other caregivers\",\n    slug: \"support-groups\",\n    color: \"#8B5CF6\",\n    icon: \"Users\",\n    level: 1,\n    orderIndex: 2,\n    isOfficial: true,\n    parentSlug: \"self-care\"\n  },\n  {\n    name: \"Time for Yourself\",\n    description: \"Finding respite and maintaining your own well-being\",\n    slug: \"time-yourself\",\n    color: \"#8B5CF6\",\n    icon: \"Coffee\",\n    level: 1,\n    orderIndex: 3,\n    isOfficial: true,\n    parentSlug: \"self-care\"\n  },\n\n  // Level 1 - Care Professionals subcategories\n  {\n    name: \"Accountants\",\n    description: \"Financial accounting and tax professionals\",\n    slug: \"accountants\",\n    color: \"#059669\",\n    icon: \"Calculator\",\n    level: 1,\n    orderIndex: 1,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Aging Life Care Professional\",\n    description: \"Geriatric care managers and aging life specialists\",\n    slug: \"aging-life-care\",\n    color: \"#059669\",\n    icon: \"Users\",\n    level: 1,\n    orderIndex: 2,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Bill Pay Managers\",\n    description: \"Professional bill payment and financial management services\",\n    slug: \"bill-pay-managers\",\n    color: \"#059669\",\n    icon: \"CreditCard\",\n    level: 1,\n    orderIndex: 3,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Certified Senior Advisor\",\n    description: \"Certified professionals specializing in senior care\",\n    slug: \"certified-senior-advisor\",\n    color: \"#059669\",\n    icon: \"Award\",\n    level: 1,\n    orderIndex: 4,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Certified Retirement Counselor\",\n    description: \"Professional retirement planning and counseling\",\n    slug: \"certified-retirement-counselor\",\n    color: \"#059669\",\n    icon: \"User\",\n    level: 1,\n    orderIndex: 5,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Certified Retirement Financial Advisor\",\n    description: \"Specialized financial advisors for retirement planning\",\n    slug: \"certified-retirement-financial-advisor\",\n    color: \"#059669\",\n    icon: \"TrendingUp\",\n    level: 1,\n    orderIndex: 6,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Certified Financial Planner\",\n    description: \"Comprehensive financial planning professionals\",\n    slug: \"certified-financial-planner\",\n    color: \"#059669\",\n    icon: \"PieChart\",\n    level: 1,\n    orderIndex: 7,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Elder Law Attorneys\",\n    description: \"Legal professionals specializing in elder law\",\n    slug: \"elder-law-attorneys\",\n    color: \"#059669\",\n    icon: \"Scale\",\n    level: 1,\n    orderIndex: 8,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Fiduciaries & Trustees\",\n    description: \"Trust and fiduciary management professionals\",\n    slug: \"fiduciaries-trustees\",\n    color: \"#059669\",\n    icon: \"Shield\",\n    level: 1,\n    orderIndex: 9,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Home Health Care Aides\",\n    description: \"In-home care providers and health aides\",\n    slug: \"home-health-care-aides\",\n    color: \"#059669\",\n    icon: \"Heart\",\n    level: 1,\n    orderIndex: 10,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Senior Living Placement Advisors\",\n    description: \"Specialists helping with senior living transitions\",\n    slug: \"senior-living-placement-advisors\",\n    color: \"#059669\",\n    icon: \"Home\",\n    level: 1,\n    orderIndex: 11,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Senior Real Estate Specialists (SRES)\",\n    description: \"Real estate professionals specializing in senior transactions\",\n    slug: \"senior-real-estate-specialists\",\n    color: \"#059669\",\n    icon: \"Building\",\n    level: 1,\n    orderIndex: 12,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Social Workers\",\n    description: \"Licensed social workers and case managers\",\n    slug: \"social-workers\",\n    color: \"#059669\",\n    icon: \"Users\",\n    level: 1,\n    orderIndex: 13,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  },\n  {\n    name: \"Long-Term Care Insurance Claims Assistance\",\n    description: \"Specialists helping with long-term care insurance claims\",\n    slug: \"ltc-insurance-claims\",\n    color: \"#059669\",\n    icon: \"FileText\",\n    level: 1,\n    orderIndex: 14,\n    isOfficial: true,\n    parentSlug: \"care-professionals\"\n  }\n];\n\nconst defaultAchievements: AchievementSeed[] = [\n  // Participation achievements\n  {\n    name: \"Welcome to the Community\",\n    description: \"You've joined our caregiving community!\",\n    icon: \"ðŸ‘‹\",\n    category: \"participation\",\n    points: 5,\n    requirements: \"Sign up for an account\"\n  },\n  {\n    name: \"First Post\",\n    description: \"You made your first post to help start a conversation!\",\n    icon: \"ðŸ“\",\n    category: \"participation\",\n    points: 10,\n    requirements: \"Create your first post\"\n  },\n  {\n    name: \"Conversation Starter\",\n    description: \"You're great at getting discussions going!\",\n    icon: \"ðŸ’¬\",\n    category: \"participation\",\n    points: 50,\n    requirements: \"Create 10 posts\"\n  },\n  {\n    name: \"Community Regular\",\n    description: \"You're a valued member of our community!\",\n    icon: \"â­\",\n    category: \"participation\",\n    points: 100,\n    requirements: \"Create 25 posts\"\n  },\n\n  // Helpfulness achievements\n  {\n    name: \"Helpful Contributor\",\n    description: \"Your posts are helping other caregivers!\",\n    icon: \"ðŸ‘\",\n    category: \"helpfulness\",\n    points: 25,\n    requirements: \"Receive 10 upvotes\"\n  },\n  {\n    name: \"Trusted Advisor\",\n    description: \"People really value your advice and insights!\",\n    icon: \"ðŸŒŸ\",\n    category: \"helpfulness\",\n    points: 75,\n    requirements: \"Receive 50 upvotes\"\n  },\n  {\n    name: \"Expert Helper\",\n    description: \"You're a go-to source for caregiving wisdom!\",\n    icon: \"ðŸ†\",\n    category: \"helpfulness\",\n    points: 150,\n    requirements: \"Receive 100 upvotes\"\n  },\n  {\n    name: \"Community Hero\",\n    description: \"Your contributions make a real difference!\",\n    icon: \"ðŸ¦¸\",\n    category: \"helpfulness\",\n    points: 300,\n    requirements: \"Receive 250 upvotes\"\n  },\n\n  // Engagement achievements\n  {\n    name: \"Good Listener\",\n    description: \"You take time to read and engage with others!\",\n    icon: \"ðŸ‘‚\",\n    category: \"engagement\",\n    points: 15,\n    requirements: \"Comment on 10 posts\"\n  },\n  {\n    name: \"Active Participant\",\n    description: \"You're actively engaged in community discussions!\",\n    icon: \"ðŸ’ª\",\n    category: \"engagement\",\n    points: 40,\n    requirements: \"Comment on 50 posts\"\n  },\n  {\n    name: \"Discussion Champion\",\n    description: \"You keep conversations alive and meaningful!\",\n    icon: \"ðŸ—£ï¸\",\n    category: \"engagement\",\n    points: 80,\n    requirements: \"Comment on 100 posts\"\n  },\n\n  // Leadership achievements\n  {\n    name: \"Community Builder\",\n    description: \"You created a forum to bring people together!\",\n    icon: \"ðŸ—ï¸\",\n    category: \"leadership\",\n    points: 100,\n    requirements: \"Create a community forum\"\n  },\n  {\n    name: \"Forum Leader\",\n    description: \"You're actively managing and growing your forum!\",\n    icon: \"ðŸ‘‘\",\n    category: \"leadership\",\n    points: 200,\n    requirements: \"Have 50 posts in your created forums\"\n  },\n\n  // Special achievements\n  {\n    name: \"Early Supporter\",\n    description: \"You joined during our early days!\",\n    icon: \"ðŸŒ±\",\n    category: \"special\",\n    points: 50,\n    requirements: \"Join during beta period\"\n  },\n  {\n    name: \"One Year Strong\",\n    description: \"You've been part of our community for a full year!\",\n    icon: \"ðŸŽ‚\",\n    category: \"special\",\n    points: 100,\n    requirements: \"Active for 365 days\"\n  }\n];\n\nexport async function seedDatabase() {\n  console.log(\"Starting database seeding...\");\n\n  try {\n    // 1. Seed Achievements\n    console.log(\"Seeding achievements...\");\n    for (const achievement of defaultAchievements) {\n      const existing = await db\n        .select()\n        .from(achievements)\n        .where(eq(achievements.name, achievement.name))\n        .limit(1);\n\n      if (existing.length === 0) {\n        await db.insert(achievements).values({\n          ...achievement,\n          createdAt: new Date()\n        });\n        console.log(`  Created achievement: ${achievement.name}`);\n      }\n    }\n\n    // 2. Seed Categories (in order to handle hierarchy)\n    console.log(\"Seeding categories...\");\n    \n    // First, create all level 0 categories\n    const level0Categories = defaultCategories.filter(cat => cat.level === 0);\n    for (const category of level0Categories) {\n      const existing = await db\n        .select()\n        .from(categories)\n        .where(eq(categories.slug, category.slug))\n        .limit(1);\n\n      if (existing.length === 0) {\n        await db.insert(categories).values({\n          name: category.name,\n          description: category.description,\n          slug: category.slug,\n          color: category.color,\n          icon: category.icon,\n          postCount: 0,\n          parentId: null,\n          level: category.level,\n          orderIndex: category.orderIndex,\n          isOfficial: category.isOfficial,\n          createdBy: null,\n          createdAt: new Date()\n        });\n        console.log(`  Created category: ${category.name}`);\n      }\n    }\n\n    // Then create subcategories\n    const subcategories = defaultCategories.filter(cat => cat.level > 0);\n    for (const category of subcategories) {\n      const existing = await db\n        .select()\n        .from(categories)\n        .where(eq(categories.slug, category.slug))\n        .limit(1);\n\n      if (existing.length === 0 && category.parentSlug) {\n        // Find parent category\n        const parent = await db\n          .select()\n          .from(categories)\n          .where(eq(categories.slug, category.parentSlug))\n          .limit(1);\n\n        if (parent.length > 0) {\n          await db.insert(categories).values({\n            name: category.name,\n            description: category.description,\n            slug: category.slug,\n            color: category.color,\n            icon: category.icon,\n            postCount: 0,\n            parentId: parent[0].id,\n            level: category.level,\n            orderIndex: category.orderIndex,\n            isOfficial: category.isOfficial,\n            createdBy: null,\n            createdAt: new Date()\n          });\n          console.log(`  Created subcategory: ${category.name}`);\n        }\n      }\n    }\n\n    // 3. Create a demo user if needed\n    console.log(\"Checking for demo user...\");\n    const demoUser = await db\n      .select()\n      .from(users)\n      .where(eq(users.username, \"demo\"))\n      .limit(1);\n\n    if (demoUser.length === 0) {\n      await db.insert(users).values({\n        id: \"demo-user-id\",\n        username: \"demo\",\n        email: \"demo@example.com\",\n        firstName: \"Demo\",\n        lastName: \"User\",\n        communityName: \"Demo Caregiver\",\n        password: \"demo-password\", // Added placeholder password\n        role: \"user\",\n        introduction: \"I'm a demo user here to show how the community works!\",\n        city: \"Demo City\",\n        state: \"Demo State\",\n        reputation: 50,\n        joinedAt: new Date(),\n        lastActiveAt: new Date(),\n        createdAt: new Date(),\n        updatedAt: new Date()\n      });\n      console.log(\"  Created demo user\");\n    }\n\n    console.log(\"Database seeding completed successfully!\");\n\n  } catch (error) {\n    console.error(\"Error seeding database:\", error);\n    throw error;\n  }\n}\n\n// Function to reset database for testing\nexport async function resetDatabase() {\n  console.log(\"Resetting database...\");\n  \n  try {\n    // Delete in reverse order of dependencies\n    await db.delete(userAchievements);\n    await db.delete(votes);\n    await db.delete(comments);\n    await db.delete(posts);\n    await db.delete(categories);\n    await db.delete(achievements);\n    // Don't delete users in case there are real users\n    \n    console.log(\"Database reset completed!\");\n  } catch (error) {\n    console.error(\"Error resetting database:\", error);\n    throw error;\n  }\n}\n\n// Function to check database health\nexport async function checkDatabaseHealth() {\n  try {\n    const categoriesCount = await db.select({ count: sql`count(*)` }).from(categories);\n    const achievementsCount = await db.select({ count: sql`count(*)` }).from(achievements);\n    const usersCount = await db.select({ count: sql`count(*)` }).from(users);\n    const postsCount = await db.select({ count: sql`count(*)` }).from(posts);\n    \n    console.log(\"Database Health Check:\");\n    console.log(`  Categories: ${categoriesCount[0].count}`);\n    console.log(`  Achievements: ${achievementsCount[0].count}`);\n    console.log(`  Users: ${usersCount[0].count}`);\n    console.log(`  Posts: ${postsCount[0].count}`);\n    \n    return {\n      categories: Number(categoriesCount[0].count),\n      achievements: Number(achievementsCount[0].count),\n      users: Number(usersCount[0].count),\n      posts: Number(postsCount[0].count)\n    };\n  } catch (error) {\n    console.error(\"Database health check failed:\", error);\n    throw error;\n  }\n}\n\n// Run seeding if this file is executed directly\nconst main = async () => {\n  try {\n    await seedDatabase();\n    console.log(\"Database seeding completed successfully.\");\n    process.exit(0);\n  } catch (error) {\n    console.error(\"Database seeding failed:\", error);\n    process.exit(1);\n  }\n};\n\nmain();","size_bytes":19511},"SETUP_GUIDE.md":{"content":"# ðŸš€ Local Development Setup Guide\n\n## âš ï¸ SECURITY WARNING\n\n**IMPORTANT**: The `.env` file contains sensitive credentials and should **NEVER** be committed to version control!\n\n- `.env` is now in `.gitignore` to prevent accidental commits\n- If you've previously committed `.env`, rotate all credentials immediately:\n  - Database password\n  - Clerk API keys  \n  - Stripe keys\n  - SendGrid API key\n  - OpenAI API key\n  - Supabase keys\n\n---\n\n## Prerequisites\n- Node.js 18+ and npm installed\n- PostgreSQL database (local or cloud)\n- Clerk account (for authentication)\n\n## Quick Start\n\n### 1. Install Dependencies\n```bash\nnpm install\n```\n\n### 2. Configure Environment Variables\n\nCopy the example environment file:\n```bash\ncp .env.example .env\n```\n\nEdit `.env` and add your actual values. **CRITICAL KEYS REQUIRED:**\n\n#### âœ… **REQUIRED: Clerk Authentication** (App won't start without these)\n```env\nVITE_CLERK_PUBLISHABLE_KEY=pk_test_xxxxx\nCLERK_PUBLISHABLE_KEY=pk_test_xxxxx\nCLERK_SECRET_KEY=sk_test_xxxxx\n```\nGet these from: https://dashboard.clerk.com/\n\n#### âœ… **REQUIRED: Database**\n```env\nDATABASE_URL=postgresql://user:password@localhost:5432/database\n```\n\n#### âœ… **REQUIRED: Session Secret**\nGenerate with:\n```bash\nnode -e \"console.log(require('crypto').randomBytes(64).toString('base64'))\"\n```\n\n### 3. Set Up Database\n\nPush the database schema:\n```bash\nnpm run db:push\n```\n\nOptional: Seed with sample data:\n```bash\nnpm run seed\n```\n\n### 4. Start Development Server\n```bash\nnpm run dev\n```\n\nThe application will be available at: **http://localhost:5000**\n\n---\n\n## Optional Services\n\n### Stripe (Payment Processing)\nOnly needed if using payment features:\n```env\nSTRIPE_SECRET_KEY=sk_test_xxxxx\nVITE_STRIPE_PUBLIC_KEY=pk_test_xxxxx\n```\n\n### SendGrid (Email)\nOnly needed if sending emails:\n```env\nSENDGRID_API_KEY=SG.xxxxx\n```\n\n### OpenAI (AI Features)\nOnly needed for content moderation:\n```env\nOPENAI_API_KEY=sk-proj-xxxxx\n```\n\n### Supabase (File Storage)\nOnly needed for file uploads:\n```env\nSUPABASE_URL=https://your-project.supabase.co\nSUPABASE_ANON_KEY=xxxxx\nVITE_SUPABASE_URL=https://your-project.supabase.co\nVITE_SUPABASE_ANON_KEY=xxxxx\n```\n\n---\n\n## Troubleshooting\n\n### Empty White Page / App Won't Load\n**Cause**: Missing Clerk API keys  \n**Fix**: Ensure `VITE_CLERK_PUBLISHABLE_KEY`, `CLERK_PUBLISHABLE_KEY`, and `CLERK_SECRET_KEY` are set in `.env`\n\n### Database Connection Error\n**Cause**: Invalid `DATABASE_URL` or database not running  \n**Fix**: Verify your PostgreSQL database is running and connection string is correct\n\n### Port Already in Use\n**Cause**: Another process is using port 5000  \n**Fix**: Kill the process or change the port in `server/index.ts` (line 94)\n\n### Module Not Found Errors\n**Cause**: Missing dependencies  \n**Fix**: Run `npm install` again\n\n---\n\n## Production Build\n\nBuild for production:\n```bash\nnpm run build\n```\n\nStart production server:\n```bash\nnpm start\n```\n\n---\n\n## Available Scripts\n\n- `npm run dev` - Start development server\n- `npm run build` - Build for production\n- `npm start` - Run production server\n- `npm run db:push` - Push database schema changes\n- `npm run seed` - Seed database with sample data\n- `npm run check` - Run TypeScript type checking\n\n---\n\n## Need Help?\n\n1. Check that all required environment variables are set in `.env`\n2. Verify your database connection string is correct\n3. Ensure Clerk keys are valid and from the correct environment (development vs production)\n4. Check the console for error messages\n\n---\n\n## Architecture\n\n- **Frontend**: React 18 + TypeScript + Tailwind CSS + Vite\n- **Backend**: Express.js + PostgreSQL + Drizzle ORM\n- **Authentication**: Clerk\n- **Caching**: Redis (optional)\n- **Payments**: Stripe (optional)\n","size_bytes":3718},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/services/rag/index.ts":{"content":"// Export all RAG services and types\nimport \"dotenv/config\";\nimport { RagService } from \"./ragService\";\nimport { EmbeddingService } from \"./embeddingService\";\nimport { VectorStore } from \"./vectorStore\";\nimport { DataIngestionService } from \"./dataIngestion\";\nimport type {\n  EmbeddingConfig,\n  SearchConfig,\n  QaChunk,\n  SearchResult,\n} from \"./types\";\n\nexport { RagService, EmbeddingService, VectorStore, DataIngestionService };\nexport type { EmbeddingConfig, SearchConfig, QaChunk, SearchResult };\n\n// Default configuration\nexport const DEFAULT_EMBEDDING_CONFIG = {\n  model: \"text-embedding-3-small\",\n  dimension: 1536,\n  chunkSize: 512,\n  chunkOverlap: 50,\n} as const;\n\nexport const DEFAULT_SEARCH_CONFIG = {\n  topK: 5,\n  similarityThreshold: 0.7,\n  includeMetadata: true,\n} as const;\n\n// Singleton instance for easy access\nlet ragServiceInstance: RagService | null = null;\nlet dataIngestionInstance: DataIngestionService | null = null;\n\n/**\n * Get or create a singleton RAG service instance\n */\nexport function getRagService(): RagService {\n  if (!ragServiceInstance) {\n    ragServiceInstance = new RagService(\n      DEFAULT_EMBEDDING_CONFIG,\n      DEFAULT_SEARCH_CONFIG,\n    );\n  }\n  return ragServiceInstance;\n}\n\n/**\n * Get or create a singleton data ingestion service instance\n */\nexport function getDataIngestionService(): DataIngestionService {\n  if (!dataIngestionInstance) {\n    dataIngestionInstance = new DataIngestionService();\n  }\n  return dataIngestionInstance;\n}\n\n/**\n * Initialize the RAG system with data ingestion\n */\nexport async function initializeRagSystem(): Promise<void> {\n  const dataIngestion = getDataIngestionService();\n  console.log(\"Clearing vector store...\");\n  await dataIngestion.clearVectorStore();\n  console.log(\"Initializing RAG system...\");\n  await dataIngestion.initializeAndLoadData();\n}\n\n/**\n * Test the RAG system\n */\nexport async function testRagSystem(): Promise<void> {\n  const dataIngestion = getDataIngestionService();\n  await dataIngestion.testLoadedData();\n}\n\n/**\n * Generate an answer using RAG\n */\nexport async function generateRagAnswer(query: string) {\n  const ragService = getRagService();\n  return await ragService.generateAnswer(query);\n}\n\n/**\n * Generate an answer using RAG with streaming\n */\nexport async function* generateRagAnswerStream(query: string) {\n  const ragService = getRagService();\n  yield* ragService.generateAnswerStream(query);\n}\n\n/**\n * Search for similar content\n */\nexport async function searchSimilarContent(query: string, topK: number = 5) {\n  const ragService = getRagService();\n  return await ragService.searchSimilar(query, topK);\n}\n\n/**\n * Get RAG system statistics\n */\nexport async function getRagStats() {\n  const ragService = getRagService();\n  return await ragService.getStats();\n}\n","size_bytes":2771},"client/src/pages/ExpertApplicationWithPaymentTest.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { uploadFile } from \"@/lib/supabase\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { supabase } from \"@/lib/supabase\";\nimport { CheckCircle, Clock, XCircle, UserCheck, FileText, Upload, DollarSign, CreditCard, Linkedin } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\n// Make sure to call `loadStripe` outside of a component's render to avoid\n// recreating the `Stripe` object on every render.\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst expertApplicationSchema = z.object({\n  profession: z.string().min(2, \"Profession is required\"),\n  expertiseArea: z.string().min(5, \"Please describe your areas of expertise\"),\n  yearsOfExperience: z.number().min(1, \"Years of experience must be at least 1\").max(50, \"Please enter a realistic number\"),\n  credentials: z.string().min(10, \"Please provide your credentials and qualifications\"),\n  bio: z.string().min(50, \"Please provide a detailed bio (at least 50 characters)\"),\n  licenseNumber: z.string().min(1, \"License number is required\"),\n  // Company information\n  company: z.string().min(2, \"Company/Organization name is required\"),\n  companyAddress: z.string().min(10, \"Company address is required\"),\n  companyWebsite: z.string().url(\"Please enter a valid company website URL\").optional().or(z.literal(\"\")),\n  companyEmail: z.string().email(\"Please enter a valid company email\"),\n  // Professional links\n  websiteUrl: z.string().url(\"Please enter a valid website URL\").optional().or(z.literal(\"\")),\n  linkedinUrl: z.string().url(\"Please enter a valid LinkedIn URL\").optional().or(z.literal(\"\")),\n  blogUrl: z.string().url(\"Please enter a valid blog URL\").optional().or(z.literal(\"\")),\n  booksUrl: z.string().url(\"Please enter a valid books/publications URL\").optional().or(z.literal(\"\")),\n  articlesUrl: z.string().url(\"Please enter a valid articles URL\").optional().or(z.literal(\"\")),\n  // Consultation settings\n  consultationRate: z.number().min(50, \"Minimum consultation rate is $50/hour\").max(500, \"Maximum rate is $500/hour\"),\n  consultationEnabled: z.boolean().default(true),\n  reasonForApplying: z.string().min(20, \"Please explain why you want to become a verified expert\"),\n  // LinkedIn import option\n  importFromLinkedIn: z.boolean().default(false),\n});\n\ntype ExpertApplicationForm = z.infer<typeof expertApplicationSchema>;\n\nconst PaymentForm = ({ onPaymentSuccess }: { onPaymentSuccess: () => void }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    console.log('Payment form submitted');\n\n    if (!stripe || !elements) {\n      toast({\n        title: \"Payment Error\",\n        description: \"Stripe has not been properly initialized. Please refresh the page and try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      const card = elements.getElement(CardElement);\n      if (!card) {\n        throw new Error('Card element not found');\n      }\n\n      // Create payment method\n      const { error: methodError, paymentMethod } = await stripe.createPaymentMethod({\n        type: 'card',\n        card,\n      });\n\n      if (methodError) {\n        throw methodError;\n      }\n\n      console.log('Payment method created:', paymentMethod.id);\n\n      // Submit payment to our server\n      const response = await apiRequest('POST', '/api/experts/confirm-verification-payment', {\n        paymentMethodId: paymentMethod.id\n      });\n\n      if (response.error) {\n        throw new Error(response.error);\n      }\n\n      if (response.requiresAction) {\n        // Handle 3D Secure\n        const { error: confirmError } = await stripe.confirmCardPayment(response.clientSecret);\n        if (confirmError) {\n          throw confirmError;\n        }\n      }\n\n      toast({\n        title: \"Payment Successful\",\n        description: \"Your verification fee has been processed. Submitting your application...\",\n      });\n      onPaymentSuccess();\n\n    } catch (error: any) {\n      console.error(\"Payment error:\", error);\n      toast({\n        title: \"Payment Failed\",\n        description: error.message || \"An error occurred while processing your payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <DollarSign className=\"h-5 w-5 text-teal-600\" />\n          <h3 className=\"font-semibold text-teal-800\">Expert Verification Fee</h3>\n        </div>\n        <p className=\"text-teal-700 text-sm mb-3\">\n          A one-time $100 verification fee ensures the quality and authenticity of our expert community.\n        </p>\n        <div className=\"text-2xl font-bold text-teal-800\">$100.00</div>\n      </div>\n\n      <div className=\"p-4 border rounded-lg\">\n        <CardElement \n          options={{\n            style: {\n              base: {\n                fontSize: '16px',\n                color: '#424770',\n                '::placeholder': {\n                  color: '#aab7c4',\n                },\n              },\n              invalid: {\n                color: '#9e2146',\n              },\n            },\n          }}\n        />\n      </div>\n      \n      <Button \n        type=\"submit\" \n        disabled={!stripe || isProcessing} \n        className=\"w-full\"\n        size=\"lg\"\n      >\n        {isProcessing ? (\n          <>\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n            Processing...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-4 h-4 mr-2\" />\n            Pay $100 & Submit Application\n          </>\n        )}\n      </Button>\n    </form>\n  );\n};\n\nexport default function ExpertApplicationWithPaymentTest() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'form' | 'payment' | 'success'>('form');\n  const [applicationData, setApplicationData] = useState<ExpertApplicationForm | null>(null);\n  const [profileImage, setProfileImage] = useState<File | null>(null);\n  const [licenseFile, setLicenseFile] = useState<File | null>(null);\n\n  // Check if user already has an expert verification\n  const { data: existingApplication, isLoading: checkingExisting } = useQuery({\n    queryKey: ['/api/experts/my-application'],\n    enabled: !!user?.id,\n    retry: false,\n    queryFn: async () => {\n      const res = await apiRequest('GET', '/api/experts/my-application');\n      if (res.status === 404) {\n        return null;\n      }\n      return res.json();\n    }\n  });\n\n  const form = useForm<ExpertApplicationForm>({\n    resolver: zodResolver(expertApplicationSchema),\n    defaultValues: {\n      profession: \"\",\n      expertiseArea: \"\",\n      yearsOfExperience: 5,\n      credentials: \"\",\n      bio: \"\",\n      licenseNumber: \"\",\n      company: \"\",\n      companyAddress: \"\",\n      companyWebsite: \"\",\n      companyEmail: \"\",\n      websiteUrl: \"\",\n      linkedinUrl: \"\",\n      blogUrl: \"\",\n      booksUrl: \"\",\n      articlesUrl: \"\",\n      consultationRate: 150,\n      consultationEnabled: true,\n      reasonForApplying: \"\",\n      importFromLinkedIn: false,\n    },\n  });\n\n  const submitApplicationMutation = useMutation({\n    mutationFn: async (data: ExpertApplicationForm) => {\n      let profileImageUrl: string | undefined = undefined;\n      let licenseFileUrl: string | undefined = undefined;\n\n      if (!user) {\n        throw new Error(\"User not authenticated for file upload.\");\n      }\n\n      try {\n        // Handle profile image upload\n        if (profileImage) {\n          console.log('Uploading profile image...');\n          const { url, error } = await uploadFile(profileImage, user.id, 'profile');\n          if (error) {\n            throw new Error(`Profile image upload failed: ${error}`);\n          }\n          profileImageUrl = url || undefined;\n        }\n\n        // Handle license file upload\n        if (licenseFile) {\n          console.log('Uploading license file...');\n          const { url, error } = await uploadFile(licenseFile, user.id, 'license');\n          if (error) {\n            throw new Error(`License file upload failed: ${error}`);\n          }\n          licenseFileUrl = url || undefined;\n        }\n        \n        console.log('Files uploaded successfully, submitting application...');\n        const payload = { ...data, profileImageUrl, licenseFileUrl };\n        \n        return await apiRequest(\"POST\", \"/api/experts/apply-with-payment\", payload);\n      } catch (error: any) {\n        console.error('Application submission error:', error);\n        throw error;\n      }\n    },\n    onSuccess: () => {\n      setStep('success');\n      toast({\n        title: \"Application Submitted\",\n        description: \"Your expert verification application has been submitted for review.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Application Failed\",\n        description: error.message || \"Failed to submit application. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onFormSubmit = (data: ExpertApplicationForm) => {\n    setApplicationData(data);\n    setStep('payment');\n  };\n\n  const onPaymentSuccess = () => {\n    if (applicationData) {\n      submitApplicationMutation.mutate(applicationData);\n    }\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <UserCheck className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to apply for expert verification status.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (checkingExisting) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  if (step === 'payment') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n        <div className=\"max-w-2xl mx-auto\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5\" />\n                Complete Your Expert Verification\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Elements stripe={stripePromise}>\n                <PaymentForm onPaymentSuccess={onPaymentSuccess} />\n              </Elements>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Application Submitted Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Thank you for your payment and application. Our team will review your credentials and get back to you within 3-5 business days.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/'}>\n                Return to Home\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">Apply for Expert Verification</h1>\n          <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n            Join our trusted community of verified experts and start earning through consultations. \n            One-time $100 verification fee ensures quality and authenticity.\n          </p>\n        </div>\n        \n        <p className=\"text-center text-gray-600\">Form would go here...</p>\n        <Button onClick={() => setStep('payment')} className=\"mx-auto block mt-8\">\n          Proceed to Payment (Test)\n        </Button>\n      </div>\n    </div>\n  );\n}","size_bytes":14104},"client/src/pages/ThisWeekBy.tsx":{"content":"import { useState, useEffect, useCallback, useMemo } from \"react\";\nimport {\n  ChevronDown,\n  ChevronUp,\n  ExternalLink,\n  Loader2,\n  Heart,\n} from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport MainLayout from \"@/components/MainLayout\";\nimport EmbedContent from \"@/components/EmbedContent\";\nimport DynamicDiscussionTopicsSidebar from \"@/components/DynamicDiscussionTopicsSidebar\";\n\ninterface Source {\n  id: number;\n  categoryId: string;\n  categoryName: string;\n  name: string;\n  description: string | null;\n  embedCode: string | null;\n  websiteUrl: string | null;\n  isActive: boolean;\n  orderIndex: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Category {\n  id: string;\n  name: string;\n  sources: Source[];\n}\n\n// Category definitions\nconst categoryDefinitions = [\n  { id: \"authors\", name: \"Authors\" },\n  { id: \"newspapers\", name: \"Newspapers & Magazines\" },\n  { id: \"bloggers\", name: \"Bloggers & Writers\" },\n  { id: \"podcasters\", name: \"Podcasters & YouTubers\" },\n  { id: \"retirement-care-pros\", name: \"Retirement & Care Professionals\" },\n  { id: \"industry-leaders\", name: \"Industry Thought Leaders\" },\n];\n\nexport default function ThisWeekBy() {\n  const { toast } = useToast();\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [expandedSource, setExpandedSource] = useState<string | null>(null);\n\n\n  // Fetch all content sources\n  const { data: sources = [], isLoading } = useQuery<Source[]>({\n    queryKey: [\"/api/content-sources\"],\n  });\n\n  // Fetch user's favorite sources\n  const { data: favorites = [] } = useQuery<Source[]>({\n    queryKey: [\"/api/content-sources/favorites\"],\n  });\n\n  // Mutation for toggling favorite status\n  const toggleFavoriteMutation = useMutation({\n    mutationFn: async (sourceId: number) => {\n      return apiRequest(\"POST\", `/api/content-sources/${sourceId}/favorite`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/content-sources/favorites\"],\n      });\n      toast({\n        title: \"Success\",\n        description: \"Favorite status updated\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update favorite status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper function to check if a source is favorited\n  const isFavorited = useCallback(\n    (sourceId: number) => {\n      return favorites.some((fav: Source) => fav.id === sourceId);\n    },\n    [favorites],\n  );\n\n  // Group sources by category using useMemo to prevent infinite loops\n  const categories = useMemo(() => {\n    if (sources.length > 0) {\n      return categoryDefinitions.map((catDef) => {\n        const categorySources = sources.filter(\n          (source: Source) => source.categoryId === catDef.id,\n        );\n\n        // Sort sources with favorites first\n        const sortedSources = categorySources.sort((a: Source, b: Source) => {\n          const aIsFavorite = favorites.some((fav: Source) => fav.id === a.id);\n          const bIsFavorite = favorites.some((fav: Source) => fav.id === b.id);\n\n          if (aIsFavorite && !bIsFavorite) return -1;\n          if (!aIsFavorite && bIsFavorite) return 1;\n\n          // If both are favorites or both are not, maintain original order\n          return a.orderIndex - b.orderIndex;\n        });\n\n        return {\n          id: catDef.id,\n          name: catDef.name,\n          sources: sortedSources,\n        };\n      });\n    } else {\n      // If no sources from API, return empty categories\n      return categoryDefinitions.map((catDef) => ({\n        id: catDef.id,\n        name: catDef.name,\n        sources: [],\n      }));\n    }\n  }, [sources, favorites]);\n\n  const handleCategoryClick = (categoryId: string) => {\n    if (selectedCategory === categoryId) {\n      setSelectedCategory(null);\n      setExpandedSource(null);\n    } else {\n      setSelectedCategory(categoryId);\n      setExpandedSource(null);\n    }\n  };\n\n  const handleSourceClick = (sourceId: number) => {\n    setExpandedSource(\n      expandedSource === sourceId.toString() ? null : sourceId.toString(),\n    );\n  };\n\n  const selectedCategoryData = categories.find(\n    (cat) => cat.id === selectedCategory,\n  );\n\n  if (isLoading) {\n    return (\n      <MainLayout>\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout showSidebar={false}>\n      <div className=\"grid lg:grid-cols-12 gap-8\">\n        {/* Left Sidebar - 25% width (3/12) */}\n        <div className=\"lg:col-span-3\">\n          <DynamicDiscussionTopicsSidebar />\n        </div>\n\n        {/* Main Content - 75% width (9/12) */}\n        <div className=\"lg:col-span-9\">\n          <div>\n        {/* Categories - Compact Horizontal Layout */}\n        <div className=\"mb-9\">\n          <h2 className=\"text-lg font-semibold mb-3 text-center\">\n            This Week by your community's favorite sources . . .\n          </h2>\n          <p className=\"text-center text-gray-600 mb-4 max-w-7xl mx-auto leading-[1.75rem]\">\n            Searching the web today is overwhelming. So we searched it and\n            curated it for you. See who's talking retirement or care this week\n            and what they posted. When you want to see more, just click to go to\n            their page! If there is a voice you know that you think we should\n            add, just let us know!\n            <br />\n          </p>\n          <div className=\"mb-10\"></div>\n          <div className=\"grid grid-cols-6 gap-2\">\n            {categories.map((category) => {\n              // Split category name for two-line display\n              const words = category.name.split(/\\s+/);\n              let line1, line2;\n\n              if (words.length === 2) {\n                [line1, line2] = words;\n              } else if (category.name.includes(\"&\")) {\n                const parts = category.name.split(\"&\");\n                line1 = parts[0].trim();\n                line2 = \"& \" + parts[1].trim();\n              } else {\n                line1 = words[0];\n                line2 = words.slice(1).join(\" \");\n              }\n\n              return (\n                <button\n                  key={category.id}\n                  className={`p-3 text-sm border rounded-lg text-center transition-colors ${\n                    selectedCategory === category.id\n                      ? \"bg-[#23757a] border-[#23757a] text-[#fefefe]\"\n                      : \"bg-white border-gray-300 hover:border-gray-400\"\n                  }`}\n                  onClick={() => handleCategoryClick(category.id)}\n                >\n                  <div className=\"font-medium\">{line1}</div>\n                  <div className=\"font-medium\">{line2} ({category.sources.length})</div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Sources Display */}\n        {selectedCategory && selectedCategoryData ? (\n          <div>\n            {selectedCategoryData.sources.length > 0 ? (\n              <div>\n                {/* Render sources in rows of 3 with inline accordion */}\n                {(() => {\n                  const sourcesPerRow = 3;\n                  const rows = [];\n\n                  for (\n                    let i = 0;\n                    i < selectedCategoryData.sources.length;\n                    i += sourcesPerRow\n                  ) {\n                    const rowSources = selectedCategoryData.sources.slice(\n                      i,\n                      i + sourcesPerRow,\n                    );\n                    const rowIndex = Math.floor(i / sourcesPerRow);\n\n                    // Check if any source in this row is expanded\n                    const expandedSourceInRow = rowSources.find(\n                      (source) => source.id.toString() === expandedSource,\n                    );\n\n                    rows.push(\n                      <div key={`row-${rowIndex}`}>\n                        {/* Source cards for this row */}\n                        <div\n                          className={`grid grid-cols-3 gap-4 ${rowIndex > 0 ? \"mt-4\" : \"\"}`}\n                        >\n                          {rowSources.map((source, index) => (\n                            <div\n                              key={source.id}\n                              className={`pb-3 ${\n                                rowIndex > 0\n                                  ? \"border-t border-gray-200 pt-4\"\n                                  : \"\"\n                              }`}\n                            >\n                              <div className=\"flex items-start justify-between gap-2\">\n                                <div\n                                  className=\"flex-1 cursor-pointer\"\n                                  onClick={() => handleSourceClick(source.id)}\n                                >\n                                  <h4 className=\"text-blue-600 hover:underline text-sm font-medium\">\n                                    {source.name}\n                                  </h4>\n                                  {source.description && (\n                                    <p className=\"text-gray-600 text-xs mt-1\">\n                                      {source.description}\n                                    </p>\n                                  )}\n                                </div>\n                                <button\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    toggleFavoriteMutation.mutate(source.id);\n                                  }}\n                                  className=\"p-1 hover:bg-gray-100 rounded transition-colors\"\n                                  disabled={toggleFavoriteMutation.isPending}\n                                >\n                                  <Heart\n                                    className={`w-4 h-4 ${\n                                      isFavorited(source.id)\n                                        ? \"text-red-500 fill-red-500\"\n                                        : \"text-gray-400\"\n                                    }`}\n                                  />\n                                </button>\n                              </div>\n                            </div>\n                          ))}\n                          {/* Fill empty grid cells to maintain layout */}\n                          {rowSources.length < sourcesPerRow &&\n                            Array(sourcesPerRow - rowSources.length)\n                              .fill(null)\n                              .map((_, idx) => (\n                                <div key={`empty-${rowIndex}-${idx}`} />\n                              ))}\n                        </div>\n\n                        {/* Expanded content immediately after this row */}\n                        {expandedSourceInRow && (\n                          <div className=\"relative z-10 -mx-4 mt-4 mb-6\">\n                            <div className=\"bg-white border border-gray-200 rounded-lg shadow-lg p-4\">\n                              <div className=\"flex items-center justify-between mb-4\">\n                                <div className=\"flex items-center gap-3\">\n                                  <h3 className=\"text-lg font-semibold\">\n                                    {expandedSourceInRow.name}\n                                  </h3>\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      toggleFavoriteMutation.mutate(\n                                        expandedSourceInRow.id,\n                                      );\n                                    }}\n                                    className=\"p-1 hover:bg-gray-100 rounded transition-colors\"\n                                    disabled={toggleFavoriteMutation.isPending}\n                                  >\n                                    <Heart\n                                      className={`w-5 h-5 ${\n                                        isFavorited(expandedSourceInRow.id)\n                                          ? \"text-red-500 fill-red-500\"\n                                          : \"text-gray-400\"\n                                      }`}\n                                    />\n                                  </button>\n                                </div>\n                                <div className=\"flex items-center gap-3\">\n                                  {expandedSourceInRow.websiteUrl && (\n                                    <a\n                                      href={expandedSourceInRow.websiteUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className=\"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm\"\n                                    >\n                                      <ExternalLink className=\"w-4 h-4\" />\n                                      Visit website\n                                    </a>\n                                  )}\n                                  <button\n                                    onClick={() => setExpandedSource(null)}\n                                    className=\"text-gray-500 hover:text-gray-700\"\n                                  >\n                                    <ChevronUp className=\"w-5 h-5\" />\n                                  </button>\n                                </div>\n                              </div>\n\n                              <div\n                                className=\"bg-gray-50 rounded-lg p-6 flex flex-col\"\n                                style={{ minHeight: \"1200px\" }}\n                              >\n                                <div className=\"flex-1\">\n                                  {expandedSourceInRow.embedCode ? (\n                                    <div className=\"overflow-auto h-full\">\n                                      <EmbedContent\n                                        embedCode={expandedSourceInRow.embedCode}\n                                      />\n                                    </div>\n                                  ) : (\n                                    <div className=\"flex items-center justify-center h-full\">\n                                      <div className=\"text-center\">\n                                        <p className=\"text-gray-500 mb-4\">\n                                          No embed content available yet.\n                                        </p>\n                                        {expandedSourceInRow.websiteUrl && (\n                                          <a\n                                            href={expandedSourceInRow.websiteUrl}\n                                            target=\"_blank\"\n                                            rel=\"noopener noreferrer\"\n                                            className=\"text-blue-600 hover:text-blue-800\"\n                                          >\n                                            Visit website â†’\n                                          </a>\n                                        )}\n                                      </div>\n                                    </div>\n                                  )}\n                                </div>\n                                <div className=\"mt-6 text-center\">\n                                  <button\n                                    onClick={() => {\n                                      setExpandedSource(null);\n                                      setTimeout(() => {\n                                        window.scrollTo({ top: 0, behavior: 'smooth' });\n                                      }, 100);\n                                    }}\n                                    className=\"bg-[#0B666B] text-white px-6 py-2 rounded-lg hover:bg-[#09555a] transition-colors\"\n                                  >\n                                    Close {expandedSourceInRow.name}\n                                  </button>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                      </div>,\n                    );\n                  }\n\n                  return rows;\n                })()}\n              </div>\n            ) : (\n              <div className=\"py-8\">\n                <p className=\"text-gray-500 text-center\">\n                  No sources available in this category yet.\n                </p>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <p className=\"text-gray-500\">Select a category to view sources</p>\n          </div>\n        )}\n          </div>\n        </div>\n      </div>\n    </MainLayout>\n  );\n}\n","size_bytes":17283},"test-sendgrid-detailed.js":{"content":"import dotenv from 'dotenv';\nimport sgMail from '@sendgrid/mail';\n\ndotenv.config();\n\nconst apiKey = process.env.SENDGRID_ASK_EDITH_1_API_KEY || process.env.SENDGRID_API_KEY;\nconst fromEmail = process.env.SENDGRID_FROM_EMAIL || 'elias@askedith.org';\n\nconsole.log('=== SendGrid Configuration ===');\nconsole.log('API Key found:', !!apiKey);\nconsole.log('API Key length:', apiKey ? apiKey.length : 0);\nconsole.log('API Key prefix:', apiKey ? apiKey.substring(0, 7) : 'N/A');\nconsole.log('From email:', fromEmail);\nconsole.log('To email:', 'papasavvaselias50@gmail.com');\n\nif (!apiKey) {\n  console.error('No SendGrid API key found!');\n  process.exit(1);\n}\n\nsgMail.setApiKey(apiKey);\n\nconst msg = {\n  to: 'papasavvaselias50@gmail.com',\n  from: fromEmail,\n  subject: 'Password Reset Test - AskEdith',\n  text: 'This is a test password reset email. If you receive this, SendGrid is working correctly.',\n  html: `\n    <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n      <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n        <h1 style=\"margin: 0;\">Password Reset Test</h1>\n      </div>\n      <div style=\"padding: 30px; background-color: #f5f5f5;\">\n        <p>This is a test email to verify SendGrid is working correctly.</p>\n        <p>If you're receiving this, the email service is functioning properly.</p>\n        <p>Timestamp: ${new Date().toISOString()}</p>\n      </div>\n    </div>\n  `,\n};\n\nconsole.log('\\n=== Sending test email ===');\n\nsgMail\n  .send(msg)\n  .then((response) => {\n    console.log('âœ“ Email sent successfully!');\n    console.log('Response status:', response[0].statusCode);\n    console.log('Response headers:', response[0].headers);\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('âœ— SendGrid error:', error.message);\n    if (error.response) {\n      console.error('Response status:', error.response.statusCode);\n      console.error('Response body:', JSON.stringify(error.response.body, null, 2));\n      console.error('Response headers:', error.response.headers);\n    }\n    process.exit(1);\n  });","size_bytes":2104},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"DEPLOYMENT.md":{"content":"# Deployment Guide\n\n## Issue: Blank White Screen After Deployment\n\nIf you see a blank white screen after deploying your app, this means the production server is not properly serving the built static files.\n\n## Solution\n\n### 1. Build the Application\n```bash\n./deploy.sh\n```\n\n### 2. Deploy with Correct Environment\nMake sure your deployment platform sets:\n```\nNODE_ENV=production\n```\n\n### 3. Start Command\nUse this start command:\n```bash\nnode dist/index.js\n```\n\n## What This Fixes\n\n- **Environment Detection**: The server now correctly detects production mode using `process.env.NODE_ENV === \"production\"`\n- **Static File Serving**: In production, serves built files from `server/public/` instead of using Vite dev server\n- **Proper Build Process**: The deployment script builds both frontend and backend correctly\n\n## Verification\n\nYour production deployment should:\n1. Serve static HTML/CSS/JS files (not Vite dev content)\n2. Load your React application properly\n3. Connect to your database and API endpoints\n\nThe blank white screen issue is now resolved!","size_bytes":1055},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"send-urgent-test.js":{"content":"import sgMail from '@sendgrid/mail';\n\nconst apiKey = process.env.SENDGRID_ASK_EDITH_1_API_KEY;\nsgMail.setApiKey(apiKey);\n\nconst token = '155decfb29b312a0fb80acbb218861b971decc564b8675ffc16715a12251c3ed';\nconst resetUrl = `https://29702bf1-770c-4095-afdd-dc8fcc65ffbb-00-1s9hnopi7aao4.worf.replit.dev/reset-password?token=${token}`;\n\nconst msg = {\n  to: 'papasavvaselias50@gmail.com',\n  from: 'elias@askedith.org',\n  subject: 'Important: Your AskEdith Account Access',\n  text: `Password Reset Link: ${resetUrl}`,\n  html: `\n    <div style=\"font-family: Arial, sans-serif;\">\n      <h2>Password Reset for AskEdith</h2>\n      <p>Hi Elias,</p>\n      <p>Click here to reset your password:</p>\n      <p><a href=\"${resetUrl}\">${resetUrl}</a></p>\n      <p>This link expires in 1 hour.</p>\n      <p>If you're not receiving our emails, please check your spam folder and mark this email as \"Not Spam\".</p>\n    </div>\n  `,\n};\n\nconsole.log('Sending test email with different subject...');\n\nsgMail\n  .send(msg)\n  .then(() => {\n    console.log('âœ“ Email sent! Check inbox AND spam folder at papasavvaselias50@gmail.com');\n  })\n  .catch((error) => {\n    console.error('Error:', error.message);\n  });","size_bytes":1182},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/SignupModal.tsx":{"content":"import { useState } from \"react\";\nimport { X, Shield, Crown, Check } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface SignupModalProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst US_STATES = [\n  \"Alabama\",\n  \"Alaska\",\n  \"Arizona\",\n  \"Arkansas\",\n  \"California\",\n  \"Colorado\",\n  \"Connecticut\",\n  \"Delaware\",\n  \"Florida\",\n  \"Georgia\",\n  \"Hawaii\",\n  \"Idaho\",\n  \"Illinois\",\n  \"Indiana\",\n  \"Iowa\",\n  \"Kansas\",\n  \"Kentucky\",\n  \"Louisiana\",\n  \"Maine\",\n  \"Maryland\",\n  \"Massachusetts\",\n  \"Michigan\",\n  \"Minnesota\",\n  \"Mississippi\",\n  \"Missouri\",\n  \"Montana\",\n  \"Nebraska\",\n  \"Nevada\",\n  \"New Hampshire\",\n  \"New Jersey\",\n  \"New Mexico\",\n  \"New York\",\n  \"North Carolina\",\n  \"North Dakota\",\n  \"Ohio\",\n  \"Oklahoma\",\n  \"Oregon\",\n  \"Pennsylvania\",\n  \"Rhode Island\",\n  \"South Carolina\",\n  \"South Dakota\",\n  \"Tennessee\",\n  \"Texas\",\n  \"Utah\",\n  \"Vermont\",\n  \"Virginia\",\n  \"Washington\",\n  \"West Virginia\",\n  \"Wisconsin\",\n  \"Wyoming\",\n];\n\nexport default function SignupModal({ open, onClose }: SignupModalProps) {\n  const { registerMutation } = useAuth();\n  const [isProfessional, setIsProfessional] = useState(false);\n  const [formData, setFormData] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    email: \"\",\n    password: \"\",\n    communityName: \"\",\n    city: \"\",\n    state: \"\",\n    introduction: \"\",\n    premiumSelected: false,\n    termsAccepted: false,\n    // Professional fields\n    company: \"\",\n    companyWebsite: \"\",\n    companyPhone: \"\",\n    profession: \"\",\n    licenseNumber: \"\",\n    associationMembership: \"\",\n    // Appointment booking fields\n    allowBooking: false,\n    calendlyLink: \"\",\n  });\n\n  const handleSignup = () => {\n    if (!formData.termsAccepted) {\n      // toast is handled in useAuth hook\n      return;\n    }\n\n    if (\n      !formData.firstName ||\n      !formData.lastName ||\n      !formData.email ||\n      !formData.password ||\n      !formData.communityName\n    ) {\n      // toast is handled in useAuth hook\n      return;\n    }\n\n    registerMutation.mutate(\n      {\n        username: formData.communityName,\n        email: formData.email,\n        password: formData.password,\n        firstName: formData.firstName,\n        lastName: formData.lastName,\n        communityName: formData.communityName,\n        city: formData.city,\n        state: formData.state,\n        introduction: formData.introduction,\n        defaultProfileType: isProfessional ? \"tree\" : \"daisy\",\n        role: isProfessional ? \"expert\" : \"user\",\n      },\n      {\n        onSuccess: () => {\n          onClose(); // Close modal on success, redirect is handled in useAuth\n        },\n      },\n    );\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    handleSignup();\n  };\n\n  const handleInputChange = (field: string, value: string | boolean) => {\n    setFormData((prev) => ({ ...prev, [field]: value }));\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-2xl max-h-[95vh] overflow-y-auto p-6\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl font-bold text-gray-900\">\n            Join Our Caring Community\n          </DialogTitle>\n          <DialogDescription className=\"text-gray-600\">\n            Create your account and start connecting with fellow caregivers\n            today.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6 pb-4\">\n          {/* Professional Signup Toggle */}\n          <div className=\"bg-teal-50 border border-teal-200 rounded-lg p-4 mb-6\">\n            <div className=\"flex items-center space-x-3\">\n              <Checkbox\n                id=\"professional\"\n                checked={isProfessional}\n                onCheckedChange={(checked) =>\n                  setIsProfessional(checked as boolean)\n                }\n                className=\"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600\"\n              />\n              <div>\n                <Label\n                  htmlFor=\"professional\"\n                  className=\"text-sm font-medium text-teal-800 cursor-pointer\"\n                >\n                  I'm a healthcare or eldercare professional\n                </Label>\n                <p className=\"text-xs text-teal-600 mt-1\">\n                  Join as a verified expert with consultation capabilities ($100\n                  verification fee)\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <div>\n              <Label\n                htmlFor=\"firstName\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                First Name\n              </Label>\n              <Input\n                id=\"firstName\"\n                type=\"text\"\n                placeholder=\"Sarah\"\n                value={formData.firstName}\n                onChange={(e) => handleInputChange(\"firstName\", e.target.value)}\n                className=\"mt-1\"\n                required\n              />\n            </div>\n            <div>\n              <Label\n                htmlFor=\"lastName\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                Last Name\n              </Label>\n              <Input\n                id=\"lastName\"\n                type=\"text\"\n                placeholder=\"Johnson\"\n                value={formData.lastName}\n                onChange={(e) => handleInputChange(\"lastName\", e.target.value)}\n                className=\"mt-1\"\n                required\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label\n              htmlFor=\"communityName\"\n              className=\"text-sm font-medium text-gray-700\"\n            >\n              Your Community Name\n            </Label>\n            <Input\n              id=\"communityName\"\n              type=\"text\"\n              placeholder=\"Choose a name others will see (e.g., CaringDaughter, Portland_Helper)\"\n              value={formData.communityName}\n              onChange={(e) =>\n                handleInputChange(\"communityName\", e.target.value)\n              }\n              className=\"mt-1\"\n              required\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">\n              This name keeps your identity private while connecting with the\n              community\n            </p>\n          </div>\n\n          <div>\n            <Label\n              htmlFor=\"email\"\n              className=\"text-sm font-medium text-gray-700\"\n            >\n              Email Address\n            </Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              placeholder=\"sarah@example.com\"\n              value={formData.email}\n              onChange={(e) => handleInputChange(\"email\", e.target.value)}\n              className=\"mt-1\"\n              required\n            />\n          </div>\n\n          <div>\n            <Label\n              htmlFor=\"password\"\n              className=\"text-sm font-medium text-gray-700\"\n            >\n              Create Password\n            </Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n              value={formData.password}\n              onChange={(e) => handleInputChange(\"password\", e.target.value)}\n              className=\"mt-1\"\n              required\n            />\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            <div>\n              <Label\n                htmlFor=\"city\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                City\n              </Label>\n              <Input\n                id=\"city\"\n                type=\"text\"\n                placeholder=\"Portland\"\n                value={formData.city}\n                onChange={(e) => handleInputChange(\"city\", e.target.value)}\n                className=\"mt-1\"\n              />\n            </div>\n            <div>\n              <Label\n                htmlFor=\"state\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                State\n              </Label>\n              <Select\n                onValueChange={(value) => handleInputChange(\"state\", value)}\n              >\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue placeholder=\"Select state\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {US_STATES.map((state) => (\n                    <SelectItem key={state} value={state}>\n                      {state}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Professional Fields - Only show when isProfessional is true */}\n          {isProfessional && (\n            <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-4\">\n              <h3 className=\"text-lg font-semibold text-amber-800 mb-4\">\n                Professional Information\n              </h3>\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label\n                    htmlFor=\"company\"\n                    className=\"text-sm font-medium text-gray-700\"\n                  >\n                    Company/Organization\n                  </Label>\n                  <Input\n                    id=\"company\"\n                    type=\"text\"\n                    placeholder=\"Compassionate Care Services\"\n                    value={formData.company}\n                    onChange={(e) =>\n                      handleInputChange(\"company\", e.target.value)\n                    }\n                    className=\"mt-1\"\n                    required={isProfessional}\n                  />\n                </div>\n                <div>\n                  <Label\n                    htmlFor=\"companyWebsite\"\n                    className=\"text-sm font-medium text-gray-700\"\n                  >\n                    Company Website\n                  </Label>\n                  <Input\n                    id=\"companyWebsite\"\n                    type=\"url\"\n                    placeholder=\"https://www.yourcompany.com\"\n                    value={formData.companyWebsite}\n                    onChange={(e) =>\n                      handleInputChange(\"companyWebsite\", e.target.value)\n                    }\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label\n                  htmlFor=\"companyPhone\"\n                  className=\"text-sm font-medium text-gray-700\"\n                >\n                  Company Phone\n                </Label>\n                <Input\n                  id=\"companyPhone\"\n                  type=\"tel\"\n                  placeholder=\"(555) 123-4567\"\n                  value={formData.companyPhone}\n                  onChange={(e) =>\n                    handleInputChange(\"companyPhone\", e.target.value)\n                  }\n                  className=\"mt-1\"\n                  required={isProfessional}\n                />\n              </div>\n\n              <div>\n                <Label\n                  htmlFor=\"profession\"\n                  className=\"text-sm font-medium text-gray-700\"\n                >\n                  Profession\n                </Label>\n                <Select\n                  onValueChange={(value) =>\n                    handleInputChange(\"profession\", value)\n                  }\n                >\n                  <SelectTrigger className=\"mt-1\">\n                    <SelectValue placeholder=\"Select your profession\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"home-care-professional\">\n                      Home Care Professional\n                    </SelectItem>\n                    <SelectItem value=\"elder-law-attorney\">\n                      Elder Law Attorney\n                    </SelectItem>\n                    <SelectItem value=\"geriatrician\">Geriatrician</SelectItem>\n                    <SelectItem value=\"registered-nurse\">\n                      Registered Nurse\n                    </SelectItem>\n                    <SelectItem value=\"social-worker\">Social Worker</SelectItem>\n                    <SelectItem value=\"physical-therapist\">\n                      Physical Therapist\n                    </SelectItem>\n                    <SelectItem value=\"occupational-therapist\">\n                      Occupational Therapist\n                    </SelectItem>\n                    <SelectItem value=\"financial-advisor\">\n                      Financial Advisor\n                    </SelectItem>\n                    <SelectItem value=\"care-manager\">Care Manager</SelectItem>\n                    <SelectItem value=\"other\">Other</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <Label\n                    htmlFor=\"licenseNumber\"\n                    className=\"text-sm font-medium text-gray-700\"\n                  >\n                    License Number (if applicable)\n                  </Label>\n                  <Input\n                    id=\"licenseNumber\"\n                    type=\"text\"\n                    placeholder=\"License #123456\"\n                    value={formData.licenseNumber}\n                    onChange={(e) =>\n                      handleInputChange(\"licenseNumber\", e.target.value)\n                    }\n                    className=\"mt-1\"\n                  />\n                </div>\n                <div>\n                  <Label\n                    htmlFor=\"associationMembership\"\n                    className=\"text-sm font-medium text-gray-700\"\n                  >\n                    Professional Association\n                  </Label>\n                  <Input\n                    id=\"associationMembership\"\n                    type=\"text\"\n                    placeholder=\"National Association of...\"\n                    value={formData.associationMembership}\n                    onChange={(e) =>\n                      handleInputChange(\"associationMembership\", e.target.value)\n                    }\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n\n              {/* Appointment Booking Settings */}\n              <div className=\"space-y-4 pt-4 border-t border-amber-200\">\n                <div className=\"flex items-start space-x-3\">\n                  <Checkbox\n                    id=\"allowBooking\"\n                    checked={formData.allowBooking}\n                    onCheckedChange={(checked) =>\n                      handleInputChange(\"allowBooking\", checked as boolean)\n                    }\n                    className=\"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600 mt-1\"\n                    data-testid=\"checkbox-allow-booking\"\n                  />\n                  <div>\n                    <Label\n                      htmlFor=\"allowBooking\"\n                      className=\"text-sm font-medium text-gray-700 cursor-pointer\"\n                    >\n                      Allow appointment booking after verification\n                    </Label>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Enable clients to book paid consultation sessions with you\n                    </p>\n                  </div>\n                </div>\n\n                {formData.allowBooking && (\n                  <div>\n                    <Label\n                      htmlFor=\"calendlyLink\"\n                      className=\"text-sm font-medium text-gray-700\"\n                    >\n                      Calendly Link\n                    </Label>\n                    <Input\n                      id=\"calendlyLink\"\n                      type=\"url\"\n                      placeholder=\"https://calendly.com/your-username\"\n                      value={formData.calendlyLink}\n                      onChange={(e) =>\n                        handleInputChange(\"calendlyLink\", e.target.value)\n                      }\n                      className=\"mt-1\"\n                      data-testid=\"input-calendly-link\"\n                    />\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Your Calendly link for appointment scheduling (set up your Calendly account separately)\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"bg-amber-100 border border-amber-300 rounded p-3 mt-4\">\n                <p className=\"text-sm text-amber-800\">\n                  <strong>Professional Verification:</strong> A $100\n                  verification fee will be required to confirm your credentials\n                  and enable consultation features.\n                </p>\n              </div>\n            </div>\n          )}\n\n          <div>\n            <Label\n              htmlFor=\"introduction\"\n              className=\"text-sm font-medium text-gray-700\"\n            >\n              What brings you to our community? (Optional)\n            </Label>\n            <Textarea\n              id=\"introduction\"\n              placeholder=\"Share a bit about your caregiving journey...\"\n              value={formData.introduction}\n              onChange={(e) =>\n                handleInputChange(\"introduction\", e.target.value)\n              }\n              className=\"mt-1 h-24\"\n            />\n          </div>\n\n          {/* <div className=\"bg-teal-50 rounded-xl p-4 border border-teal-200\">\n            <h3 className=\"font-semibold text-gray-900 mb-2 flex items-center\">\n              <Crown className=\"w-4 h-4 mr-2 text-teal-600\" />\n              Premium Membership ($9.99/month)\n            </h3>\n            <ul className=\"text-sm text-gray-600 space-y-1 mb-4\">\n              <li className=\"flex items-center\">\n                <Check className=\"w-4 h-4 mr-2 text-teal-500\" />\n                Priority support responses\n              </li>\n              <li className=\"flex items-center\">\n                <Check className=\"w-4 h-4 mr-2 text-teal-500\" />\n                Access to expert-only discussions\n              </li>\n              <li className=\"flex items-center\">\n                <Check className=\"w-4 h-4 mr-2 text-teal-500\" />\n                Monthly virtual support groups\n              </li>\n              <li className=\"flex items-center\">\n                <Check className=\"w-4 h-4 mr-2 text-teal-500\" />\n                Ad-free experience\n              </li>\n            </ul>\n            \n            <div className=\"flex items-center space-x-3\">\n              <Checkbox \n                id=\"premium\"\n                checked={formData.premiumSelected}\n                onCheckedChange={(checked) => handleInputChange(\"premiumSelected\", checked as boolean)}\n                className=\"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600\"\n              />\n              <Label htmlFor=\"premium\" className=\"text-sm font-medium text-gray-700\">\n                Add Premium Membership\n              </Label>\n            </div>\n          </div> */}\n\n          <div className=\"flex items-start space-x-3\">\n            <Checkbox\n              id=\"terms\"\n              checked={formData.termsAccepted}\n              onCheckedChange={(checked) =>\n                handleInputChange(\"termsAccepted\", checked as boolean)\n              }\n              className=\"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600\"\n              required\n            />\n            <Label htmlFor=\"terms\" className=\"text-sm text-gray-600\">\n              I agree to the{\" \"}\n              <a href=\"#\" className=\"text-teal-600 hover:underline\">\n                Community Guidelines\n              </a>{\" \"}\n              and{\" \"}\n              <a href=\"#\" className=\"text-teal-600 hover:underline\">\n                Privacy Policy\n              </a>\n            </Label>\n          </div>\n\n          <div className=\"mt-8 mb-4\">\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-teal-600 hover:bg-teal-700 text-white py-4 text-lg font-bold border-2 border-teal-800 shadow-xl\"\n              style={{ minHeight: \"56px\" }}\n              disabled={registerMutation.isPending}\n            >\n              {registerMutation.isPending\n                ? \"Joining...\"\n                : isProfessional\n                  ? \"Continue to Professional Verification\"\n                  : \"Join Your Community\"}\n            </Button>\n          </div>\n\n          <p className=\"text-center text-sm text-gray-500\">\n            Already have an account?{\" \"}\n            <button\n              type=\"button\"\n              onClick={() => (window.location.href = \"/auth\")}\n              className=\"text-teal-600 hover:underline\"\n            >\n              Sign in here\n            </button>\n          </p>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":21568},"server/graphql/resolvers.ts":{"content":"import { storage } from '../storage';\nimport { moderateContent } from '../moderation';\nimport { GraphQLScalarType, Kind } from 'graphql';\n\n// Custom Date scalar\nconst DateScalar = new GraphQLScalarType({\n  name: 'Date',\n  description: 'Date custom scalar type',\n  serialize(value: any) {\n    return value instanceof Date ? value.toISOString() : null;\n  },\n  parseValue(value: any) {\n    return new Date(value);\n  },\n  parseLiteral(ast) {\n    if (ast.kind === Kind.STRING) {\n      return new Date(ast.value);\n    }\n    return null;\n  },\n});\n\nexport const resolvers = {\n  Date: DateScalar,\n\n  // Type resolvers for nested data\n  User: {\n    expertVerification: async (parent: any) => {\n      return await storage.getExpertVerification(parent.id);\n    },\n    achievements: async (parent: any) => {\n      return await storage.getUserAchievements(parent.id);\n    },\n    posts: async (parent: any) => {\n      return await storage.getPostsByAuthor(parent.id);\n    },\n    comments: async (parent: any) => {\n      // Would need to implement getCommentsByAuthor in storage\n      return [];\n    }\n  },\n\n  Category: {\n    parent: async (parent: any) => {\n      if (!parent.parentId) return null;\n      return await storage.getCategoriesByParent(parent.parentId);\n    },\n    children: async (parent: any) => {\n      return await storage.getCategoriesByParent(parent.id);\n    },\n    posts: async (parent: any) => {\n      return await storage.getPosts(parent.id);\n    }\n  },\n\n  Post: {\n    category: async (parent: any) => {\n      const categories = await storage.getCategories();\n      return categories.find(cat => cat.id === parent.categoryId);\n    },\n    author: async (parent: any) => {\n      return await storage.getUser(parent.authorId);\n    },\n    source: async (parent: any) => {\n      return await storage.getPostSource(parent.id);\n    },\n    comments: async (parent: any) => {\n      return await storage.getCommentsByPost(parent.id);\n    },\n    votes: async (parent: any) => {\n      // Would need to implement getVotesByPost in storage\n      return [];\n    }\n  },\n\n  Comment: {\n    post: async (parent: any) => {\n      return await storage.getPost(parent.postId);\n    },\n    author: async (parent: any) => {\n      return await storage.getUser(parent.authorId);\n    },\n    parent: async (parent: any) => {\n      if (!parent.parentId) return null;\n      // Would need to implement getComment in storage\n      return null;\n    },\n    replies: async (parent: any) => {\n      // Would need to implement getRepliesByComment in storage\n      return [];\n    },\n    votes: async (parent: any) => {\n      // Would need to implement getVotesByComment in storage\n      return [];\n    }\n  },\n\n  Vote: {\n    user: async (parent: any) => {\n      return await storage.getUser(parent.userId);\n    }\n  },\n\n  UserAchievement: {\n    user: async (parent: any) => {\n      return await storage.getUser(parent.userId);\n    },\n    achievement: async (parent: any) => {\n      const achievements = await storage.getAchievements();\n      return achievements.find(ach => ach.id === parent.achievementId);\n    }\n  },\n\n  ExpertVerification: {\n    user: async (parent: any) => {\n      return await storage.getUser(parent.userId);\n    }\n  },\n\n  PostSource: {\n    post: async (parent: any) => {\n      return await storage.getPost(parent.postId);\n    }\n  },\n\n  Query: {\n    // User queries\n    user: async (_: any, { id }: { id: string }) => {\n      return await storage.getUser(id);\n    },\n    users: async (_: any, { limit = 20, offset = 0 }: { limit?: number; offset?: number }) => {\n      // Would need to implement getUsers in storage\n      return [];\n    },\n    currentUser: async (_: any, __: any, context: any) => {\n      if (!context.user) return null;\n      return await storage.getUser(context.user.id);\n    },\n\n    // Category queries\n    categories: async () => {\n      return await storage.getCategories();\n    },\n    category: async (_: any, { id, slug }: { id?: string; slug?: string }) => {\n      if (id) {\n        const categories = await storage.getCategories();\n        return categories.find(cat => cat.id === parseInt(id));\n      }\n      if (slug) {\n        return await storage.getCategoryBySlug(slug);\n      }\n      return null;\n    },\n    categoryHierarchy: async () => {\n      return await storage.getCategoryHierarchy();\n    },\n    categoriesByLevel: async (_: any, { level }: { level: number }) => {\n      return await storage.getCategoriesByLevel(level);\n    },\n    categoriesByParent: async (_: any, { parentId }: { parentId: string }) => {\n      return await storage.getCategoriesByParent(parseInt(parentId));\n    },\n\n    // Post queries\n    posts: async (_: any, { categoryId, limit = 20, offset = 0, authorId }: {\n      categoryId?: string;\n      limit?: number;\n      offset?: number;\n      authorId?: string;\n    }) => {\n      if (authorId) {\n        return await storage.getPostsByAuthor(authorId, limit, offset);\n      }\n      return await storage.getPosts(categoryId ? parseInt(categoryId) : undefined, limit, offset);\n    },\n    post: async (_: any, { id }: { id: string }) => {\n      return await storage.getPost(parseInt(id));\n    },\n    postsWithExpertInfo: async (_: any, { categoryId, limit = 20, offset = 0 }: {\n      categoryId?: string;\n      limit?: number;\n      offset?: number;\n    }) => {\n      return await storage.getPostsWithExpertInfo(\n        categoryId ? parseInt(categoryId) : undefined,\n        limit,\n        offset\n      );\n    },\n\n    // Comment queries\n    comments: async (_: any, { postId }: { postId: string }) => {\n      return await storage.getCommentsByPost(parseInt(postId));\n    },\n    comment: async (_: any, { id }: { id: string }) => {\n      // Would need to implement getComment in storage\n      return null;\n    },\n\n    // Achievement queries\n    achievements: async () => {\n      return await storage.getAchievements();\n    },\n    userAchievements: async (_: any, { userId }: { userId: string }) => {\n      return await storage.getUserAchievements(userId);\n    },\n\n    // Expert verification queries\n    expertVerification: async (_: any, { userId }: { userId: string }) => {\n      return await storage.getExpertVerification(userId);\n    },\n    verifiedExperts: async () => {\n      return await storage.getVerifiedExperts();\n    },\n    featuredExperts: async () => {\n      return await storage.getFeaturedExperts();\n    },\n\n    // Stats queries\n    communityStats: async () => {\n      return await storage.getCommunityStats();\n    },\n\n    // Moderation queries\n    moderationQueue: async () => {\n      return await storage.getModerationQueue();\n    },\n    moderationResult: async (_: any, { contentId }: { contentId: string }) => {\n      return await storage.getModerationResult(contentId);\n    }\n  },\n\n  Mutation: {\n    // User mutations\n    createUser: async (_: any, { input }: { input: any }) => {\n      return await storage.createUser(input);\n    },\n    updateUser: async (_: any, { id, input }: { id: string; input: any }) => {\n      // Would need to implement updateUser in storage\n      const user = await storage.getUser(id);\n      return user;\n    },\n\n    // Post mutations\n    createPost: async (_: any, { input }: { input: any }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      // Moderate content before creating\n      const moderationResult = await moderateContent(input.content, 'post');\n      if (moderationResult.status === 'rejected') {\n        throw new Error(`Content rejected: ${moderationResult.reason}`);\n      }\n\n      const postData = {\n        ...input,\n        categoryId: parseInt(input.categoryId),\n        authorId: context.user.id,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n\n      const post = await storage.createPost(postData);\n      \n      // Update category post count\n      await storage.updateCategoryPostCount(postData.categoryId);\n      \n      // Check for achievements\n      await storage.checkAndAwardAchievements(context.user.id);\n\n      return post;\n    },\n    updatePost: async (_: any, { id, title, content, tags }: {\n      id: string;\n      title?: string;\n      content?: string;\n      tags?: string[];\n    }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      const post = await storage.getPost(parseInt(id));\n      if (!post) {\n        throw new Error('Post not found');\n      }\n\n      if (post.authorId !== context.user.id) {\n        throw new Error('Not authorized to update this post');\n      }\n\n      // Would need to implement updatePost in storage\n      return post;\n    },\n    updatePostHelpfulVotes: async (_: any, { id, increment }: { id: string; increment: number }) => {\n      await storage.updatePostHelpfulVotes(parseInt(id), increment);\n      return await storage.getPost(parseInt(id));\n    },\n\n    // Comment mutations\n    createComment: async (_: any, { input }: { input: any }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      // Moderate content before creating\n      const moderationResult = await moderateContent(input.content, 'comment');\n      if (moderationResult.status === 'rejected') {\n        throw new Error(`Content rejected: ${moderationResult.reason}`);\n      }\n\n      const commentData = {\n        ...input,\n        postId: parseInt(input.postId),\n        parentId: input.parentId ? parseInt(input.parentId) : null,\n        authorId: context.user.id,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n\n      const comment = await storage.createComment(commentData);\n      \n      // Update post comment count\n      await storage.updatePostCommentCount(commentData.postId, 1);\n      \n      // Check for achievements\n      await storage.checkAndAwardAchievements(context.user.id);\n\n      return comment;\n    },\n    updateCommentHelpfulVotes: async (_: any, { id, increment }: { id: string; increment: number }) => {\n      await storage.updateCommentHelpfulVotes(parseInt(id), increment);\n      // Would need to implement getComment in storage\n      return null;\n    },\n\n    // Category mutations\n    createCategory: async (_: any, { input }: { input: any }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      const categoryData = {\n        ...input,\n        parentId: input.parentId ? parseInt(input.parentId) : null,\n        createdAt: new Date()\n      };\n\n      return await storage.createCategory(categoryData);\n    },\n\n    // Vote mutations\n    createVote: async (_: any, { input }: { input: any }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      const voteData = {\n        ...input,\n        postId: input.postId ? parseInt(input.postId) : null,\n        commentId: input.commentId ? parseInt(input.commentId) : null,\n        userId: context.user.id,\n        createdAt: new Date()\n      };\n\n      // Check if user already voted\n      const existingVote = await storage.getUserVote(\n        context.user.id,\n        voteData.postId,\n        voteData.commentId\n      );\n\n      if (existingVote) {\n        // Remove existing vote\n        await storage.deleteVote(context.user.id, voteData.postId, voteData.commentId);\n        \n        // Update helpful votes count\n        const increment = voteData.voteType === 'helpful' ? -1 : 1;\n        if (voteData.postId) {\n          await storage.updatePostHelpfulVotes(voteData.postId, increment);\n        } else if (voteData.commentId) {\n          await storage.updateCommentHelpfulVotes(voteData.commentId, increment);\n        }\n      }\n\n      const vote = await storage.createVote(voteData);\n      \n      // Update helpful votes count\n      const increment = voteData.voteType === 'helpful' ? 1 : -1;\n      if (voteData.postId) {\n        await storage.updatePostHelpfulVotes(voteData.postId, increment);\n      } else if (voteData.commentId) {\n        await storage.updateCommentHelpfulVotes(voteData.commentId, increment);\n      }\n\n      return vote;\n    },\n    deleteVote: async (_: any, { postId, commentId }: { postId?: string; commentId?: string }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      await storage.deleteVote(\n        context.user.id,\n        postId ? parseInt(postId) : undefined,\n        commentId ? parseInt(commentId) : undefined\n      );\n\n      return true;\n    },\n\n    // Expert verification mutations\n    createExpertVerification: async (_: any, { input }: { input: any }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      const verificationData = {\n        ...input,\n        userId: context.user.id,\n        status: 'pending',\n        createdAt: new Date()\n      };\n\n      return await storage.createExpertVerification(verificationData);\n    },\n    verifyExpert: async (_: any, { id }: { id: string }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      return await storage.verifyExpert(parseInt(id), context.user.id);\n    },\n\n    // Moderation mutations\n    updateModerationStatus: async (_: any, { id, status }: { id: string; status: string }, context: any) => {\n      if (!context.user) {\n        throw new Error('Authentication required');\n      }\n\n      await storage.updateModerationStatus(parseInt(id), status, context.user.id);\n      return await storage.getModerationResult(id);\n    }\n  }\n};","size_bytes":13543},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { \n  User, \n  Mail, \n  Bell, \n  Shield, \n  Eye, \n  Lock,\n  Trash2,\n  Save\n} from \"lucide-react\";\n\nexport default function SettingsPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [formData, setFormData] = useState({\n    firstName: user?.firstName || '',\n    lastName: user?.lastName || '',\n    email: user?.email || '',\n    introduction: user?.introduction || '',\n    location: user?.location || '',\n    caregivingRole: user?.caregivingRole || ''\n  });\n\n  const [notifications, setNotifications] = useState({\n    emailNotifications: true,\n    postReplies: true,\n    expertResponses: true,\n    weeklyDigest: true\n  });\n\n  const [privacy, setPrivacy] = useState({\n    profileVisible: true,\n    showLocation: true,\n    showEmail: false\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"PATCH\", \"/api/user/profile\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been successfully updated.\"\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update profile.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleProfileUpdate = () => {\n    updateProfileMutation.mutate(formData);\n  };\n\n  const handleDeleteAccount = () => {\n    if (confirm(\"Are you sure you want to delete your account? This action cannot be undone.\")) {\n      // Handle account deletion\n      toast({\n        title: \"Account Deletion\",\n        description: \"Please contact support to delete your account.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 py-8\">\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Account Settings</h1>\n          <p className=\"text-gray-600 mt-2\">Manage your account preferences and privacy settings</p>\n        </div>\n\n        <div className=\"space-y-6\">\n          {/* Profile Information */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"w-5 h-5\" />\n                Profile Information\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"firstName\">First Name</Label>\n                  <Input\n                    id=\"firstName\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData({...formData, firstName: e.target.value})}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"lastName\">Last Name</Label>\n                  <Input\n                    id=\"lastName\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData({...formData, lastName: e.target.value})}\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({...formData, email: e.target.value})}\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"location\">Location (City, State)</Label>\n                <Input\n                  id=\"location\"\n                  value={formData.location}\n                  onChange={(e) => setFormData({...formData, location: e.target.value})}\n                  placeholder=\"e.g., Boston, MA\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"caregivingRole\">Caregiving Role</Label>\n                <Input\n                  id=\"caregivingRole\"\n                  value={formData.caregivingRole}\n                  onChange={(e) => setFormData({...formData, caregivingRole: e.target.value})}\n                  placeholder=\"e.g., Caring for my mother with dementia\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"introduction\">Introduction</Label>\n                <Textarea\n                  id=\"introduction\"\n                  value={formData.introduction}\n                  onChange={(e) => setFormData({...formData, introduction: e.target.value})}\n                  placeholder=\"Tell the community about yourself and your caregiving journey...\"\n                  rows={4}\n                />\n              </div>\n\n              <Button \n                onClick={handleProfileUpdate}\n                disabled={updateProfileMutation.isPending}\n                className=\"bg-teal-600 hover:bg-teal-700\"\n              >\n                <Save className=\"w-4 h-4 mr-2\" />\n                {updateProfileMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Notification Preferences */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bell className=\"w-5 h-5\" />\n                Notification Preferences\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Email Notifications</Label>\n                  <p className=\"text-sm text-gray-500\">Receive important updates via email</p>\n                </div>\n                <Switch\n                  checked={notifications.emailNotifications}\n                  onCheckedChange={(checked) => \n                    setNotifications({...notifications, emailNotifications: checked})\n                  }\n                />\n              </div>\n              \n              <Separator />\n              \n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Post Replies</Label>\n                  <p className=\"text-sm text-gray-500\">Get notified when someone replies to your posts</p>\n                </div>\n                <Switch\n                  checked={notifications.postReplies}\n                  onCheckedChange={(checked) => \n                    setNotifications({...notifications, postReplies: checked})\n                  }\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Expert Responses</Label>\n                  <p className=\"text-sm text-gray-500\">Get notified when experts respond to your questions</p>\n                </div>\n                <Switch\n                  checked={notifications.expertResponses}\n                  onCheckedChange={(checked) => \n                    setNotifications({...notifications, expertResponses: checked})\n                  }\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Weekly Digest</Label>\n                  <p className=\"text-sm text-gray-500\">Receive a weekly summary of community activity</p>\n                </div>\n                <Switch\n                  checked={notifications.weeklyDigest}\n                  onCheckedChange={(checked) => \n                    setNotifications({...notifications, weeklyDigest: checked})\n                  }\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Privacy Settings */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Eye className=\"w-5 h-5\" />\n                Privacy Settings\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Public Profile</Label>\n                  <p className=\"text-sm text-gray-500\">Allow others to view your profile</p>\n                </div>\n                <Switch\n                  checked={privacy.profileVisible}\n                  onCheckedChange={(checked) => \n                    setPrivacy({...privacy, profileVisible: checked})\n                  }\n                />\n              </div>\n              \n              <Separator />\n              \n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Show Location</Label>\n                  <p className=\"text-sm text-gray-500\">Display your location on your profile</p>\n                </div>\n                <Switch\n                  checked={privacy.showLocation}\n                  onCheckedChange={(checked) => \n                    setPrivacy({...privacy, showLocation: checked})\n                  }\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <Label>Show Email</Label>\n                  <p className=\"text-sm text-gray-500\">Allow community members to see your email</p>\n                </div>\n                <Switch\n                  checked={privacy.showEmail}\n                  onCheckedChange={(checked) => \n                    setPrivacy({...privacy, showEmail: checked})\n                  }\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Security */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"w-5 h-5\" />\n                Security\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Button variant=\"outline\" className=\"w-full md:w-auto\">\n                <Lock className=\"w-4 h-4 mr-2\" />\n                Change Password\n              </Button>\n              \n              <Separator />\n              \n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                <h3 className=\"font-semibold text-red-900 mb-2\">Danger Zone</h3>\n                <p className=\"text-sm text-red-700 mb-4\">\n                  Once you delete your account, there is no going back. Please be certain.\n                </p>\n                <Button \n                  variant=\"destructive\" \n                  onClick={handleDeleteAccount}\n                  className=\"bg-red-600 hover:bg-red-700\"\n                >\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                  Delete Account\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":11779},"server/services/rag/embeddingService.ts":{"content":"import { OpenAIEmbeddings } from '@langchain/openai';\nimport { RecursiveCharacterTextSplitter } from 'langchain/text_splitter';\nimport { QaChunk, EmbeddingConfig } from './types';\n\nexport class EmbeddingService {\n  private embeddings: OpenAIEmbeddings;\n  private textSplitter: RecursiveCharacterTextSplitter;\n  private config: EmbeddingConfig;\n\n  constructor(config: EmbeddingConfig) {\n    this.config = config;\n    this.embeddings = new OpenAIEmbeddings({\n      modelName: config.model,\n      openAIApiKey: process.env.OPENAI_API_KEY,\n    });\n\n    this.textSplitter = new RecursiveCharacterTextSplitter({\n      chunkSize: config.chunkSize,\n      chunkOverlap: config.chunkOverlap,\n      separators: ['\\n\\n', '\\n', '. ', '! ', '? ', ' ', ''],\n    });\n  }\n\n  /**\n   * Split text into chunks for embedding\n   */\n  async splitText(text: string): Promise<string[]> {\n    return await this.textSplitter.splitText(text);\n  }\n\n  /**\n   * Generate embeddings for a single text\n   */\n  async generateEmbedding(text: string): Promise<number[]> {\n    const embedding = await this.embeddings.embedQuery(text);\n    return embedding;\n  }\n\n  /**\n   * Generate embeddings for multiple texts\n   */\n  async generateEmbeddings(texts: string[]): Promise<number[][]> {\n    const embeddings = await this.embeddings.embedDocuments(texts);\n    return embeddings;\n  }\n\n  /**\n   * Process QA data and create chunks with embeddings\n   */\n  async processQaData(qaData: Array<{\n    id: number;\n    question: string;\n    answer: string;\n    category?: string;\n    source: string;\n  }>): Promise<QaChunk[]> {\n    const chunks: QaChunk[] = [];\n\n    for (const qa of qaData) {\n      // Combine question and answer for context\n      const fullText = `Question: ${qa.question}\\n\\nAnswer: ${qa.answer}`;\n\n      // Split into chunks\n      // const textChunks = await this.splitText(fullText);\n\n      // Generate embeddings for all chunks\n      const embedding = await this.generateEmbedding(fullText);\n\n      // // Create chunk objects\n      // for (let i = 0; i < textChunks.length; i++) {\n\n      // }\n\n      chunks.push({\n        chunkText: fullText,\n        embedding: embedding,\n        metadata: {\n          id: qa.id,\n          question: qa.question,\n          category: qa.category,\n          source: qa.source,\n          chunkIndex: 0,\n          totalChunks: 1,\n        },\n      });\n    }\n\n    return chunks;\n  }\n\n  /**\n   * Calculate cosine similarity between two vectors\n   */\n  calculateSimilarity(vec1: number[], vec2: number[]): number {\n    if (vec1.length !== vec2.length) {\n      throw new Error('Vectors must have the same length');\n    }\n\n    const dotProduct = vec1.reduce((sum, val, i) => sum + val * vec2[i], 0);\n    const magnitude1 = Math.sqrt(vec1.reduce((sum, val) => sum + val * val, 0));\n    const magnitude2 = Math.sqrt(vec2.reduce((sum, val) => sum + val * val, 0));\n\n    return dotProduct / (magnitude1 * magnitude2);\n  }\n}\n","size_bytes":2917},"client/src/pages/AdminSearchLogs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface SearchLog {\n  id: number;\n  query: string;\n  answer: string;\n  userId: string | null;\n  source: string;\n  resultFound: boolean;\n  createdAt: string;\n}\n\nexport default function AdminSearchLogs() {\n  const [limit, setLimit] = useState(100);\n\n  const { data: searchLogs = [], isLoading } = useQuery<SearchLog[]>({\n    queryKey: ['/api/admin/search-logs', limit],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/search-logs?limit=${limit}`, {\n        credentials: 'include',\n      });\n      if (!response.ok) throw new Error('Failed to fetch search logs');\n      return response.json();\n    },\n    staleTime: 30 * 1000, // 30 seconds\n  });\n\n  // Calculate stats\n  const totalSearches = searchLogs.length;\n  const successfulSearches = searchLogs.filter(log => log.resultFound).length;\n  const successRate = totalSearches > 0 ? (successfulSearches / totalSearches * 100).toFixed(1) : 0;\n  \n  // Find most common queries\n  const queryFrequency = searchLogs.reduce((acc, log) => {\n    const query = log.query.toLowerCase();\n    acc[query] = (acc[query] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n  \n  const topQueries = Object.entries(queryFrequency)\n    .sort(([, a], [, b]) => b - a)\n    .slice(0, 5)\n    .map(([query, count]) => ({ query, count }));\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto py-8\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4\"></div>\n          <div className=\"space-y-3\">\n            <div className=\"h-32 bg-gray-200 rounded\"></div>\n            <div className=\"h-64 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4\">\n      <h1 className=\"text-3xl font-bold mb-6\">Search Analytics</h1>\n      \n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Searches</CardTitle>\n            <Search className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{totalSearches}</div>\n            <p className=\"text-xs text-muted-foreground\">Last {limit} searches</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Success Rate</CardTitle>\n            {Number(successRate) > 50 ? (\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n            ) : (\n              <TrendingDown className=\"h-4 w-4 text-red-600\" />\n            )}\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{successRate}%</div>\n            <p className=\"text-xs text-muted-foreground\">Found answers</p>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Top Queries</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-1\">\n              {topQueries.slice(0, 3).map((item, index) => (\n                <div key={index} className=\"text-sm\">\n                  <span className=\"font-medium\">{item.query}</span>\n                  <span className=\"text-muted-foreground ml-2\">({item.count})</span>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Search Logs Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Search Queries</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"overflow-x-auto\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[200px]\">Query</TableHead>\n                  <TableHead className=\"w-[400px]\">Answer</TableHead>\n                  <TableHead>Source</TableHead>\n                  <TableHead>Result</TableHead>\n                  <TableHead>User</TableHead>\n                  <TableHead>Time</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {searchLogs.map((log) => (\n                  <TableRow key={log.id}>\n                    <TableCell className=\"font-medium\">{log.query}</TableCell>\n                    <TableCell>\n                      <div className=\"max-w-[400px] truncate\" title={log.answer}>\n                        {log.answer}\n                      </div>\n                    </TableCell>\n                    <TableCell>{log.source}</TableCell>\n                    <TableCell>\n                      <Badge variant={log.resultFound ? \"default\" : \"secondary\"}>\n                        {log.resultFound ? \"Found\" : \"Not Found\"}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>{log.userId || \"Anonymous\"}</TableCell>\n                    <TableCell>\n                      {format(new Date(log.createdAt), \"MMM d, HH:mm\")}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n          \n          {/* Load More */}\n          <div className=\"mt-4 flex justify-center\">\n            <button\n              onClick={() => setLimit(limit + 100)}\n              className=\"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90\"\n            >\n              Load More\n            </button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":6286},"client/src/lib/categories.ts":{"content":"import { \n  Home, \n  HeartHandshake, \n  Landmark, \n  Scale, \n  DollarSign, \n  Activity, \n  Shield, \n  Users,\n  Stethoscope,\n  Building2\n} from \"lucide-react\";\n\nexport const categoryIcons: Record<string, any> = {\n  \"senior-living\": Home,\n  \"home-care\": HeartHandshake,\n  \"government-resources\": Landmark,\n  \"legal-attorneys\": Scale,\n  \"paying-for-care\": DollarSign,\n  \"physical-therapy\": Activity,\n  \"va-benefits\": Shield,\n  \"other-professionals\": Users,\n  \"healthcare\": Stethoscope,\n  \"housing\": Building2,\n};\n\nexport const categoryColors: Record<string, string> = {\n  \"senior-living\": \"rose\",\n  \"home-care\": \"blue\",\n  \"government-resources\": \"emerald\",\n  \"legal-attorneys\": \"amber\",\n  \"paying-for-care\": \"green\",\n  \"physical-therapy\": \"cyan\",\n  \"va-benefits\": \"teal\",\n  \"other-professionals\": \"indigo\",\n  \"healthcare\": \"purple\",\n  \"housing\": \"orange\",\n};\n\nexport const categoryDescriptions: Record<string, string> = {\n  \"senior-living\": \"Assisted living, memory care, and housing decisions for aging parents.\",\n  \"home-care\": \"In-home caregiving, daily routines, and managing care at home.\",\n  \"government-resources\": \"Medicare, Medicaid, benefits, and navigating government programs.\",\n  \"legal-attorneys\": \"Legal planning, estate matters, and working with attorneys.\",\n  \"paying-for-care\": \"Financial planning, insurance, and affording quality care options.\",\n  \"physical-therapy\": \"Rehabilitation, mobility, and physical therapy resources.\",\n  \"va-benefits\": \"Veterans Affairs benefits and resources for military families.\",\n  \"other-professionals\": \"Healthcare specialists, social workers, and other professional services.\",\n  \"healthcare\": \"Medical care, doctor visits, and healthcare coordination.\",\n  \"housing\": \"Housing modifications, accessibility, and living arrangements.\",\n};\n\nexport function getCategoryGradientClass(slug: string): string {\n  const color = categoryColors[slug] || \"gray\";\n  return `gradient-${color}`;\n}\n\nexport function getCategoryBackgroundClass(slug: string): string {\n  const color = categoryColors[slug] || \"gray\";\n  return `bg-${color}`;\n}\n\nexport function getCategoryIcon(slug: string) {\n  return categoryIcons[slug] || Users;\n}\n\nexport function getCategoryDescription(slug: string): string {\n  return categoryDescriptions[slug] || \"Community discussions and support.\";\n}\n","size_bytes":2310},"client/src/pages/RagSearchPage.tsx":{"content":"import React from 'react';\nimport { RagSearch } from '@/components/RagSearch';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Brain, Search, Zap, BookOpen, Shield, TrendingUp } from 'lucide-react';\n\nexport default function RagSearchPage() {\n  const { user } = useAuth();\n\n  const features = [\n    {\n      icon: Brain,\n      title: \"AI-Powered Search\",\n      description: \"Advanced semantic search that understands context and meaning\"\n    },\n    {\n      icon: Search,\n      title: \"Comprehensive Knowledge\",\n      description: \"Search through thousands of Q&A entries about ADUs and elder care\"\n    },\n    {\n      icon: Zap,\n      title: \"Instant Answers\",\n      description: \"Get detailed, context-aware answers in seconds\"\n    },\n    {\n      icon: BookOpen,\n      title: \"Source Attribution\",\n      description: \"Every answer includes sources and confidence scores\"\n    },\n    {\n      icon: Shield,\n      title: \"Expert Knowledge\",\n      description: \"Based on verified information from elder care professionals\"\n    },\n    {\n      icon: TrendingUp,\n      title: \"Always Learning\",\n      description: \"Continuously updated with the latest information and best practices\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-teal-50\">\n      {/* Hero Section */}\n      <div className=\"bg-white border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n          <div className=\"text-center\">\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"p-3 bg-blue-100 rounded-full\">\n                <Brain className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </div>\n            <h1 className=\"text-4xl font-bold text-gray-900 mb-4\">\n              AI-Powered Elder Care Assistant\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8 max-w-3xl mx-auto\">\n              Get instant, accurate answers to your questions about ADUs, elder care,\n              retirement planning, and more. Our AI searches through our comprehensive\n              knowledge base to provide you with the most relevant information.\n            </p>\n\n            {!user && (\n              <div className=\"flex justify-center space-x-4\">\n                <Button size=\"lg\" className=\"bg-blue-600 hover:bg-blue-700\">\n                  Start Searching\n                </Button>\n                <Button size=\"lg\" variant=\"outline\">\n                  Learn More\n                </Button>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Search Section */}\n          <div className=\"lg:col-span-2\">\n            <RagSearch />\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Features */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Zap className=\"h-5 w-5 mr-2 text-blue-600\" />\n                  Key Features\n                </CardTitle>\n                <CardDescription>\n                  What makes our AI assistant special\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {features.map((feature, index) => (\n                  <div key={index} className=\"flex items-start space-x-3\">\n                    <div className=\"p-2 bg-blue-100 rounded-lg\">\n                      <feature.icon className=\"h-4 w-4 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900 text-sm\">\n                        {feature.title}\n                      </h4>\n                      <p className=\"text-gray-600 text-xs\">\n                        {feature.description}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n\n            {/* Topics */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <BookOpen className=\"h-5 w-5 mr-2 text-green-600\" />\n                  Popular Topics\n                </CardTitle>\n                <CardDescription>\n                  Common questions we can help with\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {[\n                    \"ADU Design & Construction\",\n                    \"Elder Care Planning\",\n                    \"Retirement Finances\",\n                    \"Accessibility Modifications\",\n                    \"Government Benefits\",\n                    \"Legal Considerations\",\n                    \"Healthcare Options\",\n                    \"Family Caregiving\"\n                  ].map((topic, index) => (\n                    <div key={index} className=\"flex items-center justify-between p-2 bg-gray-50 rounded-lg\">\n                      <span className=\"text-sm text-gray-700\">{topic}</span>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        Popular\n                      </Badge>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Stats */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <TrendingUp className=\"h-5 w-5 mr-2 text-purple-600\" />\n                  Knowledge Base Stats\n                </CardTitle>\n                <CardDescription>\n                  Our comprehensive database\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Total Q&A Entries</span>\n                    <span className=\"font-semibold text-gray-900\">16,000+</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Topics Covered</span>\n                    <span className=\"font-semibold text-gray-900\">50+</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Expert Sources</span>\n                    <span className=\"font-semibold text-gray-900\">100+</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600\">Average Response Time</span>\n                    <span className=\"font-semibold text-gray-900\">&lt;2s</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Help */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center\">\n                  <Shield className=\"h-5 w-5 mr-2 text-orange-600\" />\n                  Need Help?\n                </CardTitle>\n                <CardDescription>\n                  Get additional support\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <Button variant=\"outline\" className=\"w-full justify-start\">\n                  <Search className=\"h-4 w-4 mr-2\" />\n                  Browse All Topics\n                </Button>\n                <Button variant=\"outline\" className=\"w-full justify-start\">\n                  <BookOpen className=\"h-4 w-4 mr-2\" />\n                  Expert Directory\n                </Button>\n                <Button variant=\"outline\" className=\"w-full justify-start\">\n                  <Shield className=\"h-4 w-4 mr-2\" />\n                  Contact Support\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      {/* Footer Section */}\n      <div className=\"bg-gray-50 border-t mt-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n          <div className=\"text-center\">\n            <h3 className=\"text-2xl font-bold text-gray-900 mb-4\">\n              Ready to Get Started?\n            </h3>\n            <p className=\"text-gray-600 mb-6 max-w-2xl mx-auto\">\n              Ask any question about elder care, ADUs, retirement planning, or related topics.\n              Our AI will search through our comprehensive knowledge base and provide you with\n              detailed, accurate answers with source citations.\n            </p>\n            <div className=\"flex justify-center space-x-4\">\n              <Button size=\"lg\" className=\"bg-blue-600 hover:bg-blue-700\">\n                Start Searching Now\n              </Button>\n              <Button size=\"lg\" variant=\"outline\">\n                View Example Questions\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9374},"server/middleware/clerkAuth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { clerkMiddleware, getAuth, requireAuth } from \"@clerk/express\";\nimport { storage } from \"../storage\";\nimport { UserRole, User } from \"@shared/schema\";\n\n// Extend Express Request to include Clerk properties\ndeclare module \"express-serve-static-core\" {\n  interface Request {\n    userId?: string;\n    auth?: {\n      userId?: string;\n      sessionId?: string;\n      isAuthenticated: boolean;\n    };\n  }\n}\n\n// Clerk base middleware - should be applied globally\n// Use the same publishable key as frontend for consistency\nconst publishableKey = process.env.CLERK_PUBLISHABLE_KEY || process.env.VITE_CLERK_PUBLISHABLE_KEY;\nexport const clerkAuth = clerkMiddleware({\n  publishableKey: publishableKey!,\n  secretKey: process.env.CLERK_SECRET_KEY!,\n});\n\n// Enhanced middleware that syncs Clerk user with our database\nexport const clerkAuthWithSync = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    // Get auth info from Clerk middleware (should be applied before this)\n    const auth = getAuth(req);\n    \n    if (!auth.isAuthenticated || !auth.userId) {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n\n    // Try to get user from our database\n    let user = await storage.getUser(auth.userId);\n    \n    // If user doesn't exist in our database, sync from Clerk automatically\n    if (!user) {\n      console.log(`User not found in database, syncing from Clerk: ${auth.userId}`);\n      \n      // Import user sync service and sync the user\n      const { syncUserWithDatabase } = await import(\"../services/userSync\");\n      user = await syncUserWithDatabase(auth.userId);\n    }\n\n    // Attach user to request\n    req.userId = auth.userId;\n    req.user = user;\n    \n    next();\n  } catch (error) {\n    console.error(\"Clerk authentication error:\", error);\n    res.status(401).json({ message: \"Authentication failed\" });\n  }\n};\n\n// Lightweight auth check that only verifies JWT without database sync\nexport const requireClerkAuth = requireAuth();\n\n// Simple auth middleware that adds user info to request if available\nexport const optionalAuth = (req: Request, res: Response, next: NextFunction) => {\n  const auth = getAuth(req);\n  \n  if (auth.isAuthenticated && auth.userId) {\n    req.userId = auth.userId;\n    req.auth = auth;\n  }\n  \n  next();\n};\n\n// Admin access control middleware\nexport const isAdmin = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const auth = getAuth(req);\n    \n    if (!auth.isAuthenticated || !auth.userId) {\n      return res.status(401).json({ message: \"Unauthorized - not logged in\" });\n    }\n\n    // Get user from database\n    const user = await storage.getUser(auth.userId);\n    \n    if (!user) {\n      return res.status(401).json({ message: \"User not found\" });\n    }\n    \n    if (user.role !== 'admin') {\n      return res.status(403).json({ message: \"Forbidden: Admin access required\" });\n    }\n\n    // Attach user to request\n    req.userId = auth.userId;\n    req.user = user;\n    \n    next();\n  } catch (error) {\n    console.error(\"Admin authorization error:\", error);\n    res.status(500).json({ message: \"Authorization failed\" });\n  }\n};","size_bytes":3194},"client/src/components/ExpertBadge.tsx":{"content":"import { Crown } from \"lucide-react\";\n\ninterface ExpertBadgeProps {\n  level: 'bronze' | 'silver' | 'gold';\n  postCount: number;\n  className?: string;\n}\n\nexport default function ExpertBadge({ level, postCount, className = \"\" }: ExpertBadgeProps) {\n  const getBadgeConfig = () => {\n    switch (level) {\n      case 'bronze':\n        return {\n          color: '#CD7F32',\n          text: 'Bronze Expert'\n        };\n      case 'silver':\n        return {\n          color: '#C0C0C0',\n          text: 'Silver Expert'\n        };\n      case 'gold':\n        return {\n          color: '#FFBF00',\n          text: 'Gold Expert'\n        };\n    }\n  };\n\n  const config = getBadgeConfig();\n\n  return (\n    <div \n      className={`inline-flex items-center gap-1 text-xs font-bold text-teal-600 ${className}`}\n      title={`${config.text} - ${postCount} posts this year`}\n    >\n      {/* <Crown className=\"w-4 h-4\" style={{ color: config.color, fill: config.color }} />\n      <span>{config.text}</span> */}\n    </div>\n  );\n}","size_bytes":1003},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/SearchHeader.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Search, Plus, Clock, Star, TrendingUp, UserCheck } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport NewPostModal from \"@/components/NewPostModal\";\nimport { Link } from \"wouter\";\nimport {\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuTrigger,\n} from \"@/components/ui/navigation-menu\";\n\ninterface SearchHeaderProps {\n  title?: string;\n  showActionButtons?: boolean;\n  sortBy?: \"hot\" | \"new\" | \"top\";\n  onSortChange?: (sort: \"hot\" | \"new\" | \"top\") => void;\n  onSearch?: (query: string) => void;\n}\n\nexport default function SearchHeader({\n  title = \"All Things Retirement. All Things Caring.\",\n  showActionButtons = true,\n  sortBy: propSortBy,\n  onSortChange,\n  onSearch,\n}: SearchHeaderProps) {\n  // Get current user for greeting - optimized loading\n  const { data: user } = useQuery<{ firstName?: string }>({\n    queryKey: ['/api/user'],\n    staleTime: 10 * 60 * 1000, // 10 minutes - user data changes rarely\n    gcTime: 30 * 60 * 1000, // Keep in cache for 30 minutes\n    refetchOnWindowFocus: false, // Don't refetch on tab focus\n  });\n\n  // Get current time for greeting\n  const getGreeting = () => {\n    const hour = new Date().getHours();\n    if (hour < 12) return \"Good morning\";\n    if (hour < 17) return \"Good afternoon\";\n    return \"Good evening\";\n  };\n  const [localSortBy, setLocalSortBy] = useState<\"hot\" | \"new\" | \"top\">(\"hot\");\n  const sortBy = propSortBy || localSortBy;\n  const setSortBy = onSortChange || setLocalSortBy;\n  const [showNewPostModal, setShowNewPostModal] = useState(false);\n  const [showNewTopicModal, setShowNewTopicModal] = useState(false);\n  const [currentPhraseIndex, setCurrentPhraseIndex] = useState(0);\n  const [displayedText, setDisplayedText] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(true);\n  const [searchValue, setSearchValue] = useState(\"\");\n\n  // Fetch dynamic search phrases from database - optimized with longer cache\n  const { data: searchPhrasesData } = useQuery<{ phrase: string }[]>({\n    queryKey: [\"/api/search-phrases\"],\n    staleTime: 60 * 60 * 1000, // 1 hour - search phrases change rarely\n    gcTime: 2 * 60 * 60 * 1000, // Keep in memory for 2 hours\n    refetchOnWindowFocus: false, // Don't refetch on tab focus\n    refetchOnMount: false, // Don't refetch on component remount\n  });\n\n  // Extract phrases from API response or fallback to empty array\n  const searchPhrases = searchPhrasesData?.map((item) => item.phrase) || [];\n\n  // Typewriter effect for search placeholder\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout;\n\n    if (isTyping && searchPhrases.length > 0) {\n      const currentPhrase = searchPhrases[currentPhraseIndex];\n\n      if (currentPhrase && displayedText.length < currentPhrase.length) {\n        timeoutId = setTimeout(() => {\n          setDisplayedText(currentPhrase.slice(0, displayedText.length + 1));\n        }, 50);\n      } else {\n        timeoutId = setTimeout(() => {\n          setIsTyping(false);\n          setDisplayedText(\"\");\n          setCurrentPhraseIndex((prev) => (prev + 1) % searchPhrases.length);\n          setTimeout(() => setIsTyping(true), 500);\n        }, 2500);\n      }\n    }\n\n    return () => {\n      if (timeoutId) clearTimeout(timeoutId);\n    };\n  }, [displayedText, currentPhraseIndex, isTyping, searchPhrases]);\n\n  return (\n    <>\n      <div className=\"bg-[#0B666B]/90 border-b border-teal-700 relative\">\n        <div className=\"px-[30px]\" style={{ paddingTop: '65px', paddingBottom: '65px' }}>\n          <div className=\"grid lg:grid-cols-12 gap-8\">\n            {/* Left: Greeting aligned above sidebar - matches MainLayout structure */}\n            <div className=\"lg:col-span-3 flex items-center justify-start\" style={{ height: '80px' }}>\n              {user && (\n                <h1 className=\"text-xl font-medium text-white\">\n                  {getGreeting()}, {user.firstName}\n                </h1>\n              )}\n            </div>\n\n            {/* Center: Search Bar and Sort Options - matches MainLayout content area exactly */}\n            <div className=\"lg:col-span-6\">\n              <div className=\"flex flex-col items-center justify-center max-w-3xl mx-auto\" style={{ height: '80px' }}>\n                <div className=\"relative w-full mb-5\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                <textarea\n                  placeholder={displayedText + (isTyping ? \"|\" : \"\")}\n                  value={searchValue}\n                  onChange={(e) => setSearchValue(e.target.value)}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault();\n                      if (searchValue.trim() && onSearch) {\n                        onSearch(searchValue.trim());\n                      }\n                    }\n                  }}\n                  className=\"w-full pl-10 pr-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-white focus:border-transparent shadow-sm resize-none\"\n                  style={{ minHeight: '80px', lineHeight: '1.5' }}\n                  rows={3}\n                  data-testid=\"search-input\"\n                />\n              </div>\n\n                {/* Sort Options and Action Buttons */}\n                <div className=\"flex items-center justify-between w-full\">\n                  <div className=\"flex items-center space-x-4\">\n                    <span className=\"text-sm font-medium text-white\">Sort by:</span>\n                    <div className=\"flex space-x-2\">\n                      {[\"hot\", \"new\", \"top\"].map((sort) => (\n                        <button\n                          key={sort}\n                          onClick={() => setSortBy(sort as any)}\n                          className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${\n                            sortBy === sort\n                              ? \"bg-white text-teal-700\"\n                              : \"text-white hover:text-white hover:bg-teal-600\"\n                          }`}\n                        >\n                          {sort === \"hot\" && (\n                            <TrendingUp\n                              className={`w-4 h-4 inline mr-1 ${sortBy === sort ? \"text-teal-700\" : \"text-teal-400\"}`}\n                            />\n                          )}\n                          {sort === \"new\" && (\n                            <Clock className=\"w-4 h-4 inline mr-1 text-white\" />\n                          )}\n                          {sort === \"top\" && (\n                            <Star className=\"w-4 h-4 inline mr-1 text-white\" />\n                          )}\n                          {sort.charAt(0).toUpperCase() + sort.slice(1)}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Action Buttons - now inline with sort options */}\n                  {showActionButtons && (\n                    <div className=\"flex space-x-3\">\n                      <Button\n                        className=\"bg-white text-teal-700 hover:bg-teal-50 border border-white shadow-sm\"\n                        onClick={() => setShowNewPostModal(true)}\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        New Post\n                      </Button>\n                      <Button\n                        className=\"bg-amber-500 hover:bg-amber-600 text-white shadow-sm\"\n                        onClick={() => setShowNewTopicModal(true)}\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        New Topic\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            {/* Right: Reserved for future ads - matches 25/50/25 structure */}\n            <div className=\"lg:col-span-3\">\n              {/* Reserved space for advertisements */}\n            </div>\n\n          </div>\n        </div>\n      </div>\n\n      {/* Modals */}\n      {showNewPostModal && (\n        <NewPostModal\n          open={showNewPostModal}\n          onClose={() => setShowNewPostModal(false)}\n          mode=\"post\"\n        />\n      )}\n\n      {showNewTopicModal && (\n        <NewPostModal\n          open={showNewTopicModal}\n          onClose={() => setShowNewTopicModal(false)}\n          mode=\"topic\"\n        />\n      )}\n    </>\n  );\n}\n","size_bytes":8549},"DEVELOPER_HANDOFF.md":{"content":"# CaregiversCommunity - Developer Handoff Document\n\n## Project Overview\n\nCaregiversCommunity is a comprehensive online platform designed for family caregivers (primarily women aged 45-65) that combines forum-style discussions, expert consultations, and content aggregation. The platform provides a safe space for sharing experiences, getting professional advice, and accessing curated retirement and caregiving resources.\n\n## Architecture Summary\n\n### Frontend Stack\n- **React 18** with TypeScript for type safety\n- **Wouter** for lightweight client-side routing\n- **TanStack Query** for server state management and caching\n- **Radix UI** primitives with **Tailwind CSS** for styling\n- **Vite** as the build tool with path aliases\n\n### Backend Stack\n- **Express.js** with TypeScript\n- **PostgreSQL** with **Drizzle ORM** for type-safe database operations\n- **Redis** for session storage and caching\n- **GraphQL** (Apollo Server) alongside REST endpoints\n- **Passport.js** for session-based authentication\n- **Stripe** for payment processing and expert consultations\n\n### External Services\n- **OpenAI GPT-4o** for content moderation\n- **SendGrid** for email notifications\n- **Supabase** for file storage\n- **Google Calendar API** for expert scheduling\n\n## Key Functionalities\n\n### 1. User Management & Authentication\n- **Session-based authentication** with role-based access control\n- **Three user roles**: regular users, experts, and admins\n- **Expert verification system** with document upload and manual approval\n- **Profile management** with customizable avatars and community names\n\n### 2. Forum & Discussion System\n- **Hierarchical category structure** with retirement and caregiving sections\n- **Post and comment system** with threaded discussions\n- **Voting system** for helpful content\n- **Real-time updates** and notifications\n- **Search functionality** across posts and categories\n\n### 3. Expert Consultation Platform\n- **Verified expert directory** with specializations and ratings\n- **Appointment booking system** with calendar integration\n- **Stripe payment processing** with 10% platform commission\n- **Review and rating system** for completed consultations\n\n### 4. Content Aggregation (\"This Week by...\")\n- **Curated content sources** from various retirement/care professionals\n- **EmbedSocial integration** for displaying feeds\n- **Expandable accordion interface** for content viewing\n- **Admin panel** for managing content sources\n\n### 5. AI-Powered Content Moderation\n- **Automatic screening** of all posts and comments\n- **Risk assessment** and flagging system\n- **Admin review queue** for flagged content\n\n## File Structure & Key Components\n\n### Database Schema (`shared/schema.ts`)\n- **Users table**: Authentication, profiles, and role management\n- **Categories table**: Hierarchical forum structure with ordering\n- **Posts & Comments tables**: Discussion content with voting\n- **Expert-related tables**: Verifications, availability, appointments\n- **Content Sources table**: For \"This Week by...\" aggregation\n- **Moderation tables**: AI screening results and admin actions\n\n### Server Architecture\n\n#### Core Files\n- `server/index.ts` - Main server entry point\n- `server/routes.ts` - REST API endpoints\n- `server/storage.ts` - Database operations layer\n- `server/auth.ts` - Passport.js authentication setup\n- `server/graphql/server.ts` - GraphQL server configuration\n\n#### Services\n- `server/services/stripeService.ts` - Payment processing\n- `server/services/calendarService.ts` - Appointment scheduling\n- `server/services/googleCalendarService.ts` - Google Calendar integration\n- `server/moderation.ts` - AI content moderation\n\n### Client Architecture\n\n#### Core Files\n- `client/src/App.tsx` - Main app routing and providers\n- `client/src/hooks/useAuth.tsx` - Authentication state management\n- `client/src/lib/queryClient.ts` - TanStack Query configuration\n\n#### Key Pages\n- `client/src/pages/home.tsx` - Community homepage with discussions\n- `client/src/pages/ThisWeekBy.tsx` - Content aggregation interface\n- `client/src/pages/ExpertDirectory.tsx` - Expert listings\n- `client/src/pages/Dashboard.tsx` - User dashboard with statistics\n\n#### Components\n- `client/src/components/Header.tsx` - Navigation and search\n- `client/src/components/MainLayout.tsx` - Layout system (25%-55%-20%)\n- `client/src/components/DynamicDiscussionTopicsSidebar.tsx` - Forum navigation\n- `client/src/components/PostCard.tsx` - Discussion post display\n\n## Code Quality Assessment & Recommendations\n\n### âœ… Strengths\n1. **Type Safety**: Consistent TypeScript usage throughout\n2. **Modern Stack**: Uses current best practices with React 18, Drizzle ORM\n3. **Responsive Design**: Well-implemented mobile-first approach\n4. **Caching Strategy**: Multi-layer caching with Redis\n5. **Security**: Session-based auth, input validation, content moderation\n\n### âš ï¸ Areas for Improvement\n\n#### 1. Static Data That Should Be Dynamic\n- **Category ordering** in sidebar is hardcoded - should use database `orderIndex`\n- **Default profile types** (\"daisy\", \"tree\") are hardcoded strings\n- **Platform commission rate** (10%) is hardcoded in multiple places\n- **Timezone handling** could be more robust with proper timezone detection\n- **Email templates** are basic and could be more sophisticated\n\n#### 2. Security Vulnerabilities\n- **XSS Risk**: While DOMPurify is used, embed content from external sources needs careful sanitization\n- **Rate Limiting**: No rate limiting on API endpoints (potential for abuse)\n- **Session Security**: Sessions don't expire on logout client-side\n- **File Upload**: No file size limits or type validation for expert documents\n- **CORS Configuration**: Should be more restrictive in production\n\n#### 3. Performance Issues\n- **N+1 Queries**: Multiple favorite count queries per post (should batch)\n- **Excessive API Calls**: Each post triggers multiple individual requests\n- **No Pagination**: Large result sets could cause performance issues\n- **Image Optimization**: No image resizing or optimization for profile photos\n- **Bundle Size**: Large JavaScript bundle (913KB) needs code splitting\n\n#### 4. Database Design Issues\n- **Missing Indexes**: No indexes on frequently queried columns like `categoryId`, `authorId`\n- **Soft Deletes**: No soft delete functionality - data is permanently lost\n- **Audit Trail**: No tracking of who modified what and when\n- **Cascade Deletes**: Unclear deletion behavior for related records\n\n#### 5. Error Handling & Monitoring\n- **Generic Error Messages**: Users get technical error messages\n- **No Logging**: Limited error logging and monitoring\n- **Failed Payment Handling**: Incomplete error handling for Stripe failures\n- **Offline Handling**: No offline functionality or proper error states\n\n### ðŸš€ User Engagement Recommendations\n\n#### 1. Gamification Enhancements\n- **Achievement System**: Implement the existing achievement schema\n- **Points & Badges**: Reward helpful posts, comments, and community participation\n- **Leaderboards**: Weekly/monthly top contributors\n- **Streaks**: Encourage daily engagement\n\n#### 2. Content Discovery\n- **Personalized Feed**: AI-powered content recommendations\n- **Trending Topics**: Highlight popular discussions\n- **Related Posts**: Show similar content to keep users engaged\n- **Expert Spotlights**: Feature expert contributions prominently\n\n#### 3. Community Building\n- **User Introductions**: Dedicated space for new member introductions\n- **Local Groups**: Location-based subgroups\n- **Mentorship Program**: Connect experienced caregivers with newcomers\n- **Virtual Events**: Live Q&A sessions, webinars\n\n#### 4. Mobile Experience\n- **Push Notifications**: Real-time alerts for replies and mentions\n- **Progressive Web App**: Offline functionality and app-like experience\n- **Voice-to-Text**: Make posting easier for busy caregivers\n- **Quick Actions**: One-tap common actions (helpful vote, bookmark)\n\n#### 5. Content Quality\n- **Expert Verification Badges**: More prominent expert indicators\n- **Content Templates**: Guided post creation for better quality\n- **FAQ Generation**: Auto-generate FAQs from popular discussions\n- **Resource Library**: Curated collection of helpful resources\n\n## Technical Debt & Immediate Actions Needed\n\n### High Priority\n1. **Fix N+1 Query Problem**: Batch favorite count queries\n2. **Add Rate Limiting**: Implement on all API endpoints\n3. **Database Indexes**: Add indexes on foreign keys and frequently queried columns\n4. **Error Boundaries**: Add React error boundaries for better error handling\n5. **Bundle Optimization**: Implement code splitting to reduce initial load\n\n### Medium Priority\n1. **Implement Cron Jobs**: For cleanup tasks, notifications, and data maintenance\n2. **Admin Panel Enhancement**: More comprehensive content management tools\n3. **Search Optimization**: Full-text search with PostgreSQL or external service\n4. **Email System**: Rich HTML email templates with better formatting\n5. **Testing Suite**: Unit tests for critical business logic\n\n### Low Priority\n1. **Dark Mode**: User preference for dark/light theme\n2. **Accessibility**: ARIA labels and keyboard navigation\n3. **Internationalization**: Multi-language support preparation\n4. **Advanced Analytics**: User behavior tracking and insights\n\n## Environment Variables Required\n\n```bash\n# Database\nDATABASE_URL=postgresql://user:password@host:port/database\n\n# Redis (optional)\nREDIS_URL=redis://localhost:6379\n\n# Authentication\nSESSION_SECRET=your-session-secret-key\n\n# Stripe Payments\nSTRIPE_SECRET_KEY=sk_test_...\nSTRIPE_PUBLISHABLE_KEY=pk_test_...\n\n# AI Services\nOPENAI_API_KEY=sk-...\nANTHROPIC_API_KEY=sk-ant-...\n\n# Email\nSENDGRID_API_KEY=SG...\n\n# Storage\nSUPABASE_URL=https://your-project.supabase.co\nSUPABASE_ANON_KEY=eyJ...\n\n# Google Calendar (optional)\nGOOGLE_CLIENT_ID=...\nGOOGLE_CLIENT_SECRET=...\n```\n\n## Deployment Notes\n\n### Current Deployment Process\n1. Run `./deploy.sh` to build and prepare static files\n2. Production server uses `NODE_ENV=production node dist/index.js`\n3. Static files are served from `server/public/` directory\n\n### Production Recommendations\n- **CDN**: Use CloudFlare or AWS CloudFront for static assets\n- **Database**: Connection pooling with PgBouncer\n- **Redis**: Redis Cluster for high availability\n- **Monitoring**: Application monitoring with Sentry or DataDog\n- **Backup**: Automated database backups with point-in-time recovery\n\n## Getting Started for New Developers\n\n### 1. Setup\n```bash\nnpm install\ncp .env.example .env  # Configure environment variables\nnpm run db:push       # Apply database schema\nnpm run dev          # Start development server\n```\n\n### 2. Key Commands\n- `npm run dev` - Start development server\n- `npm run build` - Build for production\n- `npm run db:push` - Apply schema changes\n- `npm run db:studio` - Open database GUI\n- `./deploy.sh` - Deploy to production\n\n### 3. First Areas to Explore\n1. **User Flow**: Start with registration and login in `useAuth.tsx`\n2. **Data Layer**: Understand the database schema in `shared/schema.ts`\n3. **API Layer**: Explore REST endpoints in `server/routes.ts`\n4. **UI Components**: Look at the main layout in `MainLayout.tsx`\n5. **State Management**: Understand caching in `queryClient.ts`\n\n### 4. Testing the Application\n- Create test accounts for different user roles\n- Test the expert application and verification process\n- Try booking a consultation and payment flow\n- Explore the content aggregation features\n- Test forum functionality and moderation\n\n## Recent Changes & Current State\n\nAs of July 24, 2025:\n- âœ… Production deployment issues resolved\n- âœ… Responsive navigation implemented\n- âœ… Layout system standardized (25%-55%-20% for community, 25%-75% for ThisWeekBy)\n- âœ… Content aggregation platform functional\n- âœ… Expert consultation system with Stripe payments working\n- âš ï¸ Content moderation temporarily disabled due to OpenAI quota issues\n- âš ï¸ Some TypeScript errors in routes.ts that need attention\n\n## Support & Documentation\n\n- **Technical Architecture**: See `replit.md` for detailed architecture notes\n- **API Documentation**: REST endpoints documented in `CLAUDE.md`\n- **Database Schema**: Fully documented in `shared/schema.ts`\n- **Development Guidelines**: See `CLAUDE.md` for coding standards\n\n---\n\n*This document serves as a comprehensive handoff for developers taking over the CaregiversCommunity platform. It should be updated as the platform evolves.*","size_bytes":12418},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }","size_bytes":709},"client/src/lib/graphql.ts":{"content":"export interface GraphQLResponse<T = any> {\n  data?: T;\n  errors?: Array<{\n    message: string;\n    path?: string[];\n    extensions?: {\n      code?: string;\n    };\n  }>;\n}\n\nexport interface GraphQLRequest {\n  query: string;\n  variables?: Record<string, any>;\n  operationName?: string;\n}\n\nexport async function graphqlRequest<T = any>(\n  request: GraphQLRequest\n): Promise<GraphQLResponse<T>> {\n  try {\n    const response = await fetch('/graphql', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      credentials: 'include', // Include cookies for session-based auth\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP Error: ${response.status} ${response.statusText}`);\n    }\n\n    const result: GraphQLResponse<T> = await response.json();\n    \n    if (result.errors && result.errors.length > 0) {\n      console.error('GraphQL Errors:', result.errors);\n      throw new Error(result.errors[0].message);\n    }\n\n    return result;\n  } catch (error) {\n    console.error('GraphQL Request Failed:', error);\n    throw error;\n  }\n}\n\n// GraphQL Queries\nexport const GET_CATEGORIES = `\n  query GetCategories {\n    categories {\n      id\n      name\n      description\n      slug\n      color\n      icon\n      postCount\n      parentId\n      level\n      orderIndex\n      children {\n        id\n        name\n        description\n        slug\n        color\n        icon\n        postCount\n        level\n      }\n    }\n  }\n`;\n\nexport const GET_CATEGORY_HIERARCHY = `\n  query GetCategoryHierarchy {\n    categoryHierarchy {\n      id\n      name\n      description\n      slug\n      color\n      icon\n      postCount\n      parentId\n      level\n      orderIndex\n      children {\n        id\n        name\n        description\n        slug\n        color\n        icon\n        postCount\n        level\n        orderIndex\n        children {\n          id\n          name\n          description\n          slug\n          color\n          icon\n          postCount\n          level\n          orderIndex\n        }\n      }\n    }\n  }\n`;\n\nexport const GET_POSTS = `\n  query GetPosts($categoryId: ID, $limit: Int, $offset: Int) {\n    posts(categoryId: $categoryId, limit: $limit, offset: $offset) {\n      id\n      title\n      content\n      isResolved\n      isSticky\n      helpfulVotes\n      commentCount\n      viewCount\n      createdAt\n      updatedAt\n      tags\n      category {\n        id\n        name\n        slug\n        color\n        icon\n      }\n      author {\n        id\n        username\n        firstName\n        lastName\n        communityName\n        profileImageUrl\n        reputation\n      }\n    }\n  }\n`;\n\nexport const GET_POST = `\n  query GetPost($id: ID!) {\n    post(id: $id) {\n      id\n      title\n      content\n      isResolved\n      isSticky\n      helpfulVotes\n      commentCount\n      viewCount\n      createdAt\n      updatedAt\n      tags\n      category {\n        id\n        name\n        slug\n        color\n        icon\n      }\n      author {\n        id\n        username\n        firstName\n        lastName\n        communityName\n        profileImageUrl\n        reputation\n        expertVerification {\n          specialization\n          status\n          isFeatured\n          rating\n        }\n      }\n      comments {\n        id\n        content\n        helpfulVotes\n        createdAt\n        author {\n          id\n          username\n          firstName\n          lastName\n          communityName\n          profileImageUrl\n        }\n      }\n    }\n  }\n`;\n\nexport const GET_COMMUNITY_STATS = `\n  query GetCommunityStats {\n    communityStats {\n      totalUsers\n      totalPosts\n      totalComments\n      postsThisWeek\n    }\n  }\n`;\n\n// GraphQL Mutations\nexport const CREATE_POST = `\n  mutation CreatePost($input: PostInput!) {\n    createPost(input: $input) {\n      id\n      title\n      content\n      createdAt\n      category {\n        id\n        name\n        slug\n      }\n      author {\n        id\n        username\n        firstName\n        lastName\n      }\n    }\n  }\n`;\n\nexport const CREATE_COMMENT = `\n  mutation CreateComment($input: CommentInput!) {\n    createComment(input: $input) {\n      id\n      content\n      createdAt\n      author {\n        id\n        username\n        firstName\n        lastName\n      }\n    }\n  }\n`;\n\nexport const CREATE_VOTE = `\n  mutation CreateVote($input: VoteInput!) {\n    createVote(input: $input) {\n      id\n      voteType\n      createdAt\n    }\n  }\n`;\n\nexport const DELETE_VOTE = `\n  mutation DeleteVote($postId: ID, $commentId: ID) {\n    deleteVote(postId: $postId, commentId: $commentId)\n  }\n`;\n\n// Type definitions for better TypeScript support\nexport interface Category {\n  id: string;\n  name: string;\n  description?: string;\n  slug: string;\n  color: string;\n  icon: string;\n  postCount?: number;\n  parentId?: string;\n  level?: number;\n  orderIndex?: number;\n  children?: Category[];\n}\n\nexport interface User {\n  id: string;\n  username: string;\n  firstName?: string;\n  lastName?: string;\n  communityName?: string;\n  profileImageUrl?: string;\n  reputation?: number;\n  expertVerification?: {\n    specialization: string;\n    status: string;\n    isFeatured: boolean;\n    rating?: number;\n  };\n}\n\nexport interface Post {\n  id: string;\n  title: string;\n  content: string;\n  isResolved?: boolean;\n  isSticky?: boolean;\n  helpfulVotes?: number;\n  commentCount?: number;\n  viewCount?: number;\n  createdAt: string;\n  updatedAt?: string;\n  tags?: string[];\n  category: Category;\n  author: User;\n  comments?: Comment[];\n}\n\nexport interface Comment {\n  id: string;\n  content: string;\n  helpfulVotes?: number;\n  createdAt: string;\n  author: User;\n}\n\nexport interface CommunityStats {\n  totalUsers: number;\n  totalPosts: number;\n  totalComments: number;\n  postsThisWeek: number;\n}\n\nexport interface PostInput {\n  title: string;\n  content: string;\n  categoryId: string;\n  tags?: string[];\n  isSticky?: boolean;\n}\n\nexport interface CommentInput {\n  content: string;\n  postId: string;\n  parentId?: string;\n}\n\nexport interface VoteInput {\n  postId?: string;\n  commentId?: string;\n  voteType: string;\n}","size_bytes":6067},"client/src/lib/supabase.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\n// Supabase configuration\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n\n// Supabase is OPTIONAL - if not configured, file uploads will be disabled\nconst isSupabaseConfigured = !!(supabaseUrl && supabaseAnonKey);\n\nif (!isSupabaseConfigured) {\n  console.warn('Supabase not configured - file uploads will be disabled');\n}\n\n// Create Supabase client only if configured\nexport const supabase = isSupabaseConfigured \n  ? createClient(supabaseUrl, supabaseAnonKey)\n  : null;\n\n// File upload utility function\nexport const uploadFile = async (file: File, bucket: string = 'uploads'): Promise<{ url: string; error: null } | { url: null; error: string }> => {\n  try {\n    if (!supabase) {\n      return { url: null, error: 'Supabase is not configured. File uploads are disabled.' };\n    }\n\n    // Generate a unique filename\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\n    \n    // Upload file to Supabase storage\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .upload(fileName, file, {\n        cacheControl: '3600',\n        upsert: false\n      });\n\n    if (error) {\n      console.error('Upload error:', error);\n      return { url: null, error: error.message };\n    }\n\n    // Get public URL\n    const { data: { publicUrl } } = supabase.storage\n      .from(bucket)\n      .getPublicUrl(data.path);\n\n    return { url: publicUrl, error: null };\n  } catch (error) {\n    console.error('Upload exception:', error);\n    return { \n      url: null, \n      error: error instanceof Error ? error.message : 'Unknown upload error'\n    };\n  }\n};\n\n// Optional: Additional Supabase utilities\nexport const deleteFile = async (fileName: string, bucket: string = 'uploads'): Promise<{ success: boolean; error: string | null }> => {\n  try {\n    if (!supabase) {\n      return { success: false, error: 'Supabase is not configured' };\n    }\n\n    const { error } = await supabase.storage\n      .from(bucket)\n      .remove([fileName]);\n\n    if (error) {\n      return { success: false, error: error.message };\n    }\n\n    return { success: true, error: null };\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown delete error'\n    };\n  }\n};\n\nexport const listFiles = async (bucket: string = 'uploads', folder?: string): Promise<{ files: any[]; error: string | null }> => {\n  try {\n    if (!supabase) {\n      return { files: [], error: 'Supabase is not configured' };\n    }\n\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .list(folder);\n\n    if (error) {\n      return { files: [], error: error.message };\n    }\n\n    return { files: data || [], error: null };\n  } catch (error) {\n    return { \n      files: [], \n      error: error instanceof Error ? error.message : 'Unknown list error'\n    };\n  }\n};","size_bytes":3009},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/pages/care-connect.tsx":{"content":"import { ArrowRight, CheckCircle, Phone, Mail, Clock, X, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState, useEffect } from \"react\";\nimport caregiverImage from \"@assets/AskEdith_Hero_Image.png\";\nimport resourceListImage from \"@assets/2_resource_list_1749565216801.png\";\nimport emailPreviewImage from \"@assets/3_email_preview_v2_1749566578145.png\";\nimport emailHub1Image from \"@assets/4-email-hub-1_1749565226451.png\";\nimport emailHub2Image from \"@assets/5-email-hub-2_1749565229959.png\";\n\nexport default function CareConnect() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  const galleryImages = [\n    {\n      src: resourceListImage,\n      alt: \"AskEdith Resource Discovery Interface\",\n      title: \"Resource Discovery\",\n      description: \"Browse curated care resources by category\"\n    },\n    {\n      src: emailPreviewImage,\n      alt: \"AskEdith Email Generation Interface\",\n      title: \"Email Generation\",\n      description: \"Personalized outreach made simple\"\n    },\n    {\n      src: emailHub1Image,\n      alt: \"AskEdith Communication Hub Overview\",\n      title: \"Communication Hub\",\n      description: \"Organize all your care conversations\"\n    },\n    {\n      src: emailHub2Image,\n      alt: \"AskEdith Conversation Detail View\",\n      title: \"Conversation Details\",\n      description: \"Track responses and schedule follow-ups\"\n    }\n  ];\n\n  const openModal = (imageIndex: number) => {\n    setCurrentImageIndex(imageIndex);\n    setIsModalOpen(true);\n  };\n\n  const closeModal = () => {\n    setIsModalOpen(false);\n  };\n\n  const nextImage = () => {\n    setCurrentImageIndex((prev) => (prev + 1) % galleryImages.length);\n  };\n\n  const prevImage = () => {\n    setCurrentImageIndex((prev) => (prev - 1 + galleryImages.length) % galleryImages.length);\n  };\n\n  // Handle keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (!isModalOpen) return;\n      \n      if (e.key === 'Escape') {\n        closeModal();\n      } else if (e.key === 'ArrowLeft') {\n        prevImage();\n      } else if (e.key === 'ArrowRight') {\n        nextImage();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isModalOpen]);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Hero Section - Responsive Split Screen Design */}\n      <section className=\"min-h-[500px] lg:h-[600px] mb-32 pb-16\">\n      <div className=\"flex flex-col lg:grid lg:grid-cols-2 h-full\">\n          {/* Left Side - Green Section with Content */}\n          <div className=\"flex items-center justify-center p-6 md:p-8 bg-[#0B666B]/90 order-2 lg:order-1\">\n            <div className=\"w-full max-w-2xl text-white\">\n              <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold mb-6 md:mb-8 leading-tight\">\n                Why do caregivers turn to AskEdith?\n              </h1>\n              \n              <p className=\"text-lg md:text-xl mb-4 md:mb-6 leading-relaxed opacity-95\">\n                Because caring for a loved one shouldn't mean losing yourself in a maze of resources, \n                repeating your story endlessly, or chasing scattered email replies from dozens of agencies.\n              </p>\n              \n              <p className=\"text-base md:text-lg mb-6 md:mb-8 opacity-90\">\n                Most caregivers don't realize how exhausting this becomesâ€”until they have spent hundreds \n                of hours on calls and emails. Time better spent with family or simply catching your breath. \n                We call it the \"phone and email marathon.\"\n              </p>\n              \n              <div className=\"flex flex-wrap gap-4\">\n                <Button \n                  size=\"lg\"\n                  className=\"w-full sm:w-auto bg-white text-teal-700 hover:bg-teal-50 font-semibold px-6 sm:px-8 py-3\"\n                >\n                  Find Care Now\n                  <ArrowRight className=\"ml-2 h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Right Side - Light Amber Background with Caregiver Image */}\n          <div\n            className=\"flex items-center justify-center h-64 sm:h-80 md:h-96 lg:h-full order-1 lg:order-2\"\n            style={{ backgroundColor: \"#fefbed\" }}\n          >\n            <img\n              src={caregiverImage}\n              alt=\"AskEdith Caregiver Support\"\n              className=\"w-full h-full object-contain p-4 md:p-8\"\n            />\n          </div>\n        </div>\n      </section>\n\n      {/* Main Content Section - 1,2,3,4 Format */}\n      <section className=\"py-24 pb-24 bg-white border-t border-gray-100\">\n        <div className=\"px-[30px]\">\n        <div className=\"flex flex-col lg:grid lg:grid-cols-12 lg:gap-12 gap-y-16\">\n        {/* Main Content */}\n            <div className=\"lg:col-span-6 order-2 lg:order-1\">\n          \n              {/* Section 1 - Problem Statement */}\n              <div className=\"mb-16\">\n                <div className=\"flex items-start gap-6\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-12 h-12 bg-red-500 text-white rounded-full flex items-center justify-center font-bold text-xl\">\n                      1\n                    </div>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n                      The Phone and Email Marathon\n                    </h2>\n                    <p className=\"text-lg text-gray-700 leading-relaxed\">\n                      A marathon that depletes your energy and leaves you with more questions than answers. \n                      Caregivers spend countless hours repeating their story, navigating complex systems, \n                      and losing track of important communications across multiple agencies and providers.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Section 2 - Solution Introduction */}\n              <div className=\"mb-16\">\n                <div className=\"flex items-start gap-6\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-12 h-12 bg-teal-600 text-white rounded-full flex items-center justify-center font-bold text-xl\">\n                      2\n                    </div>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n                      AskEdith Brings You Clarity\n                    </h2>\n                    <p className=\"text-lg text-gray-700 leading-relaxed mb-6\">\n                      With just a few simple questions, Edith learns your needs and matches you with relevant resources. \n                      You choose who to contact. She helps you write your story once, connects it to your personal email, \n                      and sends it out for youâ€”beautifully and efficiently.\n                    </p>\n                    <div className=\"flex items-center gap-3 text-teal-700\">\n                      <CheckCircle className=\"w-5 h-5\" />\n                      <span className=\"font-medium\">Write your story once</span>\n                    </div>\n                    <div className=\"flex items-center gap-3 text-teal-700 mt-2\">\n                      <CheckCircle className=\"w-5 h-5\" />\n                      <span className=\"font-medium\">Choose who to contact</span>\n                    </div>\n                    <div className=\"flex items-center gap-3 text-teal-700 mt-2\">\n                      <CheckCircle className=\"w-5 h-5\" />\n                      <span className=\"font-medium\">Send efficiently and beautifully</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Section 3 - Organization Benefits */}\n              <div className=\"mb-16\">\n                <div className=\"flex items-start gap-6\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-xl\">\n                      3\n                    </div>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n                      Your Care Command Center\n                    </h2>\n                    <p className=\"text-lg text-gray-700 leading-relaxed mb-6\">\n                      As replies stream in, AskEdith organizes everything into one easy-to-use Communication & Document Hub, \n                      seamlessly connected to your personal inbox activity. No more digging through emails, losing track of \n                      who said what or who sent what document.\n                    </p>\n                    <div className=\"bg-teal-50 border-l-4 border-teal-500 p-6 rounded-r-lg\">\n                      <p className=\"text-teal-800 font-medium\">\n                        Turn the outgoing and incoming chaos into an organized \"care command center.\" \n                        So you can focus on what truly matters: caring with clarity and peace of mind.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Section 4 - Pricing and CTA */}\n              <div className=\"mb-16\">\n                <div className=\"flex items-start gap-6\">\n                  <div className=\"flex-shrink-0\">\n                    <div className=\"w-12 h-12 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-xl\">\n                      4\n                    </div>\n                  </div>\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">\n                      Simple, Affordable, No Commitments\n                    </h2>\n                    <div className=\"bg-green-50 border border-green-200 rounded-lg p-6 mb-6\">\n                      <div className=\"text-center\">\n                        <div className=\"text-4xl font-bold text-green-700 mb-2\">$9</div>\n                        <div className=\"text-lg text-green-600 mb-4\">per month</div>\n                        <p className=\"text-gray-700\">No long-term commitments required</p>\n                      </div>\n                    </div>\n                    \n                    <p className=\"text-lg text-gray-700 leading-relaxed mb-8\">\n                      Created by caregivers for caregivers. End the phone marathon. Begin with confidence.\n                    </p>\n\n                    <div className=\"flex flex-col sm:flex-row gap-4\">\n                      <Button \n                        size=\"lg\"\n                        className=\"w-full sm:w-auto bg-orange-500 hover:bg-orange-600 text-white font-semibold px-6 sm:px-8 py-3\"\n                      >\n                        Find Care Now\n                        <ArrowRight className=\"ml-2 h-5 w-5\" />\n                      </Button>\n                      <Button \n                        variant=\"outline\"\n                        size=\"lg\"\n                        className=\"w-full sm:w-auto border-teal-600 text-teal-600 hover:bg-teal-50 font-semibold px-6 sm:px-8 py-3\"\n                      >\n                        Learn More\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Contact Information */}\n              <div className=\"border-t border-gray-200 pt-12\">\n                <div className=\"text-center\">\n                  <h3 className=\"text-xl font-semibold text-gray-900 mb-6\">\n                    Questions? We're Here to Help\n                  </h3>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    <div className=\"flex items-center justify-center sm:justify-start gap-3 text-gray-600\">\n                      <Phone className=\"flex-shrink-0 w-5 h-5 text-teal-600\" />\n                      <span className=\"text-sm sm:text-base\">1-800-ASK-EDITH</span>\n                    </div>\n                    <div className=\"flex items-center justify-center sm:justify-start gap-3 text-gray-600\">\n                      <Mail className=\"flex-shrink-0 w-5 h-5 text-teal-600\" />\n                      <span className=\"text-sm sm:text-base break-all\">support@askedith.com</span>\n                    </div>\n                    <div className=\"flex items-center justify-center sm:justify-start gap-3 text-gray-600 col-span-1 sm:col-span-2 lg:col-span-1\">\n                      <Clock className=\"flex-shrink-0 w-5 h-5 text-teal-600\" />\n                      <span className=\"text-sm sm:text-base\">Mon-Fri, 9AM-6PM EST</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Right Sidebar with Interface Previews */}\n            <div className=\"lg:col-span-6 mb-12 lg:mb-0 lg:mt-0 order-1 lg:order-2\">\n              <div className=\"lg:sticky lg:top-8\">\n                <div className=\"bg-gray-50 rounded-lg p-4 sm:p-6 lg:max-h-[calc(100vh-4rem)] lg:overflow-y-auto\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">See AskEdith in Action</h3>\n                  <p className=\"text-sm text-gray-600 mb-6\">Take a look at our intuitive interface designed to simplify your caregiving journey.</p>\n                  \n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4\">\n                    {galleryImages.map((image, index) => (\n                      <div \n                        key={index} \n                        className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden cursor-pointer hover:shadow-md transition-shadow duration-200\" \n                        onClick={() => openModal(index)}\n                      >\n                        <div className=\"aspect-video bg-gray-100 flex items-center justify-center\">\n                          <img\n                            src={image.src}\n                            alt={image.alt}\n                            className=\"w-full h-full object-contain p-2 hover:opacity-90 transition-opacity duration-200\"\n                          />\n                        </div>\n                        <div className=\"p-3\">\n                          <p className=\"text-sm font-medium text-gray-700\">{image.title}</p>\n                          <p className=\"text-xs text-gray-500\">{image.description}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Image Modal/Lightbox */}\n      {isModalOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75\" onClick={closeModal}>\n          <div className=\"relative max-w-7xl max-h-[90vh] mx-4\" onClick={(e) => e.stopPropagation()}>\n            {/* Close Button */}\n            <button\n              onClick={closeModal}\n              className=\"absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors z-10\"\n            >\n              <X className=\"w-8 h-8\" />\n            </button>\n\n            {/* Navigation Buttons */}\n            <button\n              onClick={prevImage}\n              className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black bg-opacity-50 rounded-full p-2 z-10\"\n            >\n              <ChevronLeft className=\"w-8 h-8\" />\n            </button>\n\n            <button\n              onClick={nextImage}\n              className=\"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black bg-opacity-50 rounded-full p-2 z-10\"\n            >\n              <ChevronRight className=\"w-8 h-8\" />\n            </button>\n\n            {/* Image */}\n            <div className=\"bg-white rounded-lg overflow-hidden shadow-2xl\">\n              <img\n                src={galleryImages[currentImageIndex].src}\n                alt={galleryImages[currentImageIndex].alt}\n                className=\"w-full h-auto max-h-[80vh] object-contain\"\n              />\n              \n              {/* Image Info */}\n              <div className=\"p-6 bg-white\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                      {galleryImages[currentImageIndex].title}\n                    </h3>\n                    <p className=\"text-gray-600\">\n                      {galleryImages[currentImageIndex].description}\n                    </p>\n                  </div>\n                  <div className=\"text-sm text-gray-500\">\n                    {currentImageIndex + 1} of {galleryImages.length}\n                  </div>\n                </div>\n              </div>\n\n              {/* Thumbnail Navigation */}\n              <div className=\"flex justify-center space-x-2 p-4 bg-gray-50\">\n                {galleryImages.map((image, index) => (\n                  <button\n                    key={index}\n                    onClick={() => setCurrentImageIndex(index)}\n                    className={`w-16 h-16 rounded-lg overflow-hidden border-2 transition-all duration-200 ${\n                      index === currentImageIndex \n                        ? 'border-teal-500 opacity-100' \n                        : 'border-gray-300 opacity-60 hover:opacity-80'\n                    }`}\n                  >\n                    <img\n                      src={image.src}\n                      alt={image.alt}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":18112},"client/src/components/EmailVerificationBanner.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Mail, X } from \"lucide-react\";\n\ninterface EmailVerificationBannerProps {\n  email: string;\n}\n\nexport default function EmailVerificationBanner({ email }: EmailVerificationBannerProps) {\n  const [isVisible, setIsVisible] = useState(true);\n  const { toast } = useToast();\n\n  const resendVerificationMutation = useMutation({\n    mutationFn: () => apiRequest(\"/api/request-verification\", \"POST\"),\n    onSuccess: () => {\n      toast({\n        title: \"Verification Email Sent\",\n        description: `We've sent a verification email to ${email}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send verification email\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (!isVisible) return null;\n\n  return (\n    <Alert className=\"bg-amber-50 border-amber-200 mb-4\">\n      <Mail className=\"h-4 w-4 text-amber-600\" />\n      <AlertDescription className=\"flex items-center justify-between\">\n        <div className=\"flex-1\">\n          <span className=\"text-amber-800\">\n            Please verify your email address to access all features.\n          </span>\n          <Button\n            variant=\"link\"\n            className=\"text-amber-700 hover:text-amber-800 px-2\"\n            onClick={() => resendVerificationMutation.mutate()}\n            disabled={resendVerificationMutation.isPending}\n          >\n            {resendVerificationMutation.isPending ? \"Sending...\" : \"Resend verification email\"}\n          </Button>\n        </div>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"text-amber-600 hover:text-amber-700\"\n          onClick={() => setIsVisible(false)}\n        >\n          <X className=\"h-4 w-4\" />\n        </Button>\n      </AlertDescription>\n    </Alert>\n  );\n}","size_bytes":2097},"client/src/pages/AdminContentSources.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Pencil, Trash2, Plus, GripVertical, ExternalLink } from \"lucide-react\";\nimport MainLayout from \"@/components/MainLayout\";\n\ninterface ContentSource {\n  id: number;\n  categoryId: string;\n  categoryName: string;\n  name: string;\n  description: string | null;\n  embedCode: string | null;\n  websiteUrl: string | null;\n  isActive: boolean;\n  orderIndex: number;\n}\n\ninterface FormData {\n  categoryId: string;\n  name: string;\n  description: string;\n  embedCode: string;\n  websiteUrl: string;\n  isActive: boolean;\n  orderIndex: number;\n}\n\nconst categories = [\n  { id: \"authors\", name: \"Authors\" },\n  { id: \"newspapers\", name: \"Newspapers & Magazines\" },\n  { id: \"bloggers\", name: \"Bloggers & Writers\" },\n  { id: \"podcasters\", name: \"Podcasters & YouTubers\" },\n  { id: \"retirement-care-pros\", name: \"Retirement & Care Professionals\" },\n  { id: \"industry-leaders\", name: \"Industry Thought Leaders\" }\n];\n\nexport default function AdminContentSources() {\n  const { toast } = useToast();\n  const [editingSource, setEditingSource] = useState<ContentSource | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [draggedItem, setDraggedItem] = useState<ContentSource | null>(null);\n  \n  const initialFormData: FormData = {\n    categoryId: \"\",\n    name: \"\",\n    description: \"\",\n    embedCode: \"\",\n    websiteUrl: \"\",\n    isActive: true,\n    orderIndex: 0\n  };\n  \n  const [formData, setFormData] = useState<FormData>(initialFormData);\n\n  // Fetch all content sources\n  const { data: sources = [], isLoading } = useQuery<ContentSource[]>({\n    queryKey: ['/api/content-sources/all'] // Using a different endpoint for admin\n  });\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<ContentSource>) => {\n      const categoryName = categories.find(c => c.id === data.categoryId)?.name || \"\";\n      return apiRequest(\"POST\", \"/api/content-sources\", { \n        ...data, \n        categoryName \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources/all'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources'] });\n      toast({ title: \"Success\", description: \"Content source created\" });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to create content source\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<ContentSource> }) => {\n      const categoryName = categories.find(c => c.id === data.categoryId)?.name || \"\";\n      return apiRequest(\"PUT\", `/api/content-sources/${id}`, { \n        ...data, \n        categoryName \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources/all'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources'] });\n      toast({ title: \"Success\", description: \"Content source updated\" });\n      setIsDialogOpen(false);\n      setEditingSource(null);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to update content source\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Reorder mutation\n  const reorderMutation = useMutation({\n    mutationFn: async ({ categoryId, sourceIds }: { categoryId: string; sourceIds: number[] }) => {\n      return apiRequest(\"PUT\", \"/api/content-sources/reorder\", { categoryId, sourceIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources/all'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources'] });\n      toast({ title: \"Success\", description: \"Order updated successfully\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to update order\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/content-sources/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources/all'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-sources'] });\n      toast({ title: \"Success\", description: \"Content source deleted\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to delete content source\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const resetForm = () => {\n    setFormData(initialFormData);\n    setEditingSource(null);\n  };\n\n  const handleEdit = (source: ContentSource) => {\n    setEditingSource(source);\n    setFormData({\n      categoryId: source.categoryId,\n      name: source.name,\n      description: source.description || \"\",\n      embedCode: source.embedCode || \"\",\n      websiteUrl: source.websiteUrl || \"\",\n      isActive: source.isActive,\n      orderIndex: source.orderIndex\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = () => {\n    if (!formData.categoryId || !formData.name) {\n      toast({ \n        title: \"Error\", \n        description: \"Category and name are required\",\n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    if (editingSource) {\n      updateMutation.mutate({ id: editingSource.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(\"Are you sure you want to delete this content source?\")) {\n      deleteMutation.mutate(id);\n    }\n  };\n\n  const handleDragStart = (e: React.DragEvent<HTMLDivElement>, source: ContentSource) => {\n    setDraggedItem(source);\n    e.dataTransfer.effectAllowed = 'move';\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>, targetSource: ContentSource) => {\n    e.preventDefault();\n    \n    if (!draggedItem || draggedItem.id === targetSource.id) {\n      return;\n    }\n\n    // Only allow reordering within the same category\n    if (draggedItem.categoryId !== targetSource.categoryId) {\n      toast({\n        title: \"Error\",\n        description: \"Cannot move sources between categories\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Get all sources in this category\n    const categorySources = sources\n      .filter(s => s.categoryId === targetSource.categoryId)\n      .sort((a, b) => a.orderIndex - b.orderIndex);\n\n    // Remove dragged item and insert at new position\n    const filteredSources = categorySources.filter(s => s.id !== draggedItem.id);\n    const targetIndex = filteredSources.findIndex(s => s.id === targetSource.id);\n    \n    // Insert dragged item before or after target based on position\n    const newOrder = [...filteredSources];\n    newOrder.splice(targetIndex + 1, 0, draggedItem);\n\n    // Update order and send to server\n    const sourceIds = newOrder.map(s => s.id);\n    reorderMutation.mutate({ categoryId: targetSource.categoryId, sourceIds });\n\n    setDraggedItem(null);\n  };\n\n  // Filter sources by category\n  const filteredSources = selectedCategory === \"all\" \n    ? sources \n    : sources.filter(s => s.categoryId === selectedCategory);\n\n  // Group sources by category for display\n  const groupedSources = categories.reduce((acc, category) => {\n    acc[category.id] = filteredSources\n      .filter(s => s.categoryId === category.id)\n      .sort((a, b) => a.orderIndex - b.orderIndex);\n    return acc;\n  }, {} as Record<string, ContentSource[]>);\n\n  if (isLoading) {\n    return (\n      <MainLayout>\n        <div className=\"p-6\">\n          <div className=\"animate-pulse\">Loading content sources...</div>\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"p-6\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Manage Content Sources</h1>\n            <p className=\"text-gray-600 mt-1\">Add and manage news sources for \"This Week by...\"</p>\n          </div>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button \n                onClick={() => {\n                  resetForm();\n                  setIsDialogOpen(true);\n                }}\n                className=\"flex items-center gap-2\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                Add Content Source\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingSource ? 'Edit Content Source' : 'Add New Content Source'}\n                </DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 mt-4\">\n                <div>\n                  <Label htmlFor=\"category\">Category</Label>\n                  <Select \n                    value={formData.categoryId} \n                    onValueChange={(value) => setFormData({...formData, categoryId: value})}\n                  >\n                    <SelectTrigger id=\"category\">\n                      <SelectValue placeholder=\"Select a category\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categories.map(cat => (\n                        <SelectItem key={cat.id} value={cat.id}>\n                          {cat.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"name\">Source Name</Label>\n                  <Input\n                    id=\"name\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({...formData, name: e.target.value})}\n                    placeholder=\"e.g., The New York Times - Aging\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"description\">Description (optional)</Label>\n                  <Input\n                    id=\"description\"\n                    value={formData.description}\n                    onChange={(e) => setFormData({...formData, description: e.target.value})}\n                    placeholder=\"Brief description of the source\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"websiteUrl\">Website URL (optional)</Label>\n                  <Input\n                    id=\"websiteUrl\"\n                    value={formData.websiteUrl}\n                    onChange={(e) => setFormData({...formData, websiteUrl: e.target.value})}\n                    placeholder=\"https://example.com\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"embedCode\">\n                    Embed Code (optional)\n                    <span className=\"text-xs text-gray-500 block mt-1\">\n                      Paste the embed code from EmbedSocial or other services\n                    </span>\n                  </Label>\n                  <Textarea\n                    id=\"embedCode\"\n                    value={formData.embedCode}\n                    onChange={(e) => setFormData({...formData, embedCode: e.target.value})}\n                    placeholder='<div class=\"embedsocial-hashtag\" data-ref=\"...\"></div><script>...</script>'\n                    rows={6}\n                    className=\"font-mono text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"orderIndex\">Display Order</Label>\n                  <Input\n                    id=\"orderIndex\"\n                    type=\"number\"\n                    value={formData.orderIndex}\n                    onChange={(e) => setFormData({...formData, orderIndex: parseInt(e.target.value) || 0})}\n                    placeholder=\"0\"\n                  />\n                  <span className=\"text-xs text-gray-500\">Lower numbers appear first</span>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <Switch\n                    id=\"isActive\"\n                    checked={formData.isActive}\n                    onCheckedChange={(checked) => setFormData({...formData, isActive: checked})}\n                  />\n                  <Label htmlFor=\"isActive\">Active (visible on the site)</Label>\n                </div>\n\n                <div className=\"flex justify-end gap-2 pt-4\">\n                  <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button \n                    onClick={handleSubmit}\n                    disabled={createMutation.isPending || updateMutation.isPending}\n                  >\n                    {editingSource ? 'Update' : 'Create'} Source\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {/* Category filter */}\n        <div className=\"mb-6\">\n          <Label htmlFor=\"filter\">Filter by category</Label>\n          <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n            <SelectTrigger id=\"filter\" className=\"w-64\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Categories</SelectItem>\n              {categories.map(cat => (\n                <SelectItem key={cat.id} value={cat.id}>\n                  {cat.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Content sources list */}\n        <div className=\"space-y-6\">\n          {Object.entries(groupedSources).map(([categoryId, sources]) => {\n            if (sources.length === 0 && selectedCategory !== \"all\") return null;\n            \n            const category = categories.find(c => c.id === categoryId);\n            \n            return (\n              <Card key={categoryId}>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">\n                    {category?.name} ({sources.length})\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {sources.length === 0 ? (\n                    <p className=\"text-gray-500\">No sources in this category</p>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {sources.map((source, index) => (\n                        <div \n                          key={source.id} \n                          draggable\n                          onDragStart={(e) => handleDragStart(e, source)}\n                          onDragOver={handleDragOver}\n                          onDrop={(e) => handleDrop(e, source)}\n                          className={`flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-move ${\n                            draggedItem?.id === source.id ? 'opacity-50' : ''\n                          }`}\n                        >\n                          <div className=\"flex items-center gap-3 flex-1\">\n                            <GripVertical className=\"w-4 h-4 text-gray-400\" />\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"font-medium\">{source.name}</span>\n                                {!source.isActive && (\n                                  <span className=\"text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded\">\n                                    Inactive\n                                  </span>\n                                )}\n                                {source.embedCode && (\n                                  <span className=\"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded\">\n                                    Has embed\n                                  </span>\n                                )}\n                              </div>\n                              {source.description && (\n                                <p className=\"text-sm text-gray-600\">{source.description}</p>\n                              )}\n                              <div className=\"flex items-center gap-4 mt-1 text-xs text-gray-500\">\n                                <span>Order: {source.orderIndex}</span>\n                                {source.websiteUrl && (\n                                  <a \n                                    href={source.websiteUrl} \n                                    target=\"_blank\" \n                                    rel=\"noopener noreferrer\"\n                                    className=\"flex items-center gap-1 text-blue-600 hover:text-blue-800\"\n                                  >\n                                    <ExternalLink className=\"w-3 h-3\" />\n                                    Website\n                                  </a>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleEdit(source)}\n                            >\n                              <Pencil className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDelete(source.id)}\n                              className=\"text-red-600 hover:text-red-700\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </MainLayout>\n  );\n}","size_bytes":19326},"client/src/pages/admin/SocialMediaEmbeds.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport MainLayout from \"@/components/MainLayout\";\nimport { Loader2, Plus, Trash2, Edit2, Save, X } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\ninterface SocialMediaEmbed {\n  id: number;\n  type: string;\n  name: string;\n  embedCode: string | null;\n  isActive: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function AdminSocialMediaEmbeds() {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [editingCode, setEditingCode] = useState(\"\");\n  const [newEmbed, setNewEmbed] = useState({\n    type: \"todaysnews\",\n    name: \"\",\n    embedCode: \"\"\n  });\n\n  // Fetch all embeds grouped by type\n  const { data: todaysNewsEmbeds = [], isLoading: loadingTodays } = useQuery<SocialMediaEmbed[]>({\n    queryKey: [\"/api/social-media-embeds/todaysnews\"],\n  });\n\n  const { data: linkedinEmbeds = [], isLoading: loadingLinkedin } = useQuery<SocialMediaEmbed[]>({\n    queryKey: [\"/api/social-media-embeds/linkedin\"],\n  });\n\n  const { data: xPostsEmbeds = [], isLoading: loadingX } = useQuery<SocialMediaEmbed[]>({\n    queryKey: [\"/api/social-media-embeds/xposts\"],\n  });\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: (embed: typeof newEmbed) => \n      apiRequest(\"POST\", \"/api/social-media-embeds\", embed),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Social media embed created successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/social-media-embeds\"] });\n      setNewEmbed({ type: \"todaysnews\", name: \"\", embedCode: \"\" });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create social media embed\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: ({ id, embedCode }: { id: number; embedCode: string }) =>\n      apiRequest(\"PUT\", `/api/social-media-embeds/${id}`, { embedCode }),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Embed code updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/social-media-embeds\"] });\n      setEditingId(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update embed code\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => \n      apiRequest(\"DELETE\", `/api/social-media-embeds/${id}`),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Social media embed deleted successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/social-media-embeds\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete social media embed\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (embed: SocialMediaEmbed) => {\n    setEditingId(embed.id);\n    setEditingCode(embed.embedCode || \"\");\n  };\n\n  const handleSave = (id: number) => {\n    updateMutation.mutate({ id, embedCode: editingCode });\n  };\n\n  const handleCancel = () => {\n    setEditingId(null);\n    setEditingCode(\"\");\n  };\n\n  const handleCreate = () => {\n    if (!newEmbed.name.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter a name for the embed\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createMutation.mutate(newEmbed);\n  };\n\n  const renderEmbedGroup = (title: string, embeds: SocialMediaEmbed[], isLoading: boolean) => (\n    <Card className=\"mb-6\">\n      <CardHeader>\n        <CardTitle>{title}</CardTitle>\n        <CardDescription>\n          Manage RSS.app embed codes for {title.toLowerCase()}\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex justify-center py-8\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-gray-400\" />\n          </div>\n        ) : embeds.length === 0 ? (\n          <p className=\"text-gray-500 text-center py-8\">No embeds added yet</p>\n        ) : (\n          <div className=\"space-y-4\">\n            {embeds.map((embed) => (\n              <div key={embed.id} className=\"border rounded-lg p-4\">\n                <div className=\"flex items-start justify-between mb-2\">\n                  <h4 className=\"font-medium\">{embed.name}</h4>\n                  <div className=\"flex gap-2\">\n                    {editingId !== embed.id && (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleEdit(embed)}\n                        >\n                          <Edit2 className=\"w-4 h-4\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          onClick={() => deleteMutation.mutate(embed.id)}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </div>\n                \n                {editingId === embed.id ? (\n                  <div className=\"space-y-2\">\n                    <Textarea\n                      value={editingCode}\n                      onChange={(e) => setEditingCode(e.target.value)}\n                      placeholder=\"Paste your RSS.app embed code here...\"\n                      className=\"min-h-[150px] font-mono text-sm\"\n                    />\n                    <div className=\"flex gap-2\">\n                      <Button\n                        size=\"sm\"\n                        onClick={() => handleSave(embed.id)}\n                        disabled={updateMutation.isPending}\n                      >\n                        {updateMutation.isPending ? (\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        ) : (\n                          <Save className=\"w-4 h-4\" />\n                        )}\n                        Save\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={handleCancel}\n                      >\n                        <X className=\"w-4 h-4\" />\n                        Cancel\n                      </Button>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"text-sm text-gray-600\">\n                    {embed.embedCode ? (\n                      <div className=\"bg-gray-50 p-2 rounded font-mono text-xs overflow-x-auto\">\n                        {embed.embedCode.substring(0, 100)}...\n                      </div>\n                    ) : (\n                      <span className=\"italic text-gray-400\">No embed code added</span>\n                    )}\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <MainLayout>\n      <div className=\"max-w-6xl mx-auto py-8\">\n        <h1 className=\"text-3xl font-bold mb-8\">Social Media Embeds Management</h1>\n        \n        {/* Add New Embed Form */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle>Add New Embed</CardTitle>\n            <CardDescription>\n              Create a new RSS.app embed for social media feeds\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <Select\n                value={newEmbed.type}\n                onValueChange={(value) => setNewEmbed({ ...newEmbed, type: value })}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"todaysnews\">Today's News</SelectItem>\n                  <SelectItem value=\"linkedin\">LinkedIn</SelectItem>\n                  <SelectItem value=\"xposts\">X Posts</SelectItem>\n                </SelectContent>\n              </Select>\n              \n              <Input\n                placeholder=\"Feed name (e.g., 'Tech News', 'Industry Updates')\"\n                value={newEmbed.name}\n                onChange={(e) => setNewEmbed({ ...newEmbed, name: e.target.value })}\n              />\n              \n              <Button \n                onClick={handleCreate}\n                disabled={createMutation.isPending}\n              >\n                {createMutation.isPending ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin mr-2\" />\n                ) : (\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                )}\n                Add Embed\n              </Button>\n            </div>\n            \n            {newEmbed.name && (\n              <div className=\"mt-4\">\n                <Textarea\n                  placeholder=\"Paste your RSS.app embed code here (optional, can be added later)...\"\n                  value={newEmbed.embedCode}\n                  onChange={(e) => setNewEmbed({ ...newEmbed, embedCode: e.target.value })}\n                  className=\"min-h-[100px] font-mono text-sm\"\n                />\n              </div>\n            )}\n          </CardContent>\n        </Card>\n        \n        {/* Embed Groups */}\n        {renderEmbedGroup(\"Today's News\", todaysNewsEmbeds, loadingTodays)}\n        {renderEmbedGroup(\"LinkedIn\", linkedinEmbeds, loadingLinkedin)}\n        {renderEmbedGroup(\"X Posts\", xPostsEmbeds, loadingX)}\n      </div>\n    </MainLayout>\n  );\n}","size_bytes":10300},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ClerkProvider, useUser } from \"@clerk/clerk-react\";\nimport { AuthProvider } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/landing\";\nimport Home from \"@/pages/home\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Category from \"@/pages/category\";\nimport Post from \"@/pages/post\";\nimport Topic from \"@/pages/topic\";\nimport Subscribe from \"@/pages/subscribe\";\nimport ExpertDirectory from \"@/pages/ExpertDirectory\";\nimport ExpertProfile from \"@/pages/ExpertProfile\";\nimport ExpertApplication from \"@/pages/ExpertApplication\";\nimport ExpertApplicationWithPayment from \"@/pages/ExpertApplicationWithPayment\";\nimport ExpertApplicationWithPaymentTest from \"@/pages/ExpertApplicationWithPaymentTest\";\nimport ExpertApplicationPaymentFixed from \"@/pages/ExpertApplicationPaymentFixed\";\nimport ExpertApplicationSuccess from \"@/pages/ExpertApplicationSuccess\";\nimport ExpertApplicationSimple from \"@/pages/ExpertApplicationSimple\";\nimport BookConsultation from \"@/pages/BookConsultationNew\";\nimport MyBookings from \"@/pages/MyBookings\";\nimport BookAppointment from \"@/pages/BookAppointment\";\nimport ThisWeekBy from \"@/pages/ThisWeekBy\";\nimport ProfilePage from \"@/pages/profile\";\nimport SettingsPage from \"@/pages/settings\";\nimport AuthPage from \"@/pages/auth-page\";\nimport OnboardingPage from \"@/pages/onboarding\";\nimport ForgotPassword from \"@/pages/ForgotPassword\";\nimport ResetPassword from \"@/pages/ResetPassword\";\nimport VerifySuccess from \"@/pages/VerifySuccess\";\n\nimport AdminDashboard from \"@/pages/AdminDashboard\";\nimport AdminContentSources from \"@/pages/AdminContentSources\";\nimport AdminSearchLogs from \"@/pages/AdminSearchLogs\";\nimport AdminSocialMediaEmbeds from \"@/pages/admin/SocialMediaEmbeds\";\nimport RagAdmin from \"@/pages/admin/RagAdmin\";\nimport FoundersLetter from \"@/pages/FoundersLetter\";\nimport ExpertAvailability from \"@/pages/ExpertAvailability\";\nimport RagSearchPage from \"@/pages/RagSearchPage\";\nimport NotFound from \"@/pages/not-found\";\nimport Header from \"@/components/Header\";\nimport ScrollToTop from \"@/components/ScrollToTop\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nfunction Router() {\n  const { user, isLoaded } = useUser();\n  const { needsOnboarding, isLoading: authLoading } = useAuth();\n\n  // Only show loading for authenticated users who are still loading\n  // Allow unauthenticated users to access public pages immediately\n  if (user && authLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  // If user is authenticated but needs onboarding, redirect to onboarding\n  if (user && needsOnboarding) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <OnboardingPage />\n      </div>\n    );\n  }\n\n  // Removed the automatic redirect for pending expert applicants - they can now navigate freely\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n      <Switch>\n        <Route path=\"/\" component={user ? Home : Landing} />\n        <Route path=\"/landing\" component={Landing} />\n        <Route path=\"/community\" component={Home} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        <Route path=\"/auth\" component={AuthPage} />\n        <Route path=\"/onboarding\" component={OnboardingPage} />\n        <Route path=\"/topic\" component={Topic} />\n        <Route path=\"/category/:slug\" component={Category} />\n        <Route path=\"/post/:id\" component={Post} />\n        <Route path=\"/subscribe\" component={Subscribe} />\n        <Route path=\"/forgot-password\" component={ForgotPassword} />\n        <Route path=\"/reset-password\" component={ResetPassword} />\n        <Route path=\"/verify-success\" component={VerifySuccess} />\n        <Route path=\"/expert/apply\" component={ExpertApplication} />\n        <Route path=\"/expert/apply-with-payment\" component={ExpertApplicationWithPayment} />\n        <Route path=\"/expert-application-with-payment\" component={ExpertApplicationWithPayment} />\n        <Route path=\"/expert-application-with-payment-test\" component={ExpertApplicationWithPaymentTest} />\n        <Route path=\"/expert-application-payment-fixed\" component={ExpertApplicationPaymentFixed} />\n        <Route path=\"/expert-application-simple\" component={ExpertApplicationSimple} />\n        <Route path=\"/expert-application/success\" component={ExpertApplicationSuccess} />\n        <Route path=\"/expert-application-success\" component={ExpertApplicationSuccess} />\n        <Route path=\"/experts\" component={ExpertDirectory} />\n        <Route path=\"/expert/:userId\" component={ExpertProfile} />\n\n        <Route path=\"/profile/:id\" component={ProfilePage} />\n        <Route path=\"/profile\" component={ProfilePage} />\n        <Route path=\"/settings\" component={SettingsPage} />\n        <Route path=\"/book-consultation/:expertId\" component={BookConsultation} />\n        <Route path=\"/my-bookings\" component={MyBookings} />\n        <Route path=\"/book/:expertId\" component={BookAppointment} />\n        <Route path=\"/this-week-by\" component={ThisWeekBy} />\n        <Route path=\"/founders-letter\" component={FoundersLetter} />\n        <Route path=\"/expert/availability\" component={ExpertAvailability} />\n        <Route path=\"/admin/dashboard\" component={AdminDashboard} />\n        <Route path=\"/admin/content-sources\" component={AdminContentSources} />\n        <Route path=\"/admin/search-logs\" component={AdminSearchLogs} />\n        <Route path=\"/admin/social-media-embeds\" component={AdminSocialMediaEmbeds} />\n        <Route path=\"/admin/rag\" component={RagAdmin} />\n        <Route path=\"/ai-search\" component={RagSearchPage} />\n        <Route component={NotFound} />\n      </Switch>\n    </div>\n  );\n}\n\nconst clerkPubKey = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY;\n\n// Error page component for missing configuration\nfunction ConfigurationError() {\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 px-4\">\n      <div className=\"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8\">\n        <div className=\"text-center\">\n          <div className=\"text-red-600 mb-4\">\n            <svg className=\"w-16 h-16 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n            </svg>\n          </div>\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">Configuration Required</h1>\n          <p className=\"text-lg text-gray-600 mb-6\">Missing Clerk authentication keys. The application cannot start without proper configuration.</p>\n          \n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 mb-6 text-left\">\n            <h2 className=\"font-semibold text-red-900 mb-3\">Missing Environment Variable:</h2>\n            <code className=\"block bg-red-100 text-red-800 px-3 py-2 rounded font-mono text-sm\">\n              VITE_CLERK_PUBLISHABLE_KEY\n            </code>\n          </div>\n\n          <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6 text-left\">\n            <h2 className=\"font-semibold text-gray-900 mb-3\">To Fix This:</h2>\n            <ol className=\"space-y-2 text-gray-700\">\n              <li className=\"flex items-start\">\n                <span className=\"font-bold mr-2\">1.</span>\n                <span>Copy <code className=\"bg-gray-200 px-2 py-1 rounded text-sm\">.env.example</code> to <code className=\"bg-gray-200 px-2 py-1 rounded text-sm\">.env</code></span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"font-bold mr-2\">2.</span>\n                <span>Get your Clerk keys from <a href=\"https://dashboard.clerk.com/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline\">dashboard.clerk.com</a></span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"font-bold mr-2\">3.</span>\n                <span>Add the keys to your <code className=\"bg-gray-200 px-2 py-1 rounded text-sm\">.env</code> file</span>\n              </li>\n              <li className=\"flex items-start\">\n                <span className=\"font-bold mr-2\">4.</span>\n                <span>Restart the development server</span>\n              </li>\n            </ol>\n          </div>\n\n          <div className=\"mt-6 text-sm text-gray-500\">\n            <p>For detailed setup instructions, see <code className=\"bg-gray-200 px-2 py-1 rounded\">SETUP_GUIDE.md</code></p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction App() {\n  // Show helpful error page if Clerk keys are missing\n  if (!clerkPubKey) {\n    console.error(\"Missing VITE_CLERK_PUBLISHABLE_KEY environment variable\");\n    console.error(\"Please see SETUP_GUIDE.md for setup instructions\");\n    return <ConfigurationError />;\n  }\n\n  return (\n    <ClerkProvider \n      publishableKey={clerkPubKey}\n      appearance={{\n        baseTheme: undefined,\n        variables: {\n          colorPrimary: \"#487d7a\"\n        }\n      }}\n    >\n      <QueryClientProvider client={queryClient}>\n        <AuthProvider>\n          <TooltipProvider>\n            <Toaster />\n            <ScrollToTop />\n            <Router />\n          </TooltipProvider>\n        </AuthProvider>\n      </QueryClientProvider>\n    </ClerkProvider>\n  );\n}\n\nexport default App;\n","size_bytes":9766},"client/src/pages/post.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { ArrowLeft, Heart, MessageCircle, Reply, Flag, Share2, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport Header from \"@/components/Header\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { categoryIcons } from \"@/lib/categories\";\n\nexport default function Post() {\n  const { id } = useParams();\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [newComment, setNewComment] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<number | null>(null);\n\n  const { data: post, isLoading } = useQuery({\n    queryKey: [`/api/posts/${id}`],\n    enabled: !!id,\n  });\n\n  const { data: comments } = useQuery({\n    queryKey: [`/api/posts/${id}/comments`],\n    enabled: !!id,\n  });\n\n  const { data: userVote } = useQuery({\n    queryKey: [`/api/vote/${id}`],\n    enabled: !!id && isAuthenticated,\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: () => apiRequest(\"POST\", \"/api/vote\", { postId: parseInt(id!) }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${id}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/vote/${id}`] });\n    },\n  });\n\n  const commentMutation = useMutation({\n    mutationFn: (content: string) => \n      apiRequest(\"POST\", `/api/posts/${id}/comments`, { content }),\n    onSuccess: () => {\n      setNewComment(\"\");\n      setReplyingTo(null);\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${id}/comments`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${id}`] });\n      toast({\n        title: \"Comment posted!\",\n        description: \"Your comment has been added to the discussion.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to post comment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-8 bg-gray-200 rounded w-1/3\"></div>\n            <div className=\"h-64 bg-gray-200 rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!post) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Post not found</h1>\n            <Link href=\"/\">\n              <Button variant=\"outline\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Home\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const IconComponent = categoryIcons[post.category.slug] || MessageCircle;\n  const gradientClass = `gradient-${post.category.color}`;\n\n  const handleVote = () => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Sign in required\",\n        description: \"Please sign in to vote on posts.\",\n      });\n      return;\n    }\n    voteMutation.mutate();\n  };\n\n  const handleComment = () => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Sign in required\",\n        description: \"Please sign in to comment on posts.\",\n      });\n      return;\n    }\n    if (!newComment.trim()) return;\n    commentMutation.mutate(newComment);\n  };\n\n  const formatDate = (date: string) => {\n    return new Intl.RelativeTimeFormat('en', { numeric: 'auto' }).format(\n      Math.ceil((new Date(date).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24)),\n      'day'\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Navigation */}\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"sm\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back\n            </Button>\n          </Link>\n          <Link href={`/category/${post.category.slug}`}>\n            <Badge variant=\"secondary\" className=\"flex items-center gap-2\">\n              <div className={`w-3 h-3 ${gradientClass} rounded-full`}></div>\n              {post.category.name}\n            </Badge>\n          </Link>\n        </div>\n\n        {/* Main Post */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Avatar>\n                  <AvatarImage src={post.author.profileImageUrl} />\n                  <AvatarFallback>\n                    {post.author.firstName?.[0]}{post.author.lastName?.[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <div className=\"font-semibold text-gray-900\">\n                    {post.author.firstName} {post.author.lastName?.[0]}.\n                  </div>\n                  <div className=\"text-sm text-gray-500 flex items-center gap-2\">\n                    <Clock className=\"w-3 h-3\" />\n                    {formatDate(post.createdAt)}\n                  </div>\n                </div>\n              </div>\n              <Button variant=\"ghost\" size=\"sm\">\n                <Flag className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <h1 className=\"text-2xl font-bold text-gray-900 mt-4\">{post.title}</h1>\n          </CardHeader>\n          <CardContent>\n            <div className=\"prose max-w-none text-gray-700 mb-6\">\n              {post.content.split('\\n').map((paragraph: string, index: number) => (\n                <p key={index} className=\"mb-4\">{paragraph}</p>\n              ))}\n            </div>\n            \n            <Separator className=\"my-6\" />\n            \n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleVote}\n                  className={`flex items-center gap-2 ${userVote?.voted ? 'text-red-600' : 'text-gray-600'}`}\n                >\n                  <Heart className={`w-4 h-4 ${userVote?.voted ? 'fill-current' : ''}`} />\n                  {post.helpfulVotes} helpful\n                </Button>\n                <Button variant=\"ghost\" size=\"sm\" className=\"flex items-center gap-2\">\n                  <MessageCircle className=\"w-4 h-4\" />\n                  {post.commentCount} replies\n                </Button>\n              </div>\n              <Button variant=\"ghost\" size=\"sm\">\n                <Share2 className=\"w-4 h-4 mr-2\" />\n                Share\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Comments Section */}\n        <div className=\"space-y-6\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">\n            Responses ({comments?.length || 0})\n          </h2>\n\n          {/* Add Comment */}\n          {isAuthenticated ? (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-start gap-3\">\n                  <Avatar>\n                    <AvatarImage src={user?.profileImageUrl} />\n                    <AvatarFallback>\n                      {user?.firstName?.[0]}{user?.lastName?.[0]}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <Textarea\n                      placeholder=\"Share your thoughts or experiences...\"\n                      value={newComment}\n                      onChange={(e) => setNewComment(e.target.value)}\n                      className=\"mb-3\"\n                    />\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"text-xs text-gray-500\">\n                        Remember: Be supportive and respectful\n                      </div>\n                      <Button \n                        onClick={handleComment}\n                        disabled={!newComment.trim() || commentMutation.isPending}\n                      >\n                        {commentMutation.isPending ? \"Posting...\" : \"Reply to Post\"}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"pt-6 text-center\">\n                <p className=\"text-gray-600 mb-4\">Sign in to join the conversation</p>\n                <Button onClick={() => window.location.href = '/auth'}>\n                  Sign In\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Comments List */}\n          <div className=\"space-y-4\">\n            {comments?.map((comment: any) => (\n              <Card key={comment.id}>\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-start gap-3\">\n                    <Avatar>\n                      <AvatarImage src={comment.author.profileImageUrl} />\n                      <AvatarFallback>\n                        {comment.author.firstName?.[0]}{comment.author.lastName?.[0]}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <span className=\"font-semibold text-gray-900\">\n                          {comment.author.firstName} {comment.author.lastName?.[0]}.\n                        </span>\n                        {comment.isExpertResponse && (\n                          <Badge variant=\"outline\" className=\"text-purple-600 border-purple-600\">\n                            Verified Expert\n                          </Badge>\n                        )}\n                        <span className=\"text-sm text-gray-500\">\n                          {formatDate(comment.createdAt)}\n                        </span>\n                      </div>\n                      <div className=\"text-gray-700 mb-3\">\n                        {comment.content}\n                      </div>\n                      <div className=\"flex items-center gap-4\">\n                        <Button variant=\"ghost\" size=\"sm\" className=\"text-gray-500\">\n                          <Heart className=\"w-3 h-3 mr-1\" />\n                          {comment.helpfulVotes}\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\" className=\"text-gray-500\">\n                          <Reply className=\"w-3 h-3 mr-1\" />\n                          Reply to Comment\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11615},"client/src/pages/topic.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  MessageSquare,\n  ArrowUp,\n  ArrowDown,\n  Clock,\n  User,\n  Search,\n  Plus,\n  Filter,\n  TrendingUp,\n  Calendar,\n  Star,\n  CheckCircle,\n  Shield,\n  X,\n} from \"lucide-react\";\nimport DynamicDiscussionTopicsSidebar from \"@/components/DynamicDiscussionTopicsSidebar\";\nimport PostCard from \"@/components/PostCard\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface FakePost {\n  id: number;\n  title: string;\n  content: string;\n  author: {\n    firstName: string;\n    lastName: string;\n    profileImageUrl?: string;\n    isExpert?: boolean;\n    location?: string;\n  };\n  upvotes: number;\n  downvotes: number;\n  commentCount: number;\n  timeAgo: string;\n  category: string;\n  tags: string[];\n  isResolved?: boolean;\n  hasUserVoted?: 'up' | 'down' | null;\n}\n\n\n\nexport default function TopicPage() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [sortBy, setSortBy] = useState<'hot' | 'new' | 'top'>('hot');\n  \n  // Modal states\n  const [showNewPostModal, setShowNewPostModal] = useState(false);\n  const [showNewTopicModal, setShowNewTopicModal] = useState(false);\n  \n  // Form states for new post\n  const [newPostTitle, setNewPostTitle] = useState('');\n  const [newPostContent, setNewPostContent] = useState('');\n  \n  // Form states for new topic\n  const [newTopicTitle, setNewTopicTitle] = useState('');\n  const [newTopicFirstPostTitle, setNewTopicFirstPostTitle] = useState('');\n  const [newTopicFirstPostContent, setNewTopicFirstPostContent] = useState('');\n  const [selectedDiscussionForum, setSelectedDiscussionForum] = useState('');\n  const [selectedMainTopic, setSelectedMainTopic] = useState('');\n\n  // Extract topic from URL (would be dynamic in real app)\n  const topicName = new URLSearchParams(location.split('?')[1] || '').get('topic') || 'Home Care';\n\n  // Fetch real posts from API\n  const { data: posts = [], isLoading } = useQuery({\n    queryKey: ['/api/posts'],\n    retry: false,\n  });\n\n  // Fetch categories to get the current topic's categoryId\n  const { data: categories = [] } = useQuery({\n    queryKey: ['/api/categories'],\n    retry: false,\n  });\n\n  // Fetch category hierarchy for topic creation\n  const { data: categoryHierarchy = [] } = useQuery({\n    queryKey: ['/api/categories/hierarchy'],\n    retry: false,\n  });\n\n  // Fetch discussion forums (level 0)\n  const { data: discussionForums = [] } = useQuery({\n    queryKey: ['/api/categories/level/0'],\n    retry: false,\n  });\n\n  // Fetch main topics for selected discussion forum\n  const { data: mainTopics = [], isLoading: mainTopicsLoading } = useQuery({\n    queryKey: ['/api/categories/parent', selectedDiscussionForum],\n    enabled: !!selectedDiscussionForum,\n    retry: false,\n  });\n\n\n\n\n\n  // Topic hierarchy mapping function\n  const findCategoryForTopic = (topicName: string, categories: any[]) => {\n    // Direct match first\n    let category = categories.find((cat: any) => \n      cat.name === topicName || cat.slug === topicName.toLowerCase().replace(/\\s+/g, '-')\n    );\n    \n    if (category) return category;\n    \n    // Define topic hierarchy mapping\n    const topicHierarchy: { [key: string]: string } = {\n      // Federal & State Resources subtopics\n      \"Area Agencies on Aging\": \"Federal & State Resources\",\n      \"Long-Term Care Ombudsman\": \"Federal & State Resources\", \n      \"Adult Protective Services\": \"Federal & State Resources\",\n      \"Adult Day Centers\": \"Federal & State Resources\",\n      \"Meals on Wheels\": \"Federal & State Resources\",\n      \"Transportation\": \"Federal & State Resources\",\n      \"Friendship Line\": \"Federal & State Resources\",\n      \"Suicide Prevention Hotline\": \"Federal & State Resources\",\n      \"Tax Filing Help\": \"Federal & State Resources\",\n      \n      // Veteran Benefits subtopics\n      \"VA Healthcare\": \"Veteran Benefits\",\n      \"Disability Benefits\": \"Veteran Benefits\",\n      \"Military Discounts\": \"Veteran Benefits\",\n      \"Veteran Services\": \"Veteran Benefits\",\n      \"GI Bill Benefits\": \"Veteran Benefits\",\n      \n      // Medicare subtopics\n      \"Medicare Part A & B\": \"Medicare\",\n      \"Medicare Part C\": \"Medicare\",\n      \"Medicare Part D\": \"Medicare\",\n      \n      // Medicaid subtopics\n      \"Qualifying for Medicaid\": \"Medicaid\",\n      \"Lookback Periods\": \"Medicaid\",\n      \"State Claims\": \"Medicaid\",\n      \"Filing Assistance\": \"Medicaid\",\n      \n      // Home Care subtopics\n      \"Recommended Agencies\": \"Home Care\",\n      \"Managing Home Care Aides\": \"Home Care\",\n      \"Negotiating with Home Care Agencies\": \"Home Care\",\n      \"Typical Contract Periods\": \"Home Care\",\n      \n      // ADUs & Home Modifications subtopics\n      \"Accessibility Modifications\": \"ADUs & Home Modifications\",\n      \"Safety Features\": \"ADUs & Home Modifications\",\n      \"ADU Construction\": \"ADUs & Home Modifications\", \n      \"Home Assessments\": \"ADUs & Home Modifications\",\n      \n      // Selling a Home subtopics\n      \"Market Preparation\": \"Selling a Home\",\n      \"Senior-Friendly Realtors\": \"Selling a Home\",\n      \"Moving Assistance\": \"Selling a Home\",\n      \"Estate Sales\": \"Selling a Home\",\n      \n      // Senior Living subtopics\n      \"Senior Apartments\": \"Senior Living\",\n      \"Active Adult\": \"Senior Living\",\n      \"Independent Living\": \"Senior Living\",\n      \"Assisted Living\": \"Senior Living\",\n      \"Memory Care\": \"Senior Living\",\n      \"Life Plan Communities\": \"Senior Living\",\n      \"CCRCs\": \"Senior Living\",\n      \n      // Respite Care subtopics\n      \"Adult Day Programs\": \"Respite Care\",\n      \"Overnight Respite\": \"Respite Care\",\n      \"Family Relief\": \"Respite Care\",\n      \"Caregiver Support\": \"Respite Care\",\n      \n      // Hospice subtopics\n      \"End-of-Life Planning\": \"Hospice\",\n      \"Comfort Care\": \"Hospice\",\n      \"Family Support\": \"Hospice\",\n      \"Grief Resources\": \"Hospice\"\n    };\n    \n    // Check if current topic is a subtopic\n    const parentTopic = topicHierarchy[topicName];\n    if (parentTopic) {\n      category = categories.find((cat: any) => cat.name === parentTopic);\n    }\n    \n    return category;\n  };\n  \n  const currentCategory = findCategoryForTopic(topicName, categories);\n  const defaultCategoryId = currentCategory?.id || categories[0]?.id || 1;\n\n  // Vote handler function for posts\n  const handleVote = async (postId: number, voteType: 'up' | 'down') => {\n    if (!user) return;\n    // In real app, this would call the API\n    console.log(`Vote ${voteType} on post ${postId}`);\n  };\n\n  // Mutation for creating new post\n  const createPostMutation = useMutation({\n    mutationFn: async (postData: { title: string; content: string; categoryId?: number }) => {\n      const response = await apiRequest('POST', '/api/posts', postData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/posts'] });\n      setShowNewPostModal(false);\n      setNewPostTitle('');\n      setNewPostContent('');\n      toast({\n        title: \"Success\",\n        description: \"Your post has been created successfully!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create post\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mutation for creating new topic (category)\n  const createTopicMutation = useMutation({\n    mutationFn: async (topicData: { \n      name: string; \n      description: string; \n      slug: string; \n      parentId?: number;\n      level: number;\n    }) => {\n      const response = await apiRequest('POST', '/api/categories', topicData);\n      return response.json();\n    },\n    onSuccess: async (newCategory) => {\n      // Create the first post in the new topic\n      const postData = {\n        title: newTopicFirstPostTitle,\n        content: newTopicFirstPostContent,\n        categoryId: newCategory.id,\n      };\n      \n      try {\n        await apiRequest('POST', '/api/posts', postData);\n        queryClient.invalidateQueries({ queryKey: ['/api/categories'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/categories/hierarchy'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/posts'] });\n        \n        setShowNewTopicModal(false);\n        setNewTopicTitle('');\n        setNewTopicFirstPostTitle('');\n        setNewTopicFirstPostContent('');\n        setSelectedDiscussionForum('');\n        setSelectedMainTopic('');\n        \n        toast({\n          title: \"Success\",\n          description: \"Your new topic has been created successfully!\",\n        });\n      } catch (error) {\n        toast({\n          title: \"Warning\",\n          description: \"Topic created but failed to create first post\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create topic\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle form submissions\n  const handleNewPostSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newPostTitle.trim() || !newPostContent.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createPostMutation.mutate({\n      title: newPostTitle,\n      content: newPostContent,\n      categoryId: defaultCategoryId,\n    });\n  };\n\n  const handleNewTopicSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newTopicTitle.trim() || !newTopicFirstPostTitle.trim() || !newTopicFirstPostContent.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate hierarchy selection for sub-topic\n    if (!selectedDiscussionForum || !selectedMainTopic) {\n      toast({\n        title: \"Error\",\n        description: \"Please select both Discussion Forum and Main Topic for your Sub-Topic\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const slug = newTopicTitle.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');\n    \n    // Always creating sub-topics (level 2) with main topic as parent\n    const parentId = parseInt(selectedMainTopic);\n    const level = 2;\n\n    createTopicMutation.mutate({\n      name: newTopicTitle,\n      description: `Discussion about ${newTopicTitle}`,\n      slug: slug,\n      parentId,\n      level,\n    });\n  };\n\n  // Convert data to match PostCard format\n  const convertedPosts = [\n    {\n      id: 1,\n      title: \"How do I find a reliable home care agency? Mom needs help 4 hours a day\",\n      content: \"My 82-year-old mother recently had a fall and needs assistance with daily activities. I'm looking for a home care agency that can provide 4 hours of care daily. What should I look for when vetting agencies? Any red flags to watch out for?\",\n      helpfulVotes: 23,\n      commentCount: 8,\n      isResolved: false,\n      createdAt: \"2024-06-04T14:00:00Z\",\n      author: {\n        id: \"1\",\n        firstName: \"Jennifer\",\n        lastName: \"M.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face&auto=format\",\n        city: \"Phoenix\",\n        state: \"AZ\"\n      },\n      category: {\n        id: 1,\n        name: \"Home Care\",\n        slug: \"home-care\",\n        color: \"#487d7a\"\n      }\n    },\n    {\n      id: 2,\n      title: \"Home care aide doesn't follow care plan - how to address this professionally?\",\n      content: \"We've been working with a home care aide for 3 weeks now. She's very sweet, but consistently doesn't follow the care plan we established. For example, she's not helping Dad with his physical therapy exercises and often lets him skip meals. How can I address this without being confrontational?\",\n      helpfulVotes: 45,\n      commentCount: 12,\n      isResolved: true,\n      createdAt: \"2024-06-04T10:00:00Z\",\n      author: {\n        id: \"2\",\n        firstName: \"Dr. Sarah\",\n        lastName: \"K.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=150&h=150&fit=crop&crop=face&auto=format\",\n        city: \"Denver\",\n        state: \"CO\"\n      },\n      category: {\n        id: 1,\n        name: \"Home Care\",\n        slug: \"home-care\",\n        color: \"#487d7a\"\n      },\n      expertVerification: {\n        isVerified: true,\n        expertise: \"Geriatric Care\"\n      }\n    },\n    {\n      id: 3,\n      title: \"Contract question: Agency wants 40-hour minimum, we only need 20 hours\",\n      content: \"I'm negotiating with a home care agency and they're insisting on a 40-hour per week minimum. We realistically only need about 20 hours of care. Has anyone successfully negotiated lower minimums? Are there agencies that work with smaller hour requirements?\",\n      helpfulVotes: 18,\n      commentCount: 6,\n      isResolved: false,\n      createdAt: \"2024-06-04T08:00:00Z\",\n      author: {\n        id: \"3\",\n        firstName: \"Michael\",\n        lastName: \"R.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face&auto=format\",\n        city: \"Seattle\",\n        state: \"WA\"\n      },\n      category: {\n        id: 1,\n        name: \"Home Care\",\n        slug: \"home-care\",\n        color: \"#487d7a\"\n      }\n    },\n    {\n      id: 4,\n      title: \"What's a reasonable hourly rate for home care in suburban areas?\",\n      content: \"We're getting quotes from different agencies and the rates vary wildly - from $18/hour to $35/hour. This is for basic companion care and light housekeeping. What should we expect to pay in a suburban setting? Are the higher-priced agencies necessarily better?\",\n      author: {\n        firstName: \"Linda\",\n        lastName: \"T.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face&auto=format\",\n        location: \"Austin, TX\"\n      },\n      upvotes: 31,\n      downvotes: 3,\n      commentCount: 15,\n      timeAgo: \"8 hours ago\",\n      category: \"Home Care\",\n      tags: [\"pricing\", \"comparison\", \"companion-care\"]\n    },\n    {\n      id: 5,\n      title: \"Success story: Found amazing aide through word-of-mouth referral\",\n      content: \"After struggling with two different agencies, I found our current aide through a recommendation from Dad's doctor. She's been with us for 6 months now and is absolutely wonderful. Just wanted to remind everyone that sometimes the best resources come from healthcare providers who see which aides consistently do great work.\",\n      author: {\n        firstName: \"Patricia\",\n        lastName: \"W.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face&auto=format\",\n        location: \"Portland, OR\"\n      },\n      upvotes: 67,\n      downvotes: 0,\n      commentCount: 9,\n      timeAgo: \"12 hours ago\",\n      category: \"Home Care\",\n      tags: [\"success-story\", \"referrals\", \"healthcare-providers\"],\n      isResolved: true\n    },\n    {\n      id: 6,\n      title: \"Background check red flags - aide has misdemeanor from 15 years ago\",\n      content: \"The background check for a potential aide shows a misdemeanor from 15 years ago (non-violent, financial related). The agency says it's within their acceptance policy, but I'm feeling hesitant. How do you weigh past issues against current qualifications? She interviewed really well and has excellent references.\",\n      author: {\n        firstName: \"Robert\",\n        lastName: \"H.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face&auto=format\",\n        location: \"Miami, FL\"\n      },\n      upvotes: 12,\n      downvotes: 4,\n      commentCount: 18,\n      timeAgo: \"1 day ago\",\n      category: \"Home Care\",\n      tags: [\"background-checks\", \"safety\", \"decision-making\"]\n    },\n    {\n      id: 7,\n      title: \"Emergency backup plan when regular aide calls in sick?\",\n      content: \"Our regular aide called in sick this morning and the agency can't provide a substitute until tomorrow. Mom needs help with medication and meals. What do other families do for emergency coverage? Should we have multiple agencies lined up?\",\n      author: {\n        firstName: \"David\",\n        lastName: \"L.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop&crop=face&auto=format\",\n        location: \"Chicago, IL\"\n      },\n      upvotes: 29,\n      downvotes: 1,\n      commentCount: 11,\n      timeAgo: \"1 day ago\",\n      category: \"Home Care\",\n      tags: [\"emergency\", \"backup\", \"planning\"]\n    },\n    {\n      id: 8,\n      title: \"Male vs female caregivers - Dad is more comfortable with men\",\n      content: \"My father is more comfortable with male caregivers for personal care tasks. Most agencies seem to have predominantly female staff. Has anyone had success specifically requesting male caregivers? Are there agencies that specialize in this?\",\n      author: {\n        firstName: \"Angela\",\n        lastName: \"S.\",\n        profileImageUrl: \"https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=150&h=150&fit=crop&crop=face&auto=format\",\n        location: \"Dallas, TX\"\n      },\n      upvotes: 21,\n      downvotes: 2,\n      commentCount: 7,\n      timeAgo: \"2 days ago\",\n      category: \"Home Care\",\n      tags: [\"male-caregivers\", \"comfort\", \"personal-care\"]\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header with Search */}\n      <div className=\"bg-[#0B666B]/90 border-b border-teal-700\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"grid grid-cols-12 gap-8 items-start\">\n            {/* Left: Topic Title */}\n            <div className=\"col-span-3 flex flex-col justify-center\">\n              <h1 className=\"text-2xl font-bold text-white flex items-center mb-4\">\n                <div className=\"w-3 h-3 rounded-full bg-emerald-300 mr-3\"></div>\n                {topicName}\n              </h1>\n              <div className=\"text-left\">\n                <p className=\"text-white text-lg font-medium\">\n                  {convertedPosts.length} discussions\n                </p>\n                <p className=\"text-white text-sm mt-1\">\n                  Join the conversation\n                </p>\n              </div>\n            </div>\n            \n            {/* Center: Search Bar and Sort Options */}\n            <div className=\"col-span-6 flex flex-col items-center\">\n              <div className=\"relative w-full mb-5\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search discussions...\"\n                  className=\"w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-white focus:border-transparent shadow-sm\"\n                />\n              </div>\n              \n              {/* Sort Options */}\n              <div className=\"flex items-center space-x-4\">\n                <span className=\"text-sm font-medium text-white\">Sort by:</span>\n                <div className=\"flex space-x-2\">\n                {['hot', 'new', 'top'].map((sort) => (\n                  <button\n                    key={sort}\n                    onClick={() => setSortBy(sort as any)}\n                    className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${\n                      sortBy === sort\n                        ? 'bg-white text-teal-700'\n                        : 'text-white hover:text-white hover:bg-teal-600'\n                    }`}\n                  >\n                    {sort === 'hot' && <TrendingUp className={`w-4 h-4 inline mr-1 ${sortBy === sort ? 'text-teal-700' : 'text-teal-400'}`} />}\n                    {sort === 'new' && <Clock className=\"w-4 h-4 inline mr-1 text-white\" />}\n                    {sort === 'top' && <Star className=\"w-4 h-4 inline mr-1 text-white\" />}\n                    {sort.charAt(0).toUpperCase() + sort.slice(1)}\n                  </button>\n                ))}\n                </div>\n              </div>\n            </div>\n            \n            {/* Right: Action Buttons */}\n            <div className=\"col-span-3 flex flex-col gap-3 justify-self-end\">\n              <Button \n                className=\"bg-white text-teal-700 hover:bg-teal-50 border border-white shadow-sm\"\n                onClick={() => setShowNewPostModal(true)}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                New Post\n              </Button>\n              <Button \n                className=\"bg-amber-500 hover:bg-amber-600 text-white shadow-sm\"\n                onClick={() => setShowNewTopicModal(true)}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                New Topic\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid lg:grid-cols-12 gap-8\">\n          \n          {/* Left Sidebar */}\n          <div className=\"lg:col-span-4\">\n            <DynamicDiscussionTopicsSidebar />\n          </div>\n\n          {/* Main Content */}\n          <div className=\"lg:col-span-8\">\n\n            {/* Posts List */}\n            <div className=\"space-y-6\">\n              {isLoading ? (\n                <div className=\"text-center py-8\">\n                  <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full mx-auto\"></div>\n                  <p className=\"text-gray-600 mt-2\">Loading discussions...</p>\n                </div>\n              ) : posts && posts.length > 0 ? (\n                posts.map((post: any) => (\n                  <PostCard key={post.id} post={post} />\n                ))\n              ) : convertedPosts.length > 0 ? (\n                convertedPosts.map((post) => (\n                  <PostCard key={post.id} post={post} />\n                ))\n              ) : (\n                <div className=\"text-center py-12\">\n                  <p className=\"text-gray-600\">No posts yet. Be the first to start a discussion!</p>\n                </div>\n              )}\n            </div>\n\n            {/* Load More */}\n            <div className=\"mt-8 text-center\">\n              <Button variant=\"outline\" className=\"px-8\">\n                Load More Posts\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* New Post Modal */}\n      <Dialog open={showNewPostModal} onOpenChange={setShowNewPostModal}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>Create New Post in {topicName}</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleNewPostSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"post-title\">Post Title</Label>\n              <Input\n                id=\"post-title\"\n                value={newPostTitle}\n                onChange={(e) => setNewPostTitle(e.target.value)}\n                placeholder=\"Enter your post title...\"\n                className=\"w-full\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"post-content\">Content</Label>\n              <Textarea\n                id=\"post-content\"\n                value={newPostContent}\n                onChange={(e) => setNewPostContent(e.target.value)}\n                placeholder=\"Share your thoughts, questions, or experiences...\"\n                className=\"w-full min-h-[120px]\"\n              />\n            </div>\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewPostModal(false)}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"bg-teal-600 hover:bg-teal-700 text-white\"\n                disabled={createPostMutation.isPending}\n              >\n                {createPostMutation.isPending ? \"Creating...\" : \"Create Post\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* New Topic Modal */}\n      <Dialog open={showNewTopicModal} onOpenChange={setShowNewTopicModal}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>Create New Topic</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleNewTopicSubmit} className=\"space-y-4\">\n            {/* Hierarchical Selection */}\n            <div className=\"space-y-2\">\n              <Label>Discussion Forum</Label>\n              <Select \n                value={selectedDiscussionForum} \n                onValueChange={(value) => {\n                  setSelectedDiscussionForum(value);\n                  setSelectedMainTopic(''); // Reset main topic when forum changes\n                }}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select a discussion forum...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {Array.isArray(discussionForums) && discussionForums.map((forum: any) => (\n                    <SelectItem key={forum.id} value={forum.id.toString()}>\n                      {forum.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Main Topic</Label>\n              <Select \n                key={`main-topic-${selectedDiscussionForum}`}\n                value={selectedMainTopic} \n                onValueChange={setSelectedMainTopic}\n                disabled={!selectedDiscussionForum}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder={selectedDiscussionForum ? \"Select a main topic...\" : \"Select discussion forum first\"} />\n                </SelectTrigger>\n                <SelectContent>\n                  {!selectedDiscussionForum ? (\n                    <SelectItem value=\"no-forum\" disabled>Select a discussion forum first</SelectItem>\n                  ) : mainTopicsLoading ? (\n                    <SelectItem value=\"loading\" disabled>Loading main topics...</SelectItem>\n                  ) : Array.isArray(mainTopics) && mainTopics.length > 0 ? (\n                    mainTopics.map((topic: any) => (\n                      <SelectItem key={topic.id} value={topic.id.toString()}>\n                        {topic.name}\n                      </SelectItem>\n                    ))\n                  ) : (\n                    <SelectItem value=\"no-topics\" disabled>No main topics available</SelectItem>\n                  )}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"topic-title\">New Sub-Topic Title</Label>\n              <Input\n                id=\"topic-title\"\n                value={newTopicTitle}\n                onChange={(e) => setNewTopicTitle(e.target.value)}\n                placeholder=\"Enter sub-topic name...\"\n                className=\"w-full\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"first-post-title\">Title of Your First Post</Label>\n              <Input\n                id=\"first-post-title\"\n                value={newTopicFirstPostTitle}\n                onChange={(e) => setNewTopicFirstPostTitle(e.target.value)}\n                placeholder=\"Enter first post title...\"\n                className=\"w-full\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"first-post-content\">First Post Content</Label>\n              <Textarea\n                id=\"first-post-content\"\n                value={newTopicFirstPostContent}\n                onChange={(e) => setNewTopicFirstPostContent(e.target.value)}\n                placeholder=\"Start the conversation in your new topic...\"\n                className=\"w-full min-h-[120px]\"\n              />\n            </div>\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowNewTopicModal(false)}\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"bg-amber-500 hover:bg-amber-600 text-white\"\n                disabled={createTopicMutation.isPending}\n              >\n                {createTopicMutation.isPending ? \"Creating...\" : \"Create Topic\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":29567},"server/redis.ts":{"content":"import { createClient } from 'redis';\n\n// Redis client configuration\nconst redisClient = createClient({\n  url: process.env.REDIS_URL || 'redis://localhost:6379',\n  socket: {\n    reconnectStrategy: (retries) => Math.min(retries * 50, 500)\n  }\n});\n\n// Error handling\nredisClient.on('error', (err) => {\n  console.error('Redis Client Error:', err);\n});\n\nredisClient.on('connect', () => {\n  console.log('Redis Client Connected');\n});\n\nredisClient.on('ready', () => {\n  console.log('Redis Client Ready');\n});\n\n// Connect to Redis\nexport async function connectRedis() {\n  try {\n    if (!redisClient.isOpen) {\n      await redisClient.connect();\n    }\n  } catch (error) {\n    console.error('Failed to connect to Redis:', error);\n    throw error;\n  }\n}\n\n// Cache utility functions\nexport class RedisCache {\n  private static instance: RedisCache;\n  \n  static getInstance(): RedisCache {\n    if (!RedisCache.instance) {\n      RedisCache.instance = new RedisCache();\n    }\n    return RedisCache.instance;\n  }\n\n  // Set cache with TTL (time to live in seconds)\n  async set(key: string, value: any, ttl: number = 3600): Promise<void> {\n    try {\n      const stringValue = JSON.stringify(value);\n      await redisClient.setEx(key, ttl, stringValue);\n    } catch (error) {\n      console.error('Redis SET error:', error);\n    }\n  }\n\n  // Get cache\n  async get(key: string): Promise<any> {\n    try {\n      const value = await redisClient.get(key);\n      return value ? JSON.parse(value) : null;\n    } catch (error) {\n      console.error('Redis GET error:', error);\n      return null;\n    }\n  }\n\n  // Delete cache\n  async del(key: string): Promise<void> {\n    try {\n      await redisClient.del(key);\n    } catch (error) {\n      console.error('Redis DEL error:', error);\n    }\n  }\n\n  // Delete multiple keys by pattern\n  async delPattern(pattern: string): Promise<void> {\n    try {\n      const keys = await redisClient.keys(pattern);\n      if (keys.length > 0) {\n        await redisClient.del(keys);\n      }\n    } catch (error) {\n      console.error('Redis DEL pattern error:', error);\n    }\n  }\n\n  // Check if key exists\n  async exists(key: string): Promise<boolean> {\n    try {\n      const result = await redisClient.exists(key);\n      return result === 1;\n    } catch (error) {\n      console.error('Redis EXISTS error:', error);\n      return false;\n    }\n  }\n\n  // Set TTL for existing key\n  async expire(key: string, ttl: number): Promise<void> {\n    try {\n      await redisClient.expire(key, ttl);\n    } catch (error) {\n      console.error('Redis EXPIRE error:', error);\n    }\n  }\n\n  // Get all keys matching pattern\n  async keys(pattern: string): Promise<string[]> {\n    try {\n      return await redisClient.keys(pattern);\n    } catch (error) {\n      console.error('Redis KEYS error:', error);\n      return [];\n    }\n  }\n\n  // Flush all cache\n  async flushAll(): Promise<void> {\n    try {\n      await redisClient.flushAll();\n    } catch (error) {\n      console.error('Redis FLUSHALL error:', error);\n    }\n  }\n}\n\nexport { redisClient };\nexport default RedisCache.getInstance();","size_bytes":3062},"test-email.js":{"content":"import dotenv from 'dotenv';\nimport sgMail from '@sendgrid/mail';\n\ndotenv.config();\n\nconst apiKey = process.env.SENDGRID_ASK_EDITH_1_API_KEY || process.env.SENDGRID_API_KEY;\n\nconsole.log('Testing SendGrid email...');\nconsole.log('API Key found:', !!apiKey);\nconsole.log('API Key length:', apiKey ? apiKey.length : 0);\nconsole.log('API Key prefix:', apiKey ? apiKey.substring(0, 7) : 'N/A');\n\nif (!apiKey) {\n  console.error('No SendGrid API key found!');\n  process.exit(1);\n}\n\nsgMail.setApiKey(apiKey);\n\nconst msg = {\n  to: 'elias@askedith.org',\n  from: 'elias@askedith.org',\n  subject: 'Test Email from AskEdith',\n  text: 'This is a test email to verify SendGrid is working.',\n  html: '<p>This is a test email to verify SendGrid is working.</p>',\n};\n\nconsole.log('Sending test email to:', msg.to);\n\nsgMail\n  .send(msg)\n  .then(() => {\n    console.log('Email sent successfully!');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('SendGrid error:', error);\n    if (error.response) {\n      console.error('Response body:', JSON.stringify(error.response.body, null, 2));\n    }\n    process.exit(1);\n  });","size_bytes":1116},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/pages/VerifySuccess.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { CheckCircle } from \"lucide-react\";\n\nexport default function VerifySuccess() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"text-center\">\n          <div className=\"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4\">\n            <CheckCircle className=\"h-8 w-8 text-green-600\" />\n          </div>\n          <CardTitle>Email Verified!</CardTitle>\n          <CardDescription className=\"mt-2\">\n            Your email has been successfully verified. You now have full access to all features.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-sm text-gray-600 text-center\">\n            Thank you for verifying your email. You can now participate fully in our community, \n            book consultations with experts, and access all platform features.\n          </p>\n          <Link href=\"/community\">\n            <Button className=\"w-full\">Go to Community</Button>\n          </Link>\n          <Link href=\"/dashboard\">\n            <Button variant=\"outline\" className=\"w-full\">View Dashboard</Button>\n          </Link>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":1478},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Paragraph fade-in styles */\n.paragraph-fade-in {\n  opacity: 0;\n  transition: opacity 2000ms ease-in-out;\n}\n\n.paragraph-fade-in.visible {\n  opacity: 1;\n}\n\n:root {\n  --background: 0 0% 100%;\n  --foreground: 220 14.3% 4.1%;\n  --muted: 220 14.3% 95.9%;\n  --muted-foreground: 220 8.9% 46.1%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 220 14.3% 4.1%;\n  --card: 0 0% 100%;\n  --card-foreground: 220 14.3% 4.1%;\n  --border: 220 13% 91%;\n  --input: 220 13% 91%;\n  --primary: 262 83% 58%;\n  --primary-foreground: 210 20% 98%;\n  --secondary: 220 14.3% 95.9%;\n  --secondary-foreground: 220 9% 09%;\n  --accent: 220 14.3% 95.9%;\n  --accent-foreground: 220 9% 09%;\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 60 9.1% 97.8%;\n  --ring: 262 83% 58%;\n  --radius: 0.5rem;\n\n  /* AskEdith Community Color System - Updated from brand image */\n  --teal-primary: 186 84% 21%;\n  /* #0B666B - updated hex color */\n  --teal-secondary: 186 84% 18%;\n  /* darker variant of #0B666B */\n  --gold-primary: 44 85% 70%;\n  /* #E6B85C - warm gold from image */\n  --gold-secondary: 44 75% 60%;\n  /* slightly darker gold */\n  --coral-primary: 15 75% 45%;\n  /* #B85C42 - much darker coral for better contrast */\n  --coral-secondary: 15 65% 35%;\n  /* even darker coral variant */\n  --sage-primary: 140 25% 55%;\n  /* #7A9B7A - sage green from plants */\n  --cream-primary: 45 40% 92%;\n  /* #F4F1E8 - warm cream background */\n\n  /* Category Colors */\n  --rose-400: 351 81% 71%;\n  --rose-500: 350 89% 60%;\n  --rose-50: 355 100% 97%;\n  --blue-400: 213 94% 68%;\n  --blue-500: 217 91% 60%;\n  --blue-50: 214 100% 97%;\n  --emerald-400: 158 64% 52%;\n  --emerald-500: 160 84% 39%;\n  --emerald-50: 152 81% 96%;\n  --lime-400: 81 86% 67%;\n  --lime-500: 84 81% 44%;\n  --lime-50: 84 100% 97%;\n  --cyan-400: 187 85% 53%;\n  --cyan-500: 188 94% 43%;\n  --cyan-50: 185 100% 97%;\n  --teal-400: 172 76% 50%;\n  --teal-500: 173 80% 40%;\n  --teal-50: 166 76% 97%;\n  --indigo-400: 238 71% 67%;\n  --indigo-500: 239 84% 67%;\n  --indigo-50: 238 100% 97%;\n}\n\n/* EmbedSocial iframe container styling */\n.embed-container {\n  width: 100%;\n  height: 100%;\n}\n\n.embed-container iframe {\n  width: 100% !important;\n  height: 100% !important;\n  border: none;\n}\n\n/* Custom scrolling behavior for ThisWeekBy accordion */\n.embed-scroll-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  scroll-behavior: smooth;\n}\n\n/* Ensure embed social content doesn't overflow */\n.embedsocial-hashtag,\n.embedsocial-album {\n  max-width: 100% !important;\n  overflow: hidden !important;\n}\n\n.dark {\n  --background: 220 14.3% 4.1%;\n  --foreground: 60 9.1% 97.8%;\n  --muted: 220 14.3% 15.9%;\n  --muted-foreground: 220 8.9% 64.9%;\n  --popover: 220 14.3% 4.1%;\n  --popover-foreground: 60 9.1% 97.8%;\n  --card: 220 14.3% 4.1%;\n  --card-foreground: 60 9.1% 97.8%;\n  --border: 220 14.3% 15.9%;\n  --input: 220 14.3% 15.9%;\n  --primary: 262 83% 58%;\n  --primary-foreground: 210 20% 98%;\n  --secondary: 220 14.3% 15.9%;\n  --secondary-foreground: 60 9.1% 97.8%;\n  --accent: 220 14.3% 15.9%;\n  --accent-foreground: 60 9.1% 97.8%;\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 60 9.1% 97.8%;\n  --ring: 262 83% 58%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n@layer utilities {\n\n  /* Brand-aligned gradients using AskEdith color palette */\n  .gradient-teal {\n    background: linear-gradient(135deg, hsl(var(--teal-primary)), hsl(var(--teal-secondary)));\n  }\n\n  .gradient-gold {\n    background: linear-gradient(135deg, hsl(var(--gold-primary)), hsl(var(--gold-secondary)));\n  }\n\n  .gradient-coral {\n    background: linear-gradient(135deg, hsl(var(--coral-primary)), hsl(var(--coral-secondary)));\n  }\n\n  .gradient-sage {\n    background: linear-gradient(135deg, hsl(var(--sage-primary)), hsl(var(--sage-primary)));\n  }\n\n  /* Category-specific gradients with brand colors */\n  .gradient-senior {\n    background: linear-gradient(135deg, hsl(var(--coral-primary)), hsl(var(--coral-secondary)));\n  }\n\n  .gradient-home {\n    background: linear-gradient(135deg, hsl(var(--teal-primary)), hsl(var(--teal-secondary)));\n  }\n\n  .gradient-government {\n    background: linear-gradient(135deg, hsl(var(--sage-primary)), hsl(var(--emerald-500)));\n  }\n\n  .gradient-attorneys {\n    background: linear-gradient(135deg, hsl(var(--gold-primary)), hsl(var(--gold-secondary)));\n  }\n\n  .gradient-professionals {\n    background: linear-gradient(135deg, hsl(var(--teal-secondary)), hsl(var(--indigo-500)));\n  }\n\n  .gradient-va {\n    background: linear-gradient(135deg, hsl(var(--teal-primary)), hsl(var(--teal-secondary)));\n  }\n\n  .gradient-therapy {\n    background: linear-gradient(135deg, hsl(var(--coral-primary)), hsl(var(--cyan-500)));\n  }\n\n  .gradient-paying {\n    background: linear-gradient(135deg, #487d7a, #5a9891);\n  }\n\n  .bg-senior {\n    background-color: hsl(var(--rose-50));\n  }\n\n  .bg-home {\n    background-color: hsl(var(--blue-50));\n  }\n\n  .bg-government {\n    background-color: hsl(var(--emerald-50));\n  }\n\n  .bg-attorneys {\n    background-color: hsl(var(--amber-50));\n  }\n\n  .bg-professionals {\n    background-color: hsl(var(--indigo-50));\n  }\n\n  .bg-va {\n    background-color: hsl(var(--teal-50));\n  }\n\n  .bg-therapy {\n    background-color: hsl(var(--cyan-50));\n  }\n\n  .bg-paying {\n    background-color: #487d7a20;\n  }\n\n  .card-hover {\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .card-hover:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  }\n\n  .achievement-badge {\n    animation: fadeInUp 0.6s ease-out;\n  }\n\n  @keyframes fadeInUp {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n}\n\n/* Professional Social Media Card Styling */\n/* Juicer.io Feed Styling */\n.juicer-feed .feed-item,\n.juicer-feed li,\nul[class*=\"juicer\"] li,\ndiv[class*=\"juicer-feed\"] > div {\n  background: white !important;\n  border: 1px solid #e5e7eb !important;\n  border-radius: 12px !important;\n  padding: 20px !important;\n  margin-bottom: 16px !important;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;\n}\n\n.juicer-feed .feed-item:hover,\n.juicer-feed li:hover,\nul[class*=\"juicer\"] li:hover {\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;\n  transform: translateY(-2px) !important;\n  border-color: #d1d5db !important;\n}\n\n/* Profile Section Styling */\n.juicer-feed .j-poster,\n.juicer-feed .poster,\ndiv[class*=\"poster\"],\ndiv[class*=\"author\"] {\n  display: flex !important;\n  align-items: center !important;\n  margin-bottom: 16px !important;\n  gap: 12px !important;\n}\n\n.juicer-feed .j-poster img,\n.juicer-feed .poster img,\ndiv[class*=\"poster\"] img,\ndiv[class*=\"author\"] img {\n  width: 48px !important;\n  height: 48px !important;\n  border-radius: 50% !important;\n  object-fit: cover !important;\n  border: 2px solid #f3f4f6 !important;\n}\n\n/* Author Name Styling */\n.juicer-feed .j-poster a,\n.juicer-feed .poster a,\ndiv[class*=\"poster\"] a,\ndiv[class*=\"author\"] a,\ndiv[class*=\"poster-name\"],\ndiv[class*=\"author-name\"] {\n  font-weight: 600 !important;\n  font-size: 15px !important;\n  color: #111827 !important;\n  text-decoration: none !important;\n  line-height: 1.4 !important;\n}\n\n.juicer-feed .j-poster a:hover,\ndiv[class*=\"poster\"] a:hover,\ndiv[class*=\"author\"] a:hover {\n  color: #0B666B !important;\n}\n\n/* Timestamp Styling */\n.juicer-feed .j-date,\n.juicer-feed .date,\ndiv[class*=\"date\"],\ndiv[class*=\"timestamp\"],\ntime {\n  font-size: 13px !important;\n  color: #6b7280 !important;\n  font-weight: 400 !important;\n}\n\n/* Post Content Styling */\n.juicer-feed .j-text,\n.juicer-feed .text-wrapper,\ndiv[class*=\"post-text\"],\ndiv[class*=\"message\"],\ndiv[class*=\"content-text\"] {\n  font-size: 15px !important;\n  line-height: 1.6 !important;\n  color: #374151 !important;\n  margin: 16px 0 !important;\n  word-wrap: break-word !important;\n}\n\n.juicer-feed .j-text p,\ndiv[class*=\"post-text\"] p {\n  margin-bottom: 12px !important;\n}\n\n/* Hashtag Styling */\n.juicer-feed a[href*=\"hashtag\"],\na[class*=\"hashtag\"],\nspan[class*=\"hashtag\"] {\n  color: #0B666B !important;\n  font-weight: 500 !important;\n  text-decoration: none !important;\n  transition: color 0.2s ease !important;\n}\n\n.juicer-feed a[href*=\"hashtag\"]:hover {\n  color: #094d51 !important;\n  text-decoration: underline !important;\n}\n\n/* Image/Media Styling */\n.juicer-feed .j-image,\n.juicer-feed img:not(.poster img):not(.j-poster img),\ndiv[class*=\"post-image\"],\ndiv[class*=\"media\"] img {\n  border-radius: 8px !important;\n  margin: 16px 0 !important;\n  max-width: 100% !important;\n  height: auto !important;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important;\n}\n\n/* Video Styling */\n.juicer-feed video,\n.juicer-feed iframe {\n  border-radius: 8px !important;\n  margin: 16px 0 !important;\n  max-width: 100% !important;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important;\n}\n\n/* Action Buttons/Links */\n.juicer-feed .j-meta,\ndiv[class*=\"meta\"],\ndiv[class*=\"actions\"] {\n  margin-top: 12px !important;\n  padding-top: 12px !important;\n  border-top: 1px solid #f3f4f6 !important;\n  display: flex !important;\n  gap: 16px !important;\n  font-size: 13px !important;\n  color: #6b7280 !important;\n}\n\n/* RSS.app Feed Styling */\nrssapp-wall,\n.rssapp-wall,\ndiv[class*=\"rssapp\"] {\n  width: 100% !important;\n}\n\nrssapp-wall .rssapp-item,\n.rssapp-wall .rssapp-item,\ndiv[class*=\"rssapp\"] article,\ndiv[class*=\"rssapp\"] .item {\n  background: white !important;\n  border: 1px solid #e5e7eb !important;\n  border-radius: 12px !important;\n  padding: 20px !important;\n  margin-bottom: 16px !important;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important;\n  transition: all 0.3s ease !important;\n}\n\nrssapp-wall .rssapp-item:hover,\ndiv[class*=\"rssapp\"] article:hover {\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;\n  transform: translateY(-2px) !important;\n}\n\n/* Walls.io Feed Styling */\n.walls-io-container,\n#walls-io-embed {\n  width: 100% !important;\n}\n\n/* LinkedIn-specific Styling */\ndiv[class*=\"linkedin\"] .feed-item,\ndiv[data-source*=\"linkedin\"] {\n  border-left: 3px solid #0077b5 !important;\n}\n\n/* Twitter/X-specific Styling */\ndiv[class*=\"twitter\"] .feed-item,\ndiv[data-source*=\"twitter\"],\ndiv[class*=\"tweet\"] {\n  border-left: 3px solid #1DA1F2 !important;\n}\n\n/* General Social Media Card Improvements */\n.social-media-card {\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  padding: 20px;\n  margin-bottom: 16px;\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.social-media-card:hover {\n  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  transform: translateY(-2px);\n  border-color: #d1d5db;\n}\n\n/* Responsive Typography */\n@media (max-width: 768px) {\n  .juicer-feed .j-text,\n  div[class*=\"post-text\"] {\n    font-size: 14px !important;\n  }\n  \n  .juicer-feed .j-poster img,\n  div[class*=\"poster\"] img {\n    width: 40px !important;\n    height: 40px !important;\n  }\n}\n\n/* Loading State */\n.juicer-feed.loading,\n.rssapp-loading {\n  min-height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #9ca3af;\n}\n\n/* Remove default Juicer branding if present */\n.juicer-feed .j-branding,\n.juicer-feed [class*=\"powered-by\"],\ndiv[class*=\"juicer-credit\"] {\n  display: none !important;\n}\n\n/* Iframe Container Styling */\n.iframe-container iframe {\n  width: 100% !important;\n  max-width: 100% !important;\n  border: none !important;\n  display: block !important;\n}","size_bytes":11808},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"server/services/stripeService.ts":{"content":"import Stripe from \"stripe\";\nimport { storage } from \"../storage\";\nimport type { ExpertVerification, Appointment } from \"@shared/schema\";\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  throw new Error(\"STRIPE_SECRET_KEY environment variable is required\");\n}\n\nconst stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2024-12-18.acacia\",\n});\n\nexport interface CreateConnectAccountResult {\n  accountId: string;\n  accountLink?: string;\n  requiresAction: boolean;\n}\n\nexport interface PaymentIntentResult {\n  clientSecret: string;\n  paymentIntentId: string;\n  applicationFeeAmount: number;\n}\n\nexport interface PayoutInfo {\n  totalEarnings: number;\n  pendingPayouts: number;\n  availableBalance: number;\n  lastPayoutDate?: Date;\n}\n\nexport class StripeService {\n  private stripe: Stripe;\n\n  constructor() {\n    this.stripe = stripe;\n  }\n\n  /**\n   * Create Stripe Connect Express account for expert\n   */\n  async createConnectAccount(\n    expertId: string,\n    email: string,\n    refreshUrl?: string,\n    returnUrl?: string,\n  ): Promise<CreateConnectAccountResult> {\n    try {\n      // Check if expert already has a Connect account\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert) {\n        throw new Error(\"Expert verification not found\");\n      }\n\n      if (expert.stripeConnectAccountId) {\n        // Return existing account\n        return {\n          accountId: expert.stripeConnectAccountId,\n          requiresAction: false,\n        };\n      }\n\n      // Create new Express account\n      const account = await this.stripe.accounts.create({\n        type: \"express\",\n        country: \"US\",\n        email,\n        capabilities: {\n          card_payments: { requested: true },\n          transfers: { requested: true },\n        },\n        business_type: \"individual\", // Most experts will be individuals\n        metadata: {\n          expertId,\n          platform: \"CaregiversCommunity\",\n        },\n      });\n\n      // Update expert with Connect account ID\n      await storage.updateExpertVerification(expert.id, {\n        stripeConnectAccountId: account.id,\n      });\n\n      // Create account link for onboarding\n      const accountLink = await this.stripe.accountLinks.create({\n        account: account.id,\n        refresh_url:\n          refreshUrl || `${process.env.CLIENT_URL}/expert/stripe/refresh`,\n        return_url:\n          returnUrl || `${process.env.CLIENT_URL}/expert/stripe/success`,\n        type: \"account_onboarding\",\n      });\n\n      return {\n        accountId: account.id,\n        accountLink: accountLink.url,\n        requiresAction: true,\n      };\n    } catch (error) {\n      console.error(\"Error creating Connect account:\", error);\n      throw new Error(\"Failed to create Stripe Connect account\");\n    }\n  }\n\n  /**\n   * Get Connect account status and requirements\n   */\n  async getConnectAccountStatus(accountId: string): Promise<{\n    detailsSubmitted: boolean;\n    chargesEnabled: boolean;\n    payoutsEnabled: boolean;\n    requirements: string[];\n  }> {\n    try {\n      const account = await this.stripe.accounts.retrieve(accountId);\n\n      return {\n        detailsSubmitted: account.details_submitted || false,\n        chargesEnabled: account.charges_enabled || false,\n        payoutsEnabled: account.payouts_enabled || false,\n        requirements: account.requirements?.currently_due || [],\n      };\n    } catch (error) {\n      console.error(\"Error getting Connect account status:\", error);\n      throw new Error(\"Failed to get account status\");\n    }\n  }\n\n  /**\n   * Create payment intent for consultation booking with automatic fee splitting\n   */\n  async createConsultationPaymentIntent(consultation: {\n    expertId: string;\n    totalAmount: number; // in cents\n    duration: number;\n    clientId: string;\n  }): Promise<PaymentIntentResult> {\n    try {\n      // Get expert's Connect account\n      const expert = await storage.getExpertVerification(consultation.expertId);\n      if (!expert || !expert.stripeConnectAccountId) {\n        throw new Error(\"Expert must set up payment processing first\");\n      }\n\n      // Calculate platform fee (15%)\n      const platformFeeAmount = Math.round(consultation.totalAmount * 0.15);\n\n      // Create payment intent with Connect account\n      const paymentIntent = await this.stripe.paymentIntents.create({\n        amount: consultation.totalAmount,\n        currency: \"usd\",\n        application_fee_amount: platformFeeAmount,\n        transfer_data: {\n          destination: expert.stripeConnectAccountId,\n        },\n        metadata: {\n          type: \"consultation_booking\",\n          expertId: consultation.expertId,\n          clientId: consultation.clientId,\n          duration: consultation.duration.toString(),\n        },\n        automatic_payment_methods: {\n          enabled: true,\n        },\n      });\n\n      return {\n        clientSecret: paymentIntent.client_secret!,\n        paymentIntentId: paymentIntent.id,\n        applicationFeeAmount: platformFeeAmount,\n      };\n    } catch (error) {\n      console.error(\"Error creating consultation payment intent:\", error);\n      throw new Error(\"Failed to create payment intent\");\n    }\n  }\n\n  /**\n   * Create payment intent for appointment booking with automatic fee splitting\n   */\n  async createAppointmentPaymentIntent(appointment: {\n    expertId: string;\n    totalAmount: number; // in cents\n    duration: number;\n    clientEmail: string;\n    appointmentId?: number;\n  }): Promise<PaymentIntentResult> {\n    try {\n      // Get expert's Connect account\n      const expert = await storage.getExpertVerification(appointment.expertId);\n      if (!expert || !expert.stripeConnectAccountId) {\n        throw new Error(\"Expert must set up payment processing first\");\n      }\n\n      // Calculate platform fee (10%)\n      const platformFeeAmount = Math.round(appointment.totalAmount * 0.1);\n\n      // Create payment intent with Connect account\n      const paymentIntent = await this.stripe.paymentIntents.create({\n        amount: appointment.totalAmount,\n        currency: \"usd\",\n        application_fee_amount: platformFeeAmount,\n        transfer_data: {\n          destination: expert.stripeConnectAccountId,\n        },\n        metadata: {\n          type: \"appointment_booking\",\n          expertId: appointment.expertId,\n          clientEmail: appointment.clientEmail,\n          duration: appointment.duration.toString(),\n          appointmentId: appointment.appointmentId?.toString() || \"pending\",\n        },\n        automatic_payment_methods: {\n          enabled: true,\n        },\n      });\n\n      return {\n        clientSecret: paymentIntent.client_secret!,\n        paymentIntentId: paymentIntent.id,\n        applicationFeeAmount: platformFeeAmount,\n      };\n    } catch (error) {\n      console.error(\"Error creating appointment payment intent:\", error);\n      throw new Error(\"Failed to create payment intent\");\n    }\n  }\n\n  /**\n   * Process refund for cancelled appointment\n   */\n  async refundAppointment(\n    paymentIntentId: string,\n    refundAmount?: number,\n    reason?: string,\n  ): Promise<Stripe.Refund> {\n    try {\n      const refund = await this.stripe.refunds.create({\n        payment_intent: paymentIntentId,\n        amount: refundAmount, // If not specified, refunds full amount\n        reason:\n          (reason as Stripe.RefundCreateParams.Reason) ||\n          \"requested_by_customer\",\n        refund_application_fee: true, // Also refund platform fee\n        reverse_transfer: true, // Reverse the transfer to expert\n      });\n\n      return refund;\n    } catch (error) {\n      console.error(\"Error processing refund:\", error);\n      throw new Error(\"Failed to process refund\");\n    }\n  }\n\n  /**\n   * Get expert's earnings and payout information\n   */\n  async getExpertPayoutInfo(expertId: string): Promise<PayoutInfo> {\n    try {\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || !expert.stripeConnectAccountId) {\n        throw new Error(\"Expert does not have payment processing set up\");\n      }\n\n      // Get account balance\n      const balance = await this.stripe.balance.retrieve({\n        stripeAccount: expert.stripeConnectAccountId,\n      });\n\n      // Get recent payouts\n      const payouts = await this.stripe.payouts.list(\n        { limit: 1 },\n        { stripeAccount: expert.stripeConnectAccountId },\n      );\n\n      // Calculate totals\n      const availableBalance = balance.available.reduce(\n        (sum, bal) => sum + bal.amount,\n        0,\n      );\n      const pendingPayouts = balance.pending.reduce(\n        (sum, bal) => sum + bal.amount,\n        0,\n      );\n\n      // Get total earnings from completed appointments\n      const appointments = await storage.getExpertAppointments(expertId);\n      const completedAppointments = appointments.filter(\n        (apt) => apt.status === \"completed\",\n      );\n      const totalEarnings = completedAppointments.reduce(\n        (sum, apt) => sum + apt.expertEarnings,\n        0,\n      );\n\n      return {\n        totalEarnings,\n        pendingPayouts,\n        availableBalance,\n        lastPayoutDate: payouts.data[0]?.arrival_date\n          ? new Date(payouts.data[0].arrival_date * 1000)\n          : undefined,\n      };\n    } catch (error) {\n      console.error(\"Error getting expert payout info:\", error);\n      throw new Error(\"Failed to get payout information\");\n    }\n  }\n\n  /**\n   * Create instant payout for expert\n   */\n  async createInstantPayout(\n    expertId: string,\n    amount: number, // in cents\n  ): Promise<Stripe.Payout> {\n    try {\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || !expert.stripeConnectAccountId) {\n        throw new Error(\"Expert does not have payment processing set up\");\n      }\n\n      const payout = await this.stripe.payouts.create(\n        {\n          amount,\n          currency: \"usd\",\n          method: \"instant\",\n        },\n        { stripeAccount: expert.stripeConnectAccountId },\n      );\n\n      return payout;\n    } catch (error) {\n      console.error(\"Error creating instant payout:\", error);\n      throw new Error(\"Failed to create instant payout\");\n    }\n  }\n\n  /**\n   * Handle Stripe webhook events\n   */\n  async handleWebhookEvent(event: Stripe.Event): Promise<void> {\n    try {\n      switch (event.type) {\n        case \"payment_intent.succeeded\":\n          await this.handlePaymentSucceeded(\n            event.data.object as Stripe.PaymentIntent,\n          );\n          break;\n\n        case \"payment_intent.payment_failed\":\n          await this.handlePaymentFailed(\n            event.data.object as Stripe.PaymentIntent,\n          );\n          break;\n\n        case \"account.updated\":\n          await this.handleAccountUpdated(event.data.object as Stripe.Account);\n          break;\n\n        case \"transfer.created\":\n          await this.handleTransferCreated(\n            event.data.object as Stripe.Transfer,\n          );\n          break;\n\n        default:\n          console.log(`Unhandled event type: ${event.type}`);\n      }\n    } catch (error) {\n      console.error(\"Error handling webhook event:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Handle successful payment\n   */\n  private async handlePaymentSucceeded(\n    paymentIntent: Stripe.PaymentIntent,\n  ): Promise<void> {\n    const appointmentId = paymentIntent.metadata.appointmentId;\n\n    if (appointmentId && appointmentId !== \"pending\") {\n      // Update appointment status to confirmed\n      await storage.updateAppointmentStatus(\n        parseInt(appointmentId),\n        \"confirmed\",\n      );\n\n      // TODO: Send confirmation emails/notifications\n      console.log(`Payment succeeded for appointment ${appointmentId}`);\n    }\n  }\n\n  /**\n   * Handle failed payment\n   */\n  private async handlePaymentFailed(\n    paymentIntent: Stripe.PaymentIntent,\n  ): Promise<void> {\n    const appointmentId = paymentIntent.metadata.appointmentId;\n\n    if (appointmentId && appointmentId !== \"pending\") {\n      // Update appointment status to cancelled\n      await storage.updateAppointmentStatus(\n        parseInt(appointmentId),\n        \"cancelled\",\n      );\n\n      // TODO: Send failure notifications\n      console.log(`Payment failed for appointment ${appointmentId}`);\n    }\n  }\n\n  /**\n   * Handle Connect account updates\n   */\n  private async handleAccountUpdated(account: Stripe.Account): Promise<void> {\n    // Find expert by Connect account ID\n    const expertId = account.metadata?.expertId;\n\n    if (expertId) {\n      // Update expert verification status based on account capabilities\n      const expert = await storage.getExpertVerification(expertId);\n      if (expert) {\n        const canAcceptPayments =\n          account.charges_enabled && account.payouts_enabled;\n\n        // You might want to update expert status or send notifications\n        console.log(\n          `Connect account ${account.id} updated. Can accept payments: ${canAcceptPayments}`,\n        );\n      }\n    }\n  }\n\n  /**\n   * Handle transfer creation (when money is sent to expert)\n   */\n  private async handleTransferCreated(\n    transfer: Stripe.Transfer,\n  ): Promise<void> {\n    console.log(\n      `Transfer created: ${transfer.id} for ${transfer.amount} cents`,\n    );\n    // TODO: Update expert earnings tracking, send notifications\n  }\n\n  /**\n   * Get Connect account dashboard link\n   */\n  async getConnectDashboardLink(expertId: string): Promise<string> {\n    try {\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || !expert.stripeConnectAccountId) {\n        throw new Error(\"Expert does not have payment processing set up\");\n      }\n\n      const loginLink = await this.stripe.accounts.createLoginLink(\n        expert.stripeConnectAccountId,\n      );\n      return loginLink.url;\n    } catch (error) {\n      console.error(\"Error creating dashboard link:\", error);\n      throw new Error(\"Failed to create dashboard link\");\n    }\n  }\n\n  /**\n   * Verify webhook signature\n   */\n  verifyWebhookSignature(\n    payload: string | Buffer,\n    signature: string,\n  ): Stripe.Event {\n    const endpointSecret = process.env.STRIPE_WEBHOOK_SECRET;\n    if (!endpointSecret) {\n      throw new Error(\"STRIPE_WEBHOOK_SECRET environment variable is required\");\n    }\n\n    try {\n      return this.stripe.webhooks.constructEvent(\n        payload,\n        signature,\n        endpointSecret,\n      );\n    } catch (error) {\n      console.error(\"Webhook signature verification failed:\", error);\n      throw new Error(\"Invalid webhook signature\");\n    }\n  }\n}\n\nexport const stripeService = new StripeService();\n","size_bytes":14537},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/pages/BookConsultation.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Calendar, Clock, DollarSign, CreditCard, User, Mail, MessageSquare, CheckCircle } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport DefaultProfilePicture from \"@/components/DefaultProfilePicture\";\n\n// Only initialize Stripe if the public key is available\nconst stripePromise = import.meta.env.VITE_STRIPE_PUBLIC_KEY \n  ? loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY)\n  : null;\n\nconst bookingSchema = z.object({\n  scheduledAt: z.string().min(1, \"Please select a date and time\"),\n  duration: z.number().min(30, \"Minimum duration is 30 minutes\").max(120, \"Maximum duration is 2 hours\"),\n  notes: z.string().optional(),\n  clientEmail: z.string().email(\"Please enter a valid email address\"),\n  clientName: z.string().min(2, \"Please enter your full name\"),\n});\n\ntype BookingForm = z.infer<typeof bookingSchema>;\n\nconst ConsultationPaymentForm = ({ \n  bookingData, \n  totalAmount, \n  onPaymentSuccess \n}: { \n  bookingData: BookingForm & { expertId: string };\n  totalAmount: number;\n  onPaymentSuccess: () => void;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n\n    const { error } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: window.location.origin + \"/consultation/success\",\n      },\n      redirect: \"if_required\",\n    });\n\n    if (error) {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } else {\n      toast({\n        title: \"Payment Successful\",\n        description: \"Your consultation has been booked successfully!\",\n      });\n      onPaymentSuccess();\n    }\n\n    setIsProcessing(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <DollarSign className=\"h-5 w-5 text-teal-600\" />\n          <h3 className=\"font-semibold text-teal-800\">Consultation Fee</h3>\n        </div>\n        <p className=\"text-teal-700 text-sm mb-3\">\n          {bookingData.duration} minute consultation session\n        </p>\n        <div className=\"text-2xl font-bold text-teal-800\">\n          ${(totalAmount / 100).toFixed(2)}\n        </div>\n      </div>\n\n      <PaymentElement />\n      \n      <Button \n        type=\"submit\" \n        disabled={!stripe || isProcessing} \n        className=\"w-full\"\n        size=\"lg\"\n      >\n        {isProcessing ? (\n          <>\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n            Processing Payment...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-4 h-4 mr-2\" />\n            Book Consultation - ${(totalAmount / 100).toFixed(2)}\n          </>\n        )}\n      </Button>\n    </form>\n  );\n};\n\nexport default function BookConsultation() {\n  const { expertId } = useParams();\n  \n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'booking' | 'success'>('booking');\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [selectedDate, setSelectedDate] = useState(\"\");\n  const [selectedTime, setSelectedTime] = useState(\"\");\n\n  // Fetch expert details\n  const { data: expert, isLoading: expertLoading } = useQuery({\n    queryKey: [`/api/experts/${expertId}`],\n    enabled: !!expertId,\n  }) as { data: any, isLoading: boolean, error?: any };\n\n  const form = useForm<BookingForm>({\n    resolver: zodResolver(bookingSchema),\n    defaultValues: {\n      duration: 60,\n      notes: \"\",\n      clientEmail: user?.email || \"\",\n      clientName: user ? `${user.firstName} ${user.lastName}` : \"\",\n    },\n  });\n\n  // Initialize payment intent when form loads\n  useEffect(() => {\n    if (expert?.consultationRate) {\n      const initializePayment = async () => {\n        try {\n          const totalAmount = Math.round((expert.consultationRate * 60) / 60 * 100); // Default 60 minutes\n          const response = await apiRequest(\"POST\", \"/api/consultations/create-payment\", { \n            expertId: expertId!,\n            totalAmount \n          });\n          setClientSecret(response.clientSecret);\n        } catch (error) {\n          console.error(\"Failed to initialize payment:\", error);\n        }\n      };\n      initializePayment();\n    }\n  }, [expert?.consultationRate, expertId]);\n\n  const bookConsultationMutation = useMutation({\n    mutationFn: async (data: BookingForm & { expertId: string }) => {\n      const scheduledAt = `${selectedDate}T${selectedTime}:00`;\n      const totalAmount = Math.round((expert.consultationRate * data.duration) / 60 * 100);\n      \n      return await apiRequest(\"POST\", \"/api/consultations/book\", { \n        ...data,\n        scheduledAt,\n        totalAmount \n      });\n    },\n    onSuccess: () => {\n      setStep('success');\n      toast({\n        title: \"Success!\",\n        description: \"Your consultation has been booked successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Booking Failed\",\n        description: error.message || \"Failed to book consultation. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onBookingSubmit = async (data: BookingForm) => {\n    if (!selectedDate || !selectedTime) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please select a date and time for your consultation.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!clientSecret) {\n      toast({\n        title: \"Payment Not Ready\",\n        description: \"Payment system is initializing. Please wait a moment and try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Form will be handled by the Stripe Elements wrapper\n    // The actual submission happens in the payment form after successful payment\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <User className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to book a consultation.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (expertLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  if (!expert) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <h2 className=\"text-2xl font-semibold mb-4\">Expert Not Found</h2>\n            <p className=\"text-gray-600 mb-6\">\n              The expert you're looking for doesn't exist or isn't available for consultations.\n            </p>\n            <Button onClick={() => window.history.back()}>\n              Go Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!expert.consultationEnabled) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <h2 className=\"text-2xl font-semibold mb-4\">Consultations Not Available</h2>\n            <p className=\"text-gray-600 mb-6\">\n              This expert is not currently accepting consultation bookings.\n            </p>\n            <Button onClick={() => window.history.back()}>\n              Go Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Consultation Booked Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Your consultation with {expert.firstName} {expert.lastName} has been confirmed. \n              You'll receive a confirmation email with meeting details shortly.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/'}>\n                Return to Home\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View My Bookings\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n\n  // Generate available time slots (simplified - real implementation would check expert's calendar)\n  const generateTimeSlots = () => {\n    const slots = [];\n    for (let hour = 9; hour <= 17; hour++) {\n      slots.push(`${hour.toString().padStart(2, '0')}:00`);\n      if (hour < 17) {\n        slots.push(`${hour.toString().padStart(2, '0')}:30`);\n      }\n    }\n    return slots;\n  };\n\n  const timeSlots = generateTimeSlots();\n  const hourlyRate = expert.consultationRate / 100; // Convert from cents\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        \n        {/* Expert Profile Header */}\n        <Card className=\"mb-8\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-6\">\n              <div className=\"w-24 h-24 rounded-full overflow-hidden bg-gray-200 flex-shrink-0\">\n                {expert.profileImageUrl ? (\n                  <img \n                    src={expert.profileImageUrl} \n                    alt={`${expert.firstName} ${expert.lastName}`}\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <DefaultProfilePicture size={96} />\n                )}\n              </div>\n              \n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <h1 className=\"text-2xl font-bold text-gray-900\">\n                    {expert.firstName} {expert.lastName}\n                  </h1>\n                  <Badge className=\"bg-green-100 text-green-800\">\n                    Verified Expert\n                  </Badge>\n                </div>\n                \n                <p className=\"text-lg text-gray-700 mb-2\">{expert.profession}</p>\n                <p className=\"text-gray-600 mb-4\">{expert.expertiseArea}</p>\n                \n                <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n                  <span className=\"flex items-center gap-1\">\n                    <Clock className=\"w-4 h-4\" />\n                    {expert.yearsExperience} years experience\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <DollarSign className=\"w-4 h-4\" />\n                    ${hourlyRate}/hour\n                  </span>\n                </div>\n              </div>\n            </div>\n            \n            {expert.bio && (\n              <div className=\"mt-6 pt-6 border-t\">\n                <p className=\"text-gray-700\">{expert.bio}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Booking Form */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Book a Consultation</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onBookingSubmit)} className=\"space-y-6\">\n                \n                {/* Date Selection */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Select Date & Time</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-2\">Date</label>\n                      <Input\n                        type=\"date\"\n                        value={selectedDate}\n                        onChange={(e) => setSelectedDate(e.target.value)}\n                        min={new Date().toISOString().split('T')[0]}\n                        className=\"w-full\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <label className=\"block text-sm font-medium mb-2\">Time</label>\n                      <select\n                        value={selectedTime}\n                        onChange={(e) => setSelectedTime(e.target.value)}\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500\"\n                      >\n                        <option value=\"\">Select a time</option>\n                        {timeSlots.map(time => (\n                          <option key={time} value={time}>{time}</option>\n                        ))}\n                      </select>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Duration Selection */}\n                <FormField\n                  control={form.control}\n                  name=\"duration\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Session Duration</FormLabel>\n                      <FormControl>\n                        <select\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value))}\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500\"\n                        >\n                          <option value={30}>30 minutes - ${(hourlyRate * 0.5).toFixed(2)}</option>\n                          <option value={60}>60 minutes - ${hourlyRate.toFixed(2)}</option>\n                          <option value={90}>90 minutes - ${(hourlyRate * 1.5).toFixed(2)}</option>\n                          <option value={120}>120 minutes - ${(hourlyRate * 2).toFixed(2)}</option>\n                        </select>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Contact Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Contact Information</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <FormField\n                      control={form.control}\n                      name=\"clientName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Full Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Your full name\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"clientEmail\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Email Address</FormLabel>\n                          <FormControl>\n                            <Input type=\"email\" placeholder=\"your.email@example.com\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Consultation Notes */}\n                <FormField\n                  control={form.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>What would you like to discuss? (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Brief description of what you'd like to cover in the consultation...\"\n                          className=\"min-h-[100px]\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormDescription>\n                        Help the expert prepare for your session by sharing key topics or questions\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Cost Summary */}\n                {form.watch('duration') && (\n                  <div className=\"bg-gray-50 rounded-lg p-4\">\n                    <h4 className=\"font-semibold mb-2\">Cost Summary</h4>\n                    <div className=\"flex justify-between items-center\">\n                      <span>{form.watch('duration')} minute consultation</span>\n                      <span className=\"font-bold\">\n                        ${((hourlyRate * form.watch('duration')) / 60).toFixed(2)}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                {/* Payment Section */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">Payment Information</h3>\n                  {!stripePromise ? (\n                    <div className=\"border rounded-lg p-4 bg-yellow-50 border-yellow-200\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <div className=\"w-4 h-4 bg-yellow-400 rounded-full\"></div>\n                        <p className=\"font-medium text-yellow-800\">Payment System Not Configured</p>\n                      </div>\n                      <p className=\"text-sm text-yellow-700\">\n                        Stripe payment processing is not configured in this development environment. \n                        Add the VITE_STRIPE_PUBLIC_KEY environment variable to enable payments.\n                      </p>\n                    </div>\n                  ) : clientSecret ? (\n                    <div className=\"border rounded-lg p-4\">\n                      <PaymentElement />\n                    </div>\n                  ) : (\n                    <div className=\"border rounded-lg p-4 bg-gray-50\">\n                      <p className=\"text-sm text-gray-600\">\n                        Initializing secure payment...\n                      </p>\n                      <div className=\"animate-pulse space-y-3 mt-3\">\n                        <div className=\"h-10 bg-gray-200 rounded\"></div>\n                        <div className=\"grid grid-cols-2 gap-3\">\n                          <div className=\"h-10 bg-gray-200 rounded\"></div>\n                          <div className=\"h-10 bg-gray-200 rounded\"></div>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  disabled={!selectedDate || !selectedTime || !stripePromise}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  <Calendar className=\"w-4 h-4 mr-2\" />\n                  {!stripePromise ? \"Payment System Required\" : \"Submit Consultation Request\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":21323},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"server/graphql/server.ts":{"content":"import { ApolloServer } from '@apollo/server';\nimport { expressMiddleware } from '@apollo/server/express4';\nimport { ApolloServerPluginDrainHttpServer } from '@apollo/server/plugin/drainHttpServer';\nimport { makeExecutableSchema } from '@graphql-tools/schema';\nimport { typeDefs } from './typeDefs';\nimport { resolvers } from './resolvers';\nimport { Server } from 'http';\nimport type { Express } from 'express';\n\n// Create GraphQL schema\nconst schema = makeExecutableSchema({\n  typeDefs,\n  resolvers,\n});\n\nexport async function createGraphQLServer(app: Express, httpServer: Server) {\n  // Create Apollo Server\n  const server = new ApolloServer({\n    schema,\n    plugins: [ApolloServerPluginDrainHttpServer({ httpServer })],\n    formatError: (error) => {\n      console.error('GraphQL Error:', error);\n      return {\n        message: error.message,\n        code: error.extensions?.code,\n        path: error.path,\n      };\n    },\n  });\n\n  // Start the server\n  await server.start();\n\n  // Apply the Apollo GraphQL middleware\n  app.use(\n    '/graphql',\n    expressMiddleware(server, {\n      context: async ({ req }) => {\n        // Extract user from session for authentication\n        const user = (req as any).user || null;\n        \n        return {\n          user,\n          req,\n        };\n      },\n    })\n  );\n\n  console.log('ðŸš€ GraphQL server ready at http://localhost:5000/graphql');\n  \n  return server;\n}","size_bytes":1409},"client/src/pages/TestStripe.tsx":{"content":"import { useState } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function TestStripe() {\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState<any>(null);\n  const { toast } = useToast();\n\n  const testStripePayment = async () => {\n    setLoading(true);\n    try {\n      const response = await apiRequest(\"POST\", \"/api/consultations/create-payment\", {\n        expertId: \"expert_002\",\n        duration: 60,\n        totalAmount: 15000, // $150.00\n      });\n      \n      setResult(response);\n      toast({\n        title: \"Success\",\n        description: \"Payment intent created successfully!\",\n      });\n    } catch (error: any) {\n      console.error(\"Test failed:\", error);\n      setResult({ error: error.message });\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-8\">\n      <div className=\"max-w-2xl mx-auto\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Test Stripe Integration</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <p className=\"text-sm text-gray-600 mb-4\">\n                Click the button below to test creating a Stripe payment intent.\n              </p>\n              <Button \n                onClick={testStripePayment} \n                disabled={loading}\n                size=\"lg\"\n              >\n                {loading ? \"Testing...\" : \"Test Payment Intent\"}\n              </Button>\n            </div>\n            \n            {result && (\n              <div className=\"mt-6 p-4 bg-gray-100 rounded-lg\">\n                <h3 className=\"font-semibold mb-2\">Result:</h3>\n                <pre className=\"text-xs overflow-auto\">\n                  {JSON.stringify(result, null, 2)}\n                </pre>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":2257},"client/src/pages/subscribe.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Elements, PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { ArrowLeft, Crown, Check, Star, Users, MessageCircle, Heart } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\n\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\n// Make sure to call `loadStripe` outside of a component's render to avoid\n// recreating the `Stripe` object on every render.\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst SubscribeForm = () => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n\n    const { error } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: `${window.location.origin}/?subscription=success`,\n      },\n    });\n\n    if (error) {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } else {\n      toast({\n        title: \"Welcome to Premium!\",\n        description: \"Your subscription has been activated. Enjoy exclusive benefits!\",\n      });\n    }\n\n    setIsProcessing(false);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-white rounded-xl p-6 border border-gray-200\">\n        <PaymentElement />\n      </div>\n      <Button \n        type=\"submit\"\n        disabled={!stripe || isProcessing}\n        className=\"w-full bg-teal-600 hover:bg-teal-700 text-white py-4 font-semibold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1\"\n      >\n        {isProcessing ? \"Processing...\" : \"Subscribe Now - $9.99/month\"}\n      </Button>\n      <p className=\"text-xs text-gray-500 text-center\">\n        Cancel anytime. No long-term commitments.\n      </p>\n    </form>\n  );\n};\n\nexport default function Subscribe() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      return;\n    }\n\n    // Create subscription as soon as the page loads\n    apiRequest(\"POST\", \"/api/get-or-create-subscription\")\n      .then((res) => res.json())\n      .then((data) => {\n        if (data.clientSecret) {\n          setClientSecret(data.clientSecret);\n        } else {\n          toast({\n            title: \"Error\",\n            description: \"Failed to initialize payment. Please try again.\",\n            variant: \"destructive\",\n          });\n        }\n      })\n      .catch((error) => {\n        console.error(\"Subscription error:\", error);\n        toast({\n          title: \"Error\",\n          description: \"Failed to create subscription. Please try again.\",\n          variant: \"destructive\",\n        });\n      })\n      .finally(() => {\n        setIsLoading(false);\n      });\n  }, [isAuthenticated, toast]);\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n          <div className=\"text-center\">\n            <Crown className=\"w-16 h-16 text-purple-500 mx-auto mb-6\" />\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              Sign in to Subscribe\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8\">\n              Join our community first to access premium features.\n            </p>\n            <Button \n              onClick={() => window.location.href = '/auth'}\n              className=\"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700\"\n            >\n              Sign In to Continue\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (user?.isPremium) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n          <div className=\"text-center\">\n            <div className=\"w-16 h-16 bg-teal-600 rounded-full flex items-center justify-center mx-auto mb-6\">\n              <Crown className=\"w-8 h-8 text-white\" />\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              You're Already Premium! ðŸŽ‰\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8\">\n              Thank you for supporting our community. Enjoy all the exclusive benefits!\n            </p>\n            <Link href=\"/\">\n              <Button className=\"bg-teal-600 hover:bg-teal-700\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Community\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full mx-auto mb-4\" />\n            <p className=\"text-gray-600\">Setting up your subscription...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!clientSecret) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n          <div className=\"text-center\">\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              Unable to Process Subscription\n            </h1>\n            <p className=\"text-xl text-gray-600 mb-8\">\n              We're experiencing technical difficulties. Please try again later.\n            </p>\n            <Link href=\"/\">\n              <Button variant=\"outline\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Home\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      \n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Community\n              </Button>\n            </Link>\n          </div>\n          \n          <div className=\"w-16 h-16 bg-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-6\">\n            <Crown className=\"w-8 h-8 text-white\" />\n          </div>\n          \n          <h1 className=\"text-4xl font-bold text-gray-900 mb-4\">\n            Upgrade to <span className=\"text-teal-600\">Premium</span>\n          </h1>\n          <p className=\"text-xl text-gray-600 max-w-2xl mx-auto\">\n            Get exclusive access to expert discussions, priority support, and a completely ad-free experience.\n          </p>\n        </div>\n\n        <div className=\"grid lg:grid-cols-2 gap-12 items-start\">\n          {/* Premium Benefits */}\n          <div className=\"space-y-8\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Star className=\"w-5 h-5 text-amber-500\" />\n                  Premium Benefits\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Priority Expert Responses</h3>\n                      <p className=\"text-gray-600 text-sm\">Your questions get answered first by verified healthcare professionals.</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Exclusive Expert Discussions</h3>\n                      <p className=\"text-gray-600 text-sm\">Access to premium-only discussions with healthcare experts and specialists.</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Monthly Virtual Support Groups</h3>\n                      <p className=\"text-gray-600 text-sm\">Join intimate video calls with other premium members for deeper support.</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Ad-Free Experience</h3>\n                      <p className=\"text-gray-600 text-sm\">Enjoy a clean, distraction-free community experience.</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Premium Badge</h3>\n                      <p className=\"text-gray-600 text-sm\">Show your commitment to the community with a special premium badge.</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <Check className=\"w-4 h-4 text-green-600\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-gray-900\">Early Access to Features</h3>\n                      <p className=\"text-gray-600 text-sm\">Be the first to try new community features and improvements.</p>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Community Impact */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Heart className=\"w-5 h-5 text-red-500\" />\n                  Supporting Our Mission\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-gray-600 mb-4\">\n                  Your premium membership helps us maintain a safe, supportive environment for all caregivers. \n                  100% of proceeds go toward community moderation, expert verification, and platform improvements.\n                </p>\n                <div className=\"bg-amber-50 rounded-lg p-4\">\n                  <div className=\"flex items-center gap-3 mb-2\">\n                    <Users className=\"w-5 h-5 text-teal-600\" />\n                    <span className=\"font-semibold text-teal-900\">Community Impact</span>\n                  </div>\n                  <ul className=\"text-sm text-teal-800 space-y-1\">\n                    <li>â€¢ Fund expert verification and moderation</li>\n                    <li>â€¢ Keep the platform ad-free for free members</li>\n                    <li>â€¢ Develop new safety and support features</li>\n                    <li>â€¢ Host community events and resources</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Subscription Form */}\n          <div className=\"lg:sticky lg:top-8\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-center\">\n                  Complete Your Subscription\n                </CardTitle>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-gray-900\">$9.99</div>\n                  <div className=\"text-gray-500\">per month</div>\n                  <Badge variant=\"secondary\" className=\"mt-2\">Cancel anytime</Badge>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <Elements stripe={stripePromise} options={{ \n                  clientSecret,\n                  appearance: {\n                    theme: 'stripe',\n                    variables: {\n                      colorPrimary: '#0f766e', // teal-600\n                    }\n                  }\n                }}>\n                  <SubscribeForm />\n                </Elements>\n              </CardContent>\n            </Card>\n\n            {/* Testimonial */}\n            <Card className=\"mt-6\">\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-start gap-3\">\n                  <img \n                    src=\"https://images.unsplash.com/photo-1559839734-2b71ea197ec2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&h=100\" \n                    alt=\"Premium member testimonial\" \n                    className=\"w-12 h-12 rounded-full object-cover\" \n                  />\n                  <div>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <span className=\"font-semibold text-gray-900\">Linda K.</span>\n                      <Badge variant=\"outline\" className=\"text-purple-600 border-purple-600\">Premium Member</Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600 italic\">\n                      \"The expert discussions alone are worth the subscription. Having direct access to healthcare professionals who understand caregiving has been invaluable.\"\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15434},"server/cache.ts":{"content":"import RedisCache from './redis';\n\n// Cache key generators\nexport const CacheKeys = {\n  posts: (categoryId?: number, limit?: number, offset?: number) => \n    `posts:${categoryId || 'all'}:${limit || 20}:${offset || 0}`,\n  post: (id: number) => `post:${id}`,\n  postComments: (postId: number) => `post:${postId}:comments`,\n  categories: () => 'categories:all',\n  categoriesLevel: (level: number) => `categories:level:${level}`,\n  categoryHierarchy: () => 'categories:hierarchy',\n  categoryBySlug: (slug: string) => `category:slug:${slug}`,\n  user: (id: string) => `user:${id}`,\n  userByEmail: (email: string) => `user:email:${email}`,\n  userByUsername: (username: string) => `user:username:${username}`,\n  expertVerification: (userId: string) => `expert:${userId}`,\n  verifiedExperts: () => 'experts:verified',\n  featuredExperts: () => 'experts:featured',\n  communityStats: () => 'stats:community',\n  achievements: () => 'achievements:all',\n  userAchievements: (userId: string) => `user:${userId}:achievements`,\n  searchPhrases: 'search:phrases',\n};\n\n// Cache TTL settings (in seconds)\nexport const CacheTTL = {\n  posts: 300, // 5 minutes\n  post: 600, // 10 minutes  \n  comments: 180, // 3 minutes\n  categories: 3600, // 1 hour\n  user: 1800, // 30 minutes\n  experts: 7200, // 2 hours\n  stats: 900, // 15 minutes\n  achievements: 3600, // 1 hour\n  long: 7200, // 2 hours\n};\n\n// Cache invalidation patterns\nexport const InvalidationPatterns = {\n  posts: 'posts:*',\n  post: (id: number) => [`post:${id}`, `post:${id}:*`],\n  categories: 'categories:*',\n  user: (id: string) => [`user:${id}`, `user:${id}:*`],\n  experts: 'experts:*',\n  stats: 'stats:*',\n};\n\n// Generic caching wrapper function\nexport async function withCache<T>(\n  key: string,\n  ttl: number,\n  fetchFunction: () => Promise<T>\n): Promise<T> {\n  const cache = RedisCache;\n  \n  // Try to get from cache first\n  const cached = await cache.get(key);\n  if (cached !== null) {\n    console.log(`Cache HIT: ${key}`);\n    return cached;\n  }\n  \n  console.log(`Cache MISS: ${key}`);\n  \n  // Fetch fresh data\n  const data = await fetchFunction();\n  \n  // Store in cache\n  await cache.set(key, data, ttl);\n  \n  return data;\n}\n\n// Cache invalidation helpers\nexport async function invalidateCache(patterns: string | string[]): Promise<void> {\n  const cache = RedisCache;\n  const patternsArray = Array.isArray(patterns) ? patterns : [patterns];\n  \n  for (const pattern of patternsArray) {\n    await cache.delPattern(pattern);\n    console.log(`Cache invalidated: ${pattern}`);\n  }\n}\n\n// Preload cache for frequently accessed data\nexport async function preloadCache(): Promise<void> {\n  console.log('Preloading cache with frequently accessed data...');\n  \n  try {\n    // Import storage here to avoid circular dependencies\n    const { storage } = await import('./storage');\n    \n    // Preload categories\n    await withCache(\n      CacheKeys.categories(),\n      CacheTTL.categories,\n      () => storage.getCategories()\n    );\n    \n    // Preload category hierarchy\n    await withCache(\n      CacheKeys.categoryHierarchy(),\n      CacheTTL.categories,\n      () => storage.getCategoryHierarchy()\n    );\n    \n    // Preload level 0 categories (forums)\n    await withCache(\n      CacheKeys.categoriesLevel(0),\n      CacheTTL.categories,\n      () => storage.getCategoriesByLevel(0)\n    );\n    \n    // Preload community stats\n    await withCache(\n      CacheKeys.communityStats(),\n      CacheTTL.stats,\n      () => storage.getCommunityStats()\n    );\n    \n    // Preload recent posts\n    await withCache(\n      CacheKeys.posts(),\n      CacheTTL.posts,\n      () => storage.getPosts()\n    );\n    \n    console.log('Cache preloading completed');\n  } catch (error) {\n    console.error('Cache preloading failed:', error);\n  }\n}","size_bytes":3753},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}","size_bytes":3410},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex w-full items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5118},"client/src/pages/ExpertApplicationSuccess.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCircle } from \"lucide-react\";\nimport MainLayout from \"@/components/MainLayout\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function ExpertApplicationSuccess() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(true);\n\n  // Get session ID from URL\n  const urlParams = new URLSearchParams(window.location.search);\n  const sessionId = urlParams.get('session_id');\n\n  const completeApplicationMutation = useMutation({\n    mutationFn: async () => {\n      const savedData = localStorage.getItem('expertApplicationData');\n      if (!savedData || !sessionId) {\n        throw new Error('Missing application data or session ID');\n      }\n\n      const applicationData = JSON.parse(savedData);\n      \n      const response = await apiRequest(\"POST\", \"/api/experts/complete-checkout-application\", {\n        sessionId,\n        applicationData\n      });\n\n      localStorage.removeItem('expertApplicationData');\n      return response;\n    },\n    onSuccess: () => {\n      setIsProcessing(false);\n      toast({\n        title: \"Application Submitted\",\n        description: \"Your expert verification application has been submitted successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      setIsProcessing(false);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to complete application. Please contact support.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  useEffect(() => {\n    if (sessionId) {\n      completeApplicationMutation.mutate();\n    } else {\n      setIsProcessing(false);\n    }\n  }, [sessionId]);\n\n  useEffect(() => {\n    // Redirect to community after 10 seconds\n    const timer = setTimeout(() => {\n      setLocation(\"/community\");\n    }, 10000);\n\n    return () => clearTimeout(timer);\n  }, [setLocation]);\n\n  return (\n    <MainLayout>\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardHeader className=\"text-center\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-600\" />\n            <CardTitle className=\"text-2xl\">Application Submitted Successfully!</CardTitle>\n          </CardHeader>\n          <CardContent className=\"text-center space-y-4\">\n            <p className=\"text-gray-600\">\n              Thank you for applying to become a verified expert. Your application and payment have been received successfully.\n            </p>\n            <p className=\"text-gray-600\">\n              Our team will review your application within 2-3 business days. You'll receive an email notification once your verification is complete.\n            </p>\n            <div className=\"pt-4 space-y-3\">\n              <Button onClick={() => setLocation(\"/community\")} className=\"w-full\">\n                Explore Community\n              </Button>\n              <Button onClick={() => setLocation(\"/dashboard\")} variant=\"outline\" className=\"w-full\">\n                Return to Dashboard\n              </Button>\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              You will be automatically redirected to the community in 10 seconds...\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </MainLayout>\n  );\n}","size_bytes":3665},"client/src/components/DefaultProfilePicture.tsx":{"content":"import React from 'react';\n\ninterface DefaultProfilePictureProps {\n  type?: 'daisy' | 'tree';\n  size?: number;\n  className?: string;\n}\n\nconst DaisyIcon = ({ size = 40 }: { size?: number }) => (\n  <svg width={size} height={size} viewBox=\"0 0 40 40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"url(#daisyGradient)\" />\n    {/* Daisy petals */}\n    <g transform=\"translate(20,20)\">\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(0)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(45)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(90)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(135)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(180)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(225)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(270)\" />\n      <ellipse cx=\"0\" cy=\"-8\" rx=\"2\" ry=\"6\" fill=\"white\" transform=\"rotate(315)\" />\n      {/* Center */}\n      <circle cx=\"0\" cy=\"0\" r=\"3\" fill=\"#F4B942\" />\n    </g>\n    <defs>\n      <linearGradient id=\"daisyGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" style={{stopColor: '#E8D5F3'}} />\n        <stop offset=\"100%\" style={{stopColor: '#D1C4E9'}} />\n      </linearGradient>\n    </defs>\n  </svg>\n);\n\nconst TreeIcon = ({ size = 40 }: { size?: number }) => (\n  <svg width={size} height={size} viewBox=\"0 0 40 40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"url(#treeGradient)\" />\n    {/* Tree trunk */}\n    <rect x=\"18\" y=\"25\" width=\"4\" height=\"8\" fill=\"#8B4513\" rx=\"2\" />\n    {/* Tree foliage */}\n    <circle cx=\"20\" cy=\"18\" r=\"8\" fill=\"#7BB46D\" />\n    <circle cx=\"16\" cy=\"15\" r=\"6\" fill=\"#8FBC8F\" />\n    <circle cx=\"24\" cy=\"15\" r=\"6\" fill=\"#8FBC8F\" />\n    <circle cx=\"20\" cy=\"12\" r=\"5\" fill=\"#9ACD32\" />\n    <defs>\n      <linearGradient id=\"treeGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" style={{stopColor: '#E8F5E8'}} />\n        <stop offset=\"100%\" style={{stopColor: '#D4F1D4'}} />\n      </linearGradient>\n    </defs>\n  </svg>\n);\n\nexport default function DefaultProfilePicture({ \n  type = 'daisy', \n  size = 40, \n  className = '' \n}: DefaultProfilePictureProps) {\n  return (\n    <div className={`inline-flex items-center justify-center ${className}`}>\n      {type === 'daisy' ? (\n        <DaisyIcon size={size} />\n      ) : (\n        <TreeIcon size={size} />\n      )}\n    </div>\n  );\n}","size_bytes":2595},"new-feature.md":{"content":"# Expert Appointment Booking Feature - Implementation Plan\n\n## 1. Feature Overview\n\n### Core Components\n- **Expert Calendar Integration** - Connect and sync expert availability\n- **Appointment Scheduling System** - Browse, select, and book time slots\n- **Payment Processing** - Stripe integration with automatic fee splitting\n- **Booking Management** - View, modify, cancel appointments for both parties\n\n### Key Business Rules\n- Platform takes 10% commission on all consultations\n- Payments processed before appointment confirmation\n- Experts set their own hourly rates\n- Automatic calendar synchronization\n\n## 2. System Architecture\n\n### High-Level Components\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Frontend      â”‚â”€â”€â”€â”€â–¶â”‚   Backend API    â”‚â”€â”€â”€â”€â–¶â”‚   Database      â”‚\nâ”‚   Application   â”‚     â”‚   Server         â”‚     â”‚   (PostgreSQL)  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                               â”‚\n                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                               â–¼                  â–¼\n                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                        â”‚   Stripe    â”‚    â”‚  Calendar    â”‚\n                        â”‚   API       â”‚    â”‚  APIs        â”‚\n                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Service Architecture\n- **Appointment Service** - Manages booking logic and availability\n- **Payment Service** - Handles Stripe integration and fee calculations\n- **Calendar Service** - Syncs with external calendars (Google, Outlook, etc.)\n- **Notification Service** - Sends booking confirmations and reminders\n- **User Service** - Manages expert profiles and rates\n\n## 3. Database Design\n\n### Core Tables\n\n**experts**\n- id (PK)\n- user_id (FK)\n- hourly_rate\n- currency\n- bio\n- specializations (JSON)\n- calendar_connected (boolean)\n- stripe_account_id\n- availability_settings (JSON)\n\n**appointments**\n- id (PK)\n- expert_id (FK)\n- client_id (FK)\n- start_time\n- end_time\n- duration_minutes\n- status (pending, confirmed, completed, cancelled)\n- total_amount\n- platform_fee\n- expert_earnings\n- payment_intent_id\n- meeting_link\n- notes\n\n**availability_slots**\n- id (PK)\n- expert_id (FK)\n- day_of_week\n- start_time\n- end_time\n- is_recurring\n\n**calendar_integrations**\n- id (PK)\n- expert_id (FK)\n- provider (google, outlook, apple)\n- access_token\n- refresh_token\n- calendar_id\n- last_sync\n\n**payments**\n- id (PK)\n- appointment_id (FK)\n- stripe_payment_intent_id\n- amount\n- currency\n- platform_fee\n- expert_payout\n- status\n- processed_at\n\n## 4. User Flows\n\n### Expert Onboarding Flow\n1. Expert completes profile with specializations\n2. Sets hourly rate and availability preferences\n3. Connects Stripe account for payouts (Stripe Connect)\n4. Connects calendar (OAuth with Google/Outlook/Apple)\n5. Sets recurring availability or specific time slots\n6. Profile goes live for bookings\n\n### Client Booking Flow\n1. Browse/search experts by specialization, rate, availability\n2. View expert profile and available time slots\n3. Select appointment duration and time slot\n4. Add appointment notes/requirements\n5. Enter payment information\n6. Confirm booking and pay\n7. Receive confirmation with calendar invite\n\n### Appointment Management Flow\n1. View upcoming appointments dashboard\n2. Join video call through integrated link\n3. Mark appointment as complete\n4. Leave reviews/ratings\n5. Handle cancellations/rescheduling\n\n## 5. Third-Party Integrations\n\n### Stripe Integration\n\n**Stripe Connect Setup**\n- Experts create connected accounts\n- Platform uses Stripe Connect for split payments\n- Automatic fee calculation and distribution\n\n**Payment Flow**\n1. Create PaymentIntent with application_fee_amount (10%)\n2. Process payment from client\n3. Automatic split: 90% to expert, 10% to platform\n4. Handle refunds for cancellations\n\n**Required Stripe Features**\n- Stripe Connect (Express or Standard accounts)\n- Payment Intents API\n- Webhooks for payment status\n- Refund API for cancellations\n\n### Calendar Integration\n\n**Supported Providers**\n- Google Calendar (OAuth 2.0)\n- Microsoft Outlook (Microsoft Graph API)\n- Apple Calendar (CalDAV)\n\n**Sync Strategy**\n- Two-way sync for availability\n- Create calendar events on booking\n- Update calendar on cancellations\n- Periodic sync to check for conflicts\n\n## 6. Key Features & Considerations\n\n### Availability Management\n- **Recurring Availability**: Set weekly schedules\n- **Buffer Times**: Add gaps between appointments\n- **Blocked Dates**: Vacation/unavailable periods\n- **Time Zone Handling**: Display in user's local time\n\n### Pricing & Payment\n- **Multi-currency Support**: Based on expert location\n- **Automatic Currency Conversion**: For international bookings\n- **Hold & Capture**: Authorize payment on booking, capture after session\n- **Cancellation Policy**: Define refund windows\n\n### Communication\n- **Email Notifications**: Booking confirmations, reminders\n- **SMS Reminders**: Optional for both parties\n- **In-app Messaging**: Pre-appointment questions\n- **Video Integration**: Zoom, Google Meet, or custom solution\n\n## 7. Security Considerations\n\n### Data Protection\n- Encrypt sensitive data (tokens, payment info)\n- PCI compliance for payment processing\n- HIPAA compliance if health-related consultations\n- GDPR compliance for user data\n\n### Authentication & Authorization\n- Secure OAuth flows for calendar integration\n- Token rotation for API access\n- Role-based access control (expert vs client)\n- Secure storage of Stripe keys\n\n## 8. Implementation Phases\n\n### Phase 1: Foundation (Weeks 1-3)\n- Database schema setup\n- Basic user authentication\n- Expert profile creation\n- Stripe Connect integration\n\n### Phase 2: Calendar Integration (Weeks 4-5)\n- Google Calendar OAuth\n- Availability slot management\n- Time zone handling\n- Basic availability display\n\n### Phase 3: Booking System (Weeks 6-8)\n- Search and filter experts\n- Booking flow UI\n- Payment processing\n- Confirmation system\n\n### Phase 4: Management Features (Weeks 9-10)\n- Appointment dashboard\n- Cancellation/rescheduling\n- Notification system\n- Basic reporting\n\n### Phase 5: Polish & Launch (Weeks 11-12)\n- Additional calendar providers\n- Advanced features (recurring appointments)\n- Performance optimization\n- Beta testing and bug fixes\n\n## 9. Technical Considerations\n\n### Performance\n- Cache expert availability\n- Implement optimistic UI updates\n- Use webhooks for real-time updates\n- Database indexing on frequently queried fields\n\n### Scalability\n- Design for horizontal scaling\n- Use message queues for async operations\n- Implement rate limiting\n- Consider microservices architecture\n\n### Monitoring\n- Payment success/failure rates\n- Booking conversion metrics\n- Calendar sync reliability\n- API response times\n\n## 10. Future Enhancements\n\n### Potential Features\n- Group consultations\n- Subscription/package deals\n- Waiting lists for popular experts\n- AI-powered expert matching\n- Mobile app development\n- Analytics dashboard for experts\n- Automated invoice generation\n\nThis implementation plan provides a comprehensive roadmap for building the expert appointment booking system with integrated payments and calendar functionality. Would you like me to elaborate on any specific aspect or create detailed technical specifications for any component?","size_bytes":7748},"PAYMENT_DOCUMENTATION.md":{"content":"# AskEdith Payment Implementation Documentation\n\n## Overview\n\nThis document provides a detailed analysis of the current payment implementation and what needs to be done to ensure AskEdith receives proper compensation for the platform services.\n\n## Current Implementation Status\n\n### 1. Expert Verification Fee ($100) - PARTIALLY IMPLEMENTED\n\n**What's Working:**\n- Payment collection via Stripe Payment Intent or Checkout Session\n- $100 fee is successfully charged to experts during application\n- Payment status is recorded in the database\n- Expert applications are created after successful payment\n\n**What's Missing:**\n- The $100 goes entirely to the Stripe account connected to the API keys\n- NO mechanism to transfer funds to AskEdith company account\n- NO platform fee or split payment configuration\n\n**Code Location:** \n- `/api/experts/create-verification-payment-intent` (server/routes.ts lines 520-544)\n- `/api/experts/apply-with-payment` (server/routes.ts lines 473-517)\n- `/api/experts/create-checkout-session` (server/routes.ts lines 557-609)\n\n### 2. Expert Consultation Bookings - BASIC IMPLEMENTATION ONLY\n\n**What's Working:**\n- Payment intent creation for consultation bookings\n- Fixed rate of $100/hour is enforced\n- Basic booking flow with payment collection\n\n**What's Missing:**\n- NO commission structure implemented\n- NO 15% platform fee calculation\n- NO automatic fund splitting\n- NO payout mechanism to experts\n- All funds go to the main Stripe account\n\n**Code Location:**\n- `/api/consultations/create-payment` (server/routes.ts)\n- `client/src/pages/BookConsultation.tsx`\n\n## Required Implementation for Production\n\n### 1. Stripe Connect Integration (REQUIRED)\n\nTo properly handle platform fees and payouts, AskEdith needs to implement Stripe Connect:\n\n```javascript\n// Example of what needs to be implemented:\n\n// 1. Expert onboarding with Stripe Connect\nconst account = await stripe.accounts.create({\n  type: 'express',\n  country: 'US',\n  email: expert.email,\n  capabilities: {\n    card_payments: {requested: true},\n    transfers: {requested: true},\n  },\n  business_type: 'individual',\n});\n\n// 2. Generate onboarding link for expert\nconst accountLink = await stripe.accountLinks.create({\n  account: account.id,\n  refresh_url: 'https://askedith.org/expert/stripe-refresh',\n  return_url: 'https://askedith.org/expert/stripe-success',\n  type: 'account_onboarding',\n});\n\n// 3. Store expert's Stripe Connect account ID\nawait storage.updateExpert(expertId, {\n  stripeConnectAccountId: account.id\n});\n```\n\n### 2. Platform Fee Implementation for Consultations\n\n```javascript\n// When creating consultation payment:\nconst paymentIntent = await stripe.paymentIntents.create({\n  amount: 10000, // $100\n  currency: 'usd',\n  application_fee_amount: 1500, // 15% = $15 platform fee\n  transfer_data: {\n    destination: expert.stripeConnectAccountId, // Expert gets $85\n  },\n  metadata: {\n    type: 'consultation',\n    expertId: expert.id,\n    clientId: client.id,\n    platformFee: '15%'\n  }\n});\n```\n\n### 3. Verification Fee Handling\n\nFor the $100 verification fee, AskEdith should receive 100% of the payment. Current implementation already achieves this, but it should be documented:\n\n```javascript\n// Current implementation - fee goes to platform account\nconst paymentIntent = await stripe.paymentIntents.create({\n  amount: 10000, // $100 verification fee\n  currency: 'usd',\n  metadata: {\n    type: 'expert_verification_fee',\n    userId: userId,\n    // No transfer_data means funds stay with platform\n  }\n});\n```\n\n### 4. Database Schema Updates Needed\n\n```sql\n-- Add to experts table:\nALTER TABLE experts ADD COLUMN stripe_connect_account_id VARCHAR(255);\nALTER TABLE experts ADD COLUMN stripe_connect_status VARCHAR(50); -- 'pending', 'active', 'restricted'\nALTER TABLE experts ADD COLUMN stripe_payouts_enabled BOOLEAN DEFAULT FALSE;\n\n-- Add to consultations table:\nALTER TABLE consultations ADD COLUMN platform_fee_amount INTEGER; -- in cents\nALTER TABLE consultations ADD COLUMN expert_payout_amount INTEGER; -- in cents\nALTER TABLE consultations ADD COLUMN stripe_transfer_id VARCHAR(255);\nALTER TABLE consultations ADD COLUMN payout_status VARCHAR(50); -- 'pending', 'transferred', 'failed'\n```\n\n### 5. Expert Dashboard Updates\n\nExperts need to see:\n- Their earnings and pending payouts\n- Platform fee breakdown\n- Stripe Connect onboarding status\n- Payout history\n\n### 6. Admin Dashboard Requirements\n\nAskEdith administrators need:\n- Total platform revenue dashboard\n- Verification fees collected\n- Commission fees collected\n- Payout management interface\n- Expert verification queue\n\n## Implementation Priority\n\n1. **Phase 1 - Stripe Connect Setup** (Critical)\n   - Implement Stripe Connect account creation\n   - Add onboarding flow for experts\n   - Update database schema\n\n2. **Phase 2 - Payment Flow Updates** (Critical)\n   - Modify consultation booking to include platform fees\n   - Implement automatic fund splitting\n   - Add transfer tracking\n\n3. **Phase 3 - Dashboard & Reporting** (Important)\n   - Expert earnings dashboard\n   - Admin revenue dashboard\n   - Financial reporting tools\n\n4. **Phase 4 - Automation** (Nice to have)\n   - Automatic weekly/monthly payouts\n   - Tax document generation (1099s)\n   - Detailed transaction history\n\n## Security Considerations\n\n1. **Never store sensitive Stripe data directly**\n   - Only store Stripe IDs (customer_id, account_id, etc.)\n   - Use Stripe's secure APIs for all operations\n\n2. **Implement proper access controls**\n   - Experts can only see their own financial data\n   - Admin-only endpoints for platform revenue\n\n3. **Audit trail**\n   - Log all financial transactions\n   - Track payment intents, transfers, and payouts\n\n## Testing Recommendations\n\n1. Use Stripe test mode with test API keys\n2. Create test Connect accounts for development\n3. Test various scenarios:\n   - Successful payments with commission\n   - Failed payments\n   - Refunds and disputes\n   - Payout delays\n\n## Estimated Development Time\n\n- Stripe Connect Integration: 2-3 days\n- Payment Flow Updates: 1-2 days\n- Dashboard Development: 3-4 days\n- Testing & Deployment: 2-3 days\n\n**Total: 8-12 days for complete implementation**\n\n## Current Risks\n\nâš ï¸ **IMPORTANT**: The current implementation collects payments but:\n1. Does NOT split funds between experts and platform\n2. Does NOT track commission fees\n3. Does NOT provide payout mechanisms\n4. All money goes to whoever owns the Stripe API keys\n\nThis MUST be addressed before launching the platform commercially.","size_bytes":6500},"client/src/components/CreateForumModal.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Loader2 } from \"lucide-react\";\n\nconst createForumSchema = z.object({\n  name: z.string().min(3, \"Forum name must be at least 3 characters\").max(50, \"Forum name must be less than 50 characters\"),\n  description: z.string().max(200, \"Description must be less than 200 characters\").optional(),\n});\n\ninterface CreateForumModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function CreateForumModal({ open, onOpenChange }: CreateForumModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<z.infer<typeof createForumSchema>>({\n    resolver: zodResolver(createForumSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n    },\n  });\n\n  const createForumMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createForumSchema>) => {\n      const response = await fetch('/api/forums/create', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to create forum');\n      }\n      \n      return await response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Forum created successfully\",\n        description: `Your forum \"${data.forum.name}\" has been created and is now available.`,\n      });\n      form.reset();\n      onOpenChange(false);\n      queryClient.invalidateQueries({ queryKey: ['/api/forums/my-forums'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to create forum\",\n        description: error.message || \"There was an error creating your forum. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: z.infer<typeof createForumSchema>) => {\n    createForumMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[850px] min-h-[600px]\">\n        <DialogHeader>\n          <DialogTitle>Create Your Own Forum</DialogTitle>\n          <DialogDescription>\n            Create a community forum for discussions on topics that matter to you. \n            Your forum will be searchable but won't appear in the main sidebar.\n          </DialogDescription>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Forum Name</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"e.g., Caring for Parents with Alzheimer's\" \n                      {...field} \n                    />\n                  </FormControl>\n                  <FormDescription>\n                    Choose a clear, descriptive name for your forum.\n                  </FormDescription>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Description (Optional)</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      placeholder=\"Share what this forum is about and what kind of discussions you hope to see...\"\n                      className=\"resize-none\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormDescription>\n                    Help others understand what your forum is for.\n                  </FormDescription>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <DialogFooter>\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => onOpenChange(false)}\n                disabled={createForumMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createForumMutation.isPending}\n              >\n                {createForumMutation.isPending && (\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                )}\n                Create Forum\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":5365},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    return res.redirect(\"/api/login\");\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    return res.redirect(\"/api/login\");\n  }\n};\n","size_bytes":4165},"server/db-health.ts":{"content":"// server/db-health.ts\nimport 'dotenv/config';\nimport { db } from \"./db\";\nimport { users, posts, comments, categories, achievements, votes } from \"@shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\nasync function checkDatabaseHealth() {\n  console.log(\"ðŸ” Checking database health...\");\n  console.log(\"=\".repeat(50));\n\n  try {\n    // Test basic database connection\n    console.log(\"ðŸ“¡ Testing database connection...\");\n    await db.execute(sql`SELECT 1`);\n    console.log(\"  âœ… Database connection successful\");\n\n    // Count records in each table\n    console.log(\"\\nðŸ“Š Table record counts:\");\n    \n    const tables = [\n      { name: \"Users\", table: users },\n      { name: \"Categories\", table: categories },\n      { name: \"Posts\", table: posts },\n      { name: \"Comments\", table: comments },\n      { name: \"Votes\", table: votes },\n      { name: \"Achievements\", table: achievements }\n    ];\n\n    for (const { name, table } of tables) {\n      try {\n        const result = await db.select({ count: sql`count(*)` }).from(table);\n        const count = Number(result[0].count);\n        console.log(`  ${name.padEnd(12)}: ${count.toString().padStart(6)} records`);\n      } catch (error) {\n        console.log(`  ${name.padEnd(12)}: âŒ Error counting records`);\n      }\n    }\n\n    // Check for required data\n    console.log(\"\\nðŸ” Checking required data:\");\n    \n    // Check if we have categories\n    const categoryCount = await db.select({ count: sql`count(*)` }).from(categories);\n    const catCount = Number(categoryCount[0].count);\n    if (catCount > 0) {\n      console.log(\"  âœ… Categories table populated\");\n    } else {\n      console.log(\"  âš ï¸  Categories table is empty - run 'npm run seed'\");\n    }\n\n    // Check if we have achievements\n    const achievementCount = await db.select({ count: sql`count(*)` }).from(achievements);\n    const achCount = Number(achievementCount[0].count);\n    if (achCount > 0) {\n      console.log(\"  âœ… Achievements table populated\");\n    } else {\n      console.log(\"  âš ï¸  Achievements table is empty - run 'npm run seed'\");\n    }\n\n    // Check for any users\n    const userCount = await db.select({ count: sql`count(*)` }).from(users);\n    const usrCount = Number(userCount[0].count);\n    if (usrCount > 0) {\n      console.log(\"  âœ… Users table has data\");\n    } else {\n      console.log(\"  â„¹ï¸  No users yet - this is normal for a new installation\");\n    }\n\n    console.log(\"\\nðŸŽ¯ Database Health Summary:\");\n    console.log(\"=\".repeat(50));\n    console.log(\"âœ… Database is healthy and ready for use!\");\n    \n    if (catCount === 0 || achCount === 0) {\n      console.log(\"\\nðŸ’¡ Recommendation: Run 'npm run seed' to populate initial data\");\n    }\n\n    return {\n      status: \"healthy\",\n      users: usrCount,\n      categories: catCount,\n      posts: Number((await db.select({ count: sql`count(*)` }).from(posts))[0].count),\n      comments: Number((await db.select({ count: sql`count(*)` }).from(comments))[0].count),\n      achievements: achCount,\n      votes: Number((await db.select({ count: sql`count(*)` }).from(votes))[0].count)\n    };\n\n  } catch (error) {\n    console.error(\"âŒ Database health check failed:\", error);\n    console.log(\"\\nðŸš¨ Database Issues Detected:\");\n    console.log(\"=\" * 50);\n    console.log(\"- Check your DATABASE_URL environment variable\");\n    console.log(\"- Ensure your database is running\");\n    console.log(\"- Run 'npm run db:push' to sync the schema\");\n    \n    return {\n      status: \"unhealthy\",\n      error: error instanceof Error ? error.message : String(error)\n    };\n  }\n}\n\n// Run health check\ncheckDatabaseHealth()\n  .then((result) => {\n    if (result.status === \"healthy\") {\n      process.exit(0);\n    } else {\n      process.exit(1);\n    }\n  })\n  .catch((error) => {\n    console.error(\"ðŸ’¥ Health check script failed:\", error);\n    process.exit(1);\n  });","size_bytes":3857},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"server/services/rag/types.ts":{"content":"export interface QaChunk {\n  id?: number;\n  chunkText: string;\n  embedding?: number[];\n  metadata: {\n    id: number;\n    question: string;\n    category?: string;\n    source: string;\n    chunkIndex: number;\n    totalChunks: number;\n  };\n  createdAt?: Date;\n}\n\nexport interface SearchResult {\n  chunk: QaChunk;\n  score: number;\n  source: string;\n}\n\nexport interface RagResponse {\n  answer: string;\n  sources: SearchResult[];\n  confidence: number;\n  query: string;\n}\n\nexport interface EmbeddingConfig {\n  model: string;\n  dimension: number;\n  chunkSize: number;\n  chunkOverlap: number;\n}\n\nexport interface SearchConfig {\n  topK: number;\n  similarityThreshold: number;\n  includeMetadata: boolean;\n}\n","size_bytes":695},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }","size_bytes":823},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"server/graphql/typeDefs.ts":{"content":"import { gql } from 'graphql-tag';\n\nexport const typeDefs = gql`\n  scalar Date\n\n  type User {\n    id: ID!\n    username: String!\n    email: String\n    firstName: String\n    lastName: String\n    communityName: String\n    profileImageUrl: String\n    bio: String\n    location: String\n    website: String\n    socialLinksTwitter: String\n    socialLinksLinkedin: String\n    socialLinksFacebook: String\n    joinedAt: Date\n    lastActiveAt: Date\n    reputation: Int\n    expertVerification: ExpertVerification\n    achievements: [UserAchievement!]!\n    posts: [Post!]!\n    comments: [Comment!]!\n  }\n\n  type Category {\n    id: ID!\n    name: String!\n    description: String\n    slug: String!\n    color: String!\n    icon: String!\n    postCount: Int\n    parentId: ID\n    level: Int\n    orderIndex: Int\n    createdAt: Date\n    parent: Category\n    children: [Category!]!\n    posts: [Post!]!\n  }\n\n  type Post {\n    id: ID!\n    title: String!\n    content: String!\n    category: Category!\n    author: User!\n    isResolved: Boolean\n    isSticky: Boolean\n    helpfulVotes: Int\n    commentCount: Int\n    viewCount: Int\n    createdAt: Date\n    updatedAt: Date\n    tags: [String!]\n    source: PostSource\n    comments: [Comment!]!\n    votes: [Vote!]!\n  }\n\n  type Comment {\n    id: ID!\n    content: String!\n    post: Post!\n    author: User!\n    parentId: ID\n    helpfulVotes: Int\n    createdAt: Date\n    updatedAt: Date\n    parent: Comment\n    replies: [Comment!]!\n    votes: [Vote!]!\n  }\n\n  type Vote {\n    id: ID!\n    user: User!\n    postId: ID\n    commentId: ID\n    voteType: String!\n    createdAt: Date\n  }\n\n  type Achievement {\n    id: ID!\n    name: String!\n    description: String!\n    icon: String!\n    category: String!\n    points: Int!\n    requirements: String!\n    createdAt: Date\n  }\n\n  type UserAchievement {\n    id: ID!\n    user: User!\n    achievement: Achievement!\n    earnedAt: Date!\n    progress: Int\n  }\n\n  type ExpertVerification {\n    id: ID!\n    user: User!\n    specialization: String!\n    credentials: String!\n    experience: String!\n    portfolio: String\n    status: String!\n    verifiedAt: Date\n    verifiedBy: String\n    isFeatured: Boolean\n    rating: Float\n    reviewCount: Int\n  }\n\n  type PostSource {\n    id: ID!\n    post: Post!\n    sourceType: String!\n    sourceUrl: String\n    sourceTitle: String\n    sourceAuthor: String\n    publishedAt: Date\n    reliability: String\n    createdAt: Date\n  }\n\n  type CommunityStats {\n    totalUsers: Int!\n    totalPosts: Int!\n    totalComments: Int!\n    postsThisWeek: Int!\n  }\n\n  type ModerationResult {\n    id: ID!\n    contentId: String!\n    contentType: String!\n    score: Float!\n    flaggedCategories: [String!]!\n    status: String!\n    reason: String!\n    reviewedBy: String\n    createdAt: Date\n    updatedAt: Date\n  }\n\n  input PostInput {\n    title: String!\n    content: String!\n    categoryId: ID!\n    tags: [String!]\n    isSticky: Boolean\n  }\n\n  input CommentInput {\n    content: String!\n    postId: ID!\n    parentId: ID\n  }\n\n  input CategoryInput {\n    name: String!\n    description: String\n    slug: String!\n    color: String!\n    icon: String!\n    parentId: ID\n    level: Int\n    orderIndex: Int\n  }\n\n  input UserInput {\n    username: String!\n    email: String!\n    firstName: String\n    lastName: String\n    communityName: String\n    bio: String\n    location: String\n    website: String\n    socialLinksTwitter: String\n    socialLinksLinkedin: String\n    socialLinksFacebook: String\n  }\n\n  input VoteInput {\n    postId: ID\n    commentId: ID\n    voteType: String!\n  }\n\n  input ExpertVerificationInput {\n    specialization: String!\n    credentials: String!\n    experience: String!\n    portfolio: String\n  }\n\n  type Query {\n    # User queries\n    user(id: ID!): User\n    users(limit: Int, offset: Int): [User!]!\n    currentUser: User\n\n    # Category queries\n    categories: [Category!]!\n    category(id: ID, slug: String): Category\n    categoryHierarchy: [Category!]!\n    categoriesByLevel(level: Int!): [Category!]!\n    categoriesByParent(parentId: ID!): [Category!]!\n\n    # Post queries\n    posts(categoryId: ID, limit: Int, offset: Int, authorId: ID): [Post!]!\n    post(id: ID!): Post\n    postsWithExpertInfo(categoryId: ID, limit: Int, offset: Int): [Post!]!\n\n    # Comment queries\n    comments(postId: ID!): [Comment!]!\n    comment(id: ID!): Comment\n\n    # Achievement queries\n    achievements: [Achievement!]!\n    userAchievements(userId: ID!): [UserAchievement!]!\n\n    # Expert verification queries\n    expertVerification(userId: ID!): ExpertVerification\n    verifiedExperts: [ExpertVerification!]!\n    featuredExperts: [ExpertVerification!]!\n\n    # Stats queries\n    communityStats: CommunityStats!\n\n    # Moderation queries\n    moderationQueue: [ModerationResult!]!\n    moderationResult(contentId: String!): ModerationResult\n  }\n\n  type Mutation {\n    # User mutations\n    createUser(input: UserInput!): User!\n    updateUser(id: ID!, input: UserInput!): User!\n\n    # Post mutations\n    createPost(input: PostInput!): Post!\n    updatePost(id: ID!, title: String, content: String, tags: [String!]): Post!\n    deletePost(id: ID!): Boolean!\n    updatePostHelpfulVotes(id: ID!, increment: Int!): Post!\n\n    # Comment mutations\n    createComment(input: CommentInput!): Comment!\n    updateComment(id: ID!, content: String!): Comment!\n    deleteComment(id: ID!): Boolean!\n    updateCommentHelpfulVotes(id: ID!, increment: Int!): Comment!\n\n    # Category mutations\n    createCategory(input: CategoryInput!): Category!\n    updateCategory(id: ID!, input: CategoryInput!): Category!\n\n    # Vote mutations\n    createVote(input: VoteInput!): Vote!\n    deleteVote(postId: ID, commentId: ID): Boolean!\n\n    # Expert verification mutations\n    createExpertVerification(input: ExpertVerificationInput!): ExpertVerification!\n    updateExpertVerification(id: ID!, input: ExpertVerificationInput!): ExpertVerification!\n    verifyExpert(id: ID!): ExpertVerification!\n\n    # Moderation mutations\n    updateModerationStatus(id: ID!, status: String!): ModerationResult!\n  }\n\n  type Subscription {\n    postAdded(categoryId: ID): Post!\n    commentAdded(postId: ID!): Comment!\n    userOnline(userId: ID!): User!\n  }\n`;","size_bytes":6144},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/pages/category.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { ArrowLeft, Plus, MessageCircle, Users } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport Header from \"@/components/Header\";\nimport PostCard from \"@/components/PostCard\";\nimport { categoryIcons } from \"@/lib/categories\";\n\nexport default function Category() {\n  const { slug } = useParams();\n  const [showCreatePost, setShowCreatePost] = useState(false);\n\n  const { data: category } = useQuery({\n    queryKey: [`/api/categories/${slug}`],\n    enabled: !!slug,\n  });\n\n  const { data: posts } = useQuery({\n    queryKey: [`/api/posts`, category?.id],\n    queryFn: () => fetch(`/api/posts?categoryId=${category?.id}`).then(res => res.json()),\n    enabled: !!category?.id,\n  });\n\n  const IconComponent = category ? categoryIcons[category.slug] : MessageCircle;\n\n  if (!category) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Category not found</h1>\n            <Link href=\"/\">\n              <Button variant=\"outline\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Home\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const gradientClass = `gradient-${category.color}`;\n  const bgClass = `bg-${category.color}`;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header />\n\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Category Header */}\n        <div className={`${bgClass} rounded-2xl p-8 mb-8`}>\n          <div className=\"flex items-center gap-4 mb-4\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"text-gray-600 hover:text-gray-900\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back\n              </Button>\n            </Link>\n          </div>\n          \n          <div className=\"flex items-center gap-6\">\n            <div className={`w-16 h-16 ${gradientClass} rounded-2xl flex items-center justify-center`}>\n              <IconComponent className=\"w-8 h-8 text-white\" />\n            </div>\n            <div className=\"flex-1\">\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">{category.name}</h1>\n              <p className=\"text-gray-700 text-lg mb-4\">{category.description}</p>\n              <div className=\"flex items-center gap-6 text-sm text-gray-600\">\n                <div className=\"flex items-center gap-2\">\n                  <MessageCircle className=\"w-4 h-4\" />\n                  <span>{category.postCount} discussions</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"w-4 h-4\" />\n                  <span>Active community</span>\n                </div>\n              </div>\n            </div>\n            <Button \n              className=\"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white\"\n              onClick={() => setShowCreatePost(true)}\n            >\n              <Plus className=\"w-4 h-4 mr-2\" />\n              New Discussion\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid lg:grid-cols-4 gap-8\">\n          {/* Posts */}\n          <div className=\"lg:col-span-3\">\n            <div className=\"space-y-4\">\n              {posts?.length > 0 ? (\n                posts.map((post: any) => (\n                  <PostCard key={post.id} post={post} />\n                ))\n              ) : (\n                <Card>\n                  <CardContent className=\"text-center py-12\">\n                    <MessageCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">No discussions yet</h3>\n                    <p className=\"text-gray-500 mb-4\">Be the first to start a conversation in this category!</p>\n                    <Button onClick={() => setShowCreatePost(true)}>\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Start Discussion\n                    </Button>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Category Guidelines */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Community Guidelines</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-2 text-sm text-gray-600\">\n                  <li>â€¢ Be respectful and supportive</li>\n                  <li>â€¢ Share experiences, not medical advice</li>\n                  <li>â€¢ Protect personal information</li>\n                  <li>â€¢ Use clear, descriptive titles</li>\n                  <li>â€¢ Search before posting duplicates</li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            {/* Related Categories */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Related Topics</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {/* This would show related categories based on the current one */}\n                  <p className=\"text-sm text-gray-500\">\n                    Explore related discussions and find more support.\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Safety Reminder */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                  Safe Space\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-gray-600\">\n                  This is a safe, moderated space. Personal contact information is automatically protected.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6423},"send-password-reset.js":{"content":"import sgMail from '@sendgrid/mail';\n\nconst apiKey = process.env.SENDGRID_ASK_EDITH_1_API_KEY;\nsgMail.setApiKey(apiKey);\n\nconst resetToken = 'd65fc01726f29652b925be1c99f99f48f4835ae7fac77f04f65514d23b88eae1';\nconst resetUrl = `https://29702bf1-770c-4095-afdd-dc8fcc65ffbb-00-1s9hnopi7aao4.worf.replit.dev/reset-password?token=${resetToken}`;\n\nconst msg = {\n  to: 'papasavvaselias50@gmail.com',\n  from: 'elias@askedith.org',\n  subject: 'Reset your AskEdith password',\n  html: `\n    <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n      <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n        <h1 style=\"margin: 0;\">Password Reset Request</h1>\n      </div>\n      <div style=\"padding: 30px; background-color: #f5f5f5;\">\n        <h2 style=\"color: #333;\">Hi Elias (Founder),</h2>\n        <p style=\"color: #666; line-height: 1.6;\">\n          We received a request to reset your password. If you didn't make this request, you can safely ignore this email.\n        </p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${resetUrl}\" style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n            Reset Password\n          </a>\n        </div>\n        <p style=\"color: #666; font-size: 14px;\">\n          If the button doesn't work, copy and paste this link into your browser:<br>\n          <a href=\"${resetUrl}\" style=\"color: #0B666B;\">${resetUrl}</a>\n        </p>\n        <p style=\"color: #666; font-size: 14px;\">\n          This link will expire in 1 hour for security reasons.\n        </p>\n      </div>\n      <div style=\"background-color: #333; color: #999; padding: 20px; text-align: center; font-size: 12px;\">\n        <p style=\"margin: 0;\">Â© 2025 AskEdith. All rights reserved.</p>\n      </div>\n    </div>\n  `,\n};\n\nconsole.log('Sending password reset email...');\nconsole.log('Reset URL:', resetUrl);\n\nsgMail\n  .send(msg)\n  .then(() => {\n    console.log('âœ“ Password reset email sent successfully!');\n    console.log('Check your email at papasavvaselias50@gmail.com');\n  })\n  .catch((error) => {\n    console.error('âœ— Error:', error.message);\n    if (error.response) {\n      console.error('Details:', JSON.stringify(error.response.body, null, 2));\n    }\n  });","size_bytes":2340},"DEPLOYMENT_FIX.md":{"content":"# âœ… DEPLOYMENT WHITE SCREEN - FIXED!\n\n## The Problem (SOLVED)\nYour app was showing a blank white screen because deployment platforms weren't properly setting NODE_ENV=production.\n\n## The Solution (IMPLEMENTED)\n\n**AUTOMATIC PRODUCTION MODE DETECTION**\nYour server now automatically detects when built files exist and switches to production mode, regardless of environment variables.\n\n**Step 1: Build the app**\n```bash\n./deploy.sh\n```\n\n**Step 2: Deploy**\nUse either:\n```bash\nnpm start\n```\nOR\n```bash\nnode dist/index.js\n```\n\nThe server will automatically serve static files if they exist, even without NODE_ENV=production.\n\n## What Was Fixed\n\nâœ… **Smart Environment Detection**: Server detects built files and auto-switches to production mode  \nâœ… **No Environment Variable Dependency**: Works even if deployment platform doesn't set NODE_ENV  \nâœ… **Proper Static File Serving**: Built files are served correctly from the right location  \nâœ… **Fallback Protection**: Still works with proper NODE_ENV if set  \n\n## Verification\nYour app will now load properly instead of showing a blank white screen, regardless of how your deployment platform handles environment variables.\n\n**The blank white screen issue is permanently fixed!**","size_bytes":1231},"server/storage.ts":{"content":"// Path: /Users/alextoska/Desktop/CaregiversCommunity/server/storage.ts\nimport { withCache, invalidateCache, CacheKeys, CacheTTL, InvalidationPatterns } from \"./cache\";\n\n// Add these interfaces\nexport interface Activity {\n  id: number;\n  type: 'post' | 'comment';\n  title?: string;\n  content: string;\n  createdAt: Date;\n  categoryName?: string;\n}\n\nimport {\n  users,\n  posts,\n  comments,\n  categories,\n  votes,\n  achievements,\n  userAchievements,\n  expertVerifications,\n  postSources,\n  moderationResults,\n  searchPhrases,\n  consultations,\n  contentSources,\n  qaKnowledge,\n  userFavoriteContentSources,\n  userFavoritePosts,\n  expertAvailability,\n  appointments,\n  calendarIntegrations,\n  blockedTimeSlots,\n  notificationPreferences,\n  appointmentReviews,\n  type User,\n  type UserRole,\n  type UpsertUser,\n  type Post,\n  type PostWithAuthorAndCategory,\n  type PostWithExpertInfo,\n  type Comment,\n  type CommentWithAuthor,\n  type Category,\n  type Vote,\n  type Achievement,\n  type UserAchievement,\n  type ExpertVerification,\n  type CalendarIntegration,\n  type InsertCalendarIntegration,\n  type BlockedTimeSlot,\n  type InsertBlockedTimeSlot,\n  type NotificationPreference,\n  type InsertNotificationPreference,\n  type AppointmentReview,\n  type InsertAppointmentReview,\n  type PostSource,\n  type ModerationResult,\n  type SearchPhrase,\n  type Consultation,\n  type ContentSource,\n  type InsertContentSource,\n  type QaKnowledge,\n  type InsertQaKnowledge,\n  searchLogs,\n  type SearchLog,\n  type InsertSearchLog,\n  type InsertPost,\n  emailVerificationTokens,\n  passwordResetTokens,\n  type EmailVerificationToken,\n  type InsertEmailVerificationToken,\n  type PasswordResetToken,\n  type InsertPasswordResetToken,\n  socialMediaEmbeds,\n  type SocialMediaEmbed,\n  type InsertSocialMediaEmbed,\n  type InsertComment,\n  type InsertCategory,\n  type InsertVote,\n  type InsertAchievement,\n  type InsertUserAchievement,\n  type InsertExpertVerification,\n  type InsertPostSource,\n  type InsertModerationResult,\n  type InsertSearchPhrase,\n  type InsertConsultation,\n  type ExpertAvailability,\n  type InsertExpertAvailability,\n  type Appointment,\n  type InsertAppointment,\n} from \"@shared/schema\";\n\n// Extend the base User type to include role\ntype UserWithRole = User & {\n  role: UserRole;\n};\nimport { db } from \"./db\";\nimport { TimezoneService } from \"./services/timezoneService\";\nimport { eq, desc, and, sql, count, or, ilike, gte, lte, lt, ne, like } from \"drizzle-orm\";\n\n// Date validation helper function\nfunction isValidDateFormat(date: string): boolean {\n  // Check YYYY-MM-DD format\n  const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n  if (!dateRegex.test(date)) {\n    return false;\n  }\n\n  // Check if date is actually valid\n  const parsedDate = new Date(date);\n  return parsedDate instanceof Date &&\n         !isNaN(parsedDate.getTime()) &&\n         parsedDate.toISOString().slice(0, 10) === date;\n}\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: UpsertUser): Promise<User>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUserStripeInfo(userId: string, stripeInfo: { customerId: string; subscriptionId: string }): Promise<User>;\n\n  // Category operations\n  getCategories(): Promise<Category[]>;\n  getCategoriesByLevel(level: number): Promise<Category[]>;\n  getCategoriesByParent(parentId: number): Promise<Category[]>;\n  getCategoryHierarchy(): Promise<any[]>;\n  getCategoryBySlug(slug: string): Promise<Category | undefined>;\n  createCategory(category: InsertCategory): Promise<Category>;\n  updateCategoryPostCount(categoryId: number): Promise<void>;\n\n  // Post operations\n  getPosts(categoryId?: number, limit?: number, offset?: number): Promise<PostWithAuthorAndCategory[]>;\n  getPostsByAuthor(authorId: string, limit?: number, offset?: number): Promise<PostWithAuthorAndCategory[]>;\n  getPost(id: number): Promise<PostWithAuthorAndCategory | undefined>;\n  createPost(post: InsertPost): Promise<Post>;\n  updatePostHelpfulVotes(postId: number, increment: number): Promise<void>;\n  updatePostCommentCount(postId: number, increment: number): Promise<void>;\n\n  // Comment operations\n  getCommentsByPost(postId: number): Promise<CommentWithAuthor[]>;\n  createComment(comment: InsertComment): Promise<Comment>;\n  updateCommentHelpfulVotes(commentId: number, increment: number): Promise<void>;\n\n  // Vote operations\n  getUserVote(userId: string, postId?: number, commentId?: number): Promise<Vote | undefined>;\n  createVote(vote: InsertVote): Promise<Vote>;\n  deleteVote(userId: string, postId?: number, commentId?: number): Promise<void>;\n\n  // Achievement operations\n  getAchievements(): Promise<Achievement[]>;\n  getUserAchievements(userId: string): Promise<(UserAchievement & { achievement: Achievement })[]>;\n  createUserAchievement(userAchievement: InsertUserAchievement): Promise<UserAchievement>;\n  checkAndAwardAchievements(userId: string): Promise<void>;\n\n  // Expert verification operations\n  getExpertVerification(userId: string): Promise<ExpertVerification | undefined>;\n  getVerifiedExperts(): Promise<(ExpertVerification & { user: User })[]>;\n  getAllExperts(): Promise<(ExpertVerification & { user: User })[]>;\n  getFeaturedExperts(): Promise<(ExpertVerification & { user: User })[]>;\n  createExpertVerification(verification: InsertExpertVerification): Promise<ExpertVerification>;\n  updateExpertVerification(id: number, updates: Partial<InsertExpertVerification>): Promise<ExpertVerification>;\n  getPendingExpertVerifications(): Promise<(ExpertVerification & { user: User })[]>;\n  updateExpertVerificationStatus(id: number, status: 'verified' | 'rejected', adminUserId: string): Promise<ExpertVerification>;\n\n  // Post source operations\n  getPostSource(postId: number): Promise<PostSource | undefined>;\n  createPostSource(source: InsertPostSource): Promise<PostSource>;\n\n  // Enhanced post operations with expert info\n  getPostsWithExpertInfo(categoryId?: number, limit?: number, offset?: number, sortBy?: 'hot' | 'new' | 'top'): Promise<PostWithExpertInfo[]>;\n  getPostWithExpertInfo(id: number): Promise<PostWithExpertInfo | undefined>;\n\n  // Analytics operations\n  getCommunityStats(): Promise<{\n    totalUsers: number;\n    totalPosts: number;\n    totalComments: number;\n    postsThisWeek: number;\n  }>;\n\n  // Moderation operations\n  getModerationResult(contentId: string): Promise<ModerationResult | undefined>;\n  createModerationResult(moderation: InsertModerationResult): Promise<ModerationResult>;\n  getModerationQueue(): Promise<(ModerationResult & { content: any })[]>;\n  updateModerationStatus(id: number, status: string, reviewedBy: string): Promise<void>;\n\n  // Consultation operations\n  createConsultation(consultation: InsertConsultation): Promise<Consultation>;\n  getUserConsultations(userId: string): Promise<Consultation[]>;\n  getExpertConsultations(expertId: string): Promise<Consultation[]>;\n  updateConsultationStatus(id: number, status: string): Promise<Consultation>;\n\n  // Search phrase operations\n  getSearchPhrases(): Promise<SearchPhrase[]>;\n  createSearchPhrase(phrase: InsertSearchPhrase): Promise<SearchPhrase>;\n  updateSearchPhrase(id: number, updates: Partial<InsertSearchPhrase>): Promise<SearchPhrase>;\n  deleteSearchPhrase(id: number): Promise<void>;\n\n  // Forum operations\n  getUserCreatedForums(userId: string): Promise<Category[]>;\n  searchForums(query: string): Promise<Category[]>;\n\n  // Appointment booking operations\n  getExpertAvailability(expertId: string): Promise<ExpertAvailability[]>;\n  createExpertAvailability(availability: InsertExpertAvailability): Promise<ExpertAvailability>;\n  getAvailableTimeSlots(expertId: string, date: string): Promise<string[]>;\n  createAppointment(appointment: InsertAppointment): Promise<Appointment>;\n  getAppointment(id: number): Promise<Appointment | undefined>;\n  getExpertAppointments(expertId: string): Promise<Appointment[]>;\n  getClientAppointments(clientId: string): Promise<Appointment[]>;\n  updateAppointmentStatus(id: number, status: string): Promise<Appointment>;\n\n  // Content Sources\n  getContentSources(): Promise<ContentSource[]>;\n  getAllContentSources(): Promise<ContentSource[]>;\n  getContentSourcesByCategory(categoryId: string): Promise<ContentSource[]>;\n  createContentSource(source: InsertContentSource): Promise<ContentSource>;\n  updateContentSource(id: number, source: Partial<InsertContentSource>): Promise<ContentSource | undefined>;\n  deleteContentSource(id: number): Promise<void>;\n  reorderContentSources(categoryId: string, sourceIds: number[]): Promise<void>;\n\n  // Q&A Knowledge operations\n  searchQaKnowledge(query: string): Promise<QaKnowledge[]>;\n  createQaKnowledge(qa: InsertQaKnowledge): Promise<QaKnowledge>;\n  getAllQaKnowledge(): Promise<QaKnowledge[]>;\n\n  // User favorite content source operations\n  getUserFavoriteContentSources(userId: string): Promise<ContentSource[]>;\n  toggleUserFavoriteContentSource(userId: string, contentSourceId: number): Promise<boolean>; // returns true if favorited, false if unfavorited\n  isContentSourceFavoritedByUser(userId: string, contentSourceId: number): Promise<boolean>;\n\n  // User favorite post operations\n  getUserFavoritePosts(userId: string): Promise<Post[]>;\n  toggleUserFavoritePost(userId: string, postId: number): Promise<boolean>; // returns true if favorited, false if unfavorited\n  isPostFavoritedByUser(userId: string, postId: number): Promise<boolean>;\n  getPostFavoriteCount(postId: number): Promise<number>;\n\n  // Email verification operations\n  createEmailVerificationToken(token: InsertEmailVerificationToken): Promise<EmailVerificationToken>;\n  getEmailVerificationToken(token: string): Promise<EmailVerificationToken | undefined>;\n  deleteEmailVerificationToken(token: string): Promise<void>;\n  verifyUserEmail(userId: string): Promise<void>;\n\n  // Password reset operations\n  createPasswordResetToken(token: InsertPasswordResetToken): Promise<PasswordResetToken>;\n  getPasswordResetToken(token: string): Promise<PasswordResetToken | undefined>;\n  deletePasswordResetToken(token: string): Promise<void>;\n  updateUserPassword(userId: string, hashedPassword: string): Promise<void>;\n\n  // User approval operations\n  getUnapprovedExperts(): Promise<User[]>;\n  approveUser(userId: string): Promise<User>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<UserWithRole | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user ? { ...user, role: user.role as UserRole } : undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<UserWithRole | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user ? { ...user, role: user.role as UserRole } : undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<UserWithRole | undefined> {\n    const [user] = await db.select().from(users).where(ilike(users.email, email));\n    return user ? { ...user, role: user.role as UserRole } : undefined;\n  }\n\n  async createUser(userData: UpsertUser): Promise<UserWithRole> {\n    const [newUser] = await db.insert(users).values({\n      ...userData,\n      role: (userData.role ?? 'user') as UserRole, // Use provided role or default to 'user'\n    }).returning();\n    return { ...newUser, role: newUser.role as UserRole };\n  }\n\n    async upsertUser(userData: UpsertUser): Promise<UserWithRole> {\n    const [user] = await db\n      .insert(users)\n      .values({\n        ...userData,\n        role: (userData.role ?? 'user') as UserRole, // Use provided role or default to 'user'\n      })\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          username: userData.username,\n          email: userData.email,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          communityName: userData.communityName,\n          profileImageUrl: userData.profileImageUrl,\n          defaultProfileType: userData.defaultProfileType,\n          city: userData.city,\n          state: userData.state,\n          introduction: userData.introduction,\n          role: (userData.role ?? 'user') as UserRole, // Include role in update as well\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return { ...user, role: user.role as UserRole };\n  }\n\n  async updateUserStripeInfo(userId: string, stripeInfo: { customerId: string; subscriptionId: string }): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({\n        stripeCustomerId: stripeInfo.customerId,\n        stripeSubscriptionId: stripeInfo.subscriptionId,\n        isPremium: true,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return { ...user, role: user.role as UserRole };\n  }\n\n  // Category operations\n  async getCategories(): Promise<Category[]> {\n    return await db.select().from(categories)\n      .orderBy(categories.level, categories.orderIndex, categories.name);\n  }\n\n  async getCategoriesByLevel(level: number): Promise<Category[]> {\n    if (level === 0) {\n      // For top-level forums, only show official ones with real post counts\n      const categoriesWithCounts = await db\n        .select({\n          id: categories.id,\n          name: categories.name,\n          createdAt: categories.createdAt,\n          description: categories.description,\n          slug: categories.slug,\n          color: categories.color,\n          icon: categories.icon,\n          postCount: sql<number>`count(${posts.id})`.as('postCount'),\n          parentId: categories.parentId,\n          level: categories.level,\n          orderIndex: categories.orderIndex,\n          isOfficial: categories.isOfficial,\n          createdBy: categories.createdBy,\n        })\n        .from(categories)\n        .leftJoin(posts, eq(categories.id, posts.categoryId))\n        .where(and(eq(categories.level, level), eq(categories.isOfficial, true)))\n        .groupBy(categories.id)\n        .orderBy(categories.orderIndex, categories.name);\n\n      return categoriesWithCounts;\n    } else {\n      // For subcategories, show all regardless of isOfficial status\n      return await db.select().from(categories)\n        .where(eq(categories.level, level))\n        .orderBy(categories.orderIndex, categories.name);\n    }\n  }\n\n  async getCategoriesByParent(parentId: number): Promise<Category[]> {\n    return await db.select().from(categories)\n      .where(eq(categories.parentId, parentId))\n      .orderBy(categories.orderIndex, categories.name);\n  }\n\n  async getCategoryHierarchy(): Promise<any[]> {\n    // Get categories with real post counts for each level\n    const categoriesWithCounts = await db\n      .select({\n        id: categories.id,\n        name: categories.name,\n        description: categories.description,\n        slug: categories.slug,\n        color: categories.color,\n        icon: categories.icon,\n        postCount: sql<number>`count(${posts.id})`.as('postCount'),\n        parentId: categories.parentId,\n        level: categories.level,\n        orderIndex: categories.orderIndex,\n        isOfficial: categories.isOfficial,\n        createdBy: categories.createdBy,\n      })\n      .from(categories)\n      .leftJoin(posts, eq(categories.id, posts.categoryId))\n      .groupBy(categories.id)\n      .orderBy(categories.level, categories.orderIndex, categories.name);\n\n    // Build hierarchy: General (0) -> Main (1) -> Subtopic (2)\n    const hierarchy: any[] = [];\n    const generalTopics = categoriesWithCounts.filter(cat => cat.level === 0);\n\n    for (const general of generalTopics) {\n      const mainTopics = categoriesWithCounts.filter(cat => cat.level === 1 && cat.parentId === general.id)\n        .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\n      const generalWithChildren = {\n        ...general,\n        children: mainTopics.map(main => ({\n          ...main,\n          children: categoriesWithCounts.filter(cat => cat.level === 2 && cat.parentId === main.id)\n            .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0))\n        }))\n      };\n      hierarchy.push(generalWithChildren);\n    }\n    console.log('hierarchy', hierarchy);\n    return hierarchy;\n  }\n\n  async getCategoryBySlug(slug: string): Promise<Category | undefined> {\n    const [category] = await db.select().from(categories).where(eq(categories.slug, slug));\n    return category;\n  }\n\n  async createCategory(category: InsertCategory): Promise<Category> {\n    const [newCategory] = await db.insert(categories).values(category).returning();\n    return newCategory;\n  }\n\n  async updateCategoryPostCount(categoryId: number): Promise<void> {\n    const [result] = await db\n      .select({ count: count() })\n      .from(posts)\n      .where(eq(posts.categoryId, categoryId));\n\n    await db\n      .update(categories)\n      .set({ postCount: result.count })\n      .where(eq(categories.id, categoryId));\n  }\n\n  // Post operations\n  async getPostsByAuthor(authorId: string, limit = 20, offset = 0): Promise<PostWithAuthorAndCategory[]> {\n    const result = await db\n      .select({\n        id: posts.id,\n        title: posts.title,\n        content: posts.content,\n        categoryId: posts.categoryId,\n        authorId: posts.authorId,\n        isResolved: posts.isResolved,\n        isSticky: posts.isSticky,\n        helpfulVotes: posts.helpfulVotes,\n        commentCount: posts.commentCount,\n        createdAt: posts.createdAt,\n        updatedAt: posts.updatedAt,\n        author: {\n          id: users.id,\n          firstName: users.firstName,\n          lastName: users.lastName,\n          email: users.email,\n          profileImageUrl: users.profileImageUrl,\n        },\n        category: {\n          id: categories.id,\n          name: categories.name,\n          description: categories.description,\n          slug: categories.slug,\n          color: categories.color,\n          postCount: categories.postCount,\n        },\n        source: {\n          id: postSources.id,\n          sourceType: postSources.sourceType,\n          sourceTitle: postSources.sourceTitle,\n          sourceUrl: postSources.sourceUrl,\n          publisher: postSources.publisher,\n        }\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .leftJoin(postSources, eq(posts.id, postSources.postId))\n      .where(eq(posts.authorId, authorId))\n      .orderBy(desc(posts.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    return result.map(post => ({\n      ...post,\n      author: { ...post.author, role: post.author.role as UserRole }\n    }));\n  }\n\n  async getPosts(categoryId?: number, limit = 20, offset = 0): Promise<PostWithAuthorAndCategory[]> {\n    const query = db\n      .select({\n        id: posts.id,\n        title: posts.title,\n        content: posts.content,\n        authorId: posts.authorId,\n        categoryId: posts.categoryId,\n        helpfulVotes: posts.helpfulVotes,\n        commentCount: posts.commentCount,\n        isResolved: posts.isResolved,\n        isSticky: posts.isSticky,\n        createdAt: posts.createdAt,\n        updatedAt: posts.updatedAt,\n        author: users,\n        category: categories,\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .orderBy(desc(posts.isSticky), desc(posts.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    const result = categoryId \n      ? await query.where(eq(posts.categoryId, categoryId))\n      : await query;\n\n    return result.map(post => ({\n      ...post,\n      author: { ...post.author, role: post.author.role as UserRole }\n    }));\n  }\n\n  async getPost(id: number): Promise<PostWithAuthorAndCategory | undefined> {\n    const [post] = await db\n      .select({\n        id: posts.id,\n        title: posts.title,\n        content: posts.content,\n        authorId: posts.authorId,\n        categoryId: posts.categoryId,\n        helpfulVotes: posts.helpfulVotes,\n        commentCount: posts.commentCount,\n        isResolved: posts.isResolved,\n        isSticky: posts.isSticky,\n        createdAt: posts.createdAt,\n        updatedAt: posts.updatedAt,\n        author: users,\n        category: categories,\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .where(eq(posts.id, id));\n    return post ? { ...post, author: { ...post.author, role: post.author.role as UserRole } } : undefined;\n  }\n\n  async createPost(post: InsertPost): Promise<Post> {\n    const [newPost] = await db.insert(posts).values(post).returning();\n    await this.updateCategoryPostCount(post.categoryId);\n    return newPost;\n  }\n\n  async updatePostHelpfulVotes(postId: number, increment: number): Promise<void> {\n    await db\n      .update(posts)\n      .set({ helpfulVotes: sql`${posts.helpfulVotes} + ${increment}` })\n      .where(eq(posts.id, postId));\n  }\n\n  async updatePostCommentCount(postId: number, increment: number): Promise<void> {\n    await db\n      .update(posts)\n      .set({ commentCount: sql`${posts.commentCount} + ${increment}` })\n      .where(eq(posts.id, postId));\n  }\n\n  // Comment operations\n  async getCommentsByPost(postId: number): Promise<CommentWithAuthor[]> {\n    return await db\n      .select({\n        id: comments.id,\n        content: comments.content,\n        authorId: comments.authorId,\n        postId: comments.postId,\n        parentId: comments.parentId,\n        helpfulVotes: comments.helpfulVotes,\n        isExpertResponse: comments.isExpertResponse,\n        createdAt: comments.createdAt,\n        updatedAt: comments.updatedAt,\n        author: users,\n      })\n      .from(comments)\n      .innerJoin(users, eq(comments.authorId, users.id))\n      .where(eq(comments.postId, postId))\n      .orderBy(comments.createdAt)\n      .then(results => results.map(comment => ({\n        ...comment,\n        author: { ...comment.author, role: comment.author.role as UserRole }\n      })));\n  }\n\n  async createComment(comment: InsertComment): Promise<Comment> {\n    const [newComment] = await db.insert(comments).values(comment).returning();\n    await this.updatePostCommentCount(comment.postId, 1);\n    return newComment;\n  }\n\n  async updateCommentHelpfulVotes(commentId: number, increment: number): Promise<void> {\n    await db\n      .update(comments)\n      .set({ helpfulVotes: sql`${comments.helpfulVotes} + ${increment}` })\n      .where(eq(comments.id, commentId));\n  }\n\n  // Vote operations\n  async getUserVote(userId: string, postId?: number, commentId?: number): Promise<Vote | undefined> {\n    const conditions = [eq(votes.userId, userId)];\n    \n    if (postId) {\n      conditions.push(eq(votes.postId, postId));\n    }\n    if (commentId) {\n      conditions.push(eq(votes.commentId, commentId));\n    }\n\n    const [vote] = await db.select().from(votes).where(and(...conditions));\n    return vote;\n  }\n\n  async createVote(vote: InsertVote): Promise<Vote> {\n    const [newVote] = await db.insert(votes).values(vote).returning();\n\n    // Update helpful votes count\n    if (vote.postId) {\n      await this.updatePostHelpfulVotes(vote.postId, 1);\n    }\n    if (vote.commentId) {\n      await this.updateCommentHelpfulVotes(vote.commentId, 1);\n    }\n\n    return newVote;\n  }\n\n  async deleteVote(userId: string, postId?: number, commentId?: number): Promise<void> {\n    const conditions = [eq(votes.userId, userId)];\n    \n    if (postId) {\n      conditions.push(eq(votes.postId, postId));\n      await this.updatePostHelpfulVotes(postId, -1);\n    }\n    if (commentId) {\n      conditions.push(eq(votes.commentId, commentId));\n      await this.updateCommentHelpfulVotes(commentId, -1);\n    }\n\n    await db.delete(votes).where(and(...conditions));\n  }\n\n  // Achievement operations\n  async getAchievements(): Promise<Achievement[]> {\n    return await db.select().from(achievements);\n  }\n\n  async getUserAchievements(userId: string): Promise<(UserAchievement & { achievement: Achievement })[]> {\n    return await db\n      .select({\n        id: userAchievements.id,\n        userId: userAchievements.userId,\n        achievementId: userAchievements.achievementId,\n        earnedAt: userAchievements.earnedAt,\n        achievement: achievements,\n      })\n      .from(userAchievements)\n      .innerJoin(achievements, eq(userAchievements.achievementId, achievements.id))\n      .where(eq(userAchievements.userId, userId))\n      .orderBy(desc(userAchievements.earnedAt));\n  }\n\n  async createUserAchievement(userAchievement: InsertUserAchievement): Promise<UserAchievement> {\n    const [newUserAchievement] = await db.insert(userAchievements).values(userAchievement).returning();\n    return newUserAchievement;\n  }\n\n  async checkAndAwardAchievements(userId: string): Promise<void> {\n    // Implementation for checking and awarding achievements based on user activity\n    // This would include logic for different badge criteria\n    const userVotes = await db\n      .select({ count: count() })\n      .from(votes)\n      .where(eq(votes.userId, userId));\n\n    const userPosts = await db\n      .select({ count: count() })\n      .from(posts)\n      .where(eq(posts.authorId, userId));\n\n    // Example: Award \"Welcome Wagon\" badge for helping new members\n    // Award \"Wisdom Keeper\" badge for 50+ helpful votes\n    // etc.\n  }\n\n  // Expert verification operations\n  async getExpertVerification(userId: string): Promise<ExpertVerification | undefined> {\n    const [verification] = await db\n      .select()\n      .from(expertVerifications)\n      .where(eq(expertVerifications.userId, userId));\n    return verification;\n  }\n\n  async getVerifiedExperts(): Promise<(ExpertVerification & { user: User })[]> {\n    const results = await db\n      .select({\n        expertVerification: expertVerifications,\n        user: users\n      })\n      .from(expertVerifications)\n      .innerJoin(users, eq(expertVerifications.userId, users.id))\n      .where(eq(expertVerifications.verificationStatus, \"verified\"))\n      .orderBy(desc(expertVerifications.verifiedAt));\n\n    return results.map(result => ({\n      ...result.expertVerification,\n      user: { ...result.user, role: result.user.role as UserRole }\n    }));\n  }\n\n  async getFeaturedExperts(): Promise<(ExpertVerification & { user: User })[]> {\n    const results = await db\n      .select({\n        expertVerification: expertVerifications,\n        user: users\n      })\n      .from(expertVerifications)\n      .innerJoin(users, eq(expertVerifications.userId, users.id))\n      .where(and(\n        eq(expertVerifications.verificationStatus, \"verified\"),\n        eq(expertVerifications.featuredExpert, true)\n      ))\n      .orderBy(desc(expertVerifications.verifiedAt));\n\n    return results.map(result => ({\n      ...result.expertVerification,\n      user: { ...result.user, role: result.user.role as UserRole }\n    }));\n  }\n\n  async getAllExperts(): Promise<(ExpertVerification & { user: User })[]> {\n    const results = await db\n      .select({\n        expertVerification: expertVerifications,\n        user: users\n      })\n      .from(users)\n      .leftJoin(expertVerifications, eq(users.id, expertVerifications.userId))\n      .where(eq(users.role, \"expert\"))\n      .orderBy(users.firstName, users.lastName);\n\n    return results.map(result => {\n      // Determine the correct verification status based on both approval and verification\n      let displayVerificationStatus: \"verified\" | \"pending\" | \"rejected\";\n      \n      if (result.user.approved === \"no\") {\n        // If user not approved by admin, always show as pending regardless of verification status\n        displayVerificationStatus = \"pending\";\n      } else if (result.user.approved === \"yes\" && result.expertVerification?.verificationStatus === \"verified\") {\n        // Only show as verified if both admin approved AND verification completed\n        displayVerificationStatus = \"verified\";\n      } else {\n        // Default to pending for all other cases\n        displayVerificationStatus = \"pending\";\n      }\n\n      // If they have expert verification data, return it in the expected format\n      if (result.expertVerification) {\n        return {\n          ...result.expertVerification,\n          verificationStatus: displayVerificationStatus, // Override with correct status\n          user: { ...result.user, role: result.user.role as UserRole }\n        };\n      } \n      // If no expert verification, create a basic structure with all required fields\n      else {\n        return {\n          id: null,\n          userId: result.user.id,\n          profession: \"Expert\",\n          credentials: null,\n          verificationStatus: displayVerificationStatus,\n          expertiseArea: null,\n          professionalTitle: null,\n          company: null,\n          bio: null,\n          yearsExperience: null,\n          licenseNumber: null,\n          featuredExpert: false,\n          consultationEnabled: false,\n          hourlyRate: null,\n          profileImageUrl: result.user.profileImageUrl,\n          verificationDocumentUrl: null,\n          verifiedAt: null,\n          createdAt: result.user.createdAt,\n          updatedAt: result.user.updatedAt,\n          user: { ...result.user, role: result.user.role as UserRole }\n        };\n      }\n    });\n  }\n\n  async createExpertVerification(verification: InsertExpertVerification): Promise<ExpertVerification> {\n    const [newVerification] = await db.insert(expertVerifications).values(verification).returning();\n    return newVerification;\n  }\n\n  async getPendingExpertVerifications(): Promise<(ExpertVerification & { user: User })[]> {\n    const results = await db\n      .select({\n        expertVerification: expertVerifications, // Selects all columns from expertVerifications\n        user: users\n      })\n      .from(expertVerifications)\n      .innerJoin(users, eq(expertVerifications.userId, users.id))\n      .where(eq(expertVerifications.verificationStatus, \"pending\"))\n      .orderBy(desc(expertVerifications.createdAt));\n\n    return results.map(result => ({\n      ...result.expertVerification,\n      user: { ...result.user, role: result.user.role as UserRole }\n    }));\n  }\n\n  async updateExpertVerification(id: number, updates: Partial<InsertExpertVerification>): Promise<ExpertVerification> {\n    const [updated] = await db\n      .update(expertVerifications)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(expertVerifications.id, id))\n      .returning();\n    return updated;\n  }\n\n  async updateExpertVerificationStatus(id: number, status: 'verified' | 'rejected', adminUserId: string): Promise<ExpertVerification> {\n    const [verified] = await db\n      .update(expertVerifications)\n      .set({\n        verificationStatus: status,\n        verifiedAt: status === 'verified' ? new Date() : null,\n        verifiedBy: adminUserId,\n        updatedAt: new Date()\n      })\n      .where(eq(expertVerifications.id, id))\n      .returning();\n\n    if (!verified) {\n      throw new Error(`Expert verification with ID ${id} not found.`);\n    }\n\n    // Update the user's role and premium status based on verification outcome\n    if (status === 'verified') {\n      await db\n        .update(users)\n        .set({ isPremium: true, role: 'expert' })\n        .where(eq(users.id, verified.userId));\n    } else if (status === 'rejected') {\n      // Revert role to 'user' and set isPremium to false upon rejection\n      await db\n        .update(users)\n        .set({ isPremium: false, role: 'user' }) // Demote role upon rejection\n        .where(eq(users.id, verified.userId));\n    }\n\n    return verified;\n  }\n\n  // Post source operations\n  async getPostSource(postId: number): Promise<PostSource | undefined> {\n    const [source] = await db\n      .select()\n      .from(postSources)\n      .where(eq(postSources.postId, postId));\n    return source;\n  }\n\n  async createPostSource(source: InsertPostSource): Promise<PostSource> {\n    const [newSource] = await db.insert(postSources).values(source).returning();\n    return newSource;\n  }\n\n  // Enhanced post operations with expert info\n  async getPostsWithExpertInfo(categoryId?: number, limit = 20, offset = 0, sortBy: 'hot' | 'new' | 'top' = 'hot'): Promise<PostWithExpertInfo[]> {\n    let query = db\n      .select({\n        post: posts,\n        author: users,\n        category: categories,\n        source: postSources,\n        expertVerification: expertVerifications,\n        authorPostCount: sql<number>`(SELECT COUNT(*) FROM posts WHERE author_id = ${users.id})`,\n        favoriteCount: sql<number>`(SELECT COUNT(*) FROM user_favorite_posts WHERE post_id = ${posts.id})`,\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .leftJoin(postSources, eq(posts.id, postSources.postId))\n      .leftJoin(expertVerifications, and(\n        eq(users.id, expertVerifications.userId),\n        eq(expertVerifications.verificationStatus, \"verified\")\n      ));\n\n    if (categoryId) {\n      query = query.where(eq(posts.categoryId, categoryId));\n    }\n\n    // Apply sorting based on sortBy parameter\n    if (sortBy === 'new') {\n      query = query.orderBy(desc(posts.createdAt));\n    } else if (sortBy === 'top') {\n      // Sort by favorite count descending, then by created date\n      query = query.orderBy(desc(sql`(SELECT COUNT(*) FROM user_favorite_posts WHERE post_id = ${posts.id})`), desc(posts.createdAt));\n    } else {\n      // 'hot' - default sorting by recent activity and engagement\n      query = query.orderBy(desc(posts.createdAt));\n    }\n\n    query = query.limit(limit).offset(offset);\n\n    const results = await query;\n\n    return results.map(row => ({\n      ...row.post,\n      author: { ...row.author, role: row.author.role as UserRole },\n      category: row.category,\n      source: row.source || undefined,\n      expertVerification: row.expertVerification || undefined,\n      authorPostCount: row.authorPostCount,\n      favoriteCount: row.favoriteCount,\n    }));\n  }\n\n  async getPostWithExpertInfo(id: number): Promise<PostWithExpertInfo | undefined> {\n    const [result] = await db\n      .select({\n        post: posts,\n        author: users,\n        category: categories,\n        source: postSources,\n        expertVerification: expertVerifications,\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .leftJoin(postSources, eq(posts.id, postSources.postId))\n      .leftJoin(expertVerifications, and(\n        eq(users.id, expertVerifications.userId),\n        eq(expertVerifications.verificationStatus, \"verified\")\n      ))\n      .where(eq(posts.id, id));\n\n    if (!result) return undefined;\n\n    return {\n      ...result.post,\n      author: { ...result.author, role: result.author.role as UserRole },\n      category: result.category,\n      source: result.source || undefined,\n      expertVerification: result.expertVerification || undefined,\n    };\n  }\n\n  async searchPosts(searchQuery: string, limit = 20, offset = 0): Promise<PostWithExpertInfo[]> {\n    const searchTerm = `%${searchQuery}%`;\n    \n    // First, find matching post IDs from posts and comments\n    const matchingPostIds = await db\n      .selectDistinct({ postId: posts.id })\n      .from(posts)\n      .leftJoin(comments, eq(posts.id, comments.postId))\n      .leftJoin(categories, eq(posts.categoryId, categories.id))\n      .where(\n        or(\n          ilike(posts.title, searchTerm),\n          ilike(posts.content, searchTerm),\n          ilike(comments.content, searchTerm),\n          ilike(categories.name, searchTerm)\n        )\n      );\n\n    // If no matches found, return empty array\n    if (matchingPostIds.length === 0) {\n      return [];\n    }\n\n    const postIds = matchingPostIds.map(p => p.postId);\n\n    // Fetch full post details with expert info and favorite count\n    const results = await db\n      .select({\n        post: posts,\n        author: users,\n        category: categories,\n        source: postSources,\n        expertVerification: expertVerifications,\n        authorPostCount: sql<number>`COUNT(DISTINCT p2.id) FILTER (WHERE p2.created_at >= NOW() - INTERVAL '365 days')`,\n        favoriteCount: sql<number>`COUNT(DISTINCT ufp.user_id)`,\n      })\n      .from(posts)\n      .innerJoin(users, eq(posts.authorId, users.id))\n      .innerJoin(categories, eq(posts.categoryId, categories.id))\n      .leftJoin(postSources, eq(posts.id, postSources.postId))\n      .leftJoin(expertVerifications, and(\n        eq(users.id, expertVerifications.userId),\n        eq(expertVerifications.verificationStatus, \"verified\")\n      ))\n      .leftJoin(sql`posts p2`, sql`p2.author_id = ${users.id}`)\n      .leftJoin(sql`user_favorite_posts ufp`, sql`ufp.post_id = ${posts.id}`)\n      .where(sql`${posts.id} IN (${sql.join(postIds.map(id => sql`${id}`), sql`, `)})`)\n      .groupBy(\n        posts.id,\n        users.id,\n        categories.id,\n        postSources.id,\n        expertVerifications.id\n      )\n      .orderBy(desc(posts.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    return results.map(row => ({\n      ...row.post,\n      author: { ...row.author, role: row.author.role as UserRole },\n      category: row.category,\n      source: row.source || undefined,\n      expertVerification: row.expertVerification || undefined,\n      authorPostCount: row.authorPostCount,\n      favoriteCount: row.favoriteCount,\n    }));\n  }\n\n  // Analytics operations\n  async getCommunityStats(): Promise<{\n    totalUsers: number;\n    totalPosts: number;\n    totalComments: number;\n    postsThisWeek: number;\n  }> {\n    const weekAgo = new Date();\n    weekAgo.setDate(weekAgo.getDate() - 7);\n\n    const [userCount] = await db.select({ count: count() }).from(users);\n    const [postCount] = await db.select({ count: count() }).from(posts);\n    const [commentCount] = await db.select({ count: count() }).from(comments);\n    const [weeklyPostCount] = await db\n      .select({ count: count() })\n      .from(posts)\n      .where(sql`${posts.createdAt} >= ${weekAgo}`);\n\n    return {\n      totalUsers: userCount.count,\n      totalPosts: postCount.count,\n      totalComments: commentCount.count,\n      postsThisWeek: weeklyPostCount.count,\n    };\n  }\n\n  // Moderation operations\n  async getModerationResult(contentId: string): Promise<ModerationResult | undefined> {\n    const [result] = await db\n      .select()\n      .from(moderationResults)\n      .where(eq(moderationResults.contentId, contentId))\n      .orderBy(desc(moderationResults.createdAt))\n      .limit(1);\n    return result;\n  }\n\n  async createModerationResult(moderation: InsertModerationResult): Promise<ModerationResult> {\n    const [result] = await db\n      .insert(moderationResults)\n      .values(moderation)\n      .returning();\n    return result;\n  }\n\n  async getModerationQueue(): Promise<(ModerationResult & { content: any })[]> {\n    const flaggedContent = await db\n      .select()\n      .from(moderationResults)\n      .where(eq(moderationResults.moderationStatus, \"flagged\"))\n      .orderBy(desc(moderationResults.createdAt));\n\n    // Add content details for each moderation result\n    const contentWithDetails = await Promise.all(\n      flaggedContent.map(async (mod) => {\n        let content = null;\n\n        if (mod.contentType === \"post\") {\n          const [post] = await db\n            .select()\n            .from(posts)\n            .where(eq(posts.id, parseInt(mod.contentId)))\n            .limit(1);\n          content = post;\n        } else if (mod.contentType === \"comment\") {\n          const [comment] = await db\n            .select()\n            .from(comments)\n            .where(eq(comments.id, parseInt(mod.contentId)))\n            .limit(1);\n          content = comment;\n        }\n\n        return { ...mod, content };\n      })\n    );\n\n    return contentWithDetails;\n  }\n\n  async updateModerationStatus(id: number, status: string, reviewedBy: string): Promise<void> {\n    await db\n      .update(moderationResults)\n      .set({\n        moderationStatus: status,\n        reviewedBy,\n        reviewedAt: new Date(),\n      })\n      .where(eq(moderationResults.id, id));\n  }\n\n  // Consultation operations\n  async createConsultation(consultation: InsertConsultation): Promise<Consultation> {\n    const [newConsultation] = await db.insert(consultations).values(consultation).returning();\n    return newConsultation;\n  }\n\n  async getUserConsultations(userId: string): Promise<any[]> {\n    const userConsultations = await db\n      .select({\n        id: consultations.id,\n        expertId: consultations.expertId,\n        clientId: consultations.clientId,\n        scheduledAt: consultations.scheduledAt,\n        duration: consultations.duration,\n        rate: consultations.rate,\n        totalAmount: consultations.totalAmount,\n        paymentStatus: consultations.paymentStatus,\n        bookingStatus: consultations.bookingStatus,\n        notes: consultations.notes,\n        createdAt: consultations.createdAt,\n        updatedAt: consultations.updatedAt,\n        expert: {\n          id: users.id,\n          name: users.username,\n          firstName: users.firstName,\n          lastName: users.lastName,\n        }\n      })\n      .from(consultations)\n      .leftJoin(users, eq(consultations.expertId, users.id))\n      .where(eq(consultations.clientId, userId))\n      .orderBy(desc(consultations.scheduledAt));\n    return userConsultations;\n  }\n\n  async getExpertConsultations(expertId: string): Promise<Consultation[]> {\n    const expertConsultations = await db\n      .select()\n      .from(consultations)\n      .where(eq(consultations.expertId, expertId))\n      .orderBy(desc(consultations.scheduledAt));\n    return expertConsultations;\n  }\n\n  async updateConsultationStatus(id: number, status: string): Promise<Consultation> {\n    const [updatedConsultation] = await db\n      .update(consultations)\n      .set({\n        bookingStatus: status,\n        updatedAt: new Date()\n      })\n      .where(eq(consultations.id, id))\n      .returning();\n    return updatedConsultation;\n  }\n\n  // Search phrase operations\n  async getSearchPhrases(): Promise<SearchPhrase[]> {\n    try {\n      return await db\n        .select()\n        .from(searchPhrases)\n        .where(eq(searchPhrases.isActive, true))\n        .orderBy(searchPhrases.orderIndex, searchPhrases.createdAt);\n    } catch (error) {\n      console.error('Error fetching search phrases:', error);\n      throw error;\n    }\n  }\n\n  async createSearchPhrase(phrase: InsertSearchPhrase): Promise<SearchPhrase> {\n    // Auto-format phrase to start with \"Edith, \" and lowercase\n    let formattedPhrase = phrase.phrase.trim();\n\n    // Remove existing \"Edith, \" if present\n    if (formattedPhrase.toLowerCase().startsWith('edith, ')) {\n      formattedPhrase = formattedPhrase.substring(7);\n    }\n\n    // Ensure first letter is lowercase\n    if (formattedPhrase.length > 0) {\n      formattedPhrase = formattedPhrase.charAt(0).toLowerCase() + formattedPhrase.slice(1);\n    }\n\n    // Add \"Edith, \" prefix\n    formattedPhrase = 'Edith, ' + formattedPhrase;\n\n    const [newPhrase] = await db\n      .insert(searchPhrases)\n      .values({ ...phrase, phrase: formattedPhrase })\n      .returning();\n\n    // await invalidateCache([CacheKeys.searchPhrases]);\n    return newPhrase;\n  }\n\n  async updateSearchPhrase(id: number, updates: Partial<InsertSearchPhrase>): Promise<SearchPhrase> {\n    // Auto-format phrase if being updated\n    if (updates.phrase) {\n      let formattedPhrase = updates.phrase.trim();\n\n      // Remove existing \"Edith, \" if present\n      if (formattedPhrase.toLowerCase().startsWith('edith, ')) {\n        formattedPhrase = formattedPhrase.substring(7);\n      }\n\n      // Ensure first letter is lowercase\n      if (formattedPhrase.length > 0) {\n        formattedPhrase = formattedPhrase.charAt(0).toLowerCase() + formattedPhrase.slice(1);\n      }\n\n      // Add \"Edith, \" prefix\n      updates.phrase = 'Edith, ' + formattedPhrase;\n    }\n\n    const [updatedPhrase] = await db\n      .update(searchPhrases)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(searchPhrases.id, id))\n      .returning();\n\n    // await invalidateCache([CacheKeys.searchPhrases]);\n    return updatedPhrase;\n  }\n\n  async deleteSearchPhrase(id: number): Promise<void> {\n    await db\n      .delete(searchPhrases)\n      .where(eq(searchPhrases.id, id));\n\n    // await invalidateCache([CacheKeys.searchPhrases]);\n  }\n\n  // Forum operations\n  async getUserCreatedForums(userId: string): Promise<Category[]> {\n    return await db\n      .select()\n      .from(categories)\n      .where(eq(categories.createdBy, userId))\n      .orderBy(desc(categories.createdAt));\n  }\n\n  async searchForums(query: string): Promise<Category[]> {\n    return await db\n      .select()\n      .from(categories)\n      .where(\n        or(\n          ilike(categories.name, `%${query}%`),\n          ilike(categories.description, `%${query}%`)\n        )\n      )\n      .orderBy(categories.name);\n  }\n\n  // Appointment booking operations\n  async getExpertAvailability(expertId: string): Promise<ExpertAvailability[]> {\n    return await db\n      .select()\n      .from(expertAvailability)\n      .where(and(\n        eq(expertAvailability.expertId, expertId),\n        eq(expertAvailability.isActive, true)\n      ))\n      .orderBy(expertAvailability.dayOfWeek, expertAvailability.startTime);\n  }\n\n  async createExpertAvailability(availability: InsertExpertAvailability): Promise<ExpertAvailability> {\n    const [newAvailability] = await db\n      .insert(expertAvailability)\n      .values(availability)\n      .returning();\n    return newAvailability;\n  }\n\n\n  async createAppointment(appointment: InsertAppointment): Promise<Appointment> {\n    const [newAppointment] = await db\n      .insert(appointments)\n      .values(appointment)\n      .returning();\n    return newAppointment;\n  }\n\n  async getAppointment(id: number): Promise<Appointment | undefined> {\n    const [appointment] = await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.id, id));\n    return appointment;\n  }\n\n  async getExpertAppointments(expertId: string): Promise<Appointment[]> {\n    return await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.expertId, expertId))\n      .orderBy(desc(appointments.scheduledAt));\n  }\n\n  async getClientAppointments(clientId: string): Promise<Appointment[]> {\n    return await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.clientId, clientId))\n      .orderBy(desc(appointments.scheduledAt));\n  }\n\n  async updateAppointmentStatus(id: number, status: string): Promise<Appointment> {\n    const [updatedAppointment] = await db\n      .update(appointments)\n      .set({ status, updatedAt: new Date() })\n      .where(eq(appointments.id, id))\n      .returning();\n    return updatedAppointment;\n  }\n\n  // VOTING SYSTEM METHODS\n  async updateVote(voteId: number, voteType: string): Promise<Vote> {\n    const [vote] = await db.update(votes)\n      .set({ voteType })\n      .where(eq(votes.id, voteId))\n      .returning();\n    return vote;\n  }\n\n  async updatePostVoteCount(postId: number, change: number): Promise<void> {\n    await db.update(posts)\n      .set({\n        helpfulVotes: sql`GREATEST(0, ${posts.helpfulVotes} + ${change})`\n      })\n      .where(eq(posts.id, postId));\n  }\n\n  async updateCommentVoteCount(commentId: number, change: number): Promise<void> {\n    await db.update(comments)\n      .set({\n        helpfulVotes: sql`GREATEST(0, ${comments.helpfulVotes} + ${change})`\n      })\n      .where(eq(comments.id, commentId));\n  }\n\n  // ACHIEVEMENT SYSTEM METHODS\n  async getAchievementByName(name: string): Promise<Achievement | undefined> {\n    const [achievement] = await db.select().from(achievements).where(eq(achievements.name, name));\n    return achievement;\n  }\n\n  async getUserVotesReceived(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: count() })\n      .from(votes)\n      .leftJoin(posts, eq(votes.postId, posts.id))\n      .leftJoin(comments, eq(votes.commentId, comments.id))\n      .where(\n        and(\n          eq(votes.voteType, 'up'),\n          or(\n            eq(posts.authorId, userId),\n            eq(comments.authorId, userId)\n          )\n        )\n      );\n    return result[0]?.count || 0;\n  }\n\n  // USER ACTIVITY METHODS\n  async getUserActivity(userId: string, limit: number = 20, offset: number = 0): Promise<Activity[]> {\n    // Get user's posts\n    const userPosts = await db\n      .select({\n        id: posts.id,\n        type: sql<'post'>`'post'`,\n        title: posts.title,\n        content: posts.content,\n        createdAt: posts.createdAt,\n        categoryName: categories.name\n      })\n      .from(posts)\n      .leftJoin(categories, eq(posts.categoryId, categories.id))\n      .where(eq(posts.authorId, userId))\n      .orderBy(desc(posts.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    // Get user's comments\n    const userComments = await db\n      .select({\n        id: comments.id,\n        type: sql<'comment'>`'comment'`,\n        title: sql<string | null>`NULL`,\n        content: comments.content,\n        createdAt: comments.createdAt,\n        categoryName: sql<string | null>`NULL`\n      })\n      .from(comments)\n      .where(eq(comments.authorId, userId))\n      .orderBy(desc(comments.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    // Combine and sort by date\n    const allActivity = [...userPosts, ...userComments]\n      .sort((a, b) => new Date(b.createdAt || 0).getTime() - new Date(a.createdAt || 0).getTime())\n      .slice(0, limit);\n\n    return allActivity as Activity[];\n  }\n\n\n  // USER PROFILE METHODS\n  async updateUser(userId: string, updates: Partial<User>): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return { ...user, role: user.role as UserRole };\n  }\n\n  async getUserStats(userId: string): Promise<{\n    postCount: number;\n    commentCount: number;\n    votesReceived: number;\n    achievementCount: number;\n    forumsCreated: number;\n  }> {\n    const postCount = await db\n      .select({ count: count() })\n      .from(posts)\n      .where(eq(posts.authorId, userId));\n\n    const commentCount = await db\n      .select({ count: count() })\n      .from(comments)\n      .where(eq(comments.authorId, userId));\n\n    const votesReceived = await this.getUserVotesReceived(userId);\n\n    const achievementCount = await db\n      .select({ count: count() })\n      .from(userAchievements)\n      .where(eq(userAchievements.userId, userId));\n\n    const forumsCreated = await db\n      .select({ count: count() })\n      .from(categories)\n      .where(eq(categories.createdBy, userId));\n\n    return {\n      postCount: postCount[0]?.count || 0,\n      commentCount: commentCount[0]?.count || 0,\n      votesReceived,\n      achievementCount: achievementCount[0]?.count || 0,\n      forumsCreated: forumsCreated[0]?.count || 0\n    };\n  }\n\n  async getUserDashboardStats(userId: string): Promise<{\n    postsCreated: number;\n    helpfulVotes: number;\n    commentsPosted: number;\n    daysActive: number;\n  }> {\n    // Get posts created by user\n    const postCount = await db\n      .select({ count: count() })\n      .from(posts)\n      .where(eq(posts.authorId, userId));\n\n    // Get comments posted by user\n    const commentCount = await db\n      .select({ count: count() })\n      .from(comments)\n      .where(eq(comments.authorId, userId));\n\n    // Get helpful votes received by user (on their posts and comments)\n    const postVotes = await db\n      .select({ totalVotes: sql<number>`SUM(${posts.helpfulVotes})` })\n      .from(posts)\n      .where(eq(posts.authorId, userId));\n\n    const commentVotes = await db\n      .select({ totalVotes: sql<number>`SUM(${comments.helpfulVotes})` })\n      .from(comments)\n      .where(eq(comments.authorId, userId));\n\n    const postVotesTotal = postVotes[0]?.totalVotes || 0;\n    const commentVotesTotal = commentVotes[0]?.totalVotes || 0;\n    const totalHelpfulVotes = postVotesTotal + commentVotesTotal;\n\n    // Calculate days active (days since account creation)\n    const user = await this.getUser(userId);\n    const daysActive = user?.createdAt\n      ? Math.floor((Date.now() - new Date(user.createdAt).getTime()) / (1000 * 60 * 60 * 24))\n      : 0;\n\n    return {\n      postsCreated: postCount[0]?.count || 0,\n      helpfulVotes: totalHelpfulVotes,\n      commentsPosted: commentCount[0]?.count || 0,\n      daysActive\n    };\n  }\n\n  // CALENDAR INTEGRATION METHODS\n  async createOrUpdateCalendarIntegration(data: InsertCalendarIntegration): Promise<CalendarIntegration> {\n    // Check if integration already exists\n    const existing = await this.getCalendarIntegration(data.expertId);\n\n    if (existing) {\n      // Update existing integration\n      const [updated] = await db\n        .update(calendarIntegrations)\n        .set({\n          ...data,\n          updatedAt: new Date(),\n        })\n        .where(eq(calendarIntegrations.expertId, data.expertId))\n        .returning();\n      return updated;\n    } else {\n      // Create new integration\n      const [created] = await db\n        .insert(calendarIntegrations)\n        .values(data)\n        .returning();\n      return created;\n    }\n  }\n\n  async getCalendarIntegration(expertId: string): Promise<CalendarIntegration | null> {\n    const [integration] = await db\n      .select()\n      .from(calendarIntegrations)\n      .where(and(\n        eq(calendarIntegrations.expertId, expertId),\n        eq(calendarIntegrations.isActive, true)\n      ));\n    return integration || null;\n  }\n\n  async updateCalendarIntegration(\n    integrationId: number,\n    updates: Partial<CalendarIntegration>\n  ): Promise<CalendarIntegration> {\n    const [updated] = await db\n      .update(calendarIntegrations)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(calendarIntegrations.id, integrationId))\n      .returning();\n    return updated;\n  }\n\n  // BLOCKED TIME SLOTS METHODS\n  async createBlockedTimeSlot(data: InsertBlockedTimeSlot): Promise<BlockedTimeSlot> {\n    const [created] = await db\n      .insert(blockedTimeSlots)\n      .values(data)\n      .returning();\n    return created;\n  }\n\n  async getBlockedTimeSlots(\n    expertId: string,\n    startDate: Date,\n    endDate: Date\n  ): Promise<BlockedTimeSlot[]> {\n    return await db\n      .select()\n      .from(blockedTimeSlots)\n      .where(and(\n        eq(blockedTimeSlots.expertId, expertId),\n        lte(blockedTimeSlots.startDateTime, endDate),\n        gte(blockedTimeSlots.endDateTime, startDate)\n      ))\n      .orderBy(blockedTimeSlots.startDateTime);\n  }\n\n  async deleteBlockedTimeSlot(slotId: number): Promise<void> {\n    await db\n      .delete(blockedTimeSlots)\n      .where(eq(blockedTimeSlots.id, slotId));\n  }\n\n  // NOTIFICATION PREFERENCES METHODS\n  async createOrUpdateNotificationPreferences(\n    data: InsertNotificationPreference\n  ): Promise<NotificationPreference> {\n    const existing = await this.getNotificationPreferences(data.userId);\n\n    if (existing) {\n      const [updated] = await db\n        .update(notificationPreferences)\n        .set({\n          ...data,\n          updatedAt: new Date(),\n        })\n        .where(eq(notificationPreferences.userId, data.userId))\n        .returning();\n      return updated;\n    } else {\n      const [created] = await db\n        .insert(notificationPreferences)\n        .values(data)\n        .returning();\n      return created;\n    }\n  }\n\n  async getNotificationPreferences(userId: string): Promise<NotificationPreference | null> {\n    const [preferences] = await db\n      .select()\n      .from(notificationPreferences)\n      .where(eq(notificationPreferences.userId, userId));\n    return preferences || null;\n  }\n\n  // APPOINTMENT REVIEWS METHODS\n  async createAppointmentReview(data: InsertAppointmentReview): Promise<AppointmentReview> {\n    const [created] = await db\n      .insert(appointmentReviews)\n      .values(data)\n      .returning();\n    return created;\n  }\n\n  async getAppointmentReviews(appointmentId: number): Promise<AppointmentReview[]> {\n    return await db\n      .select()\n      .from(appointmentReviews)\n      .where(eq(appointmentReviews.appointmentId, appointmentId))\n      .orderBy(desc(appointmentReviews.createdAt));\n  }\n\n  async getExpertReviews(expertId: string, limit = 10): Promise<AppointmentReview[]> {\n    return await db\n      .select()\n      .from(appointmentReviews)\n      .where(and(\n        eq(appointmentReviews.revieweeId, expertId),\n        eq(appointmentReviews.isPublic, true)\n      ))\n      .orderBy(desc(appointmentReviews.createdAt))\n      .limit(limit);\n  }\n\n  // ENHANCED APPOINTMENT METHODS\n  async getAppointmentById(appointmentId: number): Promise<Appointment | null> {\n    const [appointment] = await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.id, appointmentId));\n    return appointment || null;\n  }\n\n  async updateAppointment(appointmentId: number, updates: Partial<Appointment>): Promise<Appointment> {\n    const [updated] = await db\n      .update(appointments)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(appointments.id, appointmentId))\n      .returning();\n    return updated;\n  }\n\n  async getAvailableTimeSlots(expertId: string, date: string): Promise<string[]> {\n    const targetDate = new Date(date);\n    const dayOfWeek = targetDate.getDay();\n\n    // Get expert's availability for this day\n    const availability = await db\n      .select()\n      .from(expertAvailability)\n      .where(and(\n        eq(expertAvailability.expertId, expertId),\n        eq(expertAvailability.dayOfWeek, dayOfWeek),\n        eq(expertAvailability.isActive, true)\n      ));\n\n    if (availability.length === 0) {\n      return [];\n    }\n\n    // Get existing appointments for this date\n    const startOfDay = new Date(targetDate);\n    startOfDay.setHours(0, 0, 0, 0);\n    const endOfDay = new Date(targetDate);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    const existingAppointments = await db\n      .select()\n      .from(appointments)\n      .where(and(\n        eq(appointments.expertId, expertId),\n        gte(appointments.scheduledAt, startOfDay),\n        lte(appointments.scheduledAt, endOfDay),\n        ne(appointments.status, 'cancelled')\n      ));\n\n    // Get blocked time slots for this date\n    const blockedSlots = await this.getBlockedTimeSlots(expertId, startOfDay, endOfDay);\n\n    // Generate available time slots based on availability, appointments, and blocked slots\n    const slots: string[] = [];\n\n    for (const avail of availability) {\n      const [startHour, startMinute] = avail.startTime.split(':').map(Number);\n      const [endHour, endMinute] = avail.endTime.split(':').map(Number);\n\n      const startTime = startHour * 60 + startMinute; // Convert to minutes\n      const endTime = endHour * 60 + endMinute;\n\n      // Generate 60-minute slots (can be made configurable)\n      for (let time = startTime; time < endTime; time += 60) {\n        const slotStart = new Date(targetDate);\n        slotStart.setHours(Math.floor(time / 60), time % 60, 0, 0);\n\n        const slotEnd = new Date(slotStart);\n        slotEnd.setHours(slotEnd.getHours() + 1); // 1-hour slot\n\n        // Check if slot conflicts with existing appointments\n        const hasAppointmentConflict = existingAppointments.some(apt => {\n          const aptStart = new Date(apt.scheduledAt);\n          const aptEnd = new Date(aptStart.getTime() + apt.duration * 60 * 1000);\n          return (slotStart < aptEnd && slotEnd > aptStart);\n        });\n\n        // Check if slot conflicts with blocked time\n        const hasBlockedConflict = blockedSlots.some(blocked => {\n          const blockedStart = new Date(blocked.startDateTime);\n          const blockedEnd = new Date(blocked.endDateTime);\n          return (slotStart < blockedEnd && slotEnd > blockedStart);\n        });\n\n        // Only add slot if no conflicts and it's in the future\n        if (!hasAppointmentConflict && !hasBlockedConflict && slotStart > new Date()) {\n          slots.push(slotStart.toISOString());\n        }\n      }\n    }\n\n    return slots.sort();\n  }\n\n  // TIMEZONE-AWARE AVAILABILITY METHODS\n  async getAvailableTimeSlotsWithTimezone(\n    expertId: string,\n    date: string, // YYYY-MM-DD in client timezone\n    clientTimezone: string\n  ): Promise<{\n    time: string; // Time in client timezone (HH:MM)\n    utcTime: string; // ISO string for booking\n    displayTime: string; // Formatted display time\n  }[]> {\n    // Get expert's timezone\n    const expert = await this.getUser(expertId);\n    if (!expert) throw new Error('Expert not found');\n\n    const expertTimezone = expert.timezone || 'UTC';\n\n    // Convert client date to expert's timezone to get correct day of week\n    const clientDate = new Date(`${date}T12:00:00`);\n\n    // Get day of week in expert's timezone\n    const expertLocalDate = new Date(clientDate.toLocaleString(\"en-US\", { timeZone: expertTimezone }));\n    const dayOfWeek = expertLocalDate.getDay();\n\n    // Get expert's availability for this day\n    const availability = await db\n      .select()\n      .from(expertAvailability)\n      .where(and(\n        eq(expertAvailability.expertId, expertId),\n        eq(expertAvailability.dayOfWeek, dayOfWeek),\n        eq(expertAvailability.isActive, true)\n      ));\n\n    if (availability.length === 0) {\n      return [];\n    }\n\n    // Generate time slots\n    const slots: { time: string; utcTime: string; displayTime: string }[] = [];\n\n    for (const avail of availability) {\n      const [startHour, startMinute] = avail.startTime.split(':').map(Number);\n      const [endHour, endMinute] = avail.endTime.split(':').map(Number);\n\n      const startMinutes = startHour * 60 + startMinute;\n      const endMinutes = endHour * 60 + endMinute;\n\n      // Generate 30-minute slots\n      for (let minutes = startMinutes; minutes < endMinutes; minutes += 30) {\n        const slotHour = Math.floor(minutes / 60);\n        const slotMinute = minutes % 60;\n        const expertLocalTime = `${slotHour.toString().padStart(2, '0')}:${slotMinute.toString().padStart(2, '0')}`;\n\n        // Create datetime in expert's timezone\n        const expertDateStr = expertLocalDate.toISOString().split('T')[0];\n        const expertDateTime = new Date(`${expertDateStr}T${expertLocalTime}:00`);\n\n        // Convert to UTC for storage\n        const utcDateTime = new Date(expertDateTime.toLocaleString(\"en-US\", { timeZone: \"UTC\" }));\n\n        // Convert to client timezone for display\n        const clientDateTime = new Date(utcDateTime.toLocaleString(\"en-US\", { timeZone: clientTimezone }));\n        const clientTime = `${clientDateTime.getHours().toString().padStart(2, '0')}:${clientDateTime.getMinutes().toString().padStart(2, '0')}`;\n\n        // Format for display\n        const displayTime = clientDateTime.toLocaleTimeString('en-US', {\n          hour: 'numeric',\n          minute: '2-digit',\n          hour12: true,\n          timeZone: clientTimezone\n        });\n\n        slots.push({\n          time: clientTime,\n          utcTime: utcDateTime.toISOString(),\n          displayTime\n        });\n      }\n    }\n\n    // Filter out past time slots\n    const now = new Date();\n    return slots.filter(slot => new Date(slot.utcTime) > now).sort((a, b) => a.time.localeCompare(b.time));\n  }\n\n  async createAppointmentWithTimezone(\n    appointmentData: Omit<InsertAppointment, 'scheduledAt'> & {\n      scheduledAtUtc: string; // ISO string\n      scheduledAtTimezone: string;\n    }\n  ): Promise<Appointment> {\n    const { scheduledAtUtc, scheduledAtTimezone, ...rest } = appointmentData;\n\n    const [created] = await db\n      .insert(appointments)\n      .values({\n        ...rest,\n        scheduledAt: new Date(scheduledAtUtc),\n        scheduledAtTimezone,\n      })\n      .returning();\n\n    return created;\n  }\n\n  // EXPERT AVAILABILITY METHODS\n\n  async updateExpertAvailability(\n    availabilityId: number,\n    updates: Partial<ExpertAvailability>\n  ): Promise<ExpertAvailability> {\n    const [updated] = await db\n      .update(expertAvailability)\n      .set({\n        ...updates,\n        updatedAt: new Date(),\n      })\n      .where(eq(expertAvailability.id, availabilityId))\n      .returning();\n    return updated;\n  }\n\n  async deleteExpertAvailability(availabilityId: number): Promise<void> {\n    await db\n      .delete(expertAvailability)\n      .where(eq(expertAvailability.id, availabilityId));\n  }\n\n  // DASHBOARD AND ANALYTICS METHODS\n  async getAllAppointmentsWithDetails(): Promise<any[]> {\n    // This would need a complex join query - for now, return basic appointments\n    // In production, you'd want to optimize this with proper joins\n    const allAppointments = await db\n      .select()\n      .from(appointments)\n      .orderBy(desc(appointments.scheduledAt));\n\n    // Enrich with expert and client details\n    const enrichedAppointments = await Promise.all(\n      allAppointments.map(async (appointment) => {\n        let expertInfo = null;\n        let clientInfo = null;\n\n        try {\n          const expert = await this.getUser(appointment.expertId);\n          if (expert) {\n            expertInfo = {\n              id: expert.id,\n              name: `${expert.firstName || ''} ${expert.lastName || ''}`.trim() || expert.username,\n              email: expert.email\n            };\n          }\n        } catch (error) {\n          console.warn('Failed to get expert info:', error);\n        }\n\n        if (appointment.clientId) {\n          try {\n            const client = await this.getUser(appointment.clientId);\n            if (client) {\n              clientInfo = {\n                id: client.id,\n                name: `${client.firstName || ''} ${client.lastName || ''}`.trim() || client.username,\n                email: client.email\n              };\n            }\n          } catch (error) {\n            console.warn('Failed to get client info:', error);\n          }\n        }\n\n        return {\n          ...appointment,\n          expert: expertInfo,\n          client: clientInfo || {\n            name: appointment.clientName,\n            email: appointment.clientEmail\n          },\n          totalAmount: appointment.totalAmount / 100, // Convert to dollars\n          platformFee: appointment.platformFee / 100,\n          expertEarnings: appointment.expertEarnings / 100\n        };\n      })\n    );\n\n    return enrichedAppointments;\n  }\n\n  async getPlatformAnalytics(startDate: Date): Promise<any> {\n    // Get all appointments from the period\n    const appointmentsList = await db\n      .select()\n      .from(appointments)\n      .where(gte(appointments.createdAt, startDate));\n\n    // Get all experts\n    const experts = await db\n      .select()\n      .from(expertVerifications)\n      .where(eq(expertVerifications.verificationStatus, 'verified'));\n\n    // Calculate metrics\n    const totalAppointments = appointmentsList.length;\n    const completedAppointments = appointmentsList.filter((apt: Appointment) => apt.status === 'completed').length;\n    const cancelledAppointments = appointmentsList.filter((apt: Appointment) => apt.status === 'cancelled').length;\n    const pendingAppointments = appointmentsList.filter((apt: Appointment) => apt.status === 'pending').length;\n\n    const totalRevenue = appointmentsList\n      .filter((apt: Appointment) => apt.status === 'completed')\n      .reduce((sum: number, apt: Appointment) => sum + apt.totalAmount, 0);\n\n    const platformRevenue = appointmentsList\n      .filter((apt: Appointment) => apt.status === 'completed')\n      .reduce((sum: number, apt: Appointment) => sum + apt.platformFee, 0);\n\n    const expertRevenue = appointmentsList\n      .filter((apt: Appointment) => apt.status === 'completed')\n      .reduce((sum: number, apt: Appointment) => sum + apt.expertEarnings, 0);\n\n    // Active experts (those with appointments in the period)\n    const activeExpertIds = new Set(appointmentsList.map((apt: Appointment) => apt.expertId));\n    const activeExperts = activeExpertIds.size;\n\n    // Top performing experts\n    const expertStats = appointmentsList\n      .filter((apt: Appointment) => apt.status === 'completed')\n      .reduce((acc: any, apt: Appointment) => {\n        if (!acc[apt.expertId]) {\n          acc[apt.expertId] = {\n            expertId: apt.expertId,\n            appointments: 0,\n            revenue: 0\n          };\n        }\n        acc[apt.expertId].appointments++;\n        acc[apt.expertId].revenue += apt.expertEarnings;\n        return acc;\n      }, {} as any);\n\n    const topExperts = Object.values(expertStats)\n      .sort((a: any, b: any) => b.revenue - a.revenue)\n      .slice(0, 10);\n\n    // Daily breakdown\n    const days = Math.ceil((new Date().getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\n    const dailyStats = [];\n\n    for (let i = days - 1; i >= 0; i--) {\n      const date = new Date();\n      date.setDate(date.getDate() - i);\n      const dateStr = date.toISOString().split('T')[0];\n\n      const dayAppointments = appointmentsList.filter((apt: Appointment) =>\n        new Date(apt.scheduledAt).toISOString().split('T')[0] === dateStr\n      );\n\n      dailyStats.push({\n        date: dateStr,\n        appointments: dayAppointments.length,\n        revenue: dayAppointments\n          .filter((apt: Appointment) => apt.status === 'completed')\n          .reduce((sum: number, apt: Appointment) => sum + apt.totalAmount, 0) / 100,\n        platformFee: dayAppointments\n          .filter((apt: Appointment) => apt.status === 'completed')\n          .reduce((sum: number, apt: Appointment) => sum + apt.platformFee, 0) / 100\n      });\n    }\n\n    return {\n      summary: {\n        totalExperts: experts.length,\n        activeExperts,\n        totalAppointments,\n        completedAppointments,\n        cancelledAppointments,\n        pendingAppointments,\n        totalRevenue: totalRevenue / 100,\n        platformRevenue: platformRevenue / 100,\n        expertRevenue: expertRevenue / 100,\n        completionRate: totalAppointments > 0 ? (completedAppointments / totalAppointments * 100) : 0,\n        cancellationRate: totalAppointments > 0 ? (cancelledAppointments / totalAppointments * 100) : 0,\n        averageAppointmentValue: completedAppointments > 0 ? (totalRevenue / completedAppointments / 100) : 0\n      },\n      dailyStats,\n      topExperts: topExperts.map((expert: any) => ({\n        ...expert,\n        revenue: expert.revenue / 100\n      })),\n      period: {\n        startDate: startDate.toISOString(),\n        endDate: new Date().toISOString()\n      }\n    };\n  }\n\n  // Content Sources\n  async getContentSources(): Promise<ContentSource[]> {\n    return await db\n      .select()\n      .from(contentSources)\n      .where(eq(contentSources.isActive, true))\n      .orderBy(contentSources.orderIndex, contentSources.categoryName);\n  }\n\n  async getAllContentSources(): Promise<ContentSource[]> {\n    return await db\n      .select()\n      .from(contentSources)\n      .orderBy(contentSources.categoryId, contentSources.orderIndex, contentSources.name);\n  }\n\n  async getContentSourcesByCategory(categoryId: string): Promise<ContentSource[]> {\n    return await db\n      .select()\n      .from(contentSources)\n      .where(and(\n        eq(contentSources.categoryId, categoryId),\n        eq(contentSources.isActive, true)\n      ))\n      .orderBy(contentSources.orderIndex, contentSources.name);\n  }\n\n  async createContentSource(source: InsertContentSource): Promise<ContentSource> {\n    const [newSource] = await db\n      .insert(contentSources)\n      .values(source)\n      .returning();\n    return newSource;\n  }\n\n  async updateContentSource(id: number, source: Partial<InsertContentSource>): Promise<ContentSource | undefined> {\n    const [updatedSource] = await db\n      .update(contentSources)\n      .set({ ...source, updatedAt: new Date() })\n      .where(eq(contentSources.id, id))\n      .returning();\n    return updatedSource;\n  }\n\n  async deleteContentSource(id: number): Promise<void> {\n    await db\n      .delete(contentSources)\n      .where(eq(contentSources.id, id));\n  }\n\n  async reorderContentSources(categoryId: string, sourceIds: number[]): Promise<void> {\n    // Update orderIndex for each source based on its position in the array\n    const updatePromises = sourceIds.map((sourceId, index) =>\n      db\n        .update(contentSources)\n        .set({ orderIndex: index })\n        .where(eq(contentSources.id, sourceId))\n    );\n\n    await Promise.all(updatePromises);\n  }\n\n  // Q&A Knowledge operations\n  async searchQaKnowledge(query: string): Promise<QaKnowledge[]> {\n    const queryLower = query.toLowerCase().trim();\n\n    // Get all Q&As for scoring\n    const allQas = await db.select().from(qaKnowledge);\n\n    // Common words to ignore in scoring\n    const commonWords = new Set(['the', 'and', 'for', 'what', 'when', 'where', 'how', 'why', 'who', 'which', 'can', 'should', 'would', 'could', 'does', 'has', 'have', 'had', 'will', 'with', 'from', 'your', 'that', 'this', 'find', 'about', 'edith']);\n\n    // Extract meaningful search terms\n    const searchTerms = queryLower\n      .split(' ')\n      .filter(term => term.length > 2 && !commonWords.has(term));\n\n    // Score each Q&A based on relevance\n    const scoredResults = allQas.map(qa => {\n      let score = 0;\n      const questionLower = qa.question.toLowerCase();\n      const answerLower = qa.answer.toLowerCase();\n\n      // Check for exact phrase match first (highest priority)\n      if (questionLower.includes(queryLower)) {\n        score += 100;\n      } else if (answerLower.includes(queryLower)) {\n        score += 50;\n      }\n\n      // Then check individual terms\n      searchTerms.forEach(term => {\n        // Count occurrences in question (higher weight)\n        const questionMatches = (questionLower.match(new RegExp(term, 'g')) || []).length;\n        score += questionMatches * 10;\n\n        // Count occurrences in answer (lower weight)\n        const answerMatches = (answerLower.match(new RegExp(term, 'g')) || []).length;\n        score += answerMatches * 5;\n\n        // Bonus for exact word boundaries (not part of another word)\n        const wordBoundaryRegex = new RegExp(`\\\\b${term}\\\\b`, 'gi');\n        if (wordBoundaryRegex.test(questionLower)) {\n          score += 15;\n        }\n        if (wordBoundaryRegex.test(answerLower)) {\n          score += 8;\n        }\n      });\n\n      // Special case handling for common queries\n      if (queryLower.includes('medicare') && questionLower.includes('medicare')) {\n        score += 200;\n      }\n      if (queryLower.includes('pension') && questionLower.includes('pension')) {\n        score += 200;\n      }\n      if ((queryLower.includes('home care') || queryLower.includes('aging parent')) &&\n          (questionLower.includes('home care') || questionLower.includes('aging parent'))) {\n        score += 200;\n      }\n\n      return { qa, score };\n    });\n\n    // Filter and sort by score\n    const results = scoredResults\n      .filter(item => item.score > 0)\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 5)\n      .map(item => item.qa);\n\n    return results;\n  }\n\n  async createQaKnowledge(qa: InsertQaKnowledge): Promise<QaKnowledge> {\n    const [newQa] = await db\n      .insert(qaKnowledge)\n      .values(qa)\n      .returning();\n    return newQa;\n  }\n\n  // Search log operations\n  async createSearchLog(data: InsertSearchLog): Promise<SearchLog> {\n    const [created] = await db\n      .insert(searchLogs)\n      .values(data)\n      .returning();\n    return created;\n  }\n\n  async getSearchLogs(limit = 100): Promise<SearchLog[]> {\n    return await db\n      .select()\n      .from(searchLogs)\n      .orderBy(desc(searchLogs.createdAt))\n      .limit(limit);\n  }\n\n  async getSearchLogsByDateRange(startDate: Date, endDate: Date): Promise<SearchLog[]> {\n    return await db\n      .select()\n      .from(searchLogs)\n      .where(\n        and(\n          gte(searchLogs.createdAt, startDate),\n          lte(searchLogs.createdAt, endDate)\n        )\n      )\n      .orderBy(desc(searchLogs.createdAt));\n  }\n\n  async getAllQaKnowledge(): Promise<QaKnowledge[]> {\n    return await db.select().from(qaKnowledge);\n  }\n\n  // User favorite content source operations\n  async getUserFavoriteContentSources(userId: string): Promise<ContentSource[]> {\n    const favorites = await db\n      .select({\n        contentSource: contentSources\n      })\n      .from(userFavoriteContentSources)\n      .innerJoin(contentSources, eq(userFavoriteContentSources.contentSourceId, contentSources.id))\n      .where(eq(userFavoriteContentSources.userId, userId))\n      .orderBy(desc(userFavoriteContentSources.createdAt));\n\n    return favorites.map(f => f.contentSource);\n  }\n\n  async toggleUserFavoriteContentSource(userId: string, contentSourceId: number): Promise<boolean> {\n    // Check if already favorited\n    const [existing] = await db\n      .select()\n      .from(userFavoriteContentSources)\n      .where(and(\n        eq(userFavoriteContentSources.userId, userId),\n        eq(userFavoriteContentSources.contentSourceId, contentSourceId)\n      ));\n\n    if (existing) {\n      // Remove favorite\n      await db\n        .delete(userFavoriteContentSources)\n        .where(and(\n          eq(userFavoriteContentSources.userId, userId),\n          eq(userFavoriteContentSources.contentSourceId, contentSourceId)\n        ));\n      return false;\n    } else {\n      // Add favorite\n      await db\n        .insert(userFavoriteContentSources)\n        .values({ userId, contentSourceId });\n      return true;\n    }\n  }\n\n  async isContentSourceFavoritedByUser(userId: string, contentSourceId: number): Promise<boolean> {\n    const [favorite] = await db\n      .select()\n      .from(userFavoriteContentSources)\n      .where(and(\n        eq(userFavoriteContentSources.userId, userId),\n        eq(userFavoriteContentSources.contentSourceId, contentSourceId)\n      ));\n\n    return !!favorite;\n  }\n\n  // User favorite post operations\n  async getUserFavoritePosts(userId: string): Promise<Post[]> {\n    const favorites = await db\n      .select({\n        post: posts\n      })\n      .from(userFavoritePosts)\n      .innerJoin(posts, eq(userFavoritePosts.postId, posts.id))\n      .where(eq(userFavoritePosts.userId, userId))\n      .orderBy(desc(userFavoritePosts.createdAt));\n\n    return favorites.map(f => f.post);\n  }\n\n  async toggleUserFavoritePost(userId: string, postId: number): Promise<boolean> {\n    // Check if already favorited\n    const [existing] = await db\n      .select()\n      .from(userFavoritePosts)\n      .where(and(\n        eq(userFavoritePosts.userId, userId),\n        eq(userFavoritePosts.postId, postId)\n      ));\n\n    if (existing) {\n      // Remove favorite\n      await db\n        .delete(userFavoritePosts)\n        .where(and(\n          eq(userFavoritePosts.userId, userId),\n          eq(userFavoritePosts.postId, postId)\n        ));\n      return false;\n    } else {\n      // Add favorite\n      await db\n        .insert(userFavoritePosts)\n        .values({ userId, postId });\n      return true;\n    }\n  }\n\n  async isPostFavoritedByUser(userId: string, postId: number): Promise<boolean> {\n    const [favorite] = await db\n      .select()\n      .from(userFavoritePosts)\n      .where(and(\n        eq(userFavoritePosts.userId, userId),\n        eq(userFavoritePosts.postId, postId)\n      ));\n\n    return !!favorite;\n  }\n\n  async getPostFavoriteCount(postId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(userFavoritePosts)\n      .where(eq(userFavoritePosts.postId, postId));\n\n    return result[0]?.count || 0;\n  }\n\n  // Email verification operations\n  async createEmailVerificationToken(token: InsertEmailVerificationToken): Promise<EmailVerificationToken> {\n    const [newToken] = await db.insert(emailVerificationTokens).values(token).returning();\n    return newToken;\n  }\n\n  async getEmailVerificationToken(token: string): Promise<EmailVerificationToken | undefined> {\n    const [verificationToken] = await db\n      .select()\n      .from(emailVerificationTokens)\n      .where(eq(emailVerificationTokens.token, token));\n    return verificationToken;\n  }\n\n  async deleteEmailVerificationToken(token: string): Promise<void> {\n    await db.delete(emailVerificationTokens).where(eq(emailVerificationTokens.token, token));\n  }\n\n  async verifyUserEmail(userId: string): Promise<void> {\n    await db.update(users).set({ emailVerified: true }).where(eq(users.id, userId));\n  }\n\n  // Password reset operations\n  async createPasswordResetToken(token: InsertPasswordResetToken): Promise<PasswordResetToken> {\n    const [newToken] = await db.insert(passwordResetTokens).values(token).returning();\n    return newToken;\n  }\n\n  async getPasswordResetToken(token: string): Promise<PasswordResetToken | undefined> {\n    const [resetToken] = await db\n      .select()\n      .from(passwordResetTokens)\n      .where(eq(passwordResetTokens.token, token));\n    return resetToken;\n  }\n\n  async deletePasswordResetToken(token: string): Promise<void> {\n    await db.delete(passwordResetTokens).where(eq(passwordResetTokens.token, token));\n  }\n\n  async updateUserPassword(userId: string, hashedPassword: string): Promise<void> {\n    await db.update(users).set({ password: hashedPassword }).where(eq(users.id, userId));\n  }\n\n  // Social media embeds operations\n  async getSocialMediaEmbeds(type: string): Promise<SocialMediaEmbed[]> {\n    const embeds = await db\n      .select()\n      .from(socialMediaEmbeds)\n      .where(and(\n        eq(socialMediaEmbeds.type, type),\n        eq(socialMediaEmbeds.isActive, true)\n      ))\n      .orderBy(socialMediaEmbeds.createdAt);\n    return embeds;\n  }\n\n  async createSocialMediaEmbed(embed: InsertSocialMediaEmbed): Promise<SocialMediaEmbed> {\n    const [created] = await db.insert(socialMediaEmbeds).values(embed).returning();\n    return created;\n  }\n\n  async updateSocialMediaEmbed(id: number, embedCode: string): Promise<SocialMediaEmbed> {\n    const [updated] = await db\n      .update(socialMediaEmbeds)\n      .set({\n        embedCode,\n        updatedAt: new Date()\n      })\n      .where(eq(socialMediaEmbeds.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteSocialMediaEmbed(id: number): Promise<void> {\n    await db.delete(socialMediaEmbeds).where(eq(socialMediaEmbeds.id, id));\n  }\n\n  // User approval operations\n  async getUnapprovedExperts(): Promise<UserWithRole[]> {\n    const unapprovedExperts = await db\n      .select()\n      .from(users)\n      .where(and(\n        eq(users.role, 'expert'),\n        eq(users.approved, 'no')\n      ))\n      .orderBy(desc(users.createdAt));\n    \n    return unapprovedExperts.map(user => ({ ...user, role: user.role as UserRole }));\n  }\n\n  async approveUser(userId: string): Promise<UserWithRole> {\n    const [approvedUser] = await db\n      .update(users)\n      .set({\n        approved: 'yes',\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    \n    return { ...approvedUser, role: approvedUser.role as UserRole };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":83133},"client/src/pages/ExpertApplication.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { CheckCircle, Clock, XCircle, UserCheck, FileText, Globe, Linkedin } from \"lucide-react\";\n\nconst expertApplicationSchema = z.object({\n  profession: z.string().min(2, \"Profession is required\"),\n  expertiseArea: z.string().min(5, \"Please describe your areas of expertise\"),\n  yearsOfExperience: z.number().min(1, \"Years of experience must be at least 1\").max(50, \"Please enter a realistic number\"),\n  credentials: z.string().min(10, \"Please provide your credentials and qualifications\"),\n  bio: z.string().min(50, \"Please provide a detailed bio (at least 50 characters)\"),\n  licenseNumber: z.string().min(1, \"License number is required\"),\n  // Company information\n  company: z.string().min(2, \"Company/Organization name is required\"),\n  companyAddress: z.string().min(10, \"Company address is required\"),\n  companyWebsite: z.string().url(\"Please enter a valid company website URL\").optional().or(z.literal(\"\")),\n  companyEmail: z.string().email(\"Please enter a valid company email\"),\n  // Professional links\n  websiteUrl: z.string().url(\"Please enter a valid website URL\").optional().or(z.literal(\"\")),\n  linkedinUrl: z.string().url(\"Please enter a valid LinkedIn URL\").optional().or(z.literal(\"\")),\n  blogUrl: z.string().url(\"Please enter a valid blog URL\").optional().or(z.literal(\"\")),\n  booksUrl: z.string().url(\"Please enter a valid books/publications URL\").optional().or(z.literal(\"\")),\n  articlesUrl: z.string().url(\"Please enter a valid articles URL\").optional().or(z.literal(\"\")),\n  // Files and additional info\n  profileImage: z.instanceof(File).optional(),\n  licenseFile: z.instanceof(File, { message: \"Please upload your professional license or certification\" }),\n  // Consultation settings\n  consultationRate: z.number().min(50, \"Minimum consultation rate is $50/hour\").max(500, \"Maximum rate is $500/hour\"),\n  consultationEnabled: z.boolean().default(true),\n  reasonForApplying: z.string().min(20, \"Please explain why you want to become a verified expert\"),\n  // LinkedIn import option\n  importFromLinkedIn: z.boolean().default(false),\n});\n\ntype ExpertApplicationForm = z.infer<typeof expertApplicationSchema>;\n\nexport default function ExpertApplication() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [applicationStatus, setApplicationStatus] = useState<'none' | 'success' | 'error'>('none');\n\n  // Check if user already has an expert verification\n  const { data: existingApplication, isLoading: checkingExisting } = useQuery({\n    queryKey: ['/api/experts/my-application'],\n    enabled: !!user?.id,\n    retry: false,\n    queryFn: async () => {\n      const res = await apiRequest('GET', '/api/experts/my-application');\n      if (res.status === 404) {\n        return null;\n      }\n      return res.json();\n    }\n  });\n\n  const form = useForm<ExpertApplicationForm>({\n    resolver: zodResolver(expertApplicationSchema),\n    defaultValues: {\n      profession: \"\",\n      expertiseArea: \"\",\n      yearsOfExperience: 5,\n      credentials: \"\",\n      bio: \"\",\n      licenseNumber: \"\",\n      company: \"\",\n      companyAddress: \"\",\n      companyWebsite: \"\",\n      companyEmail: \"\",\n      websiteUrl: \"\",\n      linkedinUrl: \"\",\n      blogUrl: \"\",\n      booksUrl: \"\",\n      articlesUrl: \"\",\n      consultationRate: 150,\n      consultationEnabled: true,\n      reasonForApplying: \"\",\n      importFromLinkedIn: false,\n    },\n  });\n\n  const applicationMutation = useMutation({\n    mutationFn: async (data: ExpertApplicationForm) => {\n      return await apiRequest(\"POST\", \"/api/experts/apply\", data);\n    },\n    onSuccess: () => {\n      setApplicationStatus('success');\n      toast({\n        title: \"Application Submitted\",\n        description: \"Your expert verification application has been submitted for review.\",\n      });\n    },\n    onError: (error: any) => {\n      setApplicationStatus('error');\n      toast({\n        title: \"Application Failed\",\n        description: error.message || \"Failed to submit application. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ExpertApplicationForm) => {\n    applicationMutation.mutate(data);\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <UserCheck className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to apply for expert verification status.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (checkingExisting) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  // Show status if user already has an application\n  if (existingApplication) {\n    const getStatusIcon = (status: string) => {\n      switch (status) {\n        case 'verified':\n          return <CheckCircle className=\"h-8 w-8 text-green-500\" />;\n        case 'pending':\n          return <Clock className=\"h-8 w-8 text-yellow-500\" />;\n        case 'rejected':\n          return <XCircle className=\"h-8 w-8 text-red-500\" />;\n        default:\n          return <FileText className=\"h-8 w-8 text-gray-500\" />;\n      }\n    };\n\n    const getStatusMessage = (status: string) => {\n      switch (status) {\n        case 'verified':\n          return {\n            title: \"You're Already Verified!\",\n            description: \"Congratulations! You are already a verified expert on AskEdith.\",\n            action: \"View Your Profile\"\n          };\n        case 'pending':\n          return {\n            title: \"Application Under Review\",\n            description: \"Your expert verification application is currently being reviewed by our team.\",\n            action: \"Update Application\"\n          };\n        case 'rejected':\n          return {\n            title: \"Application Not Approved\",\n            description: \"Your previous application was not approved. You can submit a new application with updated information.\",\n            action: \"Reapply\"\n          };\n        default:\n          return {\n            title: \"Application Submitted\",\n            description: \"Your application has been submitted.\",\n            action: \"View Status\"\n          };\n      }\n    };\n\n    const statusInfo = getStatusMessage(existingApplication.verificationStatus);\n\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            {getStatusIcon(existingApplication.verificationStatus)}\n            <h2 className=\"text-2xl font-semibold mt-4 mb-2\">{statusInfo.title}</h2>\n            <p className=\"text-gray-600 mb-6\">{statusInfo.description}</p>\n            \n            <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n              <h3 className=\"font-semibold mb-2\">Application Details:</h3>\n              <div className=\"space-y-1 text-sm\">\n                <p><span className=\"font-medium\">Profession:</span> {existingApplication.profession}</p>\n                <p><span className=\"font-medium\">Expertise:</span> {existingApplication.expertiseArea}</p>\n                <p><span className=\"font-medium\">Experience:</span> {existingApplication.yearsOfExperience} years</p>\n                <p><span className=\"font-medium\">Status:</span> \n                  <Badge className=\"ml-2\" variant={\n                    existingApplication.verificationStatus === 'verified' ? 'default' :\n                    existingApplication.verificationStatus === 'pending' ? 'secondary' : 'destructive'\n                  }>\n                    {existingApplication.verificationStatus}\n                  </Badge>\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex gap-4 justify-center\">\n              {existingApplication.verificationStatus === 'verified' && (\n                <Button onClick={() => window.location.href = `/expert/${user?.id}`}>\n                  {statusInfo.action}\n                </Button>\n              )}\n              {existingApplication.verificationStatus === 'rejected' && (\n                <Button onClick={() => window.location.reload()}>\n                  {statusInfo.action}\n                </Button>\n              )}\n              <Button variant=\"outline\" onClick={() => window.history.back()}>\n                Go Back\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-3xl mx-auto\">\n        \n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">Apply for Expert Verification</h1>\n          <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n            Join our trusted community of verified experts and help families navigate caregiving challenges \n            with your professional expertise and experience.\n          </p>\n        </div>\n\n        {/* Benefits Card */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-green-500\" />\n              Expert Verification Benefits\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Verified Expert Badge</h4>\n                  <p className=\"text-sm text-gray-600\">Display your credentials with a verified expert badge</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Featured Profile</h4>\n                  <p className=\"text-sm text-gray-600\">Get featured in our expert directory</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Source Attribution</h4>\n                  <p className=\"text-sm text-gray-600\">Link your content to original sources and publications</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Priority Support</h4>\n                  <p className=\"text-sm text-gray-600\">Enhanced visibility for your helpful contributions</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Application Form */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Expert Verification Application</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"profession\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Profession *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"e.g., Geriatrician, Social Worker, Elder Law Attorney\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"location\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Location *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"e.g., San Francisco, CA\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"expertiseArea\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Areas of Expertise *</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Describe your specific areas of expertise in caregiving, healthcare, legal, financial, or other relevant fields...\"\n                          className=\"min-h-[100px]\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormDescription>\n                        Be specific about your specializations (e.g., dementia care, Medicare planning, elder law)\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"yearsOfExperience\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Years of Professional Experience *</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"1\" \n                          max=\"50\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"credentials\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Credentials & Qualifications *</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"List your relevant degrees, certifications, licenses, and professional affiliations...\"\n                          className=\"min-h-[120px]\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormDescription>\n                        Include degrees, licenses, certifications, and professional memberships\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"bio\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Professional Bio *</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Tell us about your background, experience, and what drives your passion for helping families...\"\n                          className=\"min-h-[150px]\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormDescription>\n                        This will be displayed on your expert profile page\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"websiteUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"flex items-center gap-2\">\n                          <Globe className=\"h-4 w-4\" />\n                          Professional Website\n                        </FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"https://your-website.com\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"linkedinUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"flex items-center gap-2\">\n                          <Linkedin className=\"h-4 w-4\" />\n                          LinkedIn Profile\n                        </FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"https://linkedin.com/in/yourprofile\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Consultation Settings */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Consultation Settings</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"consultationRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Hourly Consultation Rate (USD) *</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            min=\"50\" \n                            max=\"500\"\n                            placeholder=\"150\"\n                            {...field}\n                            onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Set your hourly rate for consultation sessions ($50-$500)\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"consultationEnabled\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel>\n                            Allow appointment booking after verification\n                          </FormLabel>\n                          <FormDescription>\n                            Enable clients to book paid consultation sessions with you\n                          </FormDescription>\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reasonForApplying\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Why do you want to become a verified expert? *</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Explain your motivation for joining our expert community and how you plan to help families...\"\n                          className=\"min-h-[120px]\"\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {applicationStatus === 'success' && (\n                  <Alert>\n                    <CheckCircle className=\"h-4 w-4\" />\n                    <AlertDescription>\n                      Your application has been submitted successfully! We'll review it and get back to you within 5-7 business days.\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                {applicationStatus === 'error' && (\n                  <Alert variant=\"destructive\">\n                    <XCircle className=\"h-4 w-4\" />\n                    <AlertDescription>\n                      There was an error submitting your application. Please try again.\n                    </AlertDescription>\n                  </Alert>\n                )}\n\n                <div className=\"flex gap-4 pt-6\">\n                  <Button \n                    type=\"submit\" \n                    disabled={applicationMutation.isPending}\n                    className=\"flex-1 md:flex-none\"\n                  >\n                    {applicationMutation.isPending ? \"Submitting...\" : \"Submit Application\"}\n                  </Button>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => window.history.back()}\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":23310},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/DynamicDiscussionTopicsSidebar.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { CreateForumModal } from \"./CreateForumModal\";\nimport {\n  Compass,\n  ChevronDown,\n  ChevronRight,\n  Heart,\n  Users,\n  Shield,\n  Plus,\n} from \"lucide-react\";\n\ninterface Discussion {\n  id: number;\n  name: string;\n  count: number;\n  color: string;\n  topics: Array<{\n    id: number;\n    name: string;\n    count: number;\n  }>;\n}\n\ninterface Forum {\n  id: number;\n  forumName: string;\n  forumPostCount: number;\n  discussions: Discussion[];\n  orderIndex?: number;\n}\n\ninterface DynamicDiscussionTopicsSidebarProps {\n  onCategoryClick?: (categoryId: number, categoryName: string) => void;\n  selectedCategoryId?: number;\n}\n\nexport default function DynamicDiscussionTopicsSidebar({\n  onCategoryClick,\n  selectedCategoryId,\n}: DynamicDiscussionTopicsSidebarProps = {}) {\n  // Debug log to verify prop is being passed\n  console.log(\n    \"DynamicDiscussionTopicsSidebar rendered with onCategoryClick:\",\n    !!onCategoryClick,\n  );\n  const [expandedDiscussions, setExpandedDiscussions] = useState<\n    Record<string, boolean>\n  >({});\n  const [expandedForums, setExpandedForums] = useState<Record<string, boolean>>(\n    {},\n  );\n  const [showCreateForumModal, setShowCreateForumModal] = useState(false);\n  const [showRetirementSeeMore, setShowRetirementSeeMore] = useState(false);\n  const [showCaregivingSeeMore, setShowCaregivingSeeMore] = useState(false);\n\n  // Fetch dynamic data from database\n  const { data: discussionForums = [] } = useQuery({\n    queryKey: [\"/api/categories/level/0\"],\n    retry: false,\n  });\n\n  const { data: categoryHierarchy = [] } = useQuery({\n    queryKey: [\"/api/categories/hierarchy\"],\n    retry: false,\n  });\n\n  const toggleDiscussion = (discussionName: string) => {\n    setExpandedDiscussions((prev) => ({\n      ...prev,\n      [discussionName]: !prev[discussionName],\n    }));\n  };\n\n  const toggleForum = (forumName: string) => {\n    setExpandedForums((prev) => ({\n      ...prev,\n      [forumName]: !prev[forumName],\n    }));\n  };\n\n  const handleCategoryClick = (id: number, name: string) => {\n    if (onCategoryClick) {\n      onCategoryClick(id, name);\n    }\n  };\n\n  // Helper function to assign colors based on discussion names\n  function getColorForDiscussion(discussionName: string): string {\n    const colorMap: Record<string, string> = {\n      \"Federal & State Resources\": \"bg-teal-100\",\n      \"Veteran Benefits\": \"bg-red-100\",\n      Medicare: \"bg-blue-100\",\n      Medicaid: \"bg-pink-100\",\n      \"Home Care Services\": \"bg-emerald-100\",\n      \"ADUs & Home Modifications\": \"bg-orange-100\",\n      \"Selling a Home\": \"bg-yellow-100\",\n      \"Senior Living Options\": \"bg-purple-100\",\n      \"Respite Care\": \"bg-indigo-100\",\n      \"Hospice Care\": \"bg-gray-100\",\n      \"Hospitals & Rehab\": \"bg-cyan-100\",\n    };\n    return colorMap[discussionName] || \"bg-gray-100\";\n  }\n\n  // Build forums from database data\n  const forums: Forum[] = (discussionForums as any[])\n    .filter((forum: any) => forum.level === 0) // Only top-level discussion forums\n    .map((forum: any) => {\n      const forumData = (categoryHierarchy as any[]).find(\n        (item: any) => item.id === forum.id,\n      );\n      const mainDiscussions = forumData?.children || [];\n\n      const discussions = mainDiscussions.map((discussion: any) => ({\n        id: discussion.id,\n        name: discussion.name,\n        count: parseInt(discussion.postCount) || 0,\n        color: getColorForDiscussion(discussion.name),\n        topics: (discussion.children || []).map((topic: any) => ({\n          id: topic.id,\n          name: topic.name,\n          count: topic.postCount || 0,\n        })),\n        orderIndex: discussion.orderIndex || 0, // Add orderIndex\n      }));\n\n      // Calculate total posts for this forum\n      const totalForumPosts = discussions.reduce(\n        (total: number, discussion: any) => total + discussion.count,\n        parseInt(forum.postCount) || 0,\n      );\n\n      return {\n        id: forum.id,\n        forumName: forum.name,\n        forumPostCount: totalForumPosts,\n        discussions,\n        orderIndex: forum.orderIndex || 0, // Add orderIndex\n      };\n    });\n\n\n  // Initialize all forums as closed by default - only once when forums are first loaded\n  useEffect(() => {\n    if ((discussionForums as any[]).length > 0 && Object.keys(expandedForums).length === 0) {\n      const initialForumState: Record<string, boolean> = {};\n      (discussionForums as any[]).forEach((forum: any) => {\n        initialForumState[forum.name] = false;\n      });\n      setExpandedForums(initialForumState);\n    }\n  }, [discussionForums, expandedForums]);\n\n  // Define retirement forum names that should appear in the retirement section\n  const retirementForumSet = new Set([\n    \"Advice Between Generations\",\n    \"My Favorite Places to Visit\",\n    \"My Favorite Recipes\",\n    \"Should I Spend or Should I Save?\",\n    \"401Ks, IRAs, & Pensions\",\n    \"Financial Planning for Retirement\",\n    \"Social Security\",\n    \"Wills, Trusts, & Estate Planning\",\n    \"Accessory Dwelling Units\",\n    \"Home Modifications\",\n    \"Buying & Selling a Home\",\n    \"Empty Nest Decisions\",\n    \"Retirement & Senior Living Communities\",\n    \"Career Changes & Semi-Retirement\",\n    \"Entrepreneurship in Retirement\",\n    \"Gig Life\",\n    \"Grandchildren\",\n    \"Family Dynamics\",\n    \"Divorce\",\n    \"Widowhood\",\n    \"General Health\",\n    \"Navigating Medicare\",\n    \"Navigating Medicaid\",\n    \"Solo Life\",\n    \"Travel in Retirement\",\n    \"Taxes and Retirement\",\n    \"Veteran Retirement & Benefits\",\n  ]);\n\n  // Define where separators should appear (after these forums)\n  const separatorAfter = new Set([\n    \"Social Security\", // End of Financial Planning Group\n    \"Wills, Trusts, & Estate Planning\", // After Financial Planning Group\n    \"Retirement & Senior Living Communities\", // After Housing & Life Transitions Group (updated)\n    \"Gig Life\", // After Work & Business Group\n    \"Widowhood\", // After Family Group\n    \"Navigating Medicaid\", // After Health Group\n  ]);\n\n  // Separate forums into retirement and caregiving categories\n  // Both sections now use order_index for sorting\n  const retirementForums = forums\n    .filter((forum) => retirementForumSet.has(forum.forumName))\n    .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\n\n  const caregivingForums = forums\n    .filter((forum) => !retirementForumSet.has(forum.forumName))\n    .sort((a, b) => (a.orderIndex || 0) - (b.orderIndex || 0));\n\n  return (\n    <div className=\"space-y-6\">\n      {/* All Things Retirement Section */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n        <div className=\"px-6 py-4 border-b border-gray-100 bg-[#1e3a5f]/90\">\n          <div className=\"flex items-center space-x-2\">\n            <Compass className=\"w-5 h-5 text-white\" />\n            <h3 className=\"font-semibold text-white\">All Things Retirement</h3>\n          </div>\n          <p className=\"text-sm text-white/100 mt-1\">\n            Members Sharing Knowledge. For a stronger retirement.\n          </p>\n        </div>\n\n        <div className=\"p-4\">\n          <div className=\"space-y-1\">\n            {/* First, A Little Fun Header */}\n            <div className=\"py-2.5 px-3\">\n              <span className=\"text-sm font-bold\" style={{ color: \"#1e3a5f\" }}>\n                First, A Little Fun!\n              </span>\n            </div>\n\n            {/* Render the fun forums */}\n            {retirementForums\n              .filter((forum) =>\n                [\n                  \"Advice Between Generations\",\n                  \"My Favorite Places to Visit\",\n                  \"My Favorite Recipes\",\n                  \"Should I Spend or Should I Save?\",\n                ].includes(forum.forumName),\n              )\n              .map((forum, index) => (\n                <div key={forum.forumName}>\n                  <button\n                    onClick={() => {\n                      console.log(\n                        \"Forum clicked:\",\n                        forum.forumName,\n                        \"ID:\",\n                        forum.id,\n                      );\n                      toggleForum(forum.forumName);\n                      if (onCategoryClick) {\n                        console.log(\n                          \"Calling onCategoryClick with:\",\n                          forum.id,\n                          forum.forumName,\n                        );\n                        onCategoryClick(forum.id, forum.forumName);\n                      } else {\n                        console.log(\"onCategoryClick is not defined\");\n                      }\n                    }}\n                    className=\"w-full flex items-center justify-between py-2.5 px-3 transition-colors duration-150 group\"\n                    onMouseEnter={(e) =>\n                      (e.currentTarget.style.backgroundColor = \"#fffef8\")\n                    }\n                    onMouseLeave={(e) =>\n                      (e.currentTarget.style.backgroundColor = \"transparent\")\n                    }\n                  >\n                    <span\n                      className=\"text-sm font-medium text-left\"\n                      style={{ color: \"#1e3a5f\" }}\n                    >\n                      {forum.forumName}\n                    </span>\n                    <div className=\"flex items-center space-x-2\">\n                      <span className=\"text-xs text-gray-500 font-medium\">\n                        {forum.forumPostCount}\n                      </span>\n                      {expandedForums[forum.forumName] ? (\n                        <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n                      ) : (\n                        <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                      )}\n                    </div>\n                  </button>\n\n                  {expandedForums[forum.forumName] && (\n                    <div className=\"ml-3\">\n                      {forum.discussions.map((discussion, discussionIndex) => (\n                        <div key={discussion.name}>\n                          <button\n                            onClick={() => {\n                              toggleDiscussion(discussion.name);\n                              if (onCategoryClick && discussion.id) {\n                                onCategoryClick(discussion.id, discussion.name);\n                              }\n                            }}\n                            className=\"w-full flex items-center justify-between py-2 px-3 transition-colors duration-150 group\"\n                            onMouseEnter={(e) =>\n                              (e.currentTarget.style.backgroundColor =\n                                \"#fffef8\")\n                            }\n                            onMouseLeave={(e) =>\n                              (e.currentTarget.style.backgroundColor =\n                                \"transparent\")\n                            }\n                          >\n                            <div className=\"flex items-center space-x-2\">\n                              <span className=\"text-sm text-gray-700 group-hover:text-gray-900\">\n                                {discussion.name}\n                              </span>\n                            </div>\n                            <div className=\"flex items-center space-x-2\">\n                              <span className=\"text-xs text-gray-500\">\n                                {discussion.count}\n                              </span>\n                              {discussion.topics.length > 0 && expandedDiscussions[discussion.name] ? (\n                                <ChevronDown className=\"w-3 h-3 text-gray-400\" />\n                              ) : (\n                                <ChevronRight className=\"w-3 h-3 text-gray-400\" />\n                              )}\n                            </div>\n                          </button>\n\n                          {expandedDiscussions[discussion.name] &&\n                            discussion.topics.length > 0 && (\n                              <div className=\"ml-4\">\n                                {discussion.topics.map((topic, topicIndex) => (\n                                  <div key={topic.name}>\n                                    <div\n                                      className=\"relative text-xs text-gray-600 hover:text-gray-800 cursor-pointer py-1.5 transition-colors duration-150\"\n                                      onClick={() => {\n                                        if (onCategoryClick && topic.id) {\n                                          onCategoryClick(topic.id, topic.name);\n                                        }\n                                      }}\n                                      onMouseEnter={(e) =>\n                                        (e.currentTarget.style.backgroundColor =\n                                          \"#fffef8\")\n                                      }\n                                      onMouseLeave={(e) =>\n                                        (e.currentTarget.style.backgroundColor =\n                                          \"transparent\")\n                                      }\n                                      style={{\n                                        display: \"grid\",\n                                        gridTemplateColumns: \"1fr auto\",\n                                        gap: \"8px\",\n                                        alignItems: \"start\",\n                                      }}\n                                    >\n                                      <span\n                                        className=\"leading-tight\"\n                                        style={{\n                                          wordWrap: \"break-word\",\n                                          textAlign: \"left\",\n                                        }}\n                                      >\n                                        {topic.name}\n                                      </span>\n                                      <span className=\"text-xs text-gray-500\">\n                                        {topic.count}\n                                      </span>\n                                    </div>\n                                    {topicIndex <\n                                      discussion.topics.length - 1 && (\n                                      <div\n                                        className=\"border-b border-gray-100 ml-3 mr-3\"\n                                        style={{ borderBottomWidth: \"0.5px\" }}\n                                      ></div>\n                                    )}\n                                  </div>\n                                ))}\n                              </div>\n                            )}\n\n                          {discussionIndex < forum.discussions.length - 1 && (\n                            <div\n                              className=\"border-b border-gray-100 ml-3 mr-3\"\n                              style={{ borderBottomWidth: \"0.5px\" }}\n                            ></div>\n                          )}\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  {/* Add separator after specific forums */}\n                  {separatorAfter.has(forum.forumName) && (\n                    <div className=\"py-2\">\n                      <div\n                        className=\"border-t border-gray-300\"\n                        style={{ borderWidth: \"0.5px\" }}\n                      ></div>\n                    </div>\n                  )}\n                  {/* Custom divider after \"Should I Spend or Should I Save?\" */}\n                  {forum.forumName === \"Should I Spend or Should I Save?\" && (\n                    <div\n                      style={{\n                        height: \"0.25em\",\n                        backgroundColor: \"#344d6f\",\n                        marginTop: \"0.5rem\",\n                        marginBottom: \"0.5rem\",\n                      }}\n                    ></div>\n                  )}\n                </div>\n              ))}\n\n            {/* Render remaining retirement forums */}\n            {retirementForums\n              .filter(\n                (forum) =>\n                  ![\n                    \"Advice Between Generations\",\n                    \"My Favorite Places to Visit\",\n                    \"My Favorite Recipes\",\n                    \"Should I Spend or Should I Save?\",\n                  ].includes(forum.forumName),\n              )\n              .map((forum, index) => {\n                const isFirst401K =\n                  forum.forumName === \"401Ks, IRAs, & Pensions\";\n                return (\n                  <div key={forum.forumName}>\n                    <div>\n                      <button\n                        onClick={() => toggleForum(forum.forumName)}\n                        className={`w-full flex items-center justify-between px-3 transition-colors duration-150 group ${isFirst401K ? \"pt-4 pb-2.5\" : \"py-2.5\"}`}\n                        onMouseEnter={(e) =>\n                          (e.currentTarget.style.backgroundColor = \"#fffef8\")\n                        }\n                        onMouseLeave={(e) =>\n                          (e.currentTarget.style.backgroundColor =\n                            \"transparent\")\n                        }\n                      >\n                        <span\n                          className=\"text-sm font-medium text-left\"\n                          style={{ color: \"#1e3a5f\" }}\n                        >\n                          {forum.forumName}\n                        </span>\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-xs text-gray-500 font-medium\">\n                            {forum.forumPostCount}\n                          </span>\n                          {expandedForums[forum.forumName] ? (\n                            <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n                          ) : (\n                            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                          )}\n                        </div>\n                      </button>\n\n                      {expandedForums[forum.forumName] && (\n                        <div className=\"ml-3\">\n                          {forum.discussions.map(\n                            (discussion, discussionIndex) => (\n                              <div key={discussion.name}>\n                                <button\n                                  onClick={() => {\n                                    toggleDiscussion(discussion.name);\n                                    if (onCategoryClick && discussion.id) {\n                                      onCategoryClick(\n                                        discussion.id,\n                                        discussion.name,\n                                      );\n                                    }\n                                  }}\n                                  className=\"w-full flex items-center justify-between py-2 px-3 transition-colors duration-150 group\"\n                                  onMouseEnter={(e) =>\n                                    (e.currentTarget.style.backgroundColor =\n                                      \"#fffef8\")\n                                  }\n                                  onMouseLeave={(e) =>\n                                    (e.currentTarget.style.backgroundColor =\n                                      \"transparent\")\n                                  }\n                                >\n                                  <div className=\"flex items-center space-x-2\">\n                                    <span className=\"text-sm text-gray-700 group-hover:text-gray-900\">\n                                      {discussion.name}\n                                    </span>\n                                  </div>\n                                  <div className=\"flex items-center space-x-2\">\n                                    <span className=\"text-xs text-gray-500\">\n                                      {discussion.count}\n                                    </span>\n                                    {discussion.topics.length > 0 &&\n                                      (expandedDiscussions[discussion.name] ? (\n                                        <ChevronDown className=\"w-3 h-3 text-gray-400\" />\n                                      ) : (\n                                        <ChevronRight className=\"w-3 h-3 text-gray-400\" />\n                                      ))}\n                                  </div>\n                                </button>\n\n                                {expandedDiscussions[discussion.name] &&\n                                  discussion.topics.length > 0 && (\n                                    <div className=\"ml-4\">\n                                      {discussion.topics.map(\n                                        (topic, topicIndex) => (\n                                          <div key={topic.name}>\n                                            <div\n                                              className=\"relative text-xs text-gray-600 hover:text-gray-800 cursor-pointer py-1.5 transition-colors duration-150\"\n                                              onClick={() => {\n                                                if (\n                                                  onCategoryClick &&\n                                                  topic.id\n                                                ) {\n                                                  onCategoryClick(\n                                                    topic.id,\n                                                    topic.name,\n                                                  );\n                                                }\n                                              }}\n                                              onMouseEnter={(e) =>\n                                                (e.currentTarget.style.backgroundColor =\n                                                  \"#fffef8\")\n                                              }\n                                              onMouseLeave={(e) =>\n                                                (e.currentTarget.style.backgroundColor =\n                                                  \"transparent\")\n                                              }\n                                              style={{\n                                                display: \"grid\",\n                                                gridTemplateColumns: \"1fr auto\",\n                                                gap: \"8px\",\n                                                alignItems: \"start\",\n                                              }}\n                                            >\n                                              <span\n                                                className=\"leading-tight\"\n                                                style={{\n                                                  wordWrap: \"break-word\",\n                                                  textAlign: \"left\",\n                                                }}\n                                              >\n                                                {topic.name}\n                                              </span>\n                                              <span className=\"text-xs text-gray-500\">\n                                                {topic.count}\n                                              </span>\n                                            </div>\n                                            {topicIndex <\n                                              discussion.topics.length - 1 && (\n                                              <div\n                                                className=\"border-b border-gray-100 ml-3 mr-3\"\n                                                style={{\n                                                  borderBottomWidth: \"0.5px\",\n                                                }}\n                                              ></div>\n                                            )}\n                                          </div>\n                                        ),\n                                      )}\n                                    </div>\n                                  )}\n\n                                {discussionIndex <\n                                  forum.discussions.length - 1 && (\n                                  <div\n                                    className=\"border-b border-gray-100 ml-3 mr-3\"\n                                    style={{ borderBottomWidth: \"0.5px\" }}\n                                  ></div>\n                                )}\n                              </div>\n                            ),\n                          )}\n                        </div>\n                      )}\n                    </div>\n                    {/* Add separator after specific forums */}\n                    {separatorAfter.has(forum.forumName) && (\n                      <div className=\"py-2\">\n                        <div\n                          className=\"border-t border-gray-300\"\n                          style={{ borderWidth: \"0.5px\" }}\n                        ></div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n\n            {/* Create Your Own Topic Button */}\n            <div className=\"mt-4 pt-3 border-t border-gray-200\">\n              <button\n                className=\"w-full flex items-center justify-center py-3 px-4 text-sm font-medium text-[#1e3a5f] bg-[#1e3a5f]/10 hover:bg-[#1e3a5f]/20 rounded-lg transition-colors duration-150 group\"\n                onClick={() => setShowCreateForumModal(true)}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Create Your Own Topic\n              </button>\n\n              {/* See More Button */}\n              <button\n                className=\"w-full flex items-center justify-center py-3 px-4 mt-2 text-sm font-medium text-gray-700 bg-[#e6845b]/25 hover:bg-[#e6845b]/35 rounded-lg transition-colors duration-150 group\"\n                onClick={() => setShowRetirementSeeMore(!showRetirementSeeMore)}\n              >\n                <span className=\"mr-2\">See More</span>\n                <ChevronDown\n                  className={`w-4 h-4 transition-transform duration-200 ${showRetirementSeeMore ? \"rotate-180\" : \"\"}`}\n                />\n              </button>\n\n              {/* Accordion content for See More */}\n              {showRetirementSeeMore && (\n                <div className=\"mt-2 p-3 bg-gray-50 rounded-lg\">\n                  <p className=\"text-xs text-gray-500 text-center\">\n                    Additional retirement forums will appear here as they are\n                    created by the community.\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* All Things Caregiving Section */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden\">\n        <div className=\"px-6 py-4 border-b border-gray-100 bg-[#0B666B]/90\">\n          <div className=\"flex items-center space-x-2\">\n            <Heart className=\"w-5 h-5 text-white\" />\n            <h3 className=\"font-semibold text-white\">All Things Caregiving</h3>\n          </div>\n          <p className=\"text-sm text-white/100 mt-1\">\n            Support and resources for you as a caregiver\n          </p>\n        </div>\n\n        <div className=\"p-4\">\n          <div className=\"space-y-1\">\n            {caregivingForums.map((forum, forumIndex) => (\n              <div key={forum.forumName}>\n                <button\n                  onClick={() => toggleForum(forum.forumName)}\n                  className=\"w-full flex items-center justify-between py-2.5 px-3 transition-colors duration-150 group\"\n                  onMouseEnter={(e) =>\n                    (e.currentTarget.style.backgroundColor = \"#fffef8\")\n                  }\n                  onMouseLeave={(e) =>\n                    (e.currentTarget.style.backgroundColor = \"transparent\")\n                  }\n                >\n                  <span\n                    className=\"text-sm font-medium text-left\"\n                    style={{ color: \"#B85C42\" }}\n                  >\n                    {forum.forumName}\n                  </span>\n                  <div className=\"flex items-center space-x-2\">\n                    <span className=\"text-xs text-gray-500 font-medium\">\n                      {forum.forumPostCount}\n                    </span>\n                    {expandedForums[forum.forumName] ? (\n                      <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n                    ) : (\n                      <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n                    )}\n                  </div>\n                </button>\n\n                {expandedForums[forum.forumName] && (\n                  <div className=\"ml-3\">\n                    {forum.discussions.map((discussion, discussionIndex) => (\n                      <div key={discussion.name}>\n                        <button\n                          onClick={() => {\n                            toggleDiscussion(discussion.name);\n                            if (onCategoryClick && discussion.id) {\n                              onCategoryClick(discussion.id, discussion.name);\n                            }\n                          }}\n                          className=\"w-full flex items-center justify-between py-2 px-3 transition-colors duration-150 group\"\n                          onMouseEnter={(e) =>\n                            (e.currentTarget.style.backgroundColor = \"#fffef8\")\n                          }\n                          onMouseLeave={(e) =>\n                            (e.currentTarget.style.backgroundColor =\n                              \"transparent\")\n                          }\n                        >\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-sm text-gray-700 group-hover:text-gray-900\">\n                              {discussion.name}\n                            </span>\n                          </div>\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-xs text-gray-500\">\n                              {discussion.count}\n                            </span>\n                            {discussion.topics.length > 0 &&\n                              (expandedDiscussions[discussion.name] ? (\n                                <ChevronDown className=\"w-3 h-3 text-gray-400\" />\n                              ) : (\n                                <ChevronRight className=\"w-3 h-3 text-gray-400\" />\n                              ))}\n                          </div>\n                        </button>\n\n                        {expandedDiscussions[discussion.name] &&\n                          discussion.topics.length > 0 && (\n                            <div className=\"ml-4\">\n                              {discussion.topics.map((topic, topicIndex) => (\n                                <div key={topic.name}>\n                                  <div\n                                    className=\"relative text-xs text-gray-600 hover:text-gray-800 cursor-pointer py-1.5 transition-colors duration-150\"\n                                    onClick={() => {\n                                      if (onCategoryClick && topic.id) {\n                                        onCategoryClick(topic.id, topic.name);\n                                      }\n                                    }}\n                                    onMouseEnter={(e) =>\n                                      (e.currentTarget.style.backgroundColor =\n                                        \"#fffef8\")\n                                    }\n                                    onMouseLeave={(e) =>\n                                      (e.currentTarget.style.backgroundColor =\n                                        \"transparent\")\n                                    }\n                                    style={{\n                                      display: \"grid\",\n                                      gridTemplateColumns: \"1fr auto\",\n                                      gap: \"8px\",\n                                      alignItems: \"start\",\n                                    }}\n                                  >\n                                    <span\n                                      className=\"leading-tight\"\n                                      style={{\n                                        wordWrap: \"break-word\",\n                                        textAlign: \"left\",\n                                      }}\n                                    >\n                                      {topic.name}\n                                    </span>\n                                    <span className=\"text-xs text-gray-500\">\n                                      {topic.count}\n                                    </span>\n                                  </div>\n                                  {topicIndex <\n                                    discussion.topics.length - 1 && (\n                                    <div\n                                      className=\"border-b border-gray-100 ml-3 mr-3\"\n                                      style={{ borderBottomWidth: \"0.5px\" }}\n                                    ></div>\n                                  )}\n                                </div>\n                              ))}\n                            </div>\n                          )}\n\n                        {discussionIndex < forum.discussions.length - 1 && (\n                          <div\n                            className=\"border-b border-gray-100 ml-3 mr-3\"\n                            style={{ borderBottomWidth: \"0.5px\" }}\n                          ></div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {forumIndex < caregivingForums.length - 1 &&\n                  expandedForums[forum.forumName] && (\n                    <div className=\"border-b border-gray-200 my-3\"></div>\n                  )}\n              </div>\n            ))}\n\n            {/* Create Your Own Topic Button */}\n            <div className=\"mt-4 pt-3 border-t border-gray-200\">\n              <button\n                className=\"w-full flex items-center justify-center py-3 px-4 text-sm font-medium text-gray-700 bg-teal-50 hover:bg-teal-100 rounded-lg transition-colors duration-150 group\"\n                onClick={() => setShowCreateForumModal(true)}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Create Your Own Topic\n              </button>\n\n              {/* See More Button */}\n              <button\n                className=\"w-full flex items-center justify-center py-3 px-4 mt-2 text-sm font-medium text-gray-700 bg-[#e6845b]/25 hover:bg-[#e6845b]/35 rounded-lg transition-colors duration-150 group\"\n                onClick={() => setShowCaregivingSeeMore(!showCaregivingSeeMore)}\n              >\n                <span className=\"mr-2\">See More</span>\n                <ChevronDown\n                  className={`w-4 h-4 transition-transform duration-200 ${showCaregivingSeeMore ? \"rotate-180\" : \"\"}`}\n                />\n              </button>\n\n              {/* Accordion content for See More */}\n              {showCaregivingSeeMore && (\n                <div className=\"mt-2 p-3 bg-gray-50 rounded-lg\">\n                  <p className=\"text-xs text-gray-500 text-center\">\n                    Additional caregiving forums will appear here as they are\n                    created by the community.\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Community Stats */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex items-center space-x-2 mb-4\">\n          <Users className=\"w-5 h-5 text-teal-600\" />\n          <h3 className=\"font-semibold text-gray-900\">Community Stats</h3>\n        </div>\n        <div className=\"space-y-3\">\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-gray-600\">Active Members</span>\n            <span className=\"font-medium text-gray-900\">2,847</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-gray-600\">Posts Today</span>\n            <span className=\"font-medium text-gray-900\">43</span>\n          </div>\n          <div className=\"flex justify-between items-center\">\n            <span className=\"text-sm text-gray-600\">Helpful Answers</span>\n            <span className=\"font-medium text-gray-900\">1,203</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Expert Corner */}\n      <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-6\">\n        <div className=\"flex items-center space-x-2 mb-4\">\n          <Shield className=\"w-5 h-5 text-blue-600\" />\n          <h3 className=\"font-semibold text-gray-900\">Expert Corner</h3>\n        </div>\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n              <span className=\"text-xs font-medium text-blue-700\">DR</span>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-gray-900\">\n                Dr. Sarah Wilson\n              </p>\n              <p className=\"text-xs text-gray-500\">Geriatrician</p>\n            </div>\n          </div>\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\n              <span className=\"text-xs font-medium text-green-700\">LW</span>\n            </div>\n            <div>\n              <p className=\"text-sm font-medium text-gray-900\">\n                Linda Martinez\n              </p>\n              <p className=\"text-xs text-gray-500\">Elder Law Attorney</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <CreateForumModal\n        open={showCreateForumModal}\n        onOpenChange={setShowCreateForumModal}\n      />\n    </div>\n  );\n}\n","size_bytes":38720},"server/initRedis.ts":{"content":"import { connectRedis } from './redis';\nimport { preloadCache } from './cache';\n\nexport async function initializeRedis(): Promise<void> {\n  console.log('Initializing Redis...');\n  \n  try {\n    // Connect to Redis\n    await connectRedis();\n    \n    // Preload frequently accessed data into cache\n    await preloadCache();\n    \n    console.log('Redis initialization completed successfully');\n  } catch (error) {\n    console.error('Redis initialization failed:', error);\n    console.log('Continuing without Redis cache...');\n    // Application continues to work without Redis\n  }\n}","size_bytes":578},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"replit.md":{"content":"# CaregiversCommunity\n\n## Overview\nCaregiversCommunity is a full-stack platform designed to connect family caregivers (primarily women aged 45-65) in a supportive community. It offers forum-style discussions, expert consultations, and AI-powered content moderation, optimized for both mobile and desktop experiences. The platform aims to provide a vital support system for caregivers.\n\n## Recent Changes (2025-09-29)\n### Critical Bug Fixes\n- **Infinite 401 Loop Fixed**: Resolved infinite retry loop for `/api/user` endpoint that was breaking public page access for unauthenticated users.\n  - Added 10-second timeout for Clerk initialization to prevent app deadlock\n  - Updated loading state logic to allow public pages to render immediately\n  - Modified Router component to only block authenticated users during auth resolution\n- **Public Page Access Restored**: Unauthenticated users can now browse Community, Expert Directory, and other public pages without authentication.\n- **Clerk Error Handling**: Added graceful fallback when Clerk fails to initialize - app continues with limited functionality rather than crashing.\n- **Code Cleanup**: Removed debug console.log statements from registration flow.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript.\n- **Routing**: Wouter.\n- **State Management**: TanStack Query (React Query).\n- **UI Components**: Radix UI primitives with Tailwind CSS.\n- **Build Tool**: Vite.\n- **Styling**: Tailwind CSS with a custom color system reflecting a warm, professional theme.\n\n### Backend\n- **Framework**: Express.js with TypeScript.\n- **Database**: PostgreSQL with Drizzle ORM.\n- **Caching**: Redis for session storage and query caching.\n- **API Design**: Hybrid REST/GraphQL.\n- **Authentication**: Passport.js with session-based authentication.\n- **Content Moderation**: AI-powered using OpenAI GPT-4o.\n\n### Data Storage\n- **Primary Database**: PostgreSQL (Neon serverless).\n- **Session Storage**: Redis with PostgreSQL fallback.\n- **File Storage**: Supabase for profile images and expert documents.\n  - **CRITICAL ISSUE**: Supabase project (tvesaresdbghbtocwpdj.supabase.co) is inaccessible - DNS resolution fails. Project may be deleted, paused, or require reconfiguration. Profile images and expert files will not load until Supabase is restored or replaced.\n- **Cache Strategy**: Multi-layer caching with Redis.\n\n### Key Features\n- **User Management**: Session-based authentication, role-based access control (user, admin, expert), expert verification, customizable profiles.\n- **Forum & Discussion**: Hierarchical categories, threaded discussions, AI-powered content moderation with human review, full-text search.\n- **Expert Consultation**: Expert directory, native scheduling system (weekly recurring slots, timezone conversion, conflict detection), Stripe Connect integration for payments (planned commission and payouts), end-to-end booking.\n- **Community Features**: Achievement system (points, badges), voting system, expert badges, real-time notifications.\n- **Content Aggregation**: \"This Week by...\" feature curates content from various sources, RSS.app integration, expandable card UI.\n\n### Deployment\n- **Development**: Vite dev server, local PostgreSQL/Neon, local Redis.\n- **Production**: PostgreSQL with read replicas, Redis cluster, CDN for static assets, HTTPS, comprehensive security.\n- **Monitoring**: Health checks, error tracking, performance monitoring, automated backups.\n\n### Critical Payment Implementation Note\nThe current payment system collects funds but does NOT properly distribute them (e.g., expert payouts, commission collection). Stripe Connect integration is required but not yet implemented for correct financial operations.\n\n## External Dependencies\n- **Stripe**: Payment processing (currently direct to platform owner, Stripe Connect needed for payouts/commissions).\n- **SendGrid**: Email notifications.\n- **OpenAI GPT-4o**: Content moderation.\n- **Anthropic Claude**: AI assistance (planned).\n- **Neon PostgreSQL**: Serverless database.\n- **Redis**: Caching and session management.\n- **Supabase Storage**: File uploads and media management (CURRENTLY UNAVAILABLE - see Data Storage section).\n- **RSS.app**: Content aggregation.","size_bytes":4317},"server/services/googleCalendarService.ts":{"content":"import { google } from 'googleapis';\nimport { OAuth2Client } from 'google-auth-library';\n\nconst GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID;\nconst GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\nconst REDIRECT_URI = process.env.GOOGLE_REDIRECT_URI || `${process.env.BASE_URL || 'http://localhost:5000'}/api/auth/google/callback`;\n\nexport class GoogleCalendarService {\n  private oauth2Client: OAuth2Client;\n\n  constructor() {\n    this.oauth2Client = new google.auth.OAuth2(\n      GOOGLE_CLIENT_ID,\n      GOOGLE_CLIENT_SECRET,\n      REDIRECT_URI\n    );\n  }\n\n  // Generate auth URL for calendar access\n  getAuthUrl(expertId: string) {\n    const scopes = [\n      'https://www.googleapis.com/auth/calendar.readonly',\n      'https://www.googleapis.com/auth/calendar.events',\n    ];\n\n    return this.oauth2Client.generateAuthUrl({\n      access_type: 'offline',\n      scope: scopes,\n      state: expertId, // Pass expert ID in state\n    });\n  }\n\n  // Exchange code for tokens\n  async getTokens(code: string) {\n    const { tokens } = await this.oauth2Client.getToken(code);\n    return tokens;\n  }\n\n  // Set credentials for API calls\n  setCredentials(tokens: any) {\n    this.oauth2Client.setCredentials(tokens);\n  }\n\n  // Get calendar events\n  async getEvents(tokens: any, timeMin: Date, timeMax: Date) {\n    this.setCredentials(tokens);\n    \n    const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n    \n    const response = await calendar.events.list({\n      calendarId: 'primary',\n      timeMin: timeMin.toISOString(),\n      timeMax: timeMax.toISOString(),\n      singleEvents: true,\n      orderBy: 'startTime',\n    });\n\n    return response.data.items || [];\n  }\n\n  // Create calendar event for consultation\n  async createEvent(tokens: any, eventDetails: {\n    summary: string;\n    description: string;\n    start: Date;\n    end: Date;\n    attendees: { email: string }[];\n  }) {\n    this.setCredentials(tokens);\n    \n    const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n    \n    const event = {\n      summary: eventDetails.summary,\n      description: eventDetails.description,\n      start: {\n        dateTime: eventDetails.start.toISOString(),\n        timeZone: 'America/New_York', // Should be configurable\n      },\n      end: {\n        dateTime: eventDetails.end.toISOString(),\n        timeZone: 'America/New_York',\n      },\n      attendees: eventDetails.attendees,\n      reminders: {\n        useDefault: false,\n        overrides: [\n          { method: 'email', minutes: 24 * 60 }, // 1 day before\n          { method: 'popup', minutes: 30 }, // 30 minutes before\n        ],\n      },\n    };\n\n    const response = await calendar.events.insert({\n      calendarId: 'primary',\n      requestBody: event,\n      sendUpdates: 'all',\n    });\n\n    return response.data;\n  }\n\n  // Get busy times from calendar\n  async getBusyTimes(tokens: any, timeMin: Date, timeMax: Date) {\n    this.setCredentials(tokens);\n    \n    const calendar = google.calendar({ version: 'v3', auth: this.oauth2Client });\n    \n    const response = await calendar.freebusy.query({\n      requestBody: {\n        timeMin: timeMin.toISOString(),\n        timeMax: timeMax.toISOString(),\n        items: [{ id: 'primary' }],\n      },\n    });\n\n    return response.data.calendars?.primary?.busy || [];\n  }\n}\n\nexport const googleCalendarService = new GoogleCalendarService();","size_bytes":3386},"client/src/components/SignInDropdown.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Eye, EyeOff, LogIn, Mail } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function SignInDropdown() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [open, setOpen] = useState(false);\n  const [showResetForm, setShowResetForm] = useState(false);\n  const [resetEmail, setResetEmail] = useState(\"\");\n  const [isResetting, setIsResetting] = useState(false);\n  const { loginMutation } = useAuth();\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await loginMutation.mutateAsync({ username, password });\n      setOpen(false);\n      setUsername(\"\");\n      setPassword(\"\");\n    } catch (error) {\n      // Error handling is done in the mutation\n    }\n  };\n\n  const handlePasswordReset = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsResetting(true);\n    \n    try {\n      await apiRequest(\"POST\", \"/api/forgot-password\", { email: resetEmail });\n      toast({\n        title: \"Reset Email Sent\",\n        description: \"Please check your email for password reset instructions.\",\n      });\n      setShowResetForm(false);\n      setResetEmail(\"\");\n      setOpen(false);\n    } catch (error) {\n      toast({\n        title: \"Reset Failed\",\n        description: error instanceof Error ? error.message : \"Failed to send reset email\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsResetting(false);\n    }\n  };\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\">\n          Sign In\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent className=\"w-80 p-4\">\n        {!showResetForm ? (\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"text-center mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">Welcome Back</h3>\n              <p className=\"text-sm text-gray-600\">Sign in to your account</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">Username</Label>\n              <Input\n                id=\"username\"\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"Enter your username\"\n                required\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <div className=\"relative\">\n                <Input\n                  id=\"password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"Enter your password\"\n                  required\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0\"\n                  onClick={() => setShowPassword(!showPassword)}\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"h-4 w-4\" />\n                  ) : (\n                    <Eye className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? (\n                \"Signing in...\"\n              ) : (\n                <>\n                  <LogIn className=\"w-4 h-4 mr-2\" />\n                  Enter Community\n                </>\n              )}\n            </Button>\n\n            <div className=\"text-center\">\n              <button\n                type=\"button\"\n                className=\"text-sm text-teal-600 hover:text-teal-700 underline\"\n                onClick={() => setShowResetForm(true)}\n              >\n                Reset Password\n              </button>\n            </div>\n          </form>\n        ) : (\n          <form onSubmit={handlePasswordReset} className=\"space-y-4\">\n            <div className=\"text-center mb-4\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">Reset Password</h3>\n              <p className=\"text-sm text-gray-600\">Enter your email to receive reset instructions</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"resetEmail\">Email Address</Label>\n              <Input\n                id=\"resetEmail\"\n                type=\"email\"\n                value={resetEmail}\n                onChange={(e) => setResetEmail(e.target.value)}\n                placeholder=\"Enter your email address\"\n                required\n              />\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\"\n              disabled={isResetting}\n            >\n              {isResetting ? (\n                \"Sending...\"\n              ) : (\n                <>\n                  <Mail className=\"w-4 h-4 mr-2\" />\n                  Send Reset Email\n                </>\n              )}\n            </Button>\n\n            <div className=\"text-center\">\n              <button\n                type=\"button\"\n                className=\"text-sm text-teal-600 hover:text-teal-700 underline\"\n                onClick={() => setShowResetForm(false)}\n              >\n                Back to Sign In\n              </button>\n            </div>\n          </form>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","size_bytes":6232},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/EmbedContent.tsx":{"content":"import { useEffect, useRef } from 'react';\nimport DOMPurify from 'dompurify';\n\ninterface EmbedContentProps {\n  embedCode: string;\n}\n\nexport default function EmbedContent({ embedCode }: EmbedContentProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!containerRef.current || !embedCode) return;\n\n    // Clear previous content\n    containerRef.current.innerHTML = '';\n    \n    // Special handling for walls.io - load script directly without sanitization\n    if (embedCode.includes('walls.io') && embedCode.includes('cdn.walls.io')) {\n      console.log('Processing walls.io embed directly');\n      \n      // Parse the script tag to extract attributes\n      const scriptMatch = embedCode.match(/<script[^>]*>/);\n      if (scriptMatch) {\n        const scriptTag = scriptMatch[0];\n        const srcMatch = scriptTag.match(/src=\"([^\"]+)\"/);\n        const dataWallUrlMatch = scriptTag.match(/data-wallurl=\"([^\"]+)\"/);\n        const dataTitleMatch = scriptTag.match(/data-title=\"([^\"]+)\"/);\n        const dataWidthMatch = scriptTag.match(/data-width=\"([^\"]+)\"/);\n        const dataAutoheightMatch = scriptTag.match(/data-autoheight=\"([^\"]+)\"/);\n        const dataHeightMatch = scriptTag.match(/data-height=\"([^\"]+)\"/);\n        const dataLazyloadMatch = scriptTag.match(/data-lazyload=\"([^\"]+)\"/);\n        const allowMatch = scriptTag.match(/allow=\"([^\"]+)\"/);\n        \n        if (srcMatch) {\n          const script = document.createElement('script');\n          script.src = srcMatch[1];\n          script.async = true;\n          \n          // Add all data attributes\n          if (dataWallUrlMatch) script.setAttribute('data-wallurl', dataWallUrlMatch[1]);\n          if (dataTitleMatch) script.setAttribute('data-title', dataTitleMatch[1]);\n          if (dataWidthMatch) script.setAttribute('data-width', dataWidthMatch[1]);\n          if (dataAutoheightMatch) script.setAttribute('data-autoheight', dataAutoheightMatch[1]);\n          if (dataHeightMatch) script.setAttribute('data-height', dataHeightMatch[1]);\n          if (dataLazyloadMatch) script.setAttribute('data-lazyload', dataLazyloadMatch[1]);\n          if (allowMatch) script.setAttribute('allow', allowMatch[1]);\n          \n          console.log('Loading walls.io script with attributes:', {\n            src: srcMatch[1],\n            'data-wallurl': dataWallUrlMatch?.[1],\n            'data-title': dataTitleMatch?.[1]\n          });\n          \n          // Add error handling for script loading\n          script.onload = () => {\n            console.log('Walls.io script loaded successfully');\n          };\n          \n          script.onerror = (error) => {\n            console.error('Failed to load walls.io script:', error);\n          };\n          \n          // Try appending to document head instead of container for walls.io\n          document.head.appendChild(script);\n          \n          // Also create a placeholder div that walls.io might be looking for\n          const wallsContainer = document.createElement('div');\n          wallsContainer.id = 'wallsio-' + dataTitleMatch?.[1];\n          wallsContainer.className = 'wallsio-container';\n          containerRef.current.appendChild(wallsContainer);\n          \n          return;\n        }\n      }\n    }\n\n    // Configure DOMPurify to allow specific trusted tags and attributes for embeds\n    const purifyConfig = {\n      ALLOWED_TAGS: [\n        'div', 'span', 'p', 'br', 'img', 'a', 'iframe', 'script',\n        'blockquote', 'cite', 'em', 'strong', 'b', 'i', 'u',\n        'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol', 'li',\n        'rssapp-wall', // Allow RSS.app custom element\n        'juicer-feed', // Allow Juicer.io custom element\n        'walls-io-embed' // Allow Walls.io custom element\n      ],\n      ALLOWED_ATTR: [\n        'class', 'id', 'style', 'src', 'href', 'alt', 'title',\n        'width', 'height', 'frameborder', 'allowfullscreen',\n        'data-*', 'async', 'defer', 'type', 'allow',\n        'data-wallurl', 'data-title', 'data-width', 'data-autoheight',\n        'data-height', 'data-lazyload'\n      ],\n      ALLOW_DATA_ATTR: true,\n      ADD_TAGS: ['script', 'rssapp-wall', 'juicer-feed', 'walls-io-embed'], // Allow script tags, RSS.app, Juicer.io and Walls.io elements\n      ADD_ATTR: ['async', 'defer', 'type']\n    };\n\n    // Sanitize the embed code\n    const sanitizedHTML = DOMPurify.sanitize(embedCode, purifyConfig);\n    console.log('Original embed code:', embedCode);\n    console.log('Sanitized HTML:', sanitizedHTML);\n    \n    // Create a temporary container to parse the sanitized HTML\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = sanitizedHTML;\n\n    // Extract scripts from the embed code\n    const scripts = tempDiv.querySelectorAll('script');\n    const scriptContents: { src?: string; content?: string; attributes?: Record<string, string> }[] = [];\n\n    scripts.forEach((script) => {\n      if (script.src) {\n        // Only allow scripts from trusted domains\n        const allowedDomains = [\n          'embedsocial.com',\n          'widget.embedsocial.com',\n          'cdn.jsdelivr.net',\n          'cdnjs.cloudflare.com',\n          'code.jquery.com',\n          'ajax.googleapis.com',\n          'rss.app',\n          'app.rss.com',\n          'widget.rss.app',\n          'juicer.io',\n          'www.juicer.io',\n          'walls.io',\n          'my.walls.io',\n          'widget.walls.io',\n          'cdn.walls.io'\n        ];\n        \n        try {\n          const scriptUrl = new URL(script.src);\n          const isAllowedDomain = allowedDomains.some(domain => \n            scriptUrl.hostname === domain || scriptUrl.hostname.endsWith('.' + domain)\n          );\n          \n          if (isAllowedDomain) {\n            console.log('Allowed script from:', scriptUrl.hostname, script.src);\n            // Capture all data attributes for walls.io scripts\n            const attributes: Record<string, string> = {};\n            Array.from(script.attributes).forEach(attr => {\n              if (attr.name.startsWith('data-') || attr.name === 'allow') {\n                attributes[attr.name] = attr.value;\n              }\n            });\n            scriptContents.push({ src: script.src, attributes });\n          } else {\n            console.log('Blocked script from:', scriptUrl.hostname, script.src);\n          }\n        } catch (e) {\n          // Invalid URL, skip this script\n          console.warn('Invalid script URL:', script.src);\n        }\n      } else {\n        // Allow inline scripts from RSS.app embeds with strict content filtering\n        const scriptContent = script.innerHTML || script.textContent || '';\n        \n        // Only allow inline scripts that appear to be legitimate RSS.app or Juicer.io initialization\n        const isRSSAppScript = scriptContent.includes('rss.app') || \n                             scriptContent.includes('RSS.app') ||\n                             scriptContent.includes('rssapp');\n        \n        const isJuicerScript = scriptContent.includes('juicer.io') || \n                              scriptContent.includes('Juicer') ||\n                              scriptContent.includes('juicer');\n        \n        const isWallsScript = scriptContent.includes('walls.io') || \n                             scriptContent.includes('Walls') ||\n                             scriptContent.includes('walls');\n        \n        // Additional safety: reject scripts with dangerous patterns\n        const dangerousPatterns = [\n          /document\\.write/i,\n          /eval\\s*\\(/i,\n          /Function\\s*\\(/i,\n          /setTimeout\\s*\\(\\s*[\"'`]/i,\n          /setInterval\\s*\\(\\s*[\"'`]/i,\n          /innerHTML\\s*=/i,\n          /outerHTML\\s*=/i,\n          /location\\s*=/i,\n          /href\\s*=/i\n        ];\n        \n        const hasDangerousContent = dangerousPatterns.some(pattern => pattern.test(scriptContent));\n        \n        if ((isRSSAppScript || isJuicerScript || isWallsScript) && !hasDangerousContent && scriptContent.length < 5000) {\n          scriptContents.push({ content: scriptContent });\n        }\n      }\n      script.remove();\n    });\n\n    // Add the non-script HTML to the container\n    console.log('Setting container HTML:', tempDiv.innerHTML);\n    containerRef.current.innerHTML = tempDiv.innerHTML;\n    \n    // For walls.io, we need to ensure there's a target container\n    if (embedCode.includes('walls.io')) {\n      // walls.io creates its own container, so we don't need to add extra HTML\n      console.log('Walls.io embed detected');\n    }\n\n    // Execute scripts from trusted sources\n    scriptContents.forEach((scriptInfo) => {\n      const newScript = document.createElement('script');\n      \n      if (scriptInfo.src) {\n        newScript.src = scriptInfo.src;\n        newScript.async = true;\n        \n        // Apply saved attributes (especially important for walls.io)\n        if (scriptInfo.attributes) {\n          Object.entries(scriptInfo.attributes).forEach(([key, value]) => {\n            newScript.setAttribute(key, value);\n          });\n        }\n        \n        // Remove crossOrigin for Juicer.io and Walls.io scripts as it might cause CORS issues\n        if (!scriptInfo.src.includes('juicer.io') && !scriptInfo.src.includes('walls.io')) {\n          newScript.crossOrigin = 'anonymous';\n        }\n        console.log('Loading external script:', scriptInfo.src, 'with attributes:', scriptInfo.attributes);\n      } else if (scriptInfo.content) {\n        // Create inline script with trusted content\n        newScript.textContent = scriptInfo.content;\n        console.log('Executing inline script');\n      }\n      \n      // Add script to the container\n      containerRef.current?.appendChild(newScript);\n    });\n\n    // Cleanup function\n    return () => {\n      if (containerRef.current) {\n        // Remove all scripts when component unmounts\n        const scripts = containerRef.current.querySelectorAll('script');\n        scripts.forEach(script => script.remove());\n      }\n      \n      // Also clean up walls.io scripts from document head\n      const wallsScripts = document.head.querySelectorAll('script[src*=\"walls.io\"]');\n      wallsScripts.forEach(script => script.remove());\n    };\n  }, [embedCode]);\n\n  return (\n    <div ref={containerRef} className=\"embed-container relative z-10 min-h-[400px]\">\n      {/* Juicer.io often needs a specific container */}\n      {embedCode.includes('juicer.io') && (\n        <ul className=\"juicer-feed\" data-feed-id=\"alzheimers\" data-per=\"3\"></ul>\n      )}\n      {/* Walls.io needs a container with specific id */}\n      {embedCode.includes('walls.io') && (\n        <div id=\"walls-io-embed\" className=\"walls-io-container\"></div>\n      )}\n    </div>\n  );\n}","size_bytes":10664},"client/src/pages/ResetPassword.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Lock, CheckCircle } from \"lucide-react\";\n\nconst resetPasswordSchema = z.object({\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Z]/, \"Password must contain at least one uppercase letter\")\n    .regex(/[a-z]/, \"Password must contain at least one lowercase letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n  confirmPassword: z.string()\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nexport default function ResetPassword() {\n  const [location] = useLocation();\n  const [isSuccess, setIsSuccess] = useState(false);\n  const { toast } = useToast();\n  \n  // Get token from URL\n  const urlParams = new URLSearchParams(window.location.search);\n  const token = urlParams.get('token');\n\n  const form = useForm<z.infer<typeof resetPasswordSchema>>({\n    resolver: zodResolver(resetPasswordSchema),\n    defaultValues: {\n      password: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: (data: { password: string }) => \n      apiRequest(\"POST\", \"/api/reset-password\", { newPassword: data.password, token }),\n    onSuccess: () => {\n      setIsSuccess(true);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to reset password\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (values: z.infer<typeof resetPasswordSchema>) => {\n    resetPasswordMutation.mutate({ password: values.password });\n  };\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader>\n            <CardTitle>Invalid Reset Link</CardTitle>\n            <CardDescription>\n              This password reset link is invalid or has expired.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/forgot-password\">\n              <Button className=\"w-full\">Request New Reset Link</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isSuccess) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4\">\n              <CheckCircle className=\"h-6 w-6 text-green-600\" />\n            </div>\n            <CardTitle>Password Reset Successful</CardTitle>\n            <CardDescription className=\"mt-2\">\n              Your password has been successfully reset. You can now sign in with your new password.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/auth\">\n              <Button className=\"w-full\">Sign In</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center px-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <div className=\"mx-auto w-12 h-12 bg-askEdithTeal/10 rounded-full flex items-center justify-center mb-4\">\n            <Lock className=\"h-6 w-6 text-askEdithTeal\" />\n          </div>\n          <CardTitle className=\"text-center\">Reset Your Password</CardTitle>\n          <CardDescription className=\"text-center\">\n            Enter your new password below\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>New Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Enter new password\"\n                        {...field}\n                        disabled={resetPasswordMutation.isPending}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"confirmPassword\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Confirm Password</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"password\"\n                        placeholder=\"Confirm new password\"\n                        {...field}\n                        disabled={resetPasswordMutation.isPending}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"text-xs text-gray-600 space-y-1\">\n                <p>Password must:</p>\n                <ul className=\"list-disc list-inside space-y-0.5\">\n                  <li>Be at least 8 characters long</li>\n                  <li>Contain at least one uppercase letter</li>\n                  <li>Contain at least one lowercase letter</li>\n                  <li>Contain at least one number</li>\n                </ul>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full\"\n                disabled={resetPasswordMutation.isPending}\n              >\n                {resetPasswordMutation.isPending ? \"Resetting...\" : \"Reset Password\"}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":6630},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\n// Configure Neon WebSocket\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\n// Create pool with connection retry settings\nexport const pool = new Pool({ \n  connectionString: process.env.DATABASE_URL,\n  connectionTimeoutMillis: 10000,\n  idleTimeoutMillis: 30000,\n  max: 5,\n});\n\n// Handle pool connection errors gracefully\npool.on('error', (err) => {\n  console.warn('Database pool error:', err.message);\n});\n\nexport const db = drizzle({ client: pool, schema });","size_bytes":763},"client/src/pages/ExpertApplicationWithPayment.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { uploadFile } from \"@/lib/supabase\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { supabase } from \"@/lib/supabase\";\nimport { CheckCircle, Clock, XCircle, UserCheck, FileText, Upload, DollarSign, CreditCard, Linkedin } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\n// Make sure to call `loadStripe` outside of a component's render to avoid\n// recreating the `Stripe` object on every render.\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst expertApplicationSchema = z.object({\n  profession: z.string().min(2, \"Profession is required\"),\n  expertiseArea: z.string().min(5, \"Please describe your areas of expertise\"),\n  yearsOfExperience: z.number().min(1, \"Years of experience must be at least 1\").max(50, \"Please enter a realistic number\"),\n  credentials: z.string().min(10, \"Please provide your credentials and qualifications\"),\n  bio: z.string().min(50, \"Please provide a detailed bio (at least 50 characters)\"),\n  licenseNumber: z.string().min(1, \"License number is required\"),\n  // Company information\n  company: z.string().min(2, \"Company/Organization name is required\"),\n  companyAddress: z.string().min(10, \"Company address is required\"),\n  companyWebsite: z.string().url(\"Please enter a valid company website URL\").optional().or(z.literal(\"\")),\n  companyEmail: z.string().email(\"Please enter a valid company email\"),\n  // Professional links\n  websiteUrl: z.string().url(\"Please enter a valid website URL\").optional().or(z.literal(\"\")),\n  linkedinUrl: z.string().url(\"Please enter a valid LinkedIn URL\").optional().or(z.literal(\"\")),\n  blogUrl: z.string().url(\"Please enter a valid blog URL\").optional().or(z.literal(\"\")),\n  booksUrl: z.string().url(\"Please enter a valid books/publications URL\").optional().or(z.literal(\"\")),\n  articlesUrl: z.string().url(\"Please enter a valid articles URL\").optional().or(z.literal(\"\")),\n  // Consultation settings\n  consultationRate: z.number().min(50, \"Minimum consultation rate is $50/hour\").max(500, \"Maximum rate is $500/hour\"),\n  consultationEnabled: z.boolean().default(true),\n  reasonForApplying: z.string().min(20, \"Please explain why you want to become a verified expert\"),\n  // LinkedIn import option\n  importFromLinkedIn: z.boolean().default(false),\n});\n\ntype ExpertApplicationForm = z.infer<typeof expertApplicationSchema>;\n\nconst PaymentForm = ({ onPaymentSuccess }: { onPaymentSuccess: () => void }) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    console.log('Payment form submitted');\n\n    if (!stripe || !elements) {\n      const errorMsg = 'Stripe or Elements not initialized';\n      console.error(errorMsg);\n      toast({\n        title: \"Payment Error\",\n        description: \"Stripe has not been properly initialized. Please refresh the page and try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n    console.log('Processing payment...');\n\n    try {\n      console.log('Calling stripe.confirmPayment...');\n      \n      const { error, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: window.location.origin + \"/expert-application/success\",\n        },\n        redirect: \"if_required\",\n      });\n\n      console.log('stripe.confirmPayment result:', { error, paymentIntent });\n\n      if (error) {\n        // Check if this is a specific error about payment intent state\n        if (error.type === 'invalid_request_error' && error.code === 'payment_intent_unexpected_state') {\n          console.log('Payment intent in unexpected state, checking if already succeeded:', error);\n          \n          // The payment might have already succeeded, let's proceed with the application\n          toast({\n            title: \"Processing Application\",\n            description: \"Verifying payment status and submitting your application...\",\n          });\n          \n          // Proceed directly to payment success\n          onPaymentSuccess();\n          return;\n        }\n        console.error('Payment error from Stripe:', error);\n        setIsProcessing(false);\n        throw error;\n      }\n\n      // Check payment intent status\n      if (paymentIntent && paymentIntent.status === 'succeeded') {\n        console.log('Payment successful, calling onPaymentSuccess');\n        toast({\n          title: \"Payment Successful\",\n          description: \"Your verification fee has been processed. Submitting your application...\",\n        });\n        onPaymentSuccess();\n      } else if (paymentIntent && paymentIntent.status === 'requires_action') {\n        console.log('Payment requires action (3D Secure), browser will redirect...');\n        // The browser will handle the redirect automatically due to redirect: \"if_required\"\n        return;\n      } else {\n        console.log('Unexpected payment status:', paymentIntent?.status);\n        toast({\n          title: \"Payment Processing\",\n          description: \"Your payment is being processed. Please wait...\",\n          variant: \"default\",\n        });\n      }\n    } catch (error: any) {\n      console.error(\"Payment error:\", error);\n      toast({\n        title: \"Payment Failed\",\n        description: error.message || \"An error occurred while processing your payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      console.log('Payment processing complete');\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <DollarSign className=\"h-5 w-5 text-teal-600\" />\n          <h3 className=\"font-semibold text-teal-800\">Expert Verification Fee</h3>\n        </div>\n        <p className=\"text-teal-700 text-sm mb-3\">\n          A one-time $100 verification fee ensures the quality and authenticity of our expert community.\n        </p>\n        <div className=\"text-2xl font-bold text-teal-800\">$100.00</div>\n      </div>\n\n      <PaymentElement />\n      \n      <Button \n        type=\"submit\" \n        disabled={!stripe || isProcessing} \n        className=\"w-full\"\n        size=\"lg\"\n      >\n        {isProcessing ? (\n          <>\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n            Processing Payment...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-4 h-4 mr-2\" />\n            Pay $100 & Submit Application\n          </>\n        )}\n      </Button>\n    </form>\n  );\n};\n\nexport default function ExpertApplicationWithPayment() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'form' | 'payment' | 'success'>('form');\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [applicationData, setApplicationData] = useState<ExpertApplicationForm | null>(null);\n  const [profileImage, setProfileImage] = useState<File | null>(null);\n  const [licenseFile, setLicenseFile] = useState<File | null>(null);\n\n  // Check if user already has an expert verification\n  const { data: existingApplication, isLoading: checkingExisting } = useQuery({\n    queryKey: ['/api/experts/my-application'],\n    enabled: !!user?.id,\n    retry: false,\n    queryFn: async () => {\n      const res = await apiRequest('GET', '/api/experts/my-application');\n      if (res.status === 404) {\n        return null;\n      }\n      return res.json();\n    }\n  });\n\n  const form = useForm<ExpertApplicationForm>({\n    resolver: zodResolver(expertApplicationSchema),\n    defaultValues: {\n      profession: \"\",\n      expertiseArea: \"\",\n      yearsOfExperience: 5,\n      credentials: \"\",\n      bio: \"\",\n      licenseNumber: \"\",\n      company: \"\",\n      companyAddress: \"\",\n      companyWebsite: \"\",\n      companyEmail: \"\",\n      websiteUrl: \"\",\n      linkedinUrl: \"\",\n      blogUrl: \"\",\n      booksUrl: \"\",\n      articlesUrl: \"\",\n      consultationRate: 150,\n      consultationEnabled: true,\n      reasonForApplying: \"\",\n      importFromLinkedIn: false,\n    },\n  });\n\n  const [paymentIntentId, setPaymentIntentId] = useState<string>(\"\");\n  \n  const createPaymentIntentMutation = useMutation({\n    mutationFn: async () => {\n      console.log('Creating checkout session...');\n      // Save application data to localStorage before redirecting\n      if (applicationData) {\n        localStorage.setItem('expertApplicationData', JSON.stringify(applicationData));\n      }\n      \n      const response = await apiRequest(\"POST\", \"/api/experts/create-checkout-session\", { \n        applicationData \n      });\n      console.log('Checkout session response:', response);\n      return response;\n    },\n    onSuccess: (data) => {\n      console.log('Checkout session created successfully:', data);\n      if (!data.url) {\n        console.error('No checkout URL in response');\n        toast({\n          title: \"Payment Setup Failed\",\n          description: \"Invalid payment response. Please try again.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      // Redirect to Stripe Checkout\n      window.location.href = data.url;\n    },\n    onError: (error: any) => {\n      console.error('Checkout session creation failed:', error);\n      toast({\n        title: \"Payment Setup Failed\",\n        description: error.message || \"Failed to setup payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const submitApplicationMutation = useMutation({\n    mutationFn: async (data: ExpertApplicationForm) => {\n      let profileImageUrl: string | undefined = undefined;\n      let licenseFileUrl: string | undefined = undefined;\n\n      if (!user) {\n        throw new Error(\"User not authenticated for file upload.\");\n      }\n\n      try {\n        // Skip file uploads for now - they're optional\n        console.log('Submitting application without file uploads...');\n        const payload = { \n          ...data, \n          profileImageUrl: undefined, \n          licenseFileUrl: undefined,\n          stripePaymentIntentId: paymentIntentId \n        };\n        \n        return await apiRequest(\"POST\", \"/api/experts/apply-with-payment\", payload);\n      } catch (error: any) {\n        console.error('Application submission error:', error);\n        throw error;\n      }\n    },\n    onSuccess: () => {\n      setStep('success');\n      toast({\n        title: \"Application Submitted\",\n        description: \"Your expert verification application has been submitted for review.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Application Failed\",\n        description: error.message || \"Failed to submit application. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onFormSubmit = (data: ExpertApplicationForm) => {\n    setApplicationData(data);\n    createPaymentIntentMutation.mutate();\n  };\n\n  const onPaymentSuccess = () => {\n    if (applicationData) {\n      submitApplicationMutation.mutate(applicationData);\n    }\n  };\n\n  const handleLinkedInImport = async () => {\n    toast({\n      title: \"LinkedIn Import\",\n      description: \"LinkedIn profile import feature coming soon! For now, please fill out the form manually.\",\n    });\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <UserCheck className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to apply for expert verification status.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (checkingExisting) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  // Show status if user already has an application\n  if (existingApplication) {\n    const getStatusIcon = (status: string) => {\n      switch (status) {\n        case 'verified':\n          return <CheckCircle className=\"h-8 w-8 text-green-500\" />;\n        case 'pending':\n          return <Clock className=\"h-8 w-8 text-yellow-500\" />;\n        case 'rejected':\n          return <XCircle className=\"h-8 w-8 text-red-500\" />;\n        default:\n          return <FileText className=\"h-8 w-8 text-gray-500\" />;\n      }\n    };\n\n    const getStatusMessage = (status: string) => {\n      switch (status) {\n        case 'verified':\n          return {\n            title: \"You're Already Verified!\",\n            description: \"Congratulations! You are already a verified expert on AskEdith.\",\n            action: \"View Your Profile\"\n          };\n        case 'pending':\n          return {\n            title: \"Application Under Review\",\n            description: \"Your expert verification application is currently being reviewed by our team.\",\n            action: \"Update Application\"\n          };\n        case 'rejected':\n          return {\n            title: \"Application Not Approved\",\n            description: \"Your previous application was not approved. You can submit a new application with updated information.\",\n            action: \"Reapply\"\n          };\n        default:\n          return {\n            title: \"Application Submitted\",\n            description: \"Your application has been submitted.\",\n            action: \"View Status\"\n          };\n      }\n    };\n\n    const statusInfo = getStatusMessage(existingApplication.verificationStatus);\n\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            {getStatusIcon(existingApplication.verificationStatus)}\n            <h2 className=\"text-2xl font-semibold mt-4 mb-2\">{statusInfo.title}</h2>\n            <p className=\"text-gray-600 mb-6\">{statusInfo.description}</p>\n            \n            <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n              <h3 className=\"font-semibold mb-2\">Application Details:</h3>\n              <div className=\"space-y-1 text-sm\">\n                <p><span className=\"font-medium\">Profession:</span> {existingApplication.profession}</p>\n                <p><span className=\"font-medium\">Expertise:</span> {existingApplication.expertiseArea}</p>\n                <p><span className=\"font-medium\">Experience:</span> {existingApplication.yearsExperience} years</p>\n                <p><span className=\"font-medium\">Status:</span> \n                  <Badge className=\"ml-2\" variant={\n                    existingApplication.verificationStatus === 'verified' ? 'default' :\n                    existingApplication.verificationStatus === 'pending' ? 'secondary' : 'destructive'\n                  }>\n                    {existingApplication.verificationStatus}\n                  </Badge>\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex gap-4 justify-center\">\n              {existingApplication.verificationStatus === 'verified' && (\n                <Button onClick={() => window.location.href = `/expert/${user?.id}`}>\n                  {statusInfo.action}\n                </Button>\n              )}\n              {existingApplication.verificationStatus === 'rejected' && (\n                <Button onClick={() => window.location.reload()}>\n                  {statusInfo.action}\n                </Button>\n              )}\n              <Button onClick={() => window.location.href = '/community'}>\n                Explore Community\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                Go to Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Application Submitted Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Thank you for your payment and application. Our team will review your credentials and get back to you within 3-5 business days.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/'}>\n                Return to Home\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'payment') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n        <div className=\"max-w-2xl mx-auto\">\n          <Card>\n            <CardContent className=\"text-center p-8\">\n              <div className=\"animate-spin w-16 h-16 border-4 border-teal-600 border-t-transparent rounded-full mx-auto mb-4\" />\n              <h2 className=\"text-2xl font-semibold mb-4\">Redirecting to Payment...</h2>\n              <p className=\"text-gray-600\">\n                Please wait while we redirect you to our secure payment page.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        \n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">Apply for Expert Verification</h1>\n          <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n            Join our trusted community of verified experts and start earning through consultations. \n            One-time $100 verification fee ensures quality and authenticity.\n          </p>\n        </div>\n\n        {/* Benefits Card */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-green-500\" />\n              Expert Verification Benefits\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Verified Expert Badge</h4>\n                  <p className=\"text-sm text-gray-600\">Display your credentials with a verified expert badge</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Consultation Bookings</h4>\n                  <p className=\"text-sm text-gray-600\">Earn money through paid consultation sessions</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Featured Profile</h4>\n                  <p className=\"text-sm text-gray-600\">Get featured in our expert directory</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-1 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium\">Priority Support</h4>\n                  <p className=\"text-sm text-gray-600\">Enhanced visibility for your helpful contributions</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* LinkedIn Import Option */}\n        <Card className=\"mb-8\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Linkedin className=\"h-6 w-6 text-blue-600\" />\n                <div>\n                  <h3 className=\"font-semibold\">Import from LinkedIn</h3>\n                  <p className=\"text-sm text-gray-600\">Pre-fill your application with LinkedIn profile data</p>\n                </div>\n              </div>\n              <Button onClick={handleLinkedInImport} variant=\"outline\">\n                Import Profile\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Application Form */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Expert Verification Application</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onFormSubmit)} className=\"space-y-6\">\n                \n                {/* Basic Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Basic Information</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <FormField\n                      control={form.control}\n                      name=\"profession\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Profession *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"e.g., Geriatrician, Social Worker, Elder Law Attorney\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"yearsOfExperience\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Years of Professional Experience *</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"number\" \n                              min=\"1\" \n                              max=\"50\"\n                              {...field}\n                              onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"expertiseArea\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Areas of Expertise *</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Describe your specific areas of expertise in caregiving, healthcare, legal, financial, or other relevant fields...\"\n                            className=\"min-h-[100px]\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Be specific about your specializations (e.g., dementia care, Medicare planning, elder law)\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"bio\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Professional Bio *</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Tell us about your background, experience, and what drives your passion for helping families...\"\n                            className=\"min-h-[150px]\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormDescription>\n                          This will be displayed on your expert profile page\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Credentials & License */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Credentials & License</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"credentials\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Credentials & Qualifications *</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"List your relevant degrees, certifications, licenses, and professional affiliations...\"\n                            className=\"min-h-[120px]\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Include degrees, licenses, certifications, and professional memberships\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"licenseNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>License Number *</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Your professional license number\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">License Document Upload (Optional)</label>\n                    <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center\">\n                      <Upload className=\"h-8 w-8 mx-auto mb-2 text-gray-400\" />\n                      <input\n                        type=\"file\"\n                        accept=\".pdf,.jpg,.jpeg,.png\"\n                        onChange={(e) => setLicenseFile(e.target.files?.[0] || null)}\n                        className=\"hidden\"\n                        id=\"license-upload\"\n                      />\n                      <label htmlFor=\"license-upload\" className=\"cursor-pointer\">\n                        <span className=\"text-sm text-gray-600\">\n                          Click to upload your professional license or certification\n                        </span>\n                        <p className=\"text-xs text-gray-500 mt-1\">PDF, JPG, PNG up to 5MB (Optional)</p>\n                      </label>\n                      {licenseFile && (\n                        <p className=\"text-sm text-green-600 mt-2\">âœ“ {licenseFile.name}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Company Information */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Company Information</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <FormField\n                      control={form.control}\n                      name=\"company\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company/Organization *</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Your company or organization name\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"companyEmail\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company Email *</FormLabel>\n                          <FormControl>\n                            <Input type=\"email\" placeholder=\"company@example.com\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyAddress\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Company Address *</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Full company address including city, state, and zip code\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyWebsite\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Company Website</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"https://yourcompany.com\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Professional Links */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Professional Links & Publications</h3>\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <FormField\n                      control={form.control}\n                      name=\"websiteUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Personal Website</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"https://yourwebsite.com\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"linkedinUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>LinkedIn Profile</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"https://linkedin.com/in/yourprofile\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"blogUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Blog/Newsletter</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"https://yourblog.com or Substack URL\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"booksUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Published Books</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Amazon author page or book links\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"articlesUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Published Articles</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Links to your published articles\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                {/* Profile Photo */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Profile Photo</h3>\n                  \n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">Professional Photo</label>\n                    <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center\">\n                      <Upload className=\"h-8 w-8 mx-auto mb-2 text-gray-400\" />\n                      <input\n                        type=\"file\"\n                        accept=\".jpg,.jpeg,.png\"\n                        onChange={(e) => setProfileImage(e.target.files?.[0] || null)}\n                        className=\"hidden\"\n                        id=\"photo-upload\"\n                      />\n                      <label htmlFor=\"photo-upload\" className=\"cursor-pointer\">\n                        <span className=\"text-sm text-gray-600\">\n                          Click to upload your professional headshot\n                        </span>\n                        <p className=\"text-xs text-gray-500 mt-1\">JPG, PNG up to 2MB</p>\n                      </label>\n                      {profileImage && (\n                        <p className=\"text-sm text-green-600 mt-2\">âœ“ {profileImage.name}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Consultation Settings */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Consultation Settings</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"consultationRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Hourly Consultation Rate (USD) *</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            min=\"50\" \n                            max=\"500\"\n                            placeholder=\"150\"\n                            {...field}\n                            onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Set your hourly rate for consultation sessions ($50-$500)\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"consultationEnabled\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                          />\n                        </FormControl>\n                        <div className=\"space-y-1 leading-none\">\n                          <FormLabel>\n                            Enable consultation bookings after verification\n                          </FormLabel>\n                          <FormDescription>\n                            Allow clients to book paid consultation sessions with you\n                          </FormDescription>\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Reason for Applying */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold border-b pb-2\">Application Details</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"reasonForApplying\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Why do you want to become a verified expert? *</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"Share your motivation for joining our expert community and how you plan to help families...\"\n                            className=\"min-h-[100px]\"\n                            {...field} \n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"pt-6 border-t\">\n                  <Button \n                    type=\"submit\" \n                    disabled={createPaymentIntentMutation.isPending}\n                    className=\"w-full\"\n                    size=\"lg\"\n                  >\n                    {createPaymentIntentMutation.isPending ? (\n                      <>\n                        <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                        Setting up payment...\n                      </>\n                    ) : (\n                      <>\n                        <CreditCard className=\"w-4 h-4 mr-2\" />\n                        Continue to Payment ($100)\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":40745},"CLAUDE.md":{"content":"# CLAUDE.md\n\nThis file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\n\n## Project Overview\n\nCaregiversCommunity is a full-stack caregivers support platform built with React, Express.js, GraphQL, PostgreSQL, Redis, and Stripe. It provides a forum for caregivers to connect, share resources, get expert advice, and book consultations with verified professionals.\n\n## Architecture\n\n### Frontend (client/)\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter for lightweight routing\n- **State Management**: TanStack Query (React Query) for server state\n- **UI Components**: Radix UI primitives with Tailwind CSS\n- **Authentication**: Session-based with custom useAuth hook\n- **Build Tool**: Vite with path aliases (@/ for client/src, @shared/ for shared)\n\n### Backend (server/)\n- **Framework**: Express.js with TypeScript\n- **Database**: PostgreSQL with Drizzle ORM\n- **Caching**: Redis for sessions and performance\n- **API**: Both REST endpoints and GraphQL (Apollo Server)\n- **Authentication**: Passport.js with local strategy\n- **Payments**: Stripe for expert consultations and premium features\n- **Moderation**: AI-powered content moderation\n- **File Storage**: Integration for profile images and license documents\n\n### Database Schema (shared/schema.ts)\nKey entities include:\n- Users (with roles: user, admin, expert)\n- Categories (hierarchical forum structure)\n- Posts and Comments (with voting system)\n- Expert Verifications (for professional credentials)\n- Consultations/Appointments (for expert bookings)\n- Achievements (gamification system)\n- Moderation Results (AI content moderation)\n\n## Development Commands\n\n```bash\n# Development\nnpm run dev                    # Start development server (client + server)\n\n# Database\nnpm run db:push               # Push schema changes to database\nnpm run seed                  # Seed database with initial data\nnpm run db:health             # Check database connection\n\n# Build & Deploy\nnpm run build                 # Build for production\nnpm run start                 # Start production server\nnpm run check                 # TypeScript type checking\n```\n\n## Key Development Patterns\n\n### File Structure\n- `client/src/pages/` - Route components\n- `client/src/components/` - Reusable UI components\n- `client/src/hooks/` - Custom React hooks\n- `client/src/lib/` - Utilities and configurations\n- `server/routes.ts` - REST API endpoints\n- `server/graphql/` - GraphQL schema and resolvers\n- `shared/schema.ts` - Database schema and types\n\n### Authentication Flow\nAuthentication uses session-based auth with Passport.js:\n- `useAuth()` hook provides user state\n- `isAuthenticated` middleware protects routes\n- User roles determine access levels (user/admin/expert)\n\n### Data Fetching\n- Use TanStack Query for server state management\n- GraphQL for complex queries, REST for simple operations\n- Mutations use optimistic updates where appropriate\n\n### UI Components\n- All components use Tailwind CSS for styling\n- Radix UI provides accessible primitives\n- Components follow the shadcn/ui pattern in `client/src/components/ui/`\n\n### Database Operations\n- Use Drizzle ORM for type-safe database queries\n- All queries go through proper error handling\n- Transactions for complex operations\n\n## Environment Setup\n\nRequired environment variables:\n- `DATABASE_URL` - PostgreSQL connection string\n- `REDIS_URL` - Redis connection string (optional, falls back to in-memory)\n- `STRIPE_SECRET_KEY` - Stripe API key for payments\n- `ANTHROPIC_API_KEY` - For AI content moderation\n- `SESSION_SECRET` - Session encryption key\n\n## Testing\n\nThe project does not currently have a test suite configured. When adding tests, consider:\n- Unit tests for utilities and pure functions\n- Integration tests for API endpoints\n- Component tests for React components\n- E2E tests for critical user flows\n\n## Deployment Notes\n\n- Server runs on port 5001 by default\n- Production build serves static files from Express\n- Database migrations are handled via Drizzle Kit\n- Redis is optional but recommended for production\n\n## Common Tasks\n\n### Adding New Features\n1. Update database schema in `shared/schema.ts`\n2. Run `npm run db:push` to apply schema changes\n3. Add API endpoints in `server/routes.ts` or GraphQL resolvers\n4. Create React components and pages\n5. Update TypeScript types as needed\n\n### Working with Authentication\n- User authentication state is managed in `client/src/hooks/useAuth.tsx`\n- Protected routes check user roles and authentication status\n- Expert verification requires manual admin approval\n\n### Content Moderation\n- All posts and comments are automatically moderated via AI\n- Moderation results are stored in the database\n- Admins can review flagged content\n\n### Payment Integration\n- Stripe handles all payment processing\n- Expert consultations use Stripe Connect for marketplace payments\n- Premium subscriptions are managed through Stripe billing","size_bytes":4936},"shared/schema.ts":{"content":"import {\n  pgTable,\n  text,\n  varchar,\n  timestamp,\n  jsonb,\n  index,\n  serial,\n  integer,\n  boolean,\n  real,\n  unique,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// Session storage table for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table for Replit Auth\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().notNull(),\n  username: varchar(\"username\").unique().notNull(),\n  email: varchar(\"email\").unique(),\n  password: varchar(\"password\").notNull(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  communityName: varchar(\"community_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  defaultProfileType: varchar(\"default_profile_type\").default(\"daisy\"), // \"daisy\" or \"tree\"\n  city: varchar(\"city\"),\n  role: varchar(\"role\", { length: 50 }).default(\"user\").notNull(), // 'user', 'admin', 'expert'\n  approved: varchar(\"approved\", { length: 20 }).default(\"no\").notNull(), // 'yes', 'no', 'not applicable'\n  state: varchar(\"state\"),\n  timezone: varchar(\"timezone\", { length: 100 }).default(\"UTC\"), // IANA timezone identifier\n  introduction: text(\"introduction\"),\n  stripeCustomerId: varchar(\"stripe_customer_id\"),\n  stripeSubscriptionId: varchar(\"stripe_subscription_id\"),\n  isPremium: boolean(\"is_premium\").default(false),\n  emailVerified: boolean(\"email_verified\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Categories for discussions - now supports hierarchy\nexport const categories = pgTable(\"categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  slug: varchar(\"slug\", { length: 100 }).notNull().unique(),\n  color: varchar(\"color\", { length: 50 }).notNull(),\n  icon: varchar(\"icon\", { length: 50 }).notNull(),\n  postCount: integer(\"post_count\").default(0),\n  parentId: integer(\"parent_id\"), // For hierarchy - will add reference later\n  level: integer(\"level\").default(0), // 0=General, 1=Main, 2=Subtopic\n  orderIndex: integer(\"order_index\").default(0), // For sorting\n  isOfficial: boolean(\"is_official\").default(false), // Whether it appears in main sidebar\n  createdBy: varchar(\"created_by\").references(() => users.id), // User who created the forum\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Posts/discussions\nexport const posts = pgTable(\"posts\", {\n  id: serial(\"id\").primaryKey(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  content: text(\"content\").notNull(),\n  authorId: varchar(\"author_id\").notNull().references(() => users.id),\n  categoryId: integer(\"category_id\").notNull().references(() => categories.id),\n  helpfulVotes: integer(\"helpful_votes\").default(0),\n  commentCount: integer(\"comment_count\").default(0),\n  isResolved: boolean(\"is_resolved\").default(false),\n  isSticky: boolean(\"is_sticky\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_posts_author_id\").on(table.authorId),\n  index(\"idx_posts_category_id\").on(table.categoryId),\n  index(\"idx_posts_created_at\").on(table.createdAt),\n  index(\"idx_posts_sticky_created\").on(table.isSticky, table.createdAt),\n]);\n\n// Comments on posts\nexport const comments = pgTable(\"comments\", {\n  id: serial(\"id\").primaryKey(),\n  content: text(\"content\").notNull(),\n  authorId: varchar(\"author_id\").notNull().references(() => users.id),\n  postId: integer(\"post_id\").notNull().references(() => posts.id),\n  parentId: integer(\"parent_id\"), // Self-reference - will add FK later\n  helpfulVotes: integer(\"helpful_votes\").default(0),\n  isExpertResponse: boolean(\"is_expert_response\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Helpful votes tracking\nexport const votes = pgTable(\"votes\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  postId: integer(\"post_id\").references(() => posts.id),\n  commentId: integer(\"comment_id\").references(() => comments.id),\n  voteType: varchar(\"vote_type\", { length: 10 }).notNull(), // 'up' or 'down'\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Achievement system\nexport const achievements = pgTable(\"achievements\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  description: text(\"description\"),\n  badgeIcon: varchar(\"badge_icon\", { length: 50 }),\n  badgeColor: varchar(\"badge_color\", { length: 50 }),\n  criteria: jsonb(\"criteria\"), // JSON criteria for earning the badge\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User achievements (many-to-many)\nexport const userAchievements = pgTable(\"user_achievements\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  achievementId: integer(\"achievement_id\").notNull().references(() => achievements.id),\n  earnedAt: timestamp(\"earned_at\").defaultNow(),\n});\n\n// Expert verifications\nexport const expertVerifications = pgTable(\"expert_verifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  profession: varchar(\"profession\", { length: 100 }),\n  expertiseArea: varchar(\"expertise_area\"),\n  credentials: text(\"credentials\"),\n  professionalTitle: varchar(\"professional_title\"),\n  company: varchar(\"company\"),\n  companyAddress: text(\"company_address\"),\n  companyWebsite: varchar(\"company_website\"),\n  companyEmail: varchar(\"company_email\"),\n  companyPhone: varchar(\"company_phone\"),\n  professionalAssociation: varchar(\"professional_association\"),\n  website: varchar(\"website\"),\n  linkedinUrl: varchar(\"linkedin_url\"),\n  blogUrl: varchar(\"blog_url\"),\n  booksUrl: varchar(\"books_url\"),\n  articlesUrl: varchar(\"articles_url\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  licenseFileUrl: varchar(\"license_file_url\"), // URL to uploaded license file\n  bio: text(\"bio\"),\n  yearsExperience: integer(\"years_experience\"),\n  licenseNumber: varchar(\"license_number\"),\n  // Payment tracking\n  stripePaymentIntentId: varchar(\"stripe_payment_intent_id\"),\n  verificationFeeStatus: varchar(\"verification_fee_status\", { length: 20 }).default(\"pending\"), // pending, paid, failed\n  verificationFeePaidAt: timestamp(\"verification_fee_paid_at\"),\n  // Status tracking\n  verificationStatus: varchar(\"verification_status\", { length: 20 }).default(\"pending\"),\n  verifiedAt: timestamp(\"verified_at\"),\n  verifiedBy: varchar(\"verified_by\"),\n  featuredExpert: boolean(\"featured_expert\").default(false),\n  // Consultation settings\n  consultationRate: integer(\"consultation_rate\"), // hourly rate in cents\n  consultationEnabled: boolean(\"consultation_enabled\").default(false),\n  availabilitySchedule: text(\"availability_schedule\"), // JSON string for schedule\n  // Stripe Connect integration\n  stripeConnectAccountId: varchar(\"stripe_connect_account_id\"),\n  hourlyRate: integer(\"hourly_rate\").default(10000), // hourly rate in cents, default $100\n  // Appointment booking settings\n  allowBooking: boolean(\"allow_booking\").default(false), // Allow appointment booking after verification\n  calendlyLink: text(\"calendly_link\"), // Expert's Calendly link for booking appointments\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_expert_verifications_user_id\").on(table.userId),\n  index(\"idx_expert_verifications_status\").on(table.verificationStatus),\n  index(\"idx_expert_verifications_created_at\").on(table.createdAt),\n]);\n\n// Post sources for expert content attribution\nexport const postSources = pgTable(\"post_sources\", {\n  id: serial(\"id\").primaryKey(),\n  postId: integer(\"post_id\").notNull().references(() => posts.id, { onDelete: \"cascade\" }),\n  sourceType: varchar(\"source_type\", { length: 50 }).notNull(), // 'linkedin', 'blog', 'book', 'article', 'original'\n  sourceTitle: varchar(\"source_title\"),\n  sourceUrl: varchar(\"source_url\"),\n  publicationDate: timestamp(\"publication_date\"),\n  publisher: varchar(\"publisher\"),\n  isbn: varchar(\"isbn\"), // for books\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Content moderation\nexport const moderationResults = pgTable(\"moderation_results\", {\n  id: serial(\"id\").primaryKey(),\n  contentId: varchar(\"content_id\").notNull(),\n  contentType: varchar(\"content_type\").notNull(), // 'post' or 'comment'\n  moderationScore: real(\"moderation_score\").notNull(),\n  flaggedCategories: text(\"flagged_categories\").array(),\n  moderationStatus: varchar(\"moderation_status\").notNull().default(\"approved\"), // 'approved', 'flagged', 'rejected'\n  aiResponse: text(\"ai_response\"),\n  reviewedBy: varchar(\"reviewed_by\"),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Consultation bookings\nexport const consultations = pgTable(\"consultations\", {\n  id: serial(\"id\").primaryKey(),\n  expertId: varchar(\"expert_id\").notNull().references(() => users.id),\n  clientId: varchar(\"client_id\").notNull().references(() => users.id),\n  scheduledAt: timestamp(\"scheduled_at\").notNull(),\n  duration: integer(\"duration\").notNull().default(60), // duration in minutes\n  rate: integer(\"rate\").notNull(), // rate in cents\n  totalAmount: integer(\"total_amount\").notNull(), // total amount in cents\n  stripePaymentIntentId: varchar(\"stripe_payment_intent_id\"),\n  paymentStatus: varchar(\"payment_status\", { length: 20 }).default(\"pending\"), // pending, paid, failed, refunded\n  bookingStatus: varchar(\"booking_status\", { length: 20 }).default(\"scheduled\"), // scheduled, completed, cancelled, no_show\n  meetingLink: varchar(\"meeting_link\"), // Zoom/Google Meet link\n  notes: text(\"notes\"), // Client's request or expert's notes\n  cancelledAt: timestamp(\"cancelled_at\"),\n  cancelledBy: varchar(\"cancelled_by\"),\n  cancellationReason: text(\"cancellation_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Content Sources for \"This Week by...\"\nexport const contentSources = pgTable(\"content_sources\", {\n  id: serial(\"id\").primaryKey(),\n  categoryId: varchar(\"category_id\", { length: 50 }).notNull(),\n  categoryName: varchar(\"category_name\", { length: 100 }).notNull(),\n  name: varchar(\"name\", { length: 200 }).notNull(),\n  description: text(\"description\"),\n  embedCode: text(\"embed_code\"),\n  websiteUrl: varchar(\"website_url\", { length: 500 }),\n  isActive: boolean(\"is_active\").default(true),\n  orderIndex: integer(\"order_index\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Q&A Knowledge Base\nexport const qaKnowledge = pgTable(\"qa_knowledge\", {\n  id: serial(\"id\").primaryKey(),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  category: varchar(\"category\", { length: 100 }),\n  keywords: text(\"keywords\").array(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// RAG Embeddings for vector search\nexport const qaEmbeddings = pgTable(\"qa_embeddings\", {\n  id: serial(\"id\").primaryKey(),\n  chunkText: text(\"chunk_text\").notNull(),\n  embedding: text(\"embedding\"), // Will be cast to vector(1536) in migration\n  metadata: jsonb(\"metadata\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  posts: many(posts),\n  comments: many(comments),\n  votes: many(votes),\n  achievements: many(userAchievements),\n  expertVerification: many(expertVerifications),\n}));\n\nexport const categoriesRelations = relations(categories, ({ many }) => ({\n  posts: many(posts),\n}));\n\nexport const postsRelations = relations(posts, ({ one, many }) => ({\n  author: one(users, {\n    fields: [posts.authorId],\n    references: [users.id],\n  }),\n  category: one(categories, {\n    fields: [posts.categoryId],\n    references: [categories.id],\n  }),\n  comments: many(comments),\n  votes: many(votes),\n  source: one(postSources),\n}));\n\nexport const commentsRelations = relations(comments, ({ one, many }) => ({\n  author: one(users, {\n    fields: [comments.authorId],\n    references: [users.id],\n  }),\n  post: one(posts, {\n    fields: [comments.postId],\n    references: [posts.id],\n  }),\n  parent: one(comments, {\n    fields: [comments.parentId],\n    references: [comments.id],\n  }),\n  replies: many(comments),\n  votes: many(votes),\n}));\n\nexport const votesRelations = relations(votes, ({ one }) => ({\n  user: one(users, {\n    fields: [votes.userId],\n    references: [users.id],\n  }),\n  post: one(posts, {\n    fields: [votes.postId],\n    references: [posts.id],\n  }),\n  comment: one(comments, {\n    fields: [votes.commentId],\n    references: [comments.id],\n  }),\n}));\n\nexport const achievementsRelations = relations(achievements, ({ many }) => ({\n  userAchievements: many(userAchievements),\n}));\n\nexport const userAchievementsRelations = relations(userAchievements, ({ one }) => ({\n  user: one(users, {\n    fields: [userAchievements.userId],\n    references: [users.id],\n  }),\n  achievement: one(achievements, {\n    fields: [userAchievements.achievementId],\n    references: [achievements.id],\n  }),\n}));\n\nexport const expertVerificationsRelations = relations(expertVerifications, ({ one }) => ({\n  user: one(users, {\n    fields: [expertVerifications.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const consultationsRelations = relations(consultations, ({ one }) => ({\n  expert: one(users, {\n    fields: [consultations.expertId],\n    references: [users.id],\n  }),\n  client: one(users, {\n    fields: [consultations.clientId],\n    references: [users.id],\n  }),\n}));\n\nexport const postSourcesRelations = relations(postSources, ({ one }) => ({\n  post: one(posts, {\n    fields: [postSources.postId],\n    references: [posts.id],\n  }),\n}));\n\nexport const moderationResultsRelations = relations(moderationResults, ({ one }) => ({\n  reviewer: one(users, {\n    fields: [moderationResults.reviewedBy],\n    references: [users.id],\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true });\nexport const insertPostSchema = createInsertSchema(posts);\nexport const insertCommentSchema = createInsertSchema(comments);\nexport const insertCategorySchema = createInsertSchema(categories);\nexport const insertVoteSchema = createInsertSchema(votes);\nexport const insertAchievementSchema = createInsertSchema(achievements);\nexport const insertUserAchievementSchema = createInsertSchema(userAchievements);\nexport const insertExpertVerificationSchema = createInsertSchema(expertVerifications);\nexport const insertPostSourceSchema = createInsertSchema(postSources);\nexport const insertModerationResultSchema = createInsertSchema(moderationResults);\nexport const insertConsultationSchema = createInsertSchema(consultations);\nexport const insertContentSourceSchema = createInsertSchema(contentSources).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport const insertQaKnowledgeSchema = createInsertSchema(qaKnowledge).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQaEmbeddingsSchema = createInsertSchema(qaEmbeddings).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\n// User role types\nexport type UserRole = 'user' | 'admin' | 'expert';\n\n// User approval status types\nexport type ApprovalStatus = 'yes' | 'no' | 'not applicable';\n\nexport type User = typeof users.$inferSelect & {\n  role: UserRole;\n  expertVerification?: ExpertVerification | null;\n};\nexport type Post = typeof posts.$inferSelect;\nexport type PostWithAuthorAndCategory = Post & {\n  author: User;\n  category: typeof categories.$inferSelect;\n  source?: typeof postSources.$inferSelect;\n};\nexport type PostWithExpertInfo = PostWithAuthorAndCategory & {\n  expertVerification?: ExpertVerification;\n};\nexport type Comment = typeof comments.$inferSelect;\nexport type CommentWithAuthor = Comment & { author: User };\nexport type Category = typeof categories.$inferSelect;\nexport type Vote = typeof votes.$inferSelect;\nexport type Achievement = typeof achievements.$inferSelect;\nexport type UserAchievement = typeof userAchievements.$inferSelect;\nexport type ExpertVerification = typeof expertVerifications.$inferSelect;\nexport type PostSource = typeof postSources.$inferSelect;\n\nexport type InsertPost = z.infer<typeof insertPostSchema>;\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\nexport type InsertCategory = z.infer<typeof insertCategorySchema>;\nexport type InsertVote = z.infer<typeof insertVoteSchema>;\nexport type InsertAchievement = z.infer<typeof insertAchievementSchema>;\nexport type InsertUserAchievement = z.infer<typeof insertUserAchievementSchema>;\nexport type InsertExpertVerification = z.infer<typeof insertExpertVerificationSchema>;\nexport type InsertPostSource = z.infer<typeof insertPostSourceSchema>;\n// Search phrases for typewriter effect\nexport const searchPhrases = pgTable(\"search_phrases\", {\n  id: serial(\"id\").primaryKey(),\n  phrase: text(\"phrase\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  orderIndex: integer(\"order_index\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertSearchPhraseSchema = createInsertSchema(searchPhrases).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type ModerationResult = typeof moderationResults.$inferSelect;\nexport type InsertModerationResult = z.infer<typeof insertModerationResultSchema>;\nexport type Consultation = typeof consultations.$inferSelect;\nexport type InsertConsultation = z.infer<typeof insertConsultationSchema>;\nexport type SearchPhrase = typeof searchPhrases.$inferSelect;\nexport type InsertSearchPhrase = z.infer<typeof insertSearchPhraseSchema>;\n\n// Search query logs for analytics\nexport const searchLogs = pgTable(\"search_logs\", {\n  id: serial(\"id\").primaryKey(),\n  query: text(\"query\").notNull(),\n  answer: text(\"answer\").notNull(),\n  userId: text(\"user_id\"), // Optional, null for anonymous searches\n  source: text(\"source\").notNull().default('landing'), // 'landing', 'community', etc\n  resultFound: boolean(\"result_found\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertSearchLogSchema = createInsertSchema(searchLogs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type SearchLog = typeof searchLogs.$inferSelect;\nexport type InsertSearchLog = z.infer<typeof insertSearchLogSchema>;\nexport type ContentSource = typeof contentSources.$inferSelect;\nexport type InsertContentSource = z.infer<typeof insertContentSourceSchema>;\nexport type QaKnowledge = typeof qaKnowledge.$inferSelect;\nexport type InsertQaKnowledge = z.infer<typeof insertQaKnowledgeSchema>;\nexport type QaEmbeddings = typeof qaEmbeddings.$inferSelect;\nexport type InsertQaEmbeddings = z.infer<typeof insertQaEmbeddingsSchema>;\n\n// User favorite content sources\nexport const userFavoriteContentSources = pgTable(\"user_favorite_content_sources\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => users.id),\n  contentSourceId: integer(\"content_source_id\").notNull().references(() => contentSources.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userSourceUnique: unique().on(table.userId, table.contentSourceId),\n}));\n\nexport const insertUserFavoriteContentSourceSchema = createInsertSchema(userFavoriteContentSources).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type UserFavoriteContentSource = typeof userFavoriteContentSources.$inferSelect;\nexport type InsertUserFavoriteContentSource = z.infer<typeof insertUserFavoriteContentSourceSchema>;\n\n// User favorite posts table\nexport const userFavoritePosts = pgTable(\"user_favorite_posts\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => users.id),\n  postId: integer(\"post_id\").notNull().references(() => posts.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => ({\n  userPostUnique: unique().on(table.userId, table.postId),\n}));\n\nexport const insertUserFavoritePostSchema = createInsertSchema(userFavoritePosts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type UserFavoritePost = typeof userFavoritePosts.$inferSelect;\nexport type InsertUserFavoritePost = z.infer<typeof insertUserFavoritePostSchema>;\n\n// Expert availability schedule\nexport const expertAvailability = pgTable(\"expert_availability\", {\n  id: serial(\"id\").primaryKey(),\n  expertId: text(\"expert_id\").notNull().references(() => users.id),\n  dayOfWeek: integer(\"day_of_week\").notNull(), // 0=Sunday, 1=Monday, etc.\n  startTime: text(\"start_time\").notNull(), // HH:MM format in expert's timezone\n  endTime: text(\"end_time\").notNull(), // HH:MM format in expert's timezone\n  timezone: text(\"timezone\").notNull().default(\"UTC\"), // IANA timezone identifier for this availability\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Appointment bookings\nexport const appointments = pgTable(\"appointments\", {\n  id: serial(\"id\").primaryKey(),\n  expertId: text(\"expert_id\").notNull().references(() => users.id),\n  clientId: text(\"client_id\").references(() => users.id), // null for non-registered users\n  clientName: text(\"client_name\").notNull(),\n  clientEmail: text(\"client_email\").notNull(),\n  scheduledAt: timestamp(\"scheduled_at\").notNull(), // Stored in UTC\n  scheduledAtTimezone: text(\"scheduled_at_timezone\").notNull().default(\"UTC\"), // Original timezone for display\n  duration: integer(\"duration\").notNull(), // minutes\n  notes: text(\"notes\"),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, confirmed, completed, cancelled\n  totalAmount: integer(\"total_amount\").notNull(), // cents\n  platformFee: integer(\"platform_fee\").notNull(), // cents (10%)\n  expertEarnings: integer(\"expert_earnings\").notNull(), // cents (90%)\n  stripePaymentIntentId: text(\"stripe_payment_intent_id\"),\n  stripeConnectAccountId: text(\"stripe_connect_account_id\"),\n  meetingLink: text(\"meeting_link\"),\n  cancelledAt: timestamp(\"cancelled_at\"),\n  cancelReason: text(\"cancel_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertExpertAvailabilitySchema = createInsertSchema(expertAvailability).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAppointmentSchema = createInsertSchema(appointments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Google Calendar integration\nexport const calendarIntegrations = pgTable(\"calendar_integrations\", {\n  id: serial(\"id\").primaryKey(),\n  expertId: text(\"expert_id\").notNull().references(() => users.id),\n  provider: text(\"provider\").notNull().default(\"google\"), // 'google' for now\n  accessToken: text(\"access_token\").notNull(),\n  refreshToken: text(\"refresh_token\").notNull(),\n  tokenExpiresAt: timestamp(\"token_expires_at\").notNull(),\n  calendarId: text(\"calendar_id\"), // Google Calendar ID\n  calendarName: text(\"calendar_name\"),\n  isActive: boolean(\"is_active\").default(true),\n  lastSyncAt: timestamp(\"last_sync_at\"),\n  syncErrors: text(\"sync_errors\"), // JSON string for error logging\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Blocked time slots for experts (vacations, breaks, etc.)\nexport const blockedTimeSlots = pgTable(\"blocked_time_slots\", {\n  id: serial(\"id\").primaryKey(),\n  expertId: text(\"expert_id\").notNull().references(() => users.id),\n  startDateTime: timestamp(\"start_date_time\").notNull(),\n  endDateTime: timestamp(\"end_date_time\").notNull(),\n  reason: text(\"reason\"), // \"vacation\", \"break\", \"meeting\", etc.\n  isAllDay: boolean(\"is_all_day\").default(false),\n  isRecurring: boolean(\"is_recurring\").default(false),\n  recurrenceRule: text(\"recurrence_rule\"), // RRULE format for recurring blocks\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Notification preferences for experts and clients\nexport const notificationPreferences = pgTable(\"notification_preferences\", {\n  id: serial(\"id\").primaryKey(),\n  userId: text(\"user_id\").notNull().references(() => users.id),\n  emailNotifications: boolean(\"email_notifications\").default(true),\n  smsNotifications: boolean(\"sms_notifications\").default(false),\n  appointmentReminders: boolean(\"appointment_reminders\").default(true),\n  reminderTimeMinutes: integer(\"reminder_time_minutes\").default(60), // minutes before appointment\n  bookingConfirmations: boolean(\"booking_confirmations\").default(true),\n  cancellationNotifications: boolean(\"cancellation_notifications\").default(true),\n  phoneNumber: text(\"phone_number\"), // for SMS notifications\n  timezone: text(\"timezone\").default(\"America/New_York\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Appointment reviews and ratings\nexport const appointmentReviews = pgTable(\"appointment_reviews\", {\n  id: serial(\"id\").primaryKey(),\n  appointmentId: integer(\"appointment_id\").notNull().references(() => appointments.id),\n  reviewerId: text(\"reviewer_id\").notNull().references(() => users.id), // client or expert\n  revieweeId: text(\"reviewee_id\").notNull().references(() => users.id), // expert or client\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  reviewText: text(\"review_text\"),\n  isPublic: boolean(\"is_public\").default(true),\n  isVerified: boolean(\"is_verified\").default(false), // admin verified review\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertCalendarIntegrationSchema = createInsertSchema(calendarIntegrations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertBlockedTimeSlotSchema = createInsertSchema(blockedTimeSlots).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertNotificationPreferenceSchema = createInsertSchema(notificationPreferences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAppointmentReviewSchema = createInsertSchema(appointmentReviews).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type ExpertAvailability = typeof expertAvailability.$inferSelect;\nexport type InsertExpertAvailability = z.infer<typeof insertExpertAvailabilitySchema>;\nexport type Appointment = typeof appointments.$inferSelect;\nexport type InsertAppointment = z.infer<typeof insertAppointmentSchema>;\nexport type CalendarIntegration = typeof calendarIntegrations.$inferSelect;\nexport type InsertCalendarIntegration = z.infer<typeof insertCalendarIntegrationSchema>;\nexport type BlockedTimeSlot = typeof blockedTimeSlots.$inferSelect;\nexport type InsertBlockedTimeSlot = z.infer<typeof insertBlockedTimeSlotSchema>;\nexport type NotificationPreference = typeof notificationPreferences.$inferSelect;\nexport type InsertNotificationPreference = z.infer<typeof insertNotificationPreferenceSchema>;\nexport type AppointmentReview = typeof appointmentReviews.$inferSelect;\nexport type InsertAppointmentReview = z.infer<typeof insertAppointmentReviewSchema>;\n\n// Additional relations for new tables\nexport const expertAvailabilityRelations = relations(expertAvailability, ({ one }) => ({\n  expert: one(users, {\n    fields: [expertAvailability.expertId],\n    references: [users.id],\n  }),\n}));\n\nexport const appointmentsRelations = relations(appointments, ({ one, many }) => ({\n  expert: one(users, {\n    fields: [appointments.expertId],\n    references: [users.id],\n  }),\n  client: one(users, {\n    fields: [appointments.clientId],\n    references: [users.id],\n  }),\n  reviews: many(appointmentReviews),\n}));\n\nexport const calendarIntegrationsRelations = relations(calendarIntegrations, ({ one }) => ({\n  expert: one(users, {\n    fields: [calendarIntegrations.expertId],\n    references: [users.id],\n  }),\n}));\n\nexport const blockedTimeSlotsRelations = relations(blockedTimeSlots, ({ one }) => ({\n  expert: one(users, {\n    fields: [blockedTimeSlots.expertId],\n    references: [users.id],\n  }),\n}));\n\nexport const notificationPreferencesRelations = relations(notificationPreferences, ({ one }) => ({\n  user: one(users, {\n    fields: [notificationPreferences.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const appointmentReviewsRelations = relations(appointmentReviews, ({ one }) => ({\n  appointment: one(appointments, {\n    fields: [appointmentReviews.appointmentId],\n    references: [appointments.id],\n  }),\n  reviewer: one(users, {\n    fields: [appointmentReviews.reviewerId],\n    references: [users.id],\n  }),\n  reviewee: one(users, {\n    fields: [appointmentReviews.revieweeId],\n    references: [users.id],\n  }),\n}));\n\n// Relations for userFavoritePosts\nexport const userFavoritePostsRelations = relations(userFavoritePosts, ({ one }) => ({\n  user: one(users, {\n    fields: [userFavoritePosts.userId],\n    references: [users.id],\n  }),\n  post: one(posts, {\n    fields: [userFavoritePosts.postId],\n    references: [posts.id],\n  }),\n}));\n\n// Email verification tokens\nexport const emailVerificationTokens = pgTable(\"email_verification_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Password reset tokens\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Add email verified field to users\nexport type EmailVerificationToken = typeof emailVerificationTokens.$inferSelect;\nexport type InsertEmailVerificationToken = z.infer<typeof insertEmailVerificationTokenSchema>;\nexport const insertEmailVerificationTokenSchema = createInsertSchema(emailVerificationTokens).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\nexport type InsertPasswordResetToken = z.infer<typeof insertPasswordResetTokenSchema>;\nexport const insertPasswordResetTokenSchema = createInsertSchema(passwordResetTokens).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Social media embeds table\nexport const socialMediaEmbeds = pgTable(\"social_media_embeds\", {\n  id: serial(\"id\").primaryKey(),\n  type: varchar(\"type\", { length: 50 }).notNull(), // 'todaysnews', 'linkedin', 'xposts'\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  embedCode: text(\"embed_code\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type SocialMediaEmbed = typeof socialMediaEmbeds.$inferSelect;\nexport type InsertSocialMediaEmbed = z.infer<typeof insertSocialMediaEmbedSchema>;\nexport const insertSocialMediaEmbedSchema = createInsertSchema(socialMediaEmbeds).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n","size_bytes":31635},"client/src/components/PostCard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { MessageSquare, Heart, Clock, CheckCircle, ChevronDown, ChevronRight, Reply, Calendar, ExternalLink, Star } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport ExpertBadge from \"./ExpertBadge\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Comment {\n  id: number;\n  content: string;\n  createdAt: string;\n  helpfulVotes: number;\n  isExpertResponse: boolean;\n  author: {\n    id: string;\n    username: string;\n    firstName?: string;\n    lastName?: string;\n    profileImageUrl?: string;\n    role: string;\n  };\n  parentId?: number;\n}\n\ninterface PostCardProps {\n  post: {\n    id: number;\n    title: string;\n    content: string;\n    helpfulVotes: number;\n    commentCount: number;\n    isResolved: boolean;\n    createdAt: string;\n    author: {\n      id: string;\n      firstName: string;\n      lastName: string;\n      profileImageUrl?: string;\n      city?: string;\n      state?: string;\n      role?: string;\n      approved?: string;\n    };\n    category: {\n      id: number;\n      name: string;\n      slug: string;\n      color: string;\n    };\n    expertVerification?: {\n      id: number;\n      userId: string;\n      expertiseArea?: string;\n      credentials?: string;\n      professionalTitle?: string;\n      company?: string;\n      profileImageUrl?: string;\n      bio?: string;\n      yearsExperience?: number;\n      verificationStatus: string;\n      verifiedAt?: string;\n      featuredExpert: boolean;\n    };\n    authorPostCount?: number; // Annual post count for badge calculation\n  };\n}\n\nexport default function PostCard({ post }: PostCardProps) {\n  const [isCommentsExpanded, setIsCommentsExpanded] = useState(false);\n  const [showReplyToPostForm, setShowReplyToPostForm] = useState(false);\n  const [showReplyToCommentForm, setShowReplyToCommentForm] = useState(false);\n  const [replyText, setReplyText] = useState(\"\");\n  const [replyToCommentId, setReplyToCommentId] = useState<number | null>(null);\n  const [isFavorited, setIsFavorited] = useState(false);\n  const [favoriteCount, setFavoriteCount] = useState(0);\n  \n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch comments for this post\n  const { data: comments = [] } = useQuery<Comment[]>({\n    queryKey: [`/api/posts/${post.id}/comments`],\n    enabled: isCommentsExpanded,\n  });\n\n  // Fetch favorite status\n  const { data: favoriteStatus } = useQuery<{ isFavorited: boolean }>({\n    queryKey: [`/api/posts/${post.id}/is-favorited`],\n    enabled: isAuthenticated,\n  });\n\n  // Fetch favorite count\n  const { data: favoriteCountData } = useQuery<{ count: number }>({\n    queryKey: [`/api/posts/${post.id}/favorite-count`],\n  });\n\n  // Update state when data changes\n  useEffect(() => {\n    if (favoriteStatus) {\n      setIsFavorited(favoriteStatus.isFavorited);\n    }\n  }, [favoriteStatus]);\n\n  useEffect(() => {\n    if (favoriteCountData) {\n      setFavoriteCount(favoriteCountData.count);\n    }\n  }, [favoriteCountData]);\n\n  // Create comment mutation\n  const createCommentMutation = useMutation({\n    mutationFn: async (commentData: { content: string; parentId?: number }) => {\n      return await apiRequest(\"POST\", `/api/posts/${post.id}/comments`, commentData);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${post.id}/comments`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n      setReplyText(\"\");\n      setShowReplyToPostForm(false);\n      setShowReplyToCommentForm(false);\n      setReplyToCommentId(null);\n      toast({\n        title: \"Reply posted successfully\",\n        description: \"Your reply has been added to the discussion\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to post reply\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Toggle favorite mutation\n  const toggleFavoriteMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/posts/${post.id}/favorite`);\n    },\n    onSuccess: (data) => {\n      setIsFavorited(data.isFavorited);\n      setFavoriteCount(prev => data.isFavorited ? prev + 1 : prev - 1);\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${post.id}/is-favorited`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${post.id}/favorite-count`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to update favorite\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (date: string) => {\n    const now = new Date();\n    const postDate = new Date(date);\n    const diffInHours = Math.floor((now.getTime() - postDate.getTime()) / (1000 * 60 * 60));\n    \n    if (diffInHours < 1) return \"Just now\";\n    if (diffInHours < 24) return `${diffInHours}h ago`;\n    if (diffInHours < 48) return \"Yesterday\";\n    return postDate.toLocaleDateString();\n  };\n\n  const getExpertLevel = (postCount: number): 'bronze' | 'silver' | 'gold' | null => {\n    if (postCount >= 100) return 'gold';\n    if (postCount >= 50) return 'silver';\n    if (postCount >= 2) return 'bronze';\n    return null;\n  };\n\n  // Determine expert status based on role, approval, and verification\n  const getExpertStatus = () => {\n    if (post.author.role !== 'expert') return null;\n    \n    if (post.author.approved === 'no') {\n      return { type: 'waiting', label: 'Waiting for Approval', color: 'bg-orange-100 text-orange-700' };\n    }\n    \n    if (post.author.approved === 'yes' && post.expertVerification?.verificationStatus === 'verified') {\n      return { type: 'verified', label: 'Verified Expert', color: 'bg-green-100 text-green-700' };\n    }\n    \n    if (post.author.approved === 'yes') {\n      return { type: 'approved', label: 'Verified Expert', color: 'bg-blue-100 text-blue-700' };\n    }\n    \n    return null;\n  };\n\n  const expertStatus = getExpertStatus();\n  const isVerifiedExpert = expertStatus?.type === 'verified';\n  const expertLevel = post.authorPostCount ? getExpertLevel(post.authorPostCount) : null;\n  const profileImageUrl = post.expertVerification?.profileImageUrl || post.author.profileImageUrl;\n\n  return (\n    <Card \n      className=\"p-4 hover:shadow-md transition-shadow\"\n    >\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center space-x-2 mb-2\">\n            <Badge \n              className=\"text-xs text-gray-700\" \n              style={{ backgroundColor: 'hsl(165 48% 52% / 0.15)' }}\n            >\n              {post.category.name}\n            </Badge>\n            {post.isResolved && (\n              <Badge className=\"bg-green-100 text-green-700 text-xs\">\n                <CheckCircle className=\"w-3 h-3 mr-1\" />\n                Resolved\n              </Badge>\n            )}\n          </div>\n          <h4 className=\"font-medium text-gray-900 mb-2 hover:text-teal-600\">\n            {post.title}\n          </h4>\n          \n          {/* Post Content */}\n          {post.content && (\n            <div className=\"mb-3 text-gray-700 text-sm leading-relaxed whitespace-pre-wrap\">\n              {post.content}\n            </div>\n          )}\n          \n          <div className=\"flex items-center space-x-3 text-sm text-gray-500\">\n            {/* Expert Profile Section */}\n            {expertStatus ? (\n              <div className=\"flex items-center space-x-2\">\n                <Avatar className=\"w-6 h-6 flex-shrink-0\">\n                  <AvatarImage src={profileImageUrl} />\n                  <AvatarFallback className=\"bg-teal-500 text-white text-xs\">\n                    {post.author.firstName?.[0]}{post.author.lastName?.[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex items-center space-x-2\">\n                  <span>by</span>\n                  <button \n                    className=\"font-medium text-teal-600 hover:text-teal-800 hover:underline transition-all duration-200 cursor-pointer\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      window.location.href = `/expert/${post.author.id}`;\n                    }}\n                  >\n                    {post.author.firstName} {post.author.lastName}\n                  </button>\n                  \n                  {/* Expert Status Badge */}\n                  <Badge \n                    className={`text-xs ${expertStatus.color} ml-2`}\n                    data-testid={`badge-expert-${expertStatus.type}`}\n                  >\n                    {expertStatus.type === 'verified' && <CheckCircle className=\"w-3 h-3 mr-1\" />}\n                    {expertStatus.type === 'waiting' && <Clock className=\"w-3 h-3 mr-1\" />}\n                    {expertStatus.type === 'approved' && <Star className=\"w-3 h-3 mr-1\" />}\n                    {expertStatus.label}\n                  </Badge>\n\n                  {expertLevel && isVerifiedExpert && (\n                    <ExpertBadge \n                      level={expertLevel} \n                      postCount={post.authorPostCount || 0} \n                      className=\"ml-1\"\n                    />\n                  )}\n                  \n                  {isVerifiedExpert && (\n                    <span\n                      className=\"text-xs text-teal-600 hover:text-teal-700 underline cursor-pointer flex items-center gap-1 transition-colors ml-2\"\n                      style={{ textDecorationColor: '#0d9488' }}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        window.location.href = `/book/${post.author.id}`;\n                      }}\n                    >\n                      Book Appointment\n                    </span>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex items-center space-x-2\">\n                <Avatar className=\"w-6 h-6 flex-shrink-0\">\n                  <AvatarImage src={post.author.profileImageUrl} />\n                  <AvatarFallback className=\"bg-gray-500 text-white text-xs\">\n                    {post.author.firstName?.[0]}{post.author.lastName?.[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <span>\n                  by{\" \"}\n                  <button\n                    className=\"font-medium hover:underline transition-all duration-200 cursor-pointer\"\n                    style={{ color: 'hsl(var(--coral-primary))' }}\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      window.location.href = `/profile/${post.author.id}`;\n                    }}\n                  >\n                    {post.author.firstName} {post.author.lastName}\n                  </button>\n                </span>\n              </div>\n            )}\n            <span className=\"flex items-center\">\n              <Clock className=\"w-4 h-4 mr-1\" />\n              {formatDate(post.createdAt)}\n            </span>\n          </div>\n        </div>\n        <div className=\"flex items-center space-x-4 text-sm text-gray-500\">\n          {/* Accordion arrow for comments */}\n          {post.commentCount > 0 && (\n            <button\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                setIsCommentsExpanded(!isCommentsExpanded);\n              }}\n              className=\"flex items-center hover:text-gray-700 transition-colors\"\n            >\n              {isCommentsExpanded ? (\n                <ChevronDown className=\"w-6 h-6 font-bold stroke-2\" />\n              ) : (\n                <ChevronRight className=\"w-6 h-6 font-bold stroke-2\" />\n              )}\n            </button>\n          )}\n          <span className=\"flex items-center\">\n            <MessageSquare \n              className={`w-4 h-4 mr-1 transition-colors ${\n                post.commentCount > 0 ? 'fill-current text-[#0B666B]' : ''\n              }`} \n            />\n            {post.commentCount}\n          </span>\n          <button\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              if (!isAuthenticated) {\n                toast({\n                  title: \"Sign in required\",\n                  description: \"Please sign up or sign in to continue\",\n                });\n                return;\n              }\n              toggleFavoriteMutation.mutate();\n            }}\n            className=\"flex items-center hover:text-gray-700 transition-colors\"\n            disabled={toggleFavoriteMutation.isPending}\n          >\n            <Heart \n              className={`w-4 h-4 mr-1 transition-colors ${isFavorited ? 'fill-current text-red-500' : ''}`} \n              style={{ color: isFavorited ? undefined : 'hsl(var(--coral-primary))' }} \n            />\n            {favoriteCount}\n          </button>\n        </div>\n      </div>\n      \n      {/* Reply to Post Button */}\n      <div className=\"mt-3 pt-3 border-t border-gray-200\">\n        <button\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            if (!isAuthenticated) {\n              toast({\n                title: \"Sign in required\",\n                description: \"Please sign up or sign in to continue\",\n              });\n              return;\n            }\n            setShowReplyToPostForm(!showReplyToPostForm);\n          }}\n          className=\"flex items-center gap-2 text-sm text-teal-600 hover:text-teal-700 font-bold transition-all duration-200 hover:scale-105\"\n        >\n          <Reply className=\"w-4 h-4\" />\n          <span>Reply to Post</span>\n        </button>\n      </div>\n      \n      {/* Reply to Post Form */}\n      {showReplyToPostForm && (\n        <div className=\"mt-4 bg-white rounded-lg p-4 border border-gray-200\">\n          <div className=\"flex items-start space-x-3\">\n            <Avatar className=\"w-8 h-8 flex-shrink-0\">\n              <AvatarFallback className=\"bg-gray-400 text-white text-xs\">\n                YU\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <Textarea\n                placeholder=\"Share your thoughts on this post...\"\n                value={replyText}\n                onChange={(e) => setReplyText(e.target.value)}\n                className=\"min-h-[80px] resize-none\"\n              />\n              <div className=\"flex items-center justify-between mt-3\">\n                <div className=\"text-xs text-gray-500\">\n                  Be respectful and helpful to fellow caregivers\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => setShowReplyToPostForm(false)}\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    size=\"sm\"\n                    onClick={() => {\n                      if (!isAuthenticated) {\n                        toast({\n                          title: \"Please log in\",\n                          description: \"You need to be logged in to post a reply\",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n                      createCommentMutation.mutate({ content: replyText });\n                    }}\n                    disabled={!replyText.trim() || createCommentMutation.isPending}\n                    className=\"bg-teal-600 hover:bg-teal-700\"\n                  >\n                    {createCommentMutation.isPending ? \"Posting...\" : \"Reply\"}\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Expanded Comments */}\n      {isCommentsExpanded && (\n        <div className=\"mt-4 border-l-4 pl-4\" style={{ borderColor: 'hsl(var(--coral-primary) / 0.4)' }}>\n          {comments.length === 0 ? (\n            <div className=\"text-sm text-gray-500 italic\">\n              No comments yet. Be the first to share your thoughts!\n            </div>\n          ) : (\n            comments.map((comment: Comment) => (\n              <div key={comment.id} className=\"mb-4 pb-4 border-b\" style={{ borderColor: 'hsl(var(--coral-primary) / 0.3)' }}>\n                <div className=\"flex items-start space-x-3\">\n                  <Avatar className=\"w-8 h-8 flex-shrink-0\">\n                    {comment.author.profileImageUrl ? (\n                      <AvatarImage src={comment.author.profileImageUrl} />\n                    ) : (\n                      <AvatarFallback className=\"bg-blue-400 text-white text-xs\">\n                        {comment.author.firstName?.[0]}{comment.author.lastName?.[0]}\n                      </AvatarFallback>\n                    )}\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <button\n                        className=\"text-sm font-medium text-gray-700 hover:text-gray-900 hover:underline transition-colors cursor-pointer\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          window.location.href = comment.author.role === 'expert' ? `/expert/${comment.author.id}` : `/profile/${comment.author.id}`;\n                        }}\n                      >\n                        {comment.author.firstName} {comment.author.lastName}\n                      </button>\n                      <span className=\"text-xs text-gray-500 flex items-center\">\n                        <Clock className=\"w-3 h-3 mr-1\" />\n                        {formatDate(comment.createdAt)}\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-2\">\n                      {comment.content}\n                    </p>\n                    <div className=\"flex items-center gap-3\">\n                      <button className=\"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700\">\n                        <Heart className=\"w-3 h-3\" style={{ color: 'hsl(var(--coral-primary))' }} />\n                        <span>{comment.helpfulVotes || 0}</span>\n                      </button>\n                      <button \n                        onClick={(e) => {\n                          e.preventDefault();\n                          e.stopPropagation();\n                          if (!isAuthenticated) {\n                            toast({\n                              title: \"Sign in required\",\n                              description: \"Please sign up or sign in to continue\",\n                            });\n                            return;\n                          }\n                          setReplyToCommentId(comment.id);\n                          setShowReplyToCommentForm(!showReplyToCommentForm || replyToCommentId !== comment.id);\n                        }}\n                        className=\"flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700\"\n                      >\n                        <Reply className=\"w-3 h-3\" />\n                        Reply to Comment\n                      </button>\n                    </div>\n                    \n                    {/* Reply to Comment Form */}\n                    {showReplyToCommentForm && replyToCommentId === comment.id && (\n                      <div className=\"mt-3 bg-gray-50 rounded-lg p-3 border border-gray-200\">\n                        <div className=\"flex items-start space-x-3\">\n                          <Avatar className=\"w-6 h-6 flex-shrink-0\">\n                            <AvatarFallback className=\"bg-gray-400 text-white text-xs\">\n                              {user?.firstName?.[0]}{user?.lastName?.[0]}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1\">\n                            <Textarea\n                              placeholder=\"Reply to this comment...\"\n                              value={replyText}\n                              onChange={(e) => setReplyText(e.target.value)}\n                              className=\"min-h-[60px] resize-none text-sm\"\n                            />\n                            <div className=\"flex items-center justify-end gap-2 mt-2\">\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => {\n                                  setShowReplyToCommentForm(false);\n                                  setReplyToCommentId(null);\n                                  setReplyText(\"\");\n                                }}\n                              >\n                                Cancel\n                              </Button>\n                              <Button \n                                size=\"sm\"\n                                onClick={() => {\n                                  if (!isAuthenticated) {\n                                    toast({\n                                      title: \"Please log in\",\n                                      description: \"You need to be logged in to post a reply\",\n                                      variant: \"destructive\",\n                                    });\n                                    return;\n                                  }\n                                  createCommentMutation.mutate({ \n                                    content: replyText, \n                                    parentId: comment.id \n                                  });\n                                }}\n                                disabled={!replyText.trim() || createCommentMutation.isPending}\n                                className=\"bg-teal-600 hover:bg-teal-700\"\n                              >\n                                {createCommentMutation.isPending ? \"Posting...\" : \"Reply\"}\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      )}\n    </Card>\n  );\n}","size_bytes":22971},"client/src/components/ScrollToTop.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { ChevronUp } from 'lucide-react';\n\nexport default function ScrollToTop() {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    const toggleVisibility = () => {\n      // Show button when page is scrolled down 300px\n      if (window.pageYOffset > 300) {\n        setIsVisible(true);\n      } else {\n        setIsVisible(false);\n      }\n    };\n\n    window.addEventListener('scroll', toggleVisibility);\n\n    return () => {\n      window.removeEventListener('scroll', toggleVisibility);\n    };\n  }, []);\n\n  const scrollToTop = () => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n  };\n\n  return (\n    <>\n      {isVisible && (\n        <button\n          onClick={scrollToTop}\n          className=\"fixed bottom-6 right-6 z-50 bg-[#0B666B] text-white p-3 rounded-full shadow-lg hover:bg-[#09555a] transition-all duration-300 transform hover:scale-110\"\n          aria-label=\"Return to top\"\n        >\n          <ChevronUp className=\"w-6 h-6\" />\n        </button>\n      )}\n    </>\n  );\n}","size_bytes":1076},"server/services/timezoneService.ts":{"content":"import { storage } from '../storage';\n\nexport class TimezoneService {\n  /**\n   * Convert a time from one timezone to another\n   */\n  static convertTime(\n    time: string, // HH:MM format\n    date: string, // YYYY-MM-DD format\n    fromTimezone: string,\n    toTimezone: string\n  ): string {\n    // Create a date object in the source timezone\n    const dateTime = new Date(`${date}T${time}:00`);\n    \n    // Create formatter for source timezone\n    const sourceFormatter = new Intl.DateTimeFormat('en-US', {\n      timeZone: fromTimezone,\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n    \n    // Create formatter for target timezone\n    const targetFormatter = new Intl.DateTimeFormat('en-US', {\n      timeZone: toTimezone,\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n    \n    // Parse the time in source timezone\n    const sourceParts = sourceFormatter.formatToParts(dateTime);\n    const sourceDate = new Date(\n      parseInt(sourceParts.find(p => p.type === 'year')!.value),\n      parseInt(sourceParts.find(p => p.type === 'month')!.value) - 1,\n      parseInt(sourceParts.find(p => p.type === 'day')!.value),\n      parseInt(sourceParts.find(p => p.type === 'hour')!.value),\n      parseInt(sourceParts.find(p => p.type === 'minute')!.value)\n    );\n    \n    // Convert to target timezone\n    const targetParts = targetFormatter.formatToParts(sourceDate);\n    const hour = targetParts.find(p => p.type === 'hour')!.value;\n    const minute = targetParts.find(p => p.type === 'minute')!.value;\n    \n    return `${hour}:${minute}`;\n  }\n\n  /**\n   * Convert a full timestamp from one timezone to another\n   */\n  static convertTimestamp(\n    timestamp: Date,\n    fromTimezone: string,\n    toTimezone: string\n  ): Date {\n    // Get the offset difference\n    const sourceDate = new Date(timestamp.toLocaleString(\"en-US\", { timeZone: fromTimezone }));\n    const targetDate = new Date(timestamp.toLocaleString(\"en-US\", { timeZone: toTimezone }));\n    const offset = targetDate.getTime() - sourceDate.getTime();\n    \n    return new Date(timestamp.getTime() + offset);\n  }\n\n  /**\n   * Get available time slots for an expert on a specific date in client's timezone\n   */\n  static async getAvailableTimeSlotsInClientTimezone(\n    expertId: string,\n    date: string, // YYYY-MM-DD in client timezone\n    clientTimezone: string\n  ): Promise<{ time: string; utcTime: Date }[]> {\n    // Get expert's timezone\n    const expert = await storage.getUser(expertId);\n    if (!expert) throw new Error('Expert not found');\n    \n    const expertTimezone = expert.timezone || 'UTC';\n    \n    // Get expert's availability for the day of week in their timezone\n    const clientDate = new Date(`${date}T12:00:00`); // Use noon to avoid date boundary issues\n    const expertDate = this.convertTimestamp(clientDate, clientTimezone, expertTimezone);\n    const dayOfWeek = expertDate.getDay();\n    \n    // Get expert availability for this day\n    const availability = await storage.getExpertAvailability(expertId);\n    const dayAvailability = availability.filter(\n      avail => avail.dayOfWeek === dayOfWeek && avail.isActive\n    );\n    \n    if (dayAvailability.length === 0) return [];\n    \n    // Generate time slots\n    const slots: { time: string; utcTime: Date }[] = [];\n    \n    for (const avail of dayAvailability) {\n      const [startHour, startMinute] = avail.startTime.split(':').map(Number);\n      const [endHour, endMinute] = avail.endTime.split(':').map(Number);\n      \n      const startMinutes = startHour * 60 + startMinute;\n      const endMinutes = endHour * 60 + endMinute;\n      \n      // Generate 30-minute slots\n      for (let minutes = startMinutes; minutes < endMinutes; minutes += 30) {\n        const slotHour = Math.floor(minutes / 60);\n        const slotMinute = minutes % 60;\n        const expertLocalTime = `${slotHour.toString().padStart(2, '0')}:${slotMinute.toString().padStart(2, '0')}`;\n        \n        // Convert to client timezone for display\n        const clientLocalTime = this.convertTime(\n          expertLocalTime,\n          expertDate.toISOString().split('T')[0],\n          expertTimezone,\n          clientTimezone\n        );\n        \n        // Create UTC timestamp for storage\n        const expertDateStr = expertDate.toISOString().split('T')[0];\n        const utcTime = new Date(`${expertDateStr}T${expertLocalTime}:00`);\n        \n        // Convert expert local time to UTC\n        const utcOffset = this.getTimezoneOffset(expertTimezone, utcTime);\n        utcTime.setMinutes(utcTime.getMinutes() - utcOffset);\n        \n        slots.push({\n          time: clientLocalTime,\n          utcTime\n        });\n      }\n    }\n    \n    return slots;\n  }\n\n  /**\n   * Get timezone offset in minutes for a specific timezone and date\n   */\n  static getTimezoneOffset(timezone: string, date: Date): number {\n    const utc = new Date(date.toLocaleString('en-US', { timeZone: 'UTC' }));\n    const local = new Date(date.toLocaleString('en-US', { timeZone: timezone }));\n    return (local.getTime() - utc.getTime()) / (1000 * 60);\n  }\n\n  /**\n   * Format time for display in user's timezone\n   */\n  static formatTimeForUser(\n    utcTime: Date,\n    userTimezone: string,\n    includeDate: boolean = true\n  ): string {\n    const options: Intl.DateTimeFormatOptions = {\n      timeZone: userTimezone,\n      hour: 'numeric',\n      minute: '2-digit',\n      hour12: true\n    };\n    \n    if (includeDate) {\n      options.month = 'short';\n      options.day = 'numeric';\n      options.year = 'numeric';\n    }\n    \n    return utcTime.toLocaleString('en-US', options);\n  }\n\n  /**\n   * Get list of common timezones for dropdown\n   */\n  static getCommonTimezones(): { value: string; label: string; offset: string }[] {\n    return [\n      { value: 'America/New_York', label: 'Eastern Time (ET)', offset: 'UTC-5/-4' },\n      { value: 'America/Chicago', label: 'Central Time (CT)', offset: 'UTC-6/-5' },\n      { value: 'America/Denver', label: 'Mountain Time (MT)', offset: 'UTC-7/-6' },\n      { value: 'America/Los_Angeles', label: 'Pacific Time (PT)', offset: 'UTC-8/-7' },\n      { value: 'America/Phoenix', label: 'Arizona Time (MST)', offset: 'UTC-7' },\n      { value: 'America/Anchorage', label: 'Alaska Time (AKT)', offset: 'UTC-9/-8' },\n      { value: 'Pacific/Honolulu', label: 'Hawaii Time (HST)', offset: 'UTC-10' },\n      { value: 'Europe/London', label: 'Greenwich Mean Time (GMT)', offset: 'UTC+0/+1' },\n      { value: 'Europe/Paris', label: 'Central European Time (CET)', offset: 'UTC+1/+2' },\n      { value: 'Europe/Berlin', label: 'Central European Time (CET)', offset: 'UTC+1/+2' },\n      { value: 'Asia/Tokyo', label: 'Japan Standard Time (JST)', offset: 'UTC+9' },\n      { value: 'Asia/Shanghai', label: 'China Standard Time (CST)', offset: 'UTC+8' },\n      { value: 'Asia/Dubai', label: 'Gulf Standard Time (GST)', offset: 'UTC+4' },\n      { value: 'Asia/Kolkata', label: 'India Standard Time (IST)', offset: 'UTC+5:30' },\n      { value: 'Australia/Sydney', label: 'Australian Eastern Time (AET)', offset: 'UTC+10/+11' },\n      { value: 'UTC', label: 'Coordinated Universal Time (UTC)', offset: 'UTC+0' }\n    ];\n  }\n\n  /**\n   * Detect user's timezone using browser\n   */\n  static detectUserTimezone(): string {\n    try {\n      return Intl.DateTimeFormat().resolvedOptions().timeZone;\n    } catch (error) {\n      return 'UTC';\n    }\n  }\n\n  /**\n   * Convert appointment time to different timezone for calendar integration\n   */\n  static convertAppointmentForCalendar(\n    scheduledAt: Date,\n    fromTimezone: string,\n    toTimezone: string\n  ): {\n    startTime: Date;\n    endTime: Date;\n    displayTime: string;\n  } {\n    const startTime = this.convertTimestamp(scheduledAt, fromTimezone, toTimezone);\n    const endTime = new Date(startTime.getTime() + 60 * 60 * 1000); // 1 hour default\n    \n    const displayTime = this.formatTimeForUser(startTime, toTimezone, true);\n    \n    return { startTime, endTime, displayTime };\n  }\n}\n\nexport const timezoneService = new TimezoneService();","size_bytes":8171},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"switch-database.sh":{"content":"#!/bin/bash\n\n# Database Switcher Script\n# Usage: ./switch-database.sh [production|development]\n\nif [ \"$1\" = \"production\" ]; then\n  echo \"Switching to PRODUCTION database...\"\n  export DATABASE_URL=\"$DATABASE_URL_PRODUCTION\"\n  echo \"âœ… Using PRODUCTION database\"\n  echo \"Current DB: $DATABASE_URL_PRODUCTION\"\nelif [ \"$1\" = \"development\" ]; then\n  echo \"Switching to DEVELOPMENT database...\"\n  export DATABASE_URL=\"$DATABASE_URL_DEV\"\n  echo \"âœ… Using DEVELOPMENT database\"\n  echo \"Current DB: $DATABASE_URL_DEV\"\nelse\n  echo \"Usage: ./switch-database.sh [production|development]\"\n  echo \"\"\n  echo \"Current configuration:\"\n  echo \"  Production: $DATABASE_URL_PRODUCTION\"\n  echo \"  Development: $DATABASE_URL_DEV\"\n  echo \"  Active: $DATABASE_URL\"\n  exit 1\nfi\n","size_bytes":755},"server/services/rag/ragService.ts":{"content":"import { ChatOpenAI } from \"@langchain/openai\";\nimport { PromptTemplate } from \"@langchain/core/prompts\";\nimport { EmbeddingService } from \"./embeddingService\";\nimport { VectorStore } from \"./vectorStore\";\nimport {\n  QaChunk,\n  SearchResult,\n  RagResponse,\n  EmbeddingConfig,\n  SearchConfig,\n} from \"./types\";\n\nexport class RagService {\n  private llm: ChatOpenAI;\n  private embeddingService: EmbeddingService;\n  private vectorStore: VectorStore;\n  private embeddingConfig: EmbeddingConfig;\n  private searchConfig: SearchConfig;\n\n  constructor(embeddingConfig: EmbeddingConfig, searchConfig: SearchConfig) {\n    this.embeddingConfig = embeddingConfig;\n    this.searchConfig = searchConfig;\n\n    this.llm = new ChatOpenAI({\n      modelName: \"gpt-4o-mini\",\n      apiKey: process.env.OPENAI_API_KEY,\n    });\n\n    this.embeddingService = new EmbeddingService(embeddingConfig);\n    this.vectorStore = new VectorStore(searchConfig);\n  }\n\n  /**\n   * Initialize the RAG system\n   */\n  async initialize(): Promise<void> {\n    await this.vectorStore.initialize();\n    console.log(\"RAG system initialized successfully\");\n  }\n\n  /**\n   * Process and store QA data in the vector store\n   */\n  async processAndStoreQaData(\n    qaData: Array<{\n      id: number;\n      question: string;\n      answer: string;\n      category?: string;\n      source: string;\n    }>,\n  ): Promise<void> {\n    console.log(`Processing ${qaData.length} QA entries...`);\n\n    // Process QA data into chunks with embeddings\n    const chunks = await this.embeddingService.processQaData(qaData);\n\n    // Store chunks in vector store\n    await this.vectorStore.storeChunks(chunks);\n\n    console.log(`Successfully processed and stored ${chunks.length} chunks`);\n  }\n\n  /**\n   * Generate answer using RAG\n   */\n  async generateAnswer(query: string): Promise<RagResponse> {\n    try {\n      // Generate embedding for the query\n      const queryEmbedding =\n        await this.embeddingService.generateEmbedding(query);\n\n      // Search for relevant chunks\n      const searchResults = await this.vectorStore.hybridSearch(\n        query,\n        queryEmbedding,\n        { topK: 5, similarityThreshold: 0.7 },\n      );\n      // Create context from search results\n      const context = this.buildContext(searchResults);\n\n      // Generate answer using LLM\n      const answer = await this.generateAnswerWithContext(query, context);\n\n      // Calculate confidence based on search scores\n      const confidence = this.calculateConfidence(searchResults);\n\n      return {\n        answer,\n        sources: searchResults,\n        confidence,\n        query,\n      };\n    } catch (error) {\n      console.error(\"Error generating RAG answer:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Generate answer using RAG with streaming\n   */\n  async *generateAnswerStream(query: string) {\n    try {\n      // Generate embedding for the query\n      const queryEmbedding =\n        await this.embeddingService.generateEmbedding(query);\n\n      // Search for relevant chunks\n      const searchResults = await this.vectorStore.hybridSearch(\n        query,\n        queryEmbedding,\n        { topK: 5, similarityThreshold: 0.7 },\n      );\n\n      // Create context from search results\n      const context = this.buildContext(searchResults);\n\n      // Calculate confidence based on search scores\n      const confidence = this.calculateConfidence(searchResults);\n\n      // Send metadata first\n      yield {\n        type: \"metadata\",\n        confidence,\n        sources: searchResults.map((result, index) => ({\n          chunk: result.chunk,\n          score: result.score,\n          source: `QA Knowledge Base - Entry ${index + 1}`,\n        })),\n      };\n\n      // Stream the answer\n      yield* this.generateAnswerWithContextStream(query, context);\n    } catch (error) {\n      console.error(\"Error generating RAG answer stream:\", error);\n      yield {\n        type: \"error\",\n        error: \"Failed to generate answer\",\n      };\n    }\n  }\n\n  /**\n   * Build context string from search results\n   */\n  private buildContext(searchResults: SearchResult[]): string {\n    return searchResults\n      .map((result, index) => {\n        const metadata = result.chunk.metadata;\n        return `Source ${index + 1} (${metadata.source}):\nQuestion: ${metadata.question}\nContent: ${result.chunk.chunkText}\n---`;\n      })\n      .join(\"\\n\\n\");\n  }\n\n  /**\n   * Generate answer using LLM with context\n   */\n  private async generateAnswerWithContext(\n    query: string,\n    context: string,\n  ): Promise<string> {\n    //     const promptTemplate = PromptTemplate.fromTemplate(`\n    // You are a helpful AI assistant that answers questions based on the provided context and your general knowledge.\n    // Use the information from the context when available, and supplement with your general knowledge to provide comprehensive answers.\n\n    // Context:\n    // {context}\n\n    // Question: {query}\n\n    // Instructions:\n    // 1. Answer the question using the provided context when available\n    // 2. If the context doesn't contain enough information, use your general knowledge to provide a helpful answer\n    // 3. Never mention that the context is insufficient or that you don't have enough information\n    // 4. Be specific and provide detailed information\n    // 5. Keep your answer concise but comprehensive\n    // 6. If the question is exactly the same as a question in the context, answer it with the answer exactly as it is in the context\n    // 7. Sometimes there are repeated questions in the answer, so return only the answer part\n\n    // Answer:`);\n\n    const promptTemplate = PromptTemplate.fromTemplate(`\nYou are a knowledgeable and empathetic expert on caregiving, including emotional support, medical resources, daily care strategies, legal and financial considerations, and community options for those caring for aging or dependent loved ones. Your goal is to provide practical, actionable guidance that helps users navigate their caregiving queries effectively.\nWhen responding to the userâ€™s query, always base your answer on the provided context from relevant community discussions or resources. If the context doesnâ€™t fully address the query, note any gaps and suggest general next steps without fabricating information.\nStructure your response to directly address common follow-up thoughts like: â€œWhat do I do with this information? Who can help me? Who is likely to be involved? Where can I find these people or resources?â€\nInclude the following elements in every response:\n1. Actionable Plan: Break down practical steps the user can take, tailored to the query and context. Make it step-by-step, realistic, and prioritized.\n2. Key Professionals and Stakeholders: Identify relevant experts or individuals who could assist, such as geriatric care managers (also known as Aging Life Care Professionals), elder law attorneys, healthcare providers, certified senior advisors, senior real estate specialists, or family members. Explain their roles briefly and who might be involved in the process (e.g., spouses, social workers, or support groups).\n3. Where to Find Help: Suggest reliable ways to locate these professionals, like through professional associations, local networks, or online directories. Provide links to helpful, non-commercial association websites (e.g., alz.org for The Alzheimerâ€™s Association, naela.org for the National Academy of Elder Law Attorneys, whereyoulivematters.org for finding senior living options from the American Seniors Housing Association, leadingage.org for Continuing Care Retirement Communities and Life Plan Communities, mylifesite.net as the authoritative consumer site on CCRCs and Life Plan Communities, or 55places.com for active adult and 55+ communities. For home care questions direct users to https://allianceforcareathome.org/find-a-provider/). Never mention or link to: caring.com, aplaceformom, oasissenioradvisors.com, seniorly.com, elderlifefinancial.com, silverassist.com, or familyassets.com.\n4. Experienced Perspective: Offer a general overview of how someone with real-world experience (e.g., a seasoned caregiver or caregiving professional) might approach and respond to the situation, drawing from common best practices in the context.\nKeep your tone supportive, clear, and encouraging. Be concise yet comprehensive, and cite specific parts of the context where relevant. Begin your answer with \"Hi there.\" as a greeting and end with a warm, empathetic closing.\nContext: {context}\nUser Query: {query}\n`);\n\n    const chain = promptTemplate.pipe(this.llm);\n\n    const response = await chain.invoke({\n      context,\n      query,\n    });\n\n    return response.content as string;\n  }\n\n  /**\n   * Generate answer using LLM with context (streaming version)\n   */\n  private async *generateAnswerWithContextStream(\n    query: string,\n    context: string,\n  ) {\n    const promptTemplate = PromptTemplate.fromTemplate(`\nYou are a knowledgeable and empathetic expert on caregiving, including emotional support, medical resources, daily care strategies, legal and financial considerations, and community options for those caring for aging or dependent loved ones. Your goal is to provide practical, actionable guidance that helps users navigate their caregiving queries effectively.\nWhen responding to the user's query, always base your answer on the provided context from relevant community discussions or resources. If the context doesn't fully address the query, note any gaps and suggest general next steps without fabricating information.\nStructure your response to directly address common follow-up thoughts like: \"What do I do with this information? Who can help me? Who is likely to be involved? Where can I find these people or resources?\"\nInclude the following elements in every response:\n1. Actionable Plan: Break down practical steps the user can take, tailored to the query and context. Make it step-by-step, realistic, and prioritized.\n2. Key Professionals and Stakeholders: Identify relevant experts or individuals who could assist, such as geriatric care managers (also known as Aging Life Care Professionals), elder law attorneys, healthcare providers, certified senior advisors, senior real estate specialists, or family members. Explain their roles briefly and who might be involved in the process (e.g., spouses, social workers, or support groups).\n3. Where to Find Help: Suggest reliable ways to locate these professionals, like through professional associations, local networks, or online directories. Provide links to helpful, non-commercial association websites (e.g., alz.org for The Alzheimer's Association, naela.org for the National Academy of Elder Law Attorneys, whereyoulivematters.org for finding senior living options from the American Seniors Housing Association, leadingage.org for Continuing Care Retirement Communities and Life Plan Communities, mylifesite.net as the authoritative consumer site on CCRCs and Life Plan Communities, or 55places.com for active adult and 55+ communities. For home care questions direct users to https://allianceforcareathome.org/find-a-provider/). Never mention or link to: caring.com, aplaceformom, oasissenioradvisors.com, seniorly.com, elderlifefinancial.com, silverassist.com, or familyassets.com.\n4. Experienced Perspective: Offer a general overview of how someone with real-world experience (e.g., a seasoned caregiver or caregiving professional) might approach and respond to the situation, drawing from common best practices in the context.\nKeep your tone supportive, clear, and encouraging. Be concise yet comprehensive, and cite specific parts of the context where relevant. Begin your answer with \"Hi there.\" as a greeting and end with a warm, empathetic closing.\nContext: {context}\nUser Query: {query}\n`);\n\n    const chain = promptTemplate.pipe(this.llm);\n\n    const stream = await chain.stream({\n      context,\n      query,\n    });\n\n    for await (const chunk of stream) {\n      yield {\n        type: \"content\",\n        content: chunk.content,\n      };\n    }\n  }\n\n  /**\n   * Calculate confidence score based on search results\n   */\n  private calculateConfidence(searchResults: SearchResult[]): number {\n    if (searchResults.length === 0) return 0;\n\n    // Calculate average similarity score\n    const avgScore =\n      searchResults.reduce((sum, result) => sum + result.score, 0) /\n      searchResults.length;\n\n    // Normalize to 0-1 range\n    return Math.min(Math.max(avgScore, 0), 1);\n  }\n\n  /**\n   * Search for similar content without generating an answer\n   */\n  async searchSimilar(\n    query: string,\n    topK: number = 5,\n  ): Promise<SearchResult[]> {\n    const queryEmbedding = await this.embeddingService.generateEmbedding(query);\n\n    return await this.vectorStore.hybridSearch(query, queryEmbedding, {\n      topK,\n      similarityThreshold: 0.5,\n    });\n  }\n\n  /**\n   * Get vector store statistics\n   */\n  async getStats(): Promise<{\n    totalChunks: number;\n    totalQAs: number;\n    averageChunksPerQA: number;\n  }> {\n    return await this.vectorStore.getStats();\n  }\n\n  /**\n   * Get the vector store instance\n   */\n  getVectorStore(): VectorStore {\n    return this.vectorStore;\n  }\n\n  /**\n   * Update QA data in the vector store\n   */\n  async updateQaData(\n    qaId: number,\n    qaData: {\n      question: string;\n      answer: string;\n      category?: string;\n      source: string;\n    },\n  ): Promise<void> {\n    // Delete existing chunks for this QA\n    await this.vectorStore.deleteChunksByQaId(qaId);\n\n    // Process and store new chunks\n    const chunks = await this.embeddingService.processQaData([\n      {\n        id: qaId,\n        ...qaData,\n      },\n    ]);\n\n    await this.vectorStore.storeChunks(chunks);\n  }\n\n  /**\n   * Delete QA data from the vector store\n   */\n  async deleteQaData(qaId: number): Promise<void> {\n    await this.vectorStore.deleteChunksByQaId(qaId);\n  }\n\n  /**\n   * Test the RAG system with a sample query\n   */\n  async testRagSystem(): Promise<{\n    stats: any;\n    sampleQuery: string;\n    sampleResponse: RagResponse;\n  }> {\n    const stats = await this.getStats();\n\n    if (stats.totalChunks === 0) {\n      throw new Error(\"No data available in the vector store for testing\");\n    }\n\n    const sampleQuery = \"What is an ADU and how can it be used for elder care?\";\n    const sampleResponse = await this.generateAnswer(sampleQuery);\n\n    return {\n      stats,\n      sampleQuery,\n      sampleResponse,\n    };\n  }\n}\n","size_bytes":14415},"import-to-dev-database.sh":{"content":"#!/bin/bash\n\n# Import production backup to development database\n# Usage: ./import-to-dev-database.sh\n\nif [ -z \"$DATABASE_URL_DEV\" ]; then\n  echo \"âŒ ERROR: DATABASE_URL_DEV is not set!\"\n  echo \"Please set your development database URL in Replit Secrets:\"\n  echo \"  Key: DATABASE_URL_DEV\"\n  echo \"  Value: <your dev database connection string>\"\n  exit 1\nfi\n\necho \"ðŸ”„ Importing production backup to development database...\"\necho \"Dev Database: $DATABASE_URL_DEV\"\necho \"\"\n\n# Import the backup\npsql \"$DATABASE_URL_DEV\" < production_db_backup.sql\n\nif [ $? -eq 0 ]; then\n  echo \"\"\n  echo \"âœ… SUCCESS! Production data imported to development database\"\n  echo \"\"\n  echo \"Your development database now contains:\"\n  echo \"  - All schema (tables, indexes, constraints)\"\n  echo \"  - All production data\"\n  echo \"\"\n  echo \"Next steps:\"\n  echo \"  1. Test with: DATABASE_URL=$DATABASE_URL_DEV npm run dev\"\n  echo \"  2. Or use: ./switch-database.sh development\"\nelse\n  echo \"\"\n  echo \"âŒ Import failed. Check the error messages above.\"\n  exit 1\nfi\n","size_bytes":1037},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\n\n// Extend Express Request interface\ndeclare global {\n  namespace Express {\n    interface Request {\n      userId?: string;\n      user?: any;\n    }\n  }\n}\nimport Stripe from \"stripe\";\nimport { randomBytes } from \"crypto\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./auth\";\nimport {\n  insertPostSchema,\n  insertCommentSchema,\n  insertVoteSchema,\n  insertCategorySchema,\n  insertSocialMediaEmbedSchema,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { moderateContent } from \"./moderation\";\nimport { createRedisSessionStore } from \"./sessionStore\";\nimport { initializeRedis } from \"./initRedis\";\nimport { createGraphQLServer } from \"./graphql/server\";\nimport { calendarService } from \"./services/calendarService\";\nimport { stripeService } from \"./services/stripeService\";\nimport { TimezoneService } from \"./services/timezoneService\";\nimport { googleCalendarService } from \"./services/googleCalendarService\";\nimport { syncUserWithDatabase, updateClerkUserMetadata } from \"./services/userSync\";\nimport { UpsertUser, UserRole } from \"@shared/schema\";\nimport { clerkAuthWithSync, optionalAuth, isAdmin } from \"./middleware/clerkAuth\";\nimport { clerkClient } from \"@clerk/express\";\n\nif (!process.env.STRIPE_SECRET_KEY) {\n  console.warn(\n    \"STRIPE_SECRET_KEY not found - Stripe functionality will be disabled\",\n  );\n}\n\nconst stripe = process.env.STRIPE_SECRET_KEY\n  ? new Stripe(process.env.STRIPE_SECRET_KEY, {\n      apiVersion: \"2023-10-16\",\n    })\n  : null;\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  setupAuth(app);\n\n  // Stripe status check\n  app.get(\"/api/stripe/status\", (req, res) => {\n    res.json({\n      stripe: stripe ? \"configured\" : \"not configured\",\n      hasKey: !!process.env.STRIPE_SECRET_KEY,\n    });\n  });\n\n  // Redis status check\n  app.get(\"/api/redis/status\", async (req, res) => {\n    try {\n      const RedisCache = (await import(\"./redis\")).default;\n      const testKey = \"redis:health:check\";\n      const testValue = { timestamp: Date.now(), status: \"healthy\" };\n\n      // Test Redis connection\n      await RedisCache.set(testKey, testValue, 30);\n      const retrieved = await RedisCache.get(testKey);\n      await RedisCache.del(testKey);\n\n      res.json({\n        redis: \"connected\",\n        cacheTest: retrieved ? \"passed\" : \"failed\",\n        timestamp: new Date().toISOString(),\n      });\n    } catch (error) {\n      res.json({\n        redis: \"disconnected\",\n        error: error.message,\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Cache management endpoints\n  app.get(\"/api/redis/cache-info\", async (req, res) => {\n    try {\n      const RedisCache = (await import(\"./redis\")).default;\n      const keys = await RedisCache.keys(\"*\");\n\n      const cacheInfo = {\n        totalKeys: keys.length,\n        keysByType: {\n          posts: keys.filter((k) => k.startsWith(\"posts:\")).length,\n          categories: keys.filter((k) => k.startsWith(\"categories:\")).length,\n          users: keys.filter((k) => k.startsWith(\"user:\")).length,\n          stats: keys.filter((k) => k.startsWith(\"stats:\")).length,\n          sessions: keys.filter((k) => k.startsWith(\"sess:\")).length,\n          other: keys.filter(\n            (k) => !k.match(/^(posts:|categories:|user:|stats:|sess:)/),\n          ).length,\n        },\n        sampleKeys: keys.slice(0, 10),\n      };\n\n      res.json(cacheInfo);\n    } catch (error) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/redis/cache\", async (req, res) => {\n    try {\n      const RedisCache = (await import(\"./redis\")).default;\n      const { pattern } = req.query;\n\n      if (pattern && typeof pattern === \"string\") {\n        await RedisCache.delPattern(pattern);\n        res.json({ message: `Cleared cache for pattern: ${pattern}` });\n      } else {\n        await RedisCache.flushAll();\n        res.json({ message: \"All cache cleared\" });\n      }\n    } catch (error) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Community stats (public)\n  app.get(\"/api/stats\", async (req, res) => {\n    try {\n      const stats = await storage.getCommunityStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch community stats\" });\n    }\n  });\n\n  // Categories (public)\n  app.get(\"/api/categories\", async (req, res) => {\n    try {\n      const categories = await storage.getCategories();\n      res.json(categories);\n    } catch (error) {\n      console.error(\"Error fetching categories:\", error);\n      res.status(500).json({ message: \"Failed to fetch categories\" });\n    }\n  });\n\n  // Get hierarchical category structure\n  app.get(\"/api/categories/hierarchy\", async (req, res) => {\n    try {\n      const hierarchy = await storage.getCategoryHierarchy();\n      res.json(hierarchy);\n    } catch (error) {\n      console.error(\"Error fetching category hierarchy:\", error);\n      res.status(500).json({ message: \"Failed to fetch category hierarchy\" });\n    }\n  });\n\n  // Get categories by level (0=General, 1=Main, 2=Subtopic)\n  app.get(\"/api/categories/level/:level\", async (req, res) => {\n    try {\n      const level = parseInt(req.params.level);\n      const categories = await storage.getCategoriesByLevel(level);\n      res.json(categories);\n    } catch (error) {\n      console.error(\"Error fetching categories by level:\", error);\n      res.status(500).json({ message: \"Failed to fetch categories by level\" });\n    }\n  });\n\n  // Get subcategories by parent ID\n  app.get(\"/api/categories/parent/:parentId\", async (req, res) => {\n    try {\n      const parentId = parseInt(req.params.parentId);\n      const categories = await storage.getCategoriesByParent(parentId);\n      res.json(categories);\n    } catch (error) {\n      console.error(\"Error fetching subcategories:\", error);\n      res.status(500).json({ message: \"Failed to fetch subcategories\" });\n    }\n  });\n\n  app.get(\"/api/categories/:slug\", async (req, res) => {\n    try {\n      const category = await storage.getCategoryBySlug(req.params.slug);\n      if (!category) {\n        return res.status(404).json({ message: \"Category not found\" });\n      }\n      res.json(category);\n    } catch (error) {\n      console.error(\"Error fetching category:\", error);\n      res.status(500).json({ message: \"Failed to fetch category\" });\n    }\n  });\n\n  // Create new user forum (authenticated users only)\n  app.post(\"/api/forums/create\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { name, description } = req.body;\n\n      if (!name || name.trim().length === 0) {\n        return res.status(400).json({ message: \"Forum name is required\" });\n      }\n\n      // Generate slug from name\n      const slug = name\n        .toLowerCase()\n        .replace(/[^a-z0-9\\s-]/g, \"\")\n        .replace(/\\s+/g, \"-\")\n        .replace(/-+/g, \"-\")\n        .trim();\n\n      // Check if slug already exists\n      const existingForum = await storage.getCategoryBySlug(slug);\n      if (existingForum) {\n        return res\n          .status(400)\n          .json({ message: \"A forum with this name already exists\" });\n      }\n\n      const forumData = {\n        name: name.trim(),\n        description:\n          description?.trim() || `Community forum for ${name.trim()}`,\n        slug: slug,\n        color: \"#6B7280\", // Gray color for user forums\n        icon: \"users\",\n        postCount: 0,\n        level: 0,\n        orderIndex: 999, // Put user forums at the end\n        isOfficial: false,\n        createdBy: req.user.id,\n        parentId: null,\n      };\n\n      const forum = await storage.createCategory(forumData);\n      res.status(201).json({\n        success: true,\n        message: \"Forum created successfully\",\n        forum: forum,\n      });\n    } catch (error) {\n      console.error(\"Error creating forum:\", error);\n      res.status(500).json({ message: \"Failed to create forum\" });\n    }\n  });\n\n  // Get user's created forums\n  app.get(\"/api/forums/my-forums\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userForums = await storage.getUserCreatedForums(req.user.id);\n      res.json(userForums);\n    } catch (error) {\n      console.error(\"Error fetching user forums:\", error);\n      res.status(500).json({ message: \"Failed to fetch your forums\" });\n    }\n  });\n\n  // Search forums (including user-created ones)\n  app.get(\"/api/forums/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      if (!query || query.trim().length < 2) {\n        return res\n          .status(400)\n          .json({ message: \"Search query must be at least 2 characters\" });\n      }\n\n      const results = await storage.searchForums(query.trim());\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error searching forums:\", error);\n      res.status(500).json({ message: \"Failed to search forums\" });\n    }\n  });\n\n  // Create new category (authenticated users only)\n  app.post(\"/api/categories\", isAuthenticated, async (req: any, res) => {\n    try {\n      // Add default values for required fields\n      const categoryData = {\n        ...req.body,\n        color: req.body.color || \"#487d7a\", // Default teal color\n        icon: req.body.icon || \"folder\", // Default icon\n        postCount: 0,\n      };\n\n      const validatedData = insertCategorySchema.parse(categoryData);\n      const category = await storage.createCategory(validatedData);\n\n      // Ensure we return a proper JSON response\n      res.status(201).json(category);\n    } catch (error) {\n      console.error(\"Error creating category:\", error);\n      if (error instanceof z.ZodError) {\n        res.status(400).json({\n          message: \"Invalid category data\",\n          errors: error.errors,\n        });\n      } else {\n        res.status(500).json({ message: \"Failed to create category\" });\n      }\n    }\n  });\n\n  // Posts (public for viewing, auth required for creating)\n  app.get(\"/api/posts\", async (req, res) => {\n    try {\n      // Force fresh data - expert badges in posts need real-time updates\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const categoryId = req.query.categoryId\n        ? parseInt(req.query.categoryId as string)\n        : undefined;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 20;\n      const offset = req.query.offset\n        ? parseInt(req.query.offset as string)\n        : 0;\n      const sortBy = (req.query.sortBy as \"hot\" | \"new\" | \"top\") || \"hot\";\n\n      console.log(\"GET /api/posts params:\", {\n        categoryId,\n        limit,\n        offset,\n        sortBy,\n      });\n\n      // Use enhanced posts with expert info for all post requests\n      const posts = await storage.getPostsWithExpertInfo(\n        categoryId,\n        limit,\n        offset,\n        sortBy,\n      );\n      console.log(\n        `Returning ${posts.length} posts${categoryId ? ` for category ${categoryId}` : \"\"}`,\n      );\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  app.get(\"/api/posts/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      \n      if (!query || query.trim().length === 0) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 20;\n      const offset = req.query.offset ? parseInt(req.query.offset as string) : 0;\n\n      console.log(`Searching posts with query: \"${query}\"`);\n\n      const results = await storage.searchPosts(query.trim(), limit, offset);\n      \n      console.log(`Found ${results.length} posts matching \"${query}\"`);\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error searching posts:\", error);\n      res.status(500).json({ message: \"Failed to search posts\" });\n    }\n  });\n\n  app.get(\"/api/posts/:id\", async (req, res) => {\n    try {\n      // Force fresh data - expert badges in post details need real-time updates\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const postId = parseInt(req.params.id);\n      if (isNaN(postId)) {\n        return res.status(400).json({ message: \"Invalid post ID\" });\n      }\n\n      // Use enhanced post with expert info for consistency with list view\n      const post = await storage.getPostWithExpertInfo(postId);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error fetching post:\", error);\n      res.status(500).json({ message: \"Failed to fetch post\" });\n    }\n  });\n\n  app.post(\"/api/posts\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const postData = insertPostSchema.parse({\n        ...req.body,\n        authorId: userId,\n      });\n\n      // Create post first\n      const post = await storage.createPost(postData);\n\n      // Skip moderation temporarily due to OpenAI quota issues\n      // TODO: Re-enable when quota is resolved\n      console.log(\"Moderation skipped due to OpenAI quota issues\");\n\n      await storage.checkAndAwardAchievements(userId);\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error creating post:\", error);\n      res.status(400).json({ message: \"Failed to create post\" });\n    }\n  });\n\n  // Comments (public for viewing, auth required for creating)\n  app.get(\"/api/posts/:id/comments\", async (req, res) => {\n    try {\n      const comments = await storage.getCommentsByPost(parseInt(req.params.id));\n      res.json(comments);\n    } catch (error) {\n      console.error(\"Error fetching comments:\", error);\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post(\n    \"/api/posts/:id/comments\",\n    clerkAuthWithSync,\n    async (req: any, res) => {\n      try {\n        if (!req.userId) {\n          return res.status(401).json({ message: \"Unauthorized\" });\n        }\n        const userId = req.userId;\n        const postId = parseInt(req.params.id);\n        const commentData = insertCommentSchema.parse({\n          ...req.body,\n          authorId: userId,\n          postId,\n        });\n\n        // Create comment first\n        const comment = await storage.createComment(commentData);\n\n        // Run AI moderation on the comment content\n        const moderationResult = await moderateContent(\n          commentData.content,\n          \"comment\",\n          comment.id.toString(),\n        );\n\n        // Handle moderation result\n        if (moderationResult.status === \"rejected\") {\n          res.status(400).json({\n            message:\n              \"Comment cannot be published due to content policy violations\",\n            reason: moderationResult.reason,\n          });\n          return;\n        }\n\n        if (moderationResult.status === \"flagged\") {\n          res.json({\n            ...comment,\n            moderationNote:\n              \"Comment is under review and may be removed if it violates community guidelines\",\n          });\n          return;\n        }\n\n        await storage.checkAndAwardAchievements(userId);\n        res.json(comment);\n      } catch (error) {\n        console.error(\"Error creating comment:\", error);\n        res.status(400).json({ message: \"Failed to create comment\" });\n      }\n    },\n  );\n\n  // Voting system\n  app.post(\"/api/vote\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const { postId, commentId } = req.body;\n\n      // Check if user already voted\n      const existingVote = await storage.getUserVote(userId, postId, commentId);\n\n      if (existingVote) {\n        // Remove vote\n        await storage.deleteVote(userId, postId, commentId);\n        res.json({ voted: false });\n      } else {\n        // Add vote\n        const voteData = insertVoteSchema.parse({\n          userId,\n          postId: postId || null,\n          commentId: commentId || null,\n        });\n        await storage.createVote(voteData);\n        await storage.checkAndAwardAchievements(userId);\n        res.json({ voted: true });\n      }\n    } catch (error) {\n      console.error(\"Error handling vote:\", error);\n      res.status(400).json({ message: \"Failed to handle vote\" });\n    }\n  });\n\n  app.get(\n    \"/api/vote/:postId?/:commentId?\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.user.id;\n        const postId = req.params.postId\n          ? parseInt(req.params.postId)\n          : undefined;\n        const commentId = req.params.commentId\n          ? parseInt(req.params.commentId)\n          : undefined;\n\n        const vote = await storage.getUserVote(userId, postId, commentId);\n        res.json({ voted: !!vote });\n      } catch (error) {\n        console.error(\"Error checking vote:\", error);\n        res.status(500).json({ message: \"Failed to check vote\" });\n      }\n    },\n  );\n\n  // User achievements\n  app.get(\"/api/user/achievements\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const achievements = await storage.getUserAchievements(userId);\n      res.json(achievements);\n    } catch (error) {\n      console.error(\"Error fetching user achievements:\", error);\n      res.status(500).json({ message: \"Failed to fetch achievements\" });\n    }\n  });\n\n  // Stripe subscription endpoint (if Stripe is available)\n  if (stripe) {\n    // New endpoint for expert verification payment intent\n    app.post(\n      \"/api/experts/create-verification-payment-intent\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          const { amount } = req.body; // Expect amount in cents, e.g., 10000 for $100\n\n          if (!amount || typeof amount !== \"number\" || amount <= 0) {\n            return res\n              .status(400)\n              .json({\n                message: \"Invalid amount specified for verification fee\",\n              });\n          }\n\n          console.log(\"Creating payment intent for expert verification:\", {\n            userId,\n            amount,\n          });\n\n          const paymentIntent = await stripe.paymentIntents.create({\n            amount: amount,\n            currency: \"usd\",\n            metadata: {\n              type: \"expert_verification_fee\",\n              userId: userId,\n            },\n            automatic_payment_methods: {\n              enabled: true,\n              allow_redirects: \"always\",\n            },\n          });\n\n          console.log(\"Payment intent created:\", {\n            id: paymentIntent.id,\n            status: paymentIntent.status,\n            client_secret: paymentIntent.client_secret ? \"present\" : \"missing\",\n          });\n\n          res.json({ clientSecret: paymentIntent.client_secret });\n        } catch (error: any) {\n          console.error(\n            \"Error creating expert verification payment intent:\",\n            error,\n          );\n          res\n            .status(500)\n            .json({\n              message: \"Failed to create payment intent: \" + error.message,\n            });\n        }\n      },\n    );\n\n    // Confirm payment with payment method\n    app.post(\n      \"/api/experts/confirm-verification-payment\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          const { paymentMethodId } = req.body;\n\n          if (!paymentMethodId) {\n            return res\n              .status(400)\n              .json({ message: \"Payment method ID required\" });\n          }\n\n          console.log(\n            \"Creating and confirming payment intent with method:\",\n            paymentMethodId,\n          );\n\n          // Create and confirm payment intent in one step\n          const paymentIntent = await stripe.paymentIntents.create({\n            amount: 10000, // $100.00\n            currency: \"usd\",\n            payment_method: paymentMethodId,\n            confirm: true,\n            metadata: {\n              type: \"expert_verification_fee\",\n              userId: userId,\n            },\n            automatic_payment_methods: {\n              enabled: true,\n              allow_redirects: \"always\",\n            },\n          });\n\n          console.log(\"Payment intent result:\", {\n            id: paymentIntent.id,\n            status: paymentIntent.status,\n            requiresAction: paymentIntent.status === \"requires_action\",\n          });\n\n          if (paymentIntent.status === \"requires_action\") {\n            // 3D Secure is required\n            return res.json({\n              requiresAction: true,\n              clientSecret: paymentIntent.client_secret,\n            });\n          } else if (paymentIntent.status === \"succeeded\") {\n            // Payment was successful\n            return res.json({\n              success: true,\n              paymentIntentId: paymentIntent.id,\n            });\n          } else {\n            // Payment failed\n            return res.status(400).json({\n              error: `Payment failed with status: ${paymentIntent.status}`,\n            });\n          }\n        } catch (error: any) {\n          console.error(\"Error confirming payment:\", error);\n          res\n            .status(500)\n            .json({ message: \"Failed to process payment: \" + error.message });\n        }\n      },\n    );\n\n    // Create Stripe checkout session for expert application\n    app.post(\n      \"/api/experts/create-checkout-session\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          const { applicationData } = req.body;\n          if (!applicationData) {\n            return res\n              .status(400)\n              .json({ message: \"Application data required\" });\n          }\n\n          console.log(\"Creating checkout session for expert verification\");\n\n          // Store application data in session metadata (Stripe has limits on metadata size)\n          const session = await stripe.checkout.sessions.create({\n            payment_method_types: [\"card\"],\n            line_items: [\n              {\n                price_data: {\n                  currency: \"usd\",\n                  product_data: {\n                    name: \"Expert Verification Fee\",\n                    description: \"One-time fee for expert profile verification\",\n                  },\n                  unit_amount: 10000, // $100.00\n                },\n                quantity: 1,\n              },\n            ],\n            mode: \"payment\",\n            success_url: `${process.env.REPLIT_DOMAINS ? \"https://\" + process.env.REPLIT_DOMAINS : \"http://localhost:5000\"}/expert-application-success?session_id={CHECKOUT_SESSION_ID}`,\n            cancel_url: `${process.env.REPLIT_DOMAINS ? \"https://\" + process.env.REPLIT_DOMAINS : \"http://localhost:5000\"}/expert-application-simple`,\n            metadata: {\n              userId: userId,\n              type: \"expert_verification\",\n              // Store essential data only due to Stripe metadata limits\n              profession: applicationData.profession,\n              company: applicationData.company,\n            },\n            client_reference_id: userId,\n          });\n\n          // We'll pass the application data through the success URL as a session parameter\n          // The success page will retrieve the session and complete the application\n\n          console.log(\"Checkout session created:\", session.id);\n          res.json({ url: session.url, sessionId: session.id });\n        } catch (error: any) {\n          console.error(\"Error creating checkout session:\", error);\n          res\n            .status(500)\n            .json({\n              message: \"Failed to create checkout session: \" + error.message,\n            });\n        }\n      },\n    );\n\n    // Simple payment intent creation without auto-confirm\n    app.post(\n      \"/api/experts/create-simple-payment-intent\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          console.log(\"Creating simple payment intent for expert verification\");\n\n          // Create payment intent without confirming\n          const paymentIntent = await stripe.paymentIntents.create({\n            amount: 10000, // $100.00\n            currency: \"usd\",\n            metadata: {\n              type: \"expert_verification_fee\",\n              userId: userId,\n            },\n          });\n\n          console.log(\"Simple payment intent created:\", {\n            id: paymentIntent.id,\n            status: paymentIntent.status,\n          });\n\n          res.json({\n            clientSecret: paymentIntent.client_secret,\n            paymentIntentId: paymentIntent.id,\n          });\n        } catch (error: any) {\n          console.error(\"Error creating simple payment intent:\", error);\n          res\n            .status(500)\n            .json({\n              message: \"Failed to create payment intent: \" + error.message,\n            });\n        }\n      },\n    );\n\n    // Apply with payment method - simpler approach\n    app.post(\n      \"/api/experts/apply-with-payment-method\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          const { paymentMethodId, ...applicationData } = req.body;\n\n          if (!paymentMethodId) {\n            return res\n              .status(400)\n              .json({ message: \"Payment method ID required\" });\n          }\n\n          console.log(\n            \"Processing expert application with payment method:\",\n            paymentMethodId,\n          );\n\n          // Create and confirm payment intent in one step\n          const paymentIntent = await stripe.paymentIntents.create({\n            amount: 10000, // $100.00\n            currency: \"usd\",\n            payment_method: paymentMethodId,\n            confirm: true,\n            metadata: {\n              type: \"expert_verification_fee\",\n              userId: userId,\n            },\n          });\n\n          console.log(\"Payment intent result:\", {\n            id: paymentIntent.id,\n            status: paymentIntent.status,\n          });\n\n          if (\n            paymentIntent.status === \"requires_action\" &&\n            paymentIntent.client_secret\n          ) {\n            // 3D Secure is required\n            return res.json({\n              requiresAction: true,\n              clientSecret: paymentIntent.client_secret,\n            });\n          } else if (paymentIntent.status === \"succeeded\") {\n            // Payment was successful, create the application\n            const expertVerification = await storage.createExpertVerification({\n              userId,\n              ...applicationData,\n              stripePaymentIntentId: paymentIntent.id,\n              verificationStatus: \"pending\",\n              isActive: false,\n            });\n\n            console.log(\"Expert verification created:\", expertVerification.id);\n\n            // Send confirmation email\n            if (req.user?.email) {\n              await emailService.sendExpertApplicationConfirmation(\n                req.user.email,\n                req.user.username || \"Expert\",\n              );\n            }\n\n            return res.json({\n              success: true,\n              expertVerification,\n            });\n          } else {\n            // Payment failed\n            return res.status(400).json({\n              error: `Payment failed with status: ${paymentIntent.status}`,\n            });\n          }\n        } catch (error: any) {\n          console.error(\n            \"Error processing expert application with payment:\",\n            error,\n          );\n          res\n            .status(500)\n            .json({\n              message: \"Failed to process application: \" + error.message,\n            });\n        }\n      },\n    );\n\n    // Check payment intent status\n    app.post(\n      \"/api/experts/check-payment-status\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const { paymentIntentId } = req.body;\n\n          if (!paymentIntentId) {\n            return res\n              .status(400)\n              .json({ message: \"Payment intent ID required\" });\n          }\n\n          const paymentIntent =\n            await stripe.paymentIntents.retrieve(paymentIntentId);\n\n          console.log(\"Payment intent status check:\", {\n            id: paymentIntent.id,\n            status: paymentIntent.status,\n            amount: paymentIntent.amount,\n            metadata: paymentIntent.metadata,\n          });\n\n          res.json({\n            status: paymentIntent.status,\n            amount: paymentIntent.amount,\n            metadata: paymentIntent.metadata,\n          });\n        } catch (error: any) {\n          console.error(\"Error checking payment status:\", error);\n          res\n            .status(500)\n            .json({\n              message: \"Failed to check payment status: \" + error.message,\n            });\n        }\n      },\n    );\n\n    // Existing subscription endpoint\n    app.post(\n      \"/api/get-or-create-subscription\",\n      isAuthenticated,\n      async (req: any, res) => {\n        try {\n          const userId = req.user?.id || req.user?.claims?.sub;\n          if (!userId) {\n            return res.status(401).json({ message: \"User not authenticated\" });\n          }\n\n          let user = await storage.getUser(userId);\n\n          if (!user) {\n            return res.status(404).json({ message: \"User not found\" });\n          }\n\n          if (user.stripeSubscriptionId && user.isPremium) {\n            try {\n              const subscription = await stripe.subscriptions.retrieve(\n                user.stripeSubscriptionId,\n              );\n              const invoice = await stripe.invoices.retrieve(\n                subscription.latest_invoice as string,\n              );\n\n              res.json({\n                subscriptionId: subscription.id,\n                clientSecret: (invoice.payment_intent as any)?.client_secret,\n              });\n              return;\n            } catch (error) {\n              console.error(\"Error retrieving subscription:\", error);\n              // Continue to create new subscription if retrieval fails\n            }\n          }\n\n          if (!user.email) {\n            return res.status(400).json({ message: \"No user email on file\" });\n          }\n\n          try {\n            let customer;\n            if (user.stripeCustomerId) {\n              customer = await stripe.customers.retrieve(user.stripeCustomerId);\n            } else {\n              customer = await stripe.customers.create({\n                email: user.email,\n                name: `${user.firstName} ${user.lastName}`.trim(),\n              });\n\n              user = await storage.upsertUser({\n                ...user,\n                stripeCustomerId: customer.id,\n              });\n            }\n\n            // Create a price for $9.99/month if no price ID is set\n            let priceId = process.env.STRIPE_PRICE_ID;\n            if (!priceId) {\n              const price = await stripe.prices.create({\n                currency: \"usd\",\n                unit_amount: 999, // $9.99 in cents\n                recurring: { interval: \"month\" },\n                product_data: {\n                  name: \"AskEdith Premium Membership\",\n                },\n              });\n              priceId = price.id;\n            }\n\n            const subscription = await stripe.subscriptions.create({\n              customer: customer.id,\n              items: [\n                {\n                  price: priceId,\n                },\n              ],\n              payment_behavior: \"default_incomplete\",\n              expand: [\"latest_invoice.payment_intent\"],\n            });\n\n            await storage.updateUserStripeInfo(userId, {\n              customerId: customer.id,\n              subscriptionId: subscription.id,\n            });\n\n            res.json({\n              subscriptionId: subscription.id,\n              clientSecret: (subscription.latest_invoice as any)?.payment_intent\n                ?.client_secret,\n            });\n          } catch (error: any) {\n            console.error(\"Error creating subscription:\", error);\n            return res.status(400).json({ error: { message: error.message } });\n          }\n        } catch (error: any) {\n          console.error(\"Authentication or server error:\", error);\n          return res\n            .status(500)\n            .json({ message: \"Failed to create subscription\" });\n        }\n      },\n    );\n  } else {\n    app.post(\"/api/get-or-create-subscription\", (req, res) => {\n      res.status(503).json({ message: \"Stripe not configured\" });\n    });\n  }\n\n  // Initialize default categories if they don't exist\n  (async () => {\n    try {\n      const existingCategories = await storage.getCategories();\n      if (existingCategories.length === 0) {\n        const defaultCategories = [\n          {\n            name: \"Senior Living\",\n            description:\n              \"Assisted living, memory care, and housing decisions for aging parents.\",\n            slug: \"senior-living\",\n            color: \"rose\",\n            icon: \"home\",\n          },\n          {\n            name: \"Home Care\",\n            description:\n              \"In-home caregiving, daily routines, and managing care at home.\",\n            slug: \"home-care\",\n            color: \"blue\",\n            icon: \"heart-handshake\",\n          },\n          {\n            name: \"Government Resources\",\n            description:\n              \"Medicare, Medicaid, benefits, and navigating government programs.\",\n            slug: \"government-resources\",\n            color: \"emerald\",\n            icon: \"landmark\",\n          },\n          {\n            name: \"Legal & Attorneys\",\n            description:\n              \"Legal planning, estate matters, and working with attorneys.\",\n            slug: \"legal-attorneys\",\n            color: \"amber\",\n            icon: \"scale\",\n          },\n          {\n            name: \"Paying for Care\",\n            description:\n              \"Financial planning, insurance, and affording quality care options.\",\n            slug: \"paying-for-care\",\n            color: \"lime\",\n            icon: \"dollar-sign\",\n          },\n          {\n            name: \"Physical Therapy\",\n            description:\n              \"Rehabilitation, mobility, and physical therapy resources.\",\n            slug: \"physical-therapy\",\n            color: \"cyan\",\n            icon: \"activity\",\n          },\n          {\n            name: \"VA Benefits\",\n            description:\n              \"Veterans Affairs benefits and resources for military families.\",\n            slug: \"va-benefits\",\n            color: \"teal\",\n            icon: \"shield\",\n          },\n          {\n            name: \"Other Professionals\",\n            description:\n              \"Healthcare specialists, social workers, and other professional services.\",\n            slug: \"other-professionals\",\n            color: \"indigo\",\n            icon: \"users\",\n          },\n        ];\n\n        for (const category of defaultCategories) {\n          await storage.createCategory(category);\n        }\n        console.log(\"Default categories initialized\");\n      }\n    } catch (error) {\n      console.error(\"Error initializing categories:\", error);\n    }\n  })();\n\n  // Moderation dashboard routes (admin/moderator access)\n  app.get(\"/api/moderation/queue\", isAuthenticated, async (req: any, res) => {\n    try {\n      // In a production app, you'd check if user has moderator permissions\n      const moderationQueue = await storage.getModerationQueue();\n      res.json(moderationQueue);\n    } catch (error) {\n      console.error(\"Error fetching moderation queue:\", error);\n      res.status(500).json({ message: \"Failed to fetch moderation queue\" });\n    }\n  });\n\n  app.post(\n    \"/api/moderation/:id/review\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.user.id;\n        const moderationId = parseInt(req.params.id);\n        const { status } = req.body;\n\n        if (![\"approved\", \"rejected\"].includes(status)) {\n          return res.status(400).json({ message: \"Invalid status\" });\n        }\n\n        await storage.updateModerationStatus(moderationId, status, userId);\n        res.json({ message: \"Content review completed successfully\" });\n      } catch (error) {\n        console.error(\"Error reviewing content:\", error);\n        res.status(500).json({ message: \"Failed to review content\" });\n      }\n    },\n  );\n\n\n  // Expert routes\n  app.get(\"/api/experts\", async (req, res) => {\n    try {\n      // Force fresh data - no caching for approval-sensitive data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const experts = await storage.getAllExperts();\n      res.json(experts);\n    } catch (error) {\n      console.error(\"Error fetching experts:\", error);\n      res.status(500).json({ message: \"Failed to fetch experts\" });\n    }\n  });\n\n  app.get(\"/api/experts/verified\", async (req, res) => {\n    try {\n      // Force fresh data - no caching for approval-sensitive data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const experts = await storage.getVerifiedExperts();\n      res.json(experts);\n    } catch (error) {\n      console.error(\"Error fetching verified experts:\", error);\n      res.status(500).json({ message: \"Failed to fetch verified experts\" });\n    }\n  });\n\n  app.get(\"/api/experts/featured\", async (req, res) => {\n    try {\n      // Force fresh data - no caching for approval-sensitive data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const experts = await storage.getFeaturedExperts();\n      res.json(experts);\n    } catch (error) {\n      console.error(\"Error fetching featured experts:\", error);\n      res.status(500).json({ message: \"Failed to fetch featured experts\" });\n    }\n  });\n\n  app.get(\"/api/experts/me\", isAuthenticated, async (req: any, res) => {\n    try {\n      const verification = await storage.getExpertVerification(req.user.id);\n      if (!verification) {\n        return res\n          .status(404)\n          .json({ message: \"No expert verification found\" });\n      }\n      res.json(verification);\n    } catch (error) {\n      console.error(\"Error fetching expert verification:\", error);\n      res.status(500).json({ message: \"Failed to fetch expert verification\" });\n    }\n  });\n\n  // Admin routes for expert verification\n  app.get(\"/api/admin/expert-applications\", isAdmin, async (req, res) => {\n    try {\n      const pendingApplications = await storage.getPendingExpertVerifications();\n      res.json(pendingApplications);\n    } catch (error) {\n      console.error(\"Error fetching pending expert applications:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending applications\" });\n    }\n  });\n\n  app.post(\n    \"/api/admin/expert-applications/:id/review\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const { id } = req.params;\n        const { status } = req.body; // 'verified' or 'rejected'\n\n        if (![\"verified\", \"rejected\"].includes(status)) {\n          return res.status(400).json({ message: \"Invalid status\" });\n        }\n\n        const updatedApplication = await storage.updateExpertVerificationStatus(\n          parseInt(id),\n          status,\n          req.user.id,\n        );\n\n        // If expert is verified, also approve the user automatically\n        if (status === 'verified' && updatedApplication?.userId) {\n          try {\n            await storage.approveUser(updatedApplication.userId);\n            \n            // Additional cache invalidation for real-time updates\n            try {\n              const { invalidateCache, InvalidationPatterns } = await import(\"./cache\");\n              await invalidateCache([\n                InvalidationPatterns.experts,\n                ...InvalidationPatterns.user(updatedApplication.userId),\n                'experts:*',\n                'posts:*',  // Add posts cache invalidation for expert badges in posts\n                'admin:*'\n              ]);\n            } catch (cacheError) {\n              console.log(\"Cache invalidation failed (non-critical):\", cacheError.message);\n            }\n          } catch (error) {\n            console.error(\"Failed to auto-approve user after verification:\", error);\n            // Don't fail the entire request if user approval fails\n          }\n        }\n\n        res.json({\n          message: `Application ${status} successfully.`,\n          application: updatedApplication,\n        });\n      } catch (error) {\n        console.error(\"Error reviewing expert application:\", error);\n        res.status(500).json({ message: \"Failed to review application\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/experts/my-application\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const application = await storage.getExpertVerification(req.user.id);\n        if (!application)\n          return res.status(404).json({ message: \"Application not found\" });\n        res.json(application);\n      } catch (error) {\n        console.error(\"Error fetching expert application:\", error);\n        res.status(500).json({ message: \"Failed to fetch application\" });\n      }\n    },\n  );\n\n  // Complete expert application after Stripe checkout\n  app.post(\n    \"/api/experts/complete-checkout-application\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.user?.id || req.user?.claims?.sub;\n        if (!userId) {\n          return res.status(401).json({ message: \"User not authenticated\" });\n        }\n\n        const { sessionId, applicationData } = req.body;\n        if (!sessionId || !applicationData) {\n          return res\n            .status(400)\n            .json({ message: \"Session ID and application data required\" });\n        }\n\n        // Verify the checkout session\n        const session = await stripe.checkout.sessions.retrieve(sessionId);\n\n        if (\n          session.payment_status !== \"paid\" ||\n          session.metadata?.userId !== userId\n        ) {\n          return res.status(400).json({ message: \"Invalid or unpaid session\" });\n        }\n\n        // Create the expert verification record\n        const verification = await storage.createExpertVerification({\n          userId,\n          profession: applicationData.profession,\n          expertiseArea: applicationData.expertiseArea,\n          credentials: applicationData.credentials,\n          bio: applicationData.bio,\n          yearsExperience: parseInt(applicationData.yearsOfExperience),\n          licenseNumber: applicationData.licenseNumber,\n          company: applicationData.company,\n          companyAddress: applicationData.companyAddress,\n          companyWebsite: applicationData.companyWebsite || null,\n          companyEmail: applicationData.companyEmail,\n          website: applicationData.websiteUrl || null,\n          linkedinUrl: applicationData.linkedinUrl || null,\n          blogUrl: applicationData.blogUrl || null,\n          booksUrl: applicationData.booksUrl || null,\n          articlesUrl: applicationData.articlesUrl || null,\n          profileImageUrl: null,\n          licenseFileUrl: null,\n          consultationRate: parseInt(applicationData.consultationRate) * 100, // Convert to cents\n          consultationEnabled: true,\n          verificationFeeStatus: \"paid\",\n          verificationFeePaidAt: new Date(),\n          verificationStatus: \"pending\",\n          stripePaymentIntentId: session.payment_intent as string,\n        });\n\n        res.json({ success: true, verification });\n      } catch (error: any) {\n        console.error(\"Error completing checkout application:\", error);\n        res\n          .status(500)\n          .json({\n            message: \"Failed to complete application: \" + error.message,\n          });\n      }\n    },\n  );\n\n  // Expert application with payment\n  app.post(\n    \"/api/experts/apply-with-payment\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.user.id;\n        const expertData = req.body;\n\n        // Check if user already has a verification request\n        const existing = await storage.getExpertVerification(userId);\n        if (existing) {\n          return res\n            .status(400)\n            .json({ message: \"Expert verification already exists\" });\n        }\n\n        // File URLs are now handled client-side and passed in the body\n        const { profileImageUrl, licenseFileUrl, stripePaymentIntentId } =\n          expertData;\n\n        // Verify payment if stripePaymentIntentId is provided\n        if (stripePaymentIntentId && stripe) {\n          try {\n            const paymentIntent = await stripe.paymentIntents.retrieve(\n              stripePaymentIntentId,\n            );\n            console.log(\"Verifying payment intent:\", {\n              id: paymentIntent.id,\n              status: paymentIntent.status,\n              amount: paymentIntent.amount,\n            });\n\n            if (paymentIntent.status !== \"succeeded\") {\n              return res.status(400).json({\n                message: `Payment not completed. Status: ${paymentIntent.status}`,\n              });\n            }\n          } catch (error) {\n            console.error(\"Error verifying payment intent:\", error);\n            return res.status(400).json({\n              message:\n                \"Invalid payment reference. Please complete payment first.\",\n            });\n          }\n        }\n\n        const verification = await storage.createExpertVerification({\n          userId,\n          profession: expertData.profession,\n          expertiseArea: expertData.expertiseArea,\n          credentials: expertData.credentials,\n          bio: expertData.bio,\n          yearsExperience: parseInt(expertData.yearsOfExperience),\n          licenseNumber: expertData.licenseNumber,\n          company: expertData.company,\n          companyAddress: expertData.companyAddress,\n          companyWebsite: expertData.companyWebsite || null,\n          companyEmail: expertData.companyEmail,\n          website: expertData.websiteUrl || null,\n          linkedinUrl: expertData.linkedinUrl || null,\n          blogUrl: expertData.blogUrl || null,\n          booksUrl: expertData.booksUrl || null,\n          articlesUrl: expertData.articlesUrl || null,\n          profileImageUrl: profileImageUrl || null,\n          licenseFileUrl: licenseFileUrl || null,\n          consultationRate: parseInt(expertData.consultationRate) * 100, // Convert to cents\n          consultationEnabled: expertData.consultationEnabled === \"true\",\n          verificationFeeStatus: \"paid\", // Assuming payment was successful\n          verificationFeePaidAt: new Date(),\n          verificationStatus: \"pending\",\n          stripePaymentIntentId: stripePaymentIntentId || null,\n        });\n\n        res.json(verification);\n      } catch (error) {\n        console.error(\"Error creating expert verification:\", error);\n        res.status(500).json({ message: \"Failed to submit application\" });\n      }\n    },\n  );\n\n  app.post(\"/api/experts/apply\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const expertData = req.body;\n\n      // Check if user already has a verification request\n      const existing = await storage.getExpertVerification(userId);\n      if (existing) {\n        return res\n          .status(400)\n          .json({ message: \"Expert verification already exists\" });\n      }\n\n      const verification = await storage.createExpertVerification({\n        userId,\n        ...expertData,\n        profileImageUrl: expertData.profileImageUrl || null,\n        licenseFileUrl: expertData.licenseFileUrl || null,\n        verificationStatus: \"pending\",\n      });\n\n      res.json(verification);\n    } catch (error) {\n      console.error(\"Error creating expert verification:\", error);\n      res.status(500).json({ message: \"Failed to create expert verification\" });\n    }\n  });\n\n  // This endpoint is deprecated, use /api/admin/expert-applications/:id/review instead\n  app.put(\n    \"/api/experts/:id/verify\",\n    isAuthenticated,\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const expertId = parseInt(req.params.id);\n        const verification = await storage.updateExpertVerificationStatus(\n          expertId,\n          \"verified\",\n          req.user.id,\n        );\n        res.json(verification);\n      } catch (error) {\n        console.error(\"Error verifying expert:\", error);\n        res.status(500).json({ message: \"Failed to verify expert\" });\n      }\n    },\n  );\n\n  // Enhanced posts with expert information\n  app.get(\"/api/posts/with-experts\", async (req, res) => {\n    try {\n      const { category, limit = 20, offset = 0, sortBy = \"hot\" } = req.query;\n      const categoryId =\n        category && !isNaN(parseInt(category as string))\n          ? parseInt(category as string)\n          : undefined;\n      const limitNum = !isNaN(parseInt(limit as string))\n        ? parseInt(limit as string)\n        : 20;\n      const offsetNum = !isNaN(parseInt(offset as string))\n        ? parseInt(offset as string)\n        : 0;\n      const sortByParam = (sortBy as \"hot\" | \"new\" | \"top\") || \"hot\";\n\n      const posts = await storage.getPostsWithExpertInfo(\n        categoryId,\n        limitNum,\n        offsetNum,\n        sortByParam,\n      );\n\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching posts with expert info:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  // Posts by specific author\n  app.get(\"/api/posts/by-author/:authorId\", async (req, res) => {\n    try {\n      const { authorId } = req.params;\n      const { limit = 20, offset = 0 } = req.query;\n      const limitNum = !isNaN(parseInt(limit as string))\n        ? parseInt(limit as string)\n        : 20;\n      const offsetNum = !isNaN(parseInt(offset as string))\n        ? parseInt(offset as string)\n        : 0;\n\n      const posts = await storage.getPostsByAuthor(\n        authorId,\n        limitNum,\n        offsetNum,\n      );\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching posts by author:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts by author\" });\n    }\n  });\n\n  // Get current authenticated user\n  app.get(\"/api/user\", optionalAuth, async (req: Request, res: Response) => {\n    try {\n      // If no user is authenticated, return 401\n      if (!req.userId || !req.user) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      // Check if user has expert verification\n      let expertVerification = null;\n      try {\n        expertVerification = await storage.getExpertVerification(req.userId);\n      } catch (error) {\n        // Expert verification might not exist, that's ok\n      }\n      \n      const userWithVerification = {\n        ...req.user,\n        expertVerification\n      };\n      \n      res.json(userWithVerification);\n    } catch (error) {\n      console.error(\"Error getting current user:\", error);\n      res.status(500).json({ message: \"Failed to get user\" });\n    }\n  });\n\n\n  // Get user profile by ID\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Get user dashboard statistics\n  app.get(\n    \"/api/user/dashboard-stats\",\n    clerkAuthWithSync,\n    async (req: any, res) => {\n      try {\n        if (!req.userId) {\n          return res.status(401).json({ message: \"Unauthorized\" });\n        }\n        const userId = req.userId;\n        const stats = await storage.getUserDashboardStats(userId);\n        res.json(stats);\n      } catch (error) {\n        console.error(\"Error fetching user dashboard stats:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to fetch dashboard statistics\" });\n      }\n    },\n  );\n\n  // Get posts by user ID (alias for posts/by-author for frontend convenience)\n  app.get(\"/api/posts/user/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { limit = 20, offset = 0 } = req.query;\n      const limitNum = !isNaN(parseInt(limit as string))\n        ? parseInt(limit as string)\n        : 20;\n      const offsetNum = !isNaN(parseInt(offset as string))\n        ? parseInt(offset as string)\n        : 0;\n\n      const posts = await storage.getPostsByAuthor(userId, limitNum, offsetNum);\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching user posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch user posts\" });\n    }\n  });\n\n  app.get(\"/api/posts/:id/with-expert\", async (req, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const post = await storage.getPostWithExpertInfo(postId);\n\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error fetching post with expert info:\", error);\n      res.status(500).json({ message: \"Failed to fetch post\" });\n    }\n  });\n\n  // Post source management for expert content attribution\n  app.post(\"/api/posts/:id/source\", isAuthenticated, async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const sourceData = req.body;\n\n      const source = await storage.createPostSource({\n        postId,\n        ...sourceData,\n      });\n\n      res.json(source);\n    } catch (error) {\n      console.error(\"Error creating post source:\", error);\n      res.status(500).json({ message: \"Failed to create post source\" });\n    }\n  });\n\n  app.get(\"/api/posts/:id/source\", async (req, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const source = await storage.getPostSource(postId);\n\n      if (!source) {\n        return res.status(404).json({ message: \"Post source not found\" });\n      }\n\n      res.json(source);\n    } catch (error) {\n      console.error(\"Error fetching post source:\", error);\n      res.status(500).json({ message: \"Failed to fetch post source\" });\n    }\n  });\n\n  // Development route to update existing expert with professional links\n  app.post(\"/api/dev/update-expert\", async (req, res) => {\n    try {\n      // Update existing expert verification with professional links\n      const updatedExpert = await storage.updateExpertVerification(1, {\n        website: \"https://drchen-eldercare.com\",\n        linkedinUrl: \"https://linkedin.com/in/drsarahchen\",\n        blogUrl: \"https://drchen-eldercare.com/blog\",\n        booksUrl: \"https://amazon.com/author/drsarahchen\",\n        articlesUrl: \"https://drchen-eldercare.com/publications\",\n      });\n\n      res.json({\n        message: \"Expert professional links updated successfully\",\n        expert: updatedExpert,\n      });\n    } catch (error) {\n      console.error(\"Error updating expert:\", error);\n      res.status(500).json({ message: \"Failed to update expert\" });\n    }\n  });\n\n  // Development route to create comprehensive expert data with posts\n  app.post(\"/api/dev/seed-expert-complete\", async (req, res) => {\n    try {\n      // Create a sample user first\n      const sampleUser = await storage.upsertUser({\n        id: \"expert_001\",\n        email: \"dr.chen@example.com\",\n        firstName: \"Dr. Sarah\",\n        lastName: \"Chen\",\n        profileImageUrl: null,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      });\n\n      // Create expert verification with all professional links\n      const expertVerification = await storage.createExpertVerification({\n        userId: \"expert_001\",\n        profession: \"Geriatrician & Elder Care Specialist\",\n        expertiseArea:\n          \"dementia care, medication management, family support, aging in place\",\n        yearsExperience: 15,\n        credentials:\n          \"MD - Internal Medicine, Harvard Medical School\\nBoard Certified in Geriatric Medicine\\nFellow, American Geriatrics Society\\nCertified in Alzheimer's Disease and Related Disorders\",\n        bio: \"Dr. Sarah Chen is a board-certified geriatrician with over 15 years of experience helping families navigate the complexities of aging. She specializes in dementia care, medication management, and creating comprehensive care plans that honor both the patient's dignity and family's needs. Dr. Chen has published extensively on aging in place strategies and frequently speaks at caregiving conferences nationwide.\",\n        website: \"https://drchen-eldercare.com\",\n        linkedinUrl: \"https://linkedin.com/in/drsarahchen\",\n        blogUrl: \"https://drchen-eldercare.com/blog\",\n        booksUrl: \"https://amazon.com/author/drsarahchen\",\n        articlesUrl: \"https://drchen-eldercare.com/publications\",\n        verificationStatus: \"verified\",\n        verifiedAt: new Date(),\n        verifiedBy: \"admin\",\n        featuredExpert: true,\n      });\n\n      // Create multiple sample posts with different source attributions\n      const healthcareCategory = await storage.getCategoryBySlug(\"healthcare\");\n      const posts = [];\n\n      if (healthcareCategory) {\n        // Post 1: Blog-sourced content\n        const post1 = await storage.createPost({\n          title: \"5 Warning Signs Your Loved One May Need More Support\",\n          content:\n            \"As our loved ones age, it's crucial to recognize early warning signs that they may need additional support. Here are five key indicators that shouldn't be ignored: 1) Difficulty managing medications, 2) Unexplained weight loss or changes in appetite, 3) Increased confusion or memory lapses, 4) Poor personal hygiene or neglected household tasks, 5) Social withdrawal or mood changes. Early intervention can make a significant difference in maintaining quality of life and safety.\",\n          categoryId: healthcareCategory.id,\n          authorId: \"expert_001\",\n          isResolved: false,\n          helpfulVotes: 24,\n          commentCount: 8,\n        });\n\n        await storage.createPostSource({\n          postId: post1.id,\n          sourceType: \"blog\",\n          sourceTitle: \"Early Intervention Strategies for Aging Adults\",\n          sourceUrl: \"https://drchen-eldercare.com/blog/warning-signs-support\",\n          publisher: \"Elder Care Insights\",\n        });\n\n        // Post 2: LinkedIn-sourced content\n        const post2 = await storage.createPost({\n          title: \"Managing Medication Complexity in Elderly Patients\",\n          content:\n            \"Medication management becomes increasingly complex as we age, with many seniors taking multiple prescriptions. Here's how families can help: Create a comprehensive medication list, use pill organizers, establish routine timing, communicate with all healthcare providers, and never stop medications abruptly. Regular medication reviews with your geriatrician can prevent dangerous interactions and optimize treatment effectiveness.\",\n          categoryId: healthcareCategory.id,\n          authorId: \"expert_001\",\n          isResolved: false,\n          helpfulVotes: 18,\n          commentCount: 5,\n        });\n\n        await storage.createPostSource({\n          postId: post2.id,\n          sourceType: \"linkedin\",\n          sourceTitle: \"Medication Safety for Seniors\",\n          sourceUrl:\n            \"https://linkedin.com/in/drsarahchen/posts/medication-safety\",\n          publisher: \"LinkedIn Professional Post\",\n        });\n\n        // Post 3: Book excerpt\n        const post3 = await storage.createPost({\n          title: \"Creating a Dementia-Friendly Home Environment\",\n          content:\n            \"Environmental modifications can significantly improve quality of life for individuals with dementia. Key strategies include: reducing clutter and distractions, improving lighting throughout the home, using contrasting colors for important items, securing potentially dangerous areas, creating clear pathways, and maintaining familiar routines. These changes help reduce confusion and anxiety while promoting independence and safety.\",\n          categoryId: healthcareCategory.id,\n          authorId: \"expert_001\",\n          isResolved: false,\n          helpfulVotes: 32,\n          commentCount: 12,\n        });\n\n        await storage.createPostSource({\n          postId: post3.id,\n          sourceType: \"book\",\n          sourceTitle: \"Caring for Family: A Comprehensive Guide to Elder Care\",\n          sourceUrl: \"https://amazon.com/author/drsarahchen\",\n          publisher: \"Eldercare Publishing\",\n          isbn: \"978-0-123-45678-9\",\n        });\n\n        posts.push(post1, post2, post3);\n      }\n\n      res.json({\n        message: \"Complete expert data with posts created successfully\",\n        expert: expertVerification,\n        user: sampleUser,\n        posts: posts,\n      });\n    } catch (error) {\n      console.error(\"Error creating complete expert data:\", error);\n      res\n        .status(500)\n        .json({ message: \"Failed to create complete expert data\" });\n    }\n  });\n\n  // Consultation booking routes\n  app.post(\n    \"/api/consultations/create-payment\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const { expertId, duration, totalAmount } = req.body;\n\n        console.log(\"Creating consultation payment intent:\", {\n          expertId,\n          duration,\n          totalAmount,\n          userId: req.user?.id,\n        });\n\n        const result = await stripeService.createConsultationPaymentIntent({\n          expertId,\n          totalAmount,\n          duration,\n          clientId: req.user.id,\n        });\n\n        console.log(\n          \"Consultation payment intent created:\",\n          result.paymentIntentId,\n        );\n\n        res.json({\n          clientSecret: result.clientSecret,\n          applicationFeeAmount: result.applicationFeeAmount,\n        });\n      } catch (error: any) {\n        console.error(\"Consultation payment intent creation error:\", error);\n        res\n          .status(500)\n          .json({ message: \"Error creating payment intent: \" + error.message });\n      }\n    },\n  );\n\n  app.post(\n    \"/api/consultations/finalize\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const { expertId, scheduledAt, duration, notes } = req.body;\n        const clientId = req.user.id;\n\n        // For now, use a fixed rate of $100/hour\n        const rate = 10000; // $100/hour in cents\n        const totalAmount = Math.round((rate * duration) / 60);\n\n        // Verify expert exists\n        const expertUser = await storage.getUser(expertId);\n        if (!expertUser) {\n          return res.status(400).json({ message: \"Expert not found\" });\n        }\n\n        const consultation = await storage.createConsultation({\n          expertId,\n          clientId,\n          scheduledAt: new Date(scheduledAt),\n          duration,\n          rate,\n          totalAmount,\n          paymentStatus: \"paid\",\n          bookingStatus: \"scheduled\",\n          notes: notes || null,\n        });\n\n        res.json(consultation);\n      } catch (error) {\n        console.error(\"Error finalizing consultation booking:\", error);\n        res.status(500).json({ message: \"Failed to finalize booking\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/consultations/my-bookings\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.user.id;\n        const consultations = await storage.getUserConsultations(userId);\n        res.json(consultations);\n      } catch (error) {\n        console.error(\"Error fetching user consultations:\", error);\n        res.status(500).json({ message: \"Failed to fetch consultations\" });\n      }\n    },\n  );\n\n  // Search phrases API routes\n  app.get(\"/api/search-phrases\", async (req, res) => {\n    try {\n      // Cache search phrases aggressively since they change rarely\n      res.set({\n        'Cache-Control': 'public, max-age=1800', // 30 minutes cache\n        'ETag': '\"search-phrases-v1\"'\n      });\n      \n      const phrases = await storage.getSearchPhrases();\n      res.json(phrases);\n    } catch (error) {\n      console.error(\"Error fetching search phrases:\", error);\n      res.status(500).json({ message: \"Failed to fetch search phrases\" });\n    }\n  });\n\n  app.post(\"/api/search-phrases\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { phrase, orderIndex } = req.body;\n\n      if (!phrase) {\n        return res.status(400).json({ message: \"Phrase is required\" });\n      }\n\n      const newPhrase = await storage.createSearchPhrase({\n        phrase,\n        orderIndex: orderIndex || 0,\n        isActive: true,\n      });\n\n      res.json(newPhrase);\n    } catch (error) {\n      console.error(\"Error creating search phrase:\", error);\n      res.status(500).json({ message: \"Failed to create search phrase\" });\n    }\n  });\n\n  app.put(\"/api/search-phrases/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n\n      if (isNaN(id)) {\n        return res.status(400).json({ message: \"Invalid phrase ID\" });\n      }\n\n      const updatedPhrase = await storage.updateSearchPhrase(id, updates);\n      res.json(updatedPhrase);\n    } catch (error) {\n      console.error(\"Error updating search phrase:\", error);\n      res.status(500).json({ message: \"Failed to update search phrase\" });\n    }\n  });\n\n  app.delete(\n    \"/api/search-phrases/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const id = parseInt(req.params.id);\n\n        if (isNaN(id)) {\n          return res.status(400).json({ message: \"Invalid phrase ID\" });\n        }\n\n        await storage.deleteSearchPhrase(id);\n        res.json({ message: \"Search phrase deleted successfully\" });\n      } catch (error) {\n        console.error(\"Error deleting search phrase:\", error);\n        res.status(500).json({ message: \"Failed to delete search phrase\" });\n      }\n    },\n  );\n\n  // Password reset endpoint\n  app.post(\"/api/reset-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.json({\n          message:\n            \"If an account with that email exists, you will receive reset instructions.\",\n        });\n      }\n\n      const resetToken = randomBytes(32).toString(\"hex\");\n      console.log(\n        `Password reset requested for ${email}. Reset token: ${resetToken}`,\n      );\n\n      res.json({\n        message:\n          \"If an account with that email exists, you will receive reset instructions.\",\n      });\n    } catch (error) {\n      console.error(\"Password reset error:\", error);\n      res\n        .status(500)\n        .json({ message: \"Failed to process password reset request\" });\n    }\n  });\n\n  // Expert detail endpoint for booking\n  app.get(\"/api/experts/:expertId\", async (req, res) => {\n    try {\n      // Force fresh data - no caching for approval-sensitive data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const { expertId } = req.params;\n\n      // Get expert verification with user details\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert) {\n        return res.status(404).json({ message: \"Expert not found\" });\n      }\n\n      const user = await storage.getUser(expertId);\n      if (!user) {\n        return res.status(404).json({ message: \"Expert user not found\" });\n      }\n\n      // Return properly structured expert data for booking page\n      const expertData = {\n        id: user.id,\n        username: user.username,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profileImageUrl: user.profileImageUrl || expert.profileImageUrl,\n        bio:\n          expert.bio ||\n          \"Experienced healthcare professional specializing in elder care and family support.\",\n        expertise: expert.expertiseArea\n          ? [expert.expertiseArea]\n          : [\"Elder Care\", \"Family Support\"],\n        hourlyRate: (expert.hourlyRate || 10000) / 100, // Convert cents to dollars\n        stripeConnectAccountId: expert.stripeConnectAccountId,\n        consultationEnabled: Boolean(expert.consultationEnabled),\n        // Include verification and approval status for badge logic\n        role: user.role,\n        approved: user.approved,\n        verificationStatus: expert.verificationStatus,\n        profession: expert.profession,\n        company: expert.company,\n        expertiseArea: expert.expertiseArea,\n        credentials: expert.credentials,\n        linkedinUrl: expert.linkedinUrl,\n        verifiedAt: expert.verifiedAt,\n        // Appointment booking fields\n        allowBooking: expert.allowBooking || false,\n        calendlyLink: expert.calendlyLink,\n      };\n\n      res.json(expertData);\n    } catch (error: any) {\n      res\n        .status(500)\n        .json({ message: \"Error fetching expert details: \" + error.message });\n    }\n  });\n\n  // Expert availability management routes\n  app.get(\n    \"/api/experts/my-availability\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const availability = await storage.getExpertAvailability(expertId);\n        res.json(availability);\n      } catch (error: any) {\n        res\n          .status(500)\n          .json({ message: \"Error fetching availability: \" + error.message });\n      }\n    },\n  );\n\n  app.post(\n    \"/api/experts/availability\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { dayOfWeek, startTime, endTime, timezone } = req.body;\n\n        // Validate expert\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can set availability\" });\n        }\n\n        // Create availability\n        const availability = await storage.createExpertAvailability({\n          expertId,\n          dayOfWeek,\n          startTime,\n          endTime,\n          timezone: timezone || \"UTC\",\n          isRecurring: true,\n        });\n\n        res.json(availability);\n      } catch (error: any) {\n        res\n          .status(500)\n          .json({ message: \"Error creating availability: \" + error.message });\n      }\n    },\n  );\n\n  app.delete(\n    \"/api/experts/availability/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const availabilityId = parseInt(req.params.id);\n\n        // Verify ownership\n        const availability = await storage.getExpertAvailability(expertId);\n        const slot = availability.find((a: any) => a.id === availabilityId);\n\n        if (!slot) {\n          return res\n            .status(404)\n            .json({ message: \"Availability slot not found\" });\n        }\n\n        await storage.deleteExpertAvailability(availabilityId);\n        res.json({ message: \"Availability deleted successfully\" });\n      } catch (error: any) {\n        res\n          .status(500)\n          .json({ message: \"Error deleting availability: \" + error.message });\n      }\n    },\n  );\n\n  // Appointment booking routes with Stripe Connect\n  app.get(\"/api/experts/:expertId/availability\", async (req, res) => {\n    try {\n      const { expertId } = req.params;\n      const availability = await storage.getExpertAvailability(expertId);\n      res.json(availability);\n    } catch (error: any) {\n      res\n        .status(500)\n        .json({ message: \"Error fetching availability: \" + error.message });\n    }\n  });\n\n  app.get(\"/api/experts/:expertId/available-slots/:date\", async (req, res) => {\n    try {\n      const { expertId, date } = req.params;\n      const clientTimezone = (req.query.timezone as string) || \"UTC\";\n\n      // Use timezone-aware method if timezone is provided\n      if (clientTimezone && clientTimezone !== \"UTC\") {\n        const slots = await storage.getAvailableTimeSlotsWithTimezone(\n          expertId,\n          date,\n          clientTimezone,\n        );\n        res.json({ slots, timezone: clientTimezone });\n      } else {\n        // Fallback to original method\n        const slots = await storage.getAvailableTimeSlots(expertId, date);\n        res.json({ slots });\n      }\n    } catch (error: any) {\n      res\n        .status(500)\n        .json({ message: \"Error fetching available slots: \" + error.message });\n    }\n  });\n\n  // Get available timezones\n  app.get(\"/api/timezones\", (req, res) => {\n    try {\n      const timezones = TimezoneService.getCommonTimezones();\n      res.json({ timezones });\n    } catch (error: any) {\n      res\n        .status(500)\n        .json({ message: \"Error fetching timezones: \" + error.message });\n    }\n  });\n\n  // Google Calendar Integration for Experts\n  app.get(\n    \"/api/experts/calendar/connect\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n\n        // Check if user is a verified expert\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can connect calendar\" });\n        }\n\n        const authUrl = googleCalendarService.getAuthUrl(expertId);\n        res.json({ authUrl });\n      } catch (error: any) {\n        console.error(\"Error generating calendar auth URL:\", error);\n        res\n          .status(500)\n          .json({ message: \"Error connecting calendar: \" + error.message });\n      }\n    },\n  );\n\n  // Google Calendar callback\n  app.get(\"/api/auth/google/callback\", async (req, res) => {\n    try {\n      const { code, state: expertId } = req.query;\n\n      if (!code || !expertId) {\n        return res.redirect(\"/expert-dashboard?error=missing-params\");\n      }\n\n      // Exchange code for tokens\n      const tokens = await googleCalendarService.getTokens(code as string);\n\n      // Store tokens securely (you might want to encrypt these)\n      await storage.updateExpertCalendarTokens(expertId as string, tokens);\n\n      res.redirect(\"/expert-dashboard?calendar=connected\");\n    } catch (error: any) {\n      console.error(\"Error in Google callback:\", error);\n      res.redirect(\"/expert-dashboard?error=calendar-connection-failed\");\n    }\n  });\n\n  // Get expert's calendar availability\n  app.get(\"/api/experts/:expertId/calendar-availability\", async (req, res) => {\n    try {\n      const { expertId } = req.params;\n      const { date } = req.query;\n\n      if (!date) {\n        return res.status(400).json({ message: \"Date parameter required\" });\n      }\n\n      // Get expert's calendar tokens\n      const expert = await storage.getExpertWithCalendarTokens(expertId);\n\n      if (!expert || !expert.googleCalendarTokens) {\n        // Return default availability if calendar not connected\n        const slots = await storage.getAvailableTimeSlots(\n          expertId,\n          date as string,\n        );\n        return res.json({ slots, source: \"manual\" });\n      }\n\n      // Get busy times from Google Calendar\n      const startDate = new Date(date as string);\n      const endDate = new Date(startDate);\n      endDate.setDate(endDate.getDate() + 1);\n\n      const busyTimes = await googleCalendarService.getBusyTimes(\n        expert.googleCalendarTokens,\n        startDate,\n        endDate,\n      );\n\n      // Generate available slots excluding busy times\n      const availableSlots = generateAvailableSlotsExcludingBusy(\n        busyTimes,\n        startDate,\n      );\n\n      res.json({ slots: availableSlots, source: \"google-calendar\" });\n    } catch (error: any) {\n      console.error(\"Error fetching calendar availability:\", error);\n      res\n        .status(500)\n        .json({ message: \"Error fetching availability: \" + error.message });\n    }\n  });\n\n  // Create Stripe Connect Express Account for expert\n  app.post(\n    \"/api/experts/create-connect-account\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { refreshUrl, returnUrl } = req.body;\n\n        const result = await stripeService.createConnectAccount(\n          expertId,\n          req.user.email,\n          refreshUrl,\n          returnUrl,\n        );\n\n        res.json(result);\n      } catch (error: any) {\n        console.error(\"Error creating Connect account:\", error);\n        res\n          .status(500)\n          .json({\n            message: \"Error creating Connect account: \" + error.message,\n          });\n      }\n    },\n  );\n\n  // Get Stripe Connect account status\n  app.get(\n    \"/api/experts/connect-status\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const expert = await storage.getExpertVerification(expertId);\n\n        if (!expert || !expert.stripeConnectAccountId) {\n          return res.json({\n            connected: false,\n            accountId: null,\n            requiresAction: true,\n          });\n        }\n\n        const status = await stripeService.getConnectAccountStatus(\n          expert.stripeConnectAccountId,\n        );\n\n        res.json({\n          connected: status.chargesEnabled && status.payoutsEnabled,\n          accountId: expert.stripeConnectAccountId,\n          requiresAction:\n            !status.detailsSubmitted || status.requirements.length > 0,\n          ...status,\n        });\n      } catch (error: any) {\n        console.error(\"Error getting Connect status:\", error);\n        res\n          .status(500)\n          .json({ message: \"Error getting Connect status: \" + error.message });\n      }\n    },\n  );\n\n  // Get expert earnings and payout info\n  app.get(\"/api/experts/earnings\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n      const payoutInfo = await stripeService.getExpertPayoutInfo(expertId);\n      res.json(payoutInfo);\n    } catch (error: any) {\n      console.error(\"Error getting expert earnings:\", error);\n      res\n        .status(500)\n        .json({ message: \"Error getting earnings: \" + error.message });\n    }\n  });\n\n  // Create instant payout\n  app.post(\"/api/experts/payout\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n      const { amount } = req.body; // amount in cents\n\n      if (!amount || amount <= 0) {\n        return res.status(400).json({ message: \"Valid amount is required\" });\n      }\n\n      const payout = await stripeService.createInstantPayout(expertId, amount);\n      res.json({\n        success: true,\n        payoutId: payout.id,\n        amount: payout.amount,\n        arrivalDate: new Date(payout.arrival_date * 1000),\n      });\n    } catch (error: any) {\n      console.error(\"Error creating payout:\", error);\n      res\n        .status(500)\n        .json({ message: \"Error creating payout: \" + error.message });\n    }\n  });\n\n  // Get Stripe Connect dashboard link\n  app.get(\n    \"/api/experts/dashboard-link\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const dashboardUrl =\n          await stripeService.getConnectDashboardLink(expertId);\n        res.json({ url: dashboardUrl });\n      } catch (error: any) {\n        console.error(\"Error creating dashboard link:\", error);\n        res\n          .status(500)\n          .json({ message: \"Error creating dashboard link: \" + error.message });\n      }\n    },\n  );\n\n  // Create appointment booking with Stripe Connect payment\n  app.post(\"/api/appointments/book\", async (req, res) => {\n    try {\n      const {\n        expertId,\n        clientName,\n        clientEmail,\n        scheduledAt,\n        scheduledAtTimezone,\n        duration,\n        notes,\n        totalAmount,\n      } = req.body;\n\n      // Validate required fields\n      if (\n        !expertId ||\n        !clientName ||\n        !clientEmail ||\n        !scheduledAt ||\n        !duration ||\n        !totalAmount\n      ) {\n        return res\n          .status(400)\n          .json({ message: \"Missing required booking information\" });\n      }\n\n      // Check expert availability\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || expert.verificationStatus !== \"verified\") {\n        return res\n          .status(400)\n          .json({ message: \"Expert not found or not verified\" });\n      }\n\n      if (!expert.stripeConnectAccountId) {\n        return res.status(400).json({\n          message: \"Expert must set up payment processing first\",\n        });\n      }\n\n      // Create appointment record first\n      const platformFee = Math.round(totalAmount * 0.1);\n      const expertEarnings = totalAmount - platformFee;\n\n      // Use timezone-aware creation if timezone is provided\n      const appointment = scheduledAtTimezone\n        ? await storage.createAppointmentWithTimezone({\n            expertId,\n            clientId: req.user?.id || null,\n            clientName,\n            clientEmail,\n            scheduledAtUtc: scheduledAt,\n            scheduledAtTimezone,\n            duration,\n            notes: notes || null,\n            status: \"pending\",\n            totalAmount,\n            platformFee,\n            expertEarnings,\n            stripePaymentIntentId: null,\n            stripeConnectAccountId: expert.stripeConnectAccountId,\n          })\n        : await storage.createAppointment({\n            expertId,\n            clientId: req.user?.id || null,\n            clientName,\n            clientEmail,\n            scheduledAt: new Date(scheduledAt),\n            duration,\n            notes: notes || null,\n            status: \"pending\",\n            totalAmount,\n            platformFee,\n            expertEarnings,\n            stripePaymentIntentId: null,\n            stripeConnectAccountId: expert.stripeConnectAccountId,\n          });\n\n      // Create payment intent using the service\n      const paymentResult = await stripeService.createAppointmentPaymentIntent({\n        expertId,\n        totalAmount,\n        duration,\n        clientEmail,\n        appointmentId: appointment.id,\n      });\n\n      // Update appointment with payment intent ID\n      await storage.updateAppointment(appointment.id, {\n        stripePaymentIntentId: paymentResult.paymentIntentId,\n      });\n\n      res.json({\n        clientSecret: paymentResult.clientSecret,\n        appointmentId: appointment.id,\n        platformFee: paymentResult.applicationFeeAmount,\n      });\n    } catch (error: any) {\n      console.error(\"Error creating appointment:\", error);\n      res\n        .status(500)\n        .json({ message: \"Error creating appointment: \" + error.message });\n    }\n  });\n\n  // Update appointment status after payment\n  app.post(\"/api/appointments/:id/confirm\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const appointmentId = parseInt(id);\n\n      // Get the appointment details\n      const appointment = await storage.getAppointmentById(appointmentId);\n\n      if (!appointment) {\n        return res.status(404).json({ message: \"Appointment not found\" });\n      }\n\n      // Update appointment status\n      const confirmedAppointment = await storage.updateAppointmentStatus(\n        appointmentId,\n        \"confirmed\",\n      );\n\n      let meetingLink = `https://meet.google.com/new`;\n      let calendarEventId = null;\n\n      // Try to create calendar event if expert has Google Calendar connected\n      try {\n        const calendarResult = await calendarService.createAppointmentEvent(\n          appointment.expertId,\n          {\n            id: appointment.id,\n            clientName: appointment.clientName,\n            clientEmail: appointment.clientEmail,\n            scheduledAt: appointment.scheduledAt,\n            duration: appointment.duration,\n            notes: appointment.notes || undefined,\n          },\n        );\n\n        if (calendarResult.meetingLink) {\n          meetingLink = calendarResult.meetingLink;\n        }\n        calendarEventId = calendarResult.eventId;\n      } catch (calendarError) {\n        console.warn(\"Failed to create calendar event:\", calendarError);\n        // Continue without calendar integration\n      }\n\n      res.json({\n        appointment: confirmedAppointment,\n        meetingLink,\n        calendarEventId,\n      });\n    } catch (error: any) {\n      res\n        .status(500)\n        .json({ message: \"Error confirming appointment: \" + error.message });\n    }\n  });\n\n  // Get expert's appointments\n  app.get(\n    \"/api/experts/:expertId/appointments\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const { expertId } = req.params;\n\n        // Verify the requesting user is the expert\n        if (req.user.id !== expertId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n\n        const appointments = await storage.getExpertAppointments(expertId);\n        res.json(appointments);\n      } catch (error: any) {\n        res\n          .status(500)\n          .json({ message: \"Error fetching appointments: \" + error.message });\n      }\n    },\n  );\n\n  // Get client's appointments\n  app.get(\n    \"/api/clients/:clientId/appointments\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const { clientId } = req.params;\n\n        // Verify the requesting user is the client\n        if (req.user.id !== clientId) {\n          return res.status(403).json({ message: \"Access denied\" });\n        }\n\n        const appointments = await storage.getClientAppointments(clientId);\n        res.json(appointments);\n      } catch (error: any) {\n        res\n          .status(500)\n          .json({ message: \"Error fetching appointments: \" + error.message });\n      }\n    },\n  );\n\n  // VOTING SYSTEM ROUTES\n\n  // Vote on posts\n  app.post(\"/api/posts/:id/vote\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const postId = parseInt(req.params.id);\n      const { voteType } = req.body; // 'up' or 'down'\n\n      if (![\"up\", \"down\"].includes(voteType)) {\n        return res.status(400).json({ message: \"Invalid vote type\" });\n      }\n\n      // Check if user already voted\n      const existingVote = await storage.getUserVote(userId, postId, \"post\");\n\n      if (existingVote) {\n        if (existingVote.voteType === voteType) {\n          // Remove vote if same type (toggle off)\n          await storage.deleteVote(existingVote.id);\n          await storage.updatePostVoteCount(postId, voteType === \"up\" ? -1 : 1);\n        } else {\n          // Change vote type\n          await storage.updateVote(existingVote.id, voteType);\n          await storage.updatePostVoteCount(postId, voteType === \"up\" ? 2 : -2);\n        }\n      } else {\n        // Create new vote\n        await storage.createVote({\n          userId,\n          postId,\n          voteType,\n        });\n        await storage.updatePostVoteCount(postId, voteType === \"up\" ? 1 : -1);\n      }\n\n      // Check for achievements after voting\n      const post = await storage.getPost(postId);\n      if (post && voteType === \"up\") {\n        await storage.checkAndAwardAchievements(post.author.id);\n      }\n\n      const updatedPost = await storage.getPost(postId);\n      res.json(updatedPost);\n    } catch (error) {\n      console.error(\"Error voting on post:\", error);\n      res.status(500).json({ message: \"Failed to vote\" });\n    }\n  });\n\n  // Vote on comments\n  app.post(\"/api/comments/:id/vote\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const commentId = parseInt(req.params.id);\n      const { voteType } = req.body; // 'up' or 'down'\n\n      if (![\"up\", \"down\"].includes(voteType)) {\n        return res.status(400).json({ message: \"Invalid vote type\" });\n      }\n\n      // Check if user already voted\n      const existingVote = await storage.getUserVote(\n        userId,\n        commentId,\n        \"comment\",\n      );\n\n      if (existingVote) {\n        if (existingVote.voteType === voteType) {\n          // Remove vote if same type (toggle off)\n          await storage.deleteVote(existingVote.id);\n          await storage.updateCommentVoteCount(\n            commentId,\n            voteType === \"up\" ? -1 : 1,\n          );\n        } else {\n          // Change vote type\n          await storage.updateVote(existingVote.id, voteType);\n          await storage.updateCommentVoteCount(\n            commentId,\n            voteType === \"up\" ? 2 : -2,\n          );\n        }\n      } else {\n        // Create new vote\n        await storage.createVote({\n          userId,\n          commentId,\n          voteType,\n        });\n        await storage.updateCommentVoteCount(\n          commentId,\n          voteType === \"up\" ? 1 : -1,\n        );\n      }\n\n      // Check for achievements after voting\n      const comment = await storage.getComment(commentId);\n      if (comment && voteType === \"up\") {\n        await storage.checkAndAwardAchievements(comment.author.id);\n      }\n\n      const updatedComment = await storage.getComment(commentId);\n      res.json(updatedComment);\n    } catch (error) {\n      console.error(\"Error voting on comment:\", error);\n      res.status(500).json({ message: \"Failed to vote\" });\n    }\n  });\n\n  // Get user's vote on content\n  app.get(\"/api/posts/:id/vote\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const postId = parseInt(req.params.id);\n\n      const vote = await storage.getUserVote(userId, postId, \"post\");\n      res.json({ voteType: vote?.voteType || null });\n    } catch (error) {\n      console.error(\"Error fetching user vote:\", error);\n      res.status(500).json({ message: \"Failed to fetch vote\" });\n    }\n  });\n\n  // ACHIEVEMENT SYSTEM ROUTES\n\n  // Check and award achievements for user\n  app.post(\n    \"/api/users/:id/check-achievements\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const userId = req.params.id;\n        if (req.user.id !== userId && req.user.role !== \"admin\") {\n          return res.status(403).json({ message: \"Unauthorized\" });\n        }\n\n        const newAchievements = await storage.checkAndAwardAchievements(userId);\n        res.json({ newAchievements });\n      } catch (error) {\n        console.error(\"Error checking achievements:\", error);\n        res.status(500).json({ message: \"Failed to check achievements\" });\n      }\n    },\n  );\n\n  // Get all achievements\n  app.get(\"/api/achievements\", async (req, res) => {\n    try {\n      const achievements = await storage.getAchievements();\n      res.json(achievements);\n    } catch (error) {\n      console.error(\"Error fetching achievements:\", error);\n      res.status(500).json({ message: \"Failed to fetch achievements\" });\n    }\n  });\n\n  // Get user achievements\n  app.get(\"/api/users/:id/achievements\", async (req, res) => {\n    try {\n      const achievements = await storage.getUserAchievements(req.params.id);\n      res.json(achievements);\n    } catch (error) {\n      console.error(\"Error fetching user achievements:\", error);\n      res.status(500).json({ message: \"Failed to fetch achievements\" });\n    }\n  });\n\n  // USER PROFILE ROUTES\n\n  // Get user profile with stats\n  app.get(\"/api/users/:id/profile\", async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const user = await storage.getUser(userId);\n\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const stats = await storage.getUserStats(userId);\n      const achievements = await storage.getUserAchievements(userId);\n\n      res.json({\n        ...user,\n        stats,\n        achievements,\n      });\n    } catch (error) {\n      console.error(\"Error fetching user profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  // Update user profile\n  app.put(\"/api/users/:id/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.params.id;\n      if (req.user.id !== userId && req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n\n      const allowedUpdates = [\n        \"firstName\",\n        \"lastName\",\n        \"communityName\",\n        \"introduction\",\n        \"city\",\n        \"state\",\n        \"profileImageUrl\",\n        \"defaultProfileType\",\n      ];\n\n      const updates = Object.keys(req.body)\n        .filter((key) => allowedUpdates.includes(key))\n        .reduce((obj, key) => {\n          obj[key] = req.body[key];\n          return obj;\n        }, {});\n\n      const updatedUser = await storage.updateUser(userId, updates);\n      res.json(updatedUser);\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Get user activity feed\n  app.get(\"/api/users/:id/activity\", async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const offset = parseInt(req.query.offset as string) || 0;\n\n      const activity = await storage.getUserActivity(userId, limit, offset);\n      res.json(activity);\n    } catch (error) {\n      console.error(\"Error fetching user activity:\", error);\n      res.status(500).json({ message: \"Failed to fetch user activity\" });\n    }\n  });\n\n  // SEARCH ROUTES\n\n  // Enhanced forum search\n  app.get(\"/api/forums/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      if (!query || query.trim().length < 2) {\n        return res\n          .status(400)\n          .json({ message: \"Search query must be at least 2 characters\" });\n      }\n\n      const results = await storage.searchForums(query.trim());\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error searching forums:\", error);\n      res.status(500).json({ message: \"Failed to search forums\" });\n    }\n  });\n\n  // Search posts\n  app.get(\"/api/posts/search\", async (req, res) => {\n    try {\n      const query = req.query.q as string;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const offset = parseInt(req.query.offset as string) || 0;\n\n      if (!query || query.trim().length < 2) {\n        return res\n          .status(400)\n          .json({ message: \"Search query must be at least 2 characters\" });\n      }\n\n      const results = await storage.searchPosts(query.trim(), limit, offset);\n      res.json(results);\n    } catch (error) {\n      console.error(\"Error searching posts:\", error);\n      res.status(500).json({ message: \"Failed to search posts\" });\n    }\n  });\n\n  // ENHANCED POST ROUTES\n\n  // Get posts with enhanced data including vote info\n  app.get(\"/api/posts/enhanced\", isAuthenticated, async (req: any, res) => {\n    try {\n      const categoryId = req.query.categoryId\n        ? parseInt(req.query.categoryId as string)\n        : undefined;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const offset = parseInt(req.query.offset as string) || 0;\n      const userId = req.user?.id;\n\n      let posts = await storage.getPosts(categoryId, limit, offset);\n\n      // Add user vote information if authenticated\n      if (userId) {\n        posts = await Promise.all(\n          posts.map(async (post) => {\n            const userVote = await storage.getUserVote(userId, post.id, \"post\");\n            return {\n              ...post,\n              userVote: userVote?.voteType || null,\n            };\n          }),\n        );\n      }\n\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching enhanced posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  // ADMIN ROUTES (if user has admin role)\n\n  // Get community stats\n  app.get(\"/api/admin/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const stats = await storage.getCommunityStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching admin stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Get moderation queue\n  app.get(\"/api/admin/moderation\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\" && req.user.role !== \"moderator\") {\n        return res.status(403).json({ message: \"Moderator access required\" });\n      }\n\n      const queue = await storage.getModerationQueue();\n      res.json(queue);\n    } catch (error) {\n      console.error(\"Error fetching moderation queue:\", error);\n      res.status(500).json({ message: \"Failed to fetch moderation queue\" });\n    }\n  });\n\n  // Update moderation status\n  app.put(\n    \"/api/admin/moderation/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        if (req.user.role !== \"admin\" && req.user.role !== \"moderator\") {\n          return res.status(403).json({ message: \"Moderator access required\" });\n        }\n\n        const { status, reason } = req.body;\n        await storage.updateModerationStatus(\n          parseInt(req.params.id),\n          status,\n          req.user.id,\n        );\n\n        res.json({ success: true });\n      } catch (error) {\n        console.error(\"Error updating moderation status:\", error);\n        res.status(500).json({ message: \"Failed to update moderation status\" });\n      }\n    },\n  );\n\n  // User approval endpoints for admins\n  // Get unapproved experts\n  app.get(\"/api/admin/unapproved-experts\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const unapprovedExperts = await storage.getUnapprovedExperts();\n      res.json(unapprovedExperts);\n    } catch (error) {\n      console.error(\"Error fetching unapproved experts:\", error);\n      res.status(500).json({ message: \"Failed to fetch unapproved experts\" });\n    }\n  });\n\n  // Approve a user (expert)\n  app.post(\"/api/admin/approve-user/:userId\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { userId } = req.params;\n      const approvedUser = await storage.approveUser(userId);\n      \n      // Invalidate caches to ensure real-time updates\n      try {\n        const { invalidateCache, InvalidationPatterns } = await import(\"./cache\");\n        await invalidateCache([\n          InvalidationPatterns.experts,\n          ...InvalidationPatterns.user(userId),\n          'experts:*',\n          'posts:*',  // Add posts cache invalidation for expert badges in posts\n          'admin:*'\n        ]);\n      } catch (cacheError) {\n        console.log(\"Cache invalidation failed (non-critical):\", cacheError.message);\n        // Continue even if cache fails - database will have fresh data\n      }\n      \n      res.json({ \n        success: true, \n        message: \"User approved successfully\",\n        user: approvedUser \n      });\n    } catch (error) {\n      console.error(\"Error approving user:\", error);\n      res.status(500).json({ message: \"Failed to approve user\" });\n    }\n  });\n\n\n  // STRIPE WEBHOOK ENDPOINT\n  app.post(\"/api/stripe/webhook\", async (req, res) => {\n    const signature = req.headers[\"stripe-signature\"] as string;\n\n    try {\n      // Stripe webhooks need raw body, so we handle it specially\n      const payload = req.body;\n      const event = stripeService.verifyWebhookSignature(payload, signature);\n\n      await stripeService.handleWebhookEvent(event);\n\n      res.json({ received: true });\n    } catch (error: any) {\n      console.error(\"Webhook error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Appointment cancellation and refund\n  app.post(\n    \"/api/appointments/:id/cancel\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const appointmentId = parseInt(req.params.id);\n        const { reason } = req.body;\n\n        const appointment = await storage.getAppointmentById(appointmentId);\n        if (!appointment) {\n          return res.status(404).json({ message: \"Appointment not found\" });\n        }\n\n        // Check if user can cancel (expert or client)\n        const userId = req.user.id;\n        if (\n          appointment.expertId !== userId &&\n          appointment.clientId !== userId\n        ) {\n          return res\n            .status(403)\n            .json({ message: \"Not authorized to cancel this appointment\" });\n        }\n\n        // Process refund if payment was made\n        if (\n          appointment.stripePaymentIntentId &&\n          appointment.status === \"confirmed\"\n        ) {\n          try {\n            await stripeService.refundAppointment(\n              appointment.stripePaymentIntentId,\n              undefined, // Full refund\n              reason,\n            );\n          } catch (refundError) {\n            console.error(\"Refund failed:\", refundError);\n            // Continue with cancellation even if refund fails\n          }\n        }\n\n        // Cancel calendar event if exists\n        if (appointment.expertId === userId) {\n          try {\n            // We'd need to store the calendar event ID to delete it\n            // For now, just log that we should cancel the calendar event\n            console.log(\n              `Should cancel calendar event for appointment ${appointmentId}`,\n            );\n          } catch (calendarError) {\n            console.warn(\"Failed to cancel calendar event:\", calendarError);\n          }\n        }\n\n        // Update appointment status\n        const cancelledAppointment = await storage.updateAppointment(\n          appointmentId,\n          {\n            status: \"cancelled\",\n            cancelledAt: new Date(),\n            cancelReason: reason || \"No reason provided\",\n          },\n        );\n\n        res.json({\n          success: true,\n          appointment: cancelledAppointment,\n        });\n      } catch (error: any) {\n        console.error(\"Error cancelling appointment:\", error);\n        res\n          .status(500)\n          .json({ message: \"Error cancelling appointment: \" + error.message });\n      }\n    },\n  );\n\n  // GOOGLE CALENDAR INTEGRATION ROUTES\n\n  // Initiate Google Calendar OAuth\n  app.get(\n    \"/api/calendar/oauth/init\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n\n        // Check if user is an expert\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can connect calendars\" });\n        }\n\n        const authUrl = calendarService.generateAuthUrl(expertId);\n        res.json({ authUrl });\n      } catch (error: any) {\n        console.error(\"Error initiating calendar OAuth:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to initiate calendar connection\" });\n      }\n    },\n  );\n\n  // Handle Google Calendar OAuth callback\n  app.get(\"/api/calendar/oauth/callback\", async (req, res) => {\n    try {\n      const { code, state } = req.query;\n\n      if (!code || !state) {\n        return res\n          .status(400)\n          .json({ message: \"Missing authorization code or state\" });\n      }\n\n      const expertId = state as string;\n      const integration = await calendarService.exchangeCodeForTokens(\n        code as string,\n        expertId,\n      );\n\n      // Redirect to success page\n      res.redirect(\n        `${process.env.CLIENT_URL || \"http://localhost:5173\"}/expert/calendar/success`,\n      );\n    } catch (error: any) {\n      console.error(\"Error handling calendar OAuth callback:\", error);\n      res.redirect(\n        `${process.env.CLIENT_URL || \"http://localhost:5173\"}/expert/calendar/error`,\n      );\n    }\n  });\n\n  // Get calendar integration status\n  app.get(\"/api/calendar/status\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n      const integration = await storage.getCalendarIntegration(expertId);\n\n      res.json({\n        connected: !!integration?.isActive,\n        calendarName: integration?.calendarName,\n        lastSync: integration?.lastSyncAt,\n        errors: integration?.syncErrors,\n      });\n    } catch (error: any) {\n      console.error(\"Error getting calendar status:\", error);\n      res.status(500).json({ message: \"Failed to get calendar status\" });\n    }\n  });\n\n  // Disconnect calendar\n  app.delete(\n    \"/api/calendar/disconnect\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        await calendarService.disconnectCalendar(expertId);\n        res.json({ message: \"Calendar disconnected successfully\" });\n      } catch (error: any) {\n        console.error(\"Error disconnecting calendar:\", error);\n        res.status(500).json({ message: \"Failed to disconnect calendar\" });\n      }\n    },\n  );\n\n  // Sync calendar availability\n  app.post(\"/api/calendar/sync\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n      await calendarService.syncAvailability(expertId);\n      res.json({ message: \"Calendar sync completed successfully\" });\n    } catch (error: any) {\n      console.error(\"Error syncing calendar:\", error);\n      res.status(500).json({ message: \"Failed to sync calendar\" });\n    }\n  });\n\n  // Create blocked time slot\n  app.post(\n    \"/api/calendar/blocked-slots\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { startDateTime, endDateTime, reason, isAllDay } = req.body;\n\n        if (!startDateTime || !endDateTime) {\n          return res\n            .status(400)\n            .json({ message: \"Start and end times are required\" });\n        }\n\n        const blockedSlot = await storage.createBlockedTimeSlot({\n          expertId,\n          startDateTime: new Date(startDateTime),\n          endDateTime: new Date(endDateTime),\n          reason: reason || \"Blocked time\",\n          isAllDay: isAllDay || false,\n          isRecurring: false,\n        });\n\n        res.json(blockedSlot);\n      } catch (error: any) {\n        console.error(\"Error creating blocked time slot:\", error);\n        res.status(500).json({ message: \"Failed to create blocked time slot\" });\n      }\n    },\n  );\n\n  // Get blocked time slots\n  app.get(\n    \"/api/calendar/blocked-slots\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { startDate, endDate } = req.query;\n\n        if (!startDate || !endDate) {\n          return res\n            .status(400)\n            .json({ message: \"Start and end dates are required\" });\n        }\n\n        const blockedSlots = await storage.getBlockedTimeSlots(\n          expertId,\n          new Date(startDate as string),\n          new Date(endDate as string),\n        );\n\n        res.json(blockedSlots);\n      } catch (error: any) {\n        console.error(\"Error getting blocked time slots:\", error);\n        res.status(500).json({ message: \"Failed to get blocked time slots\" });\n      }\n    },\n  );\n\n  // Delete blocked time slot\n  app.delete(\n    \"/api/calendar/blocked-slots/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const slotId = parseInt(req.params.id);\n        await storage.deleteBlockedTimeSlot(slotId);\n        res.json({ message: \"Blocked time slot deleted successfully\" });\n      } catch (error: any) {\n        console.error(\"Error deleting blocked time slot:\", error);\n        res.status(500).json({ message: \"Failed to delete blocked time slot\" });\n      }\n    },\n  );\n\n  // EXPERT AVAILABILITY MANAGEMENT ROUTES\n\n  // Set expert availability\n  app.post(\n    \"/api/experts/availability\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { dayOfWeek, startTime, endTime, timezone } = req.body;\n\n        // Validate expert status\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can set availability\" });\n        }\n\n        // Validate required fields\n        if (dayOfWeek === undefined || !startTime || !endTime) {\n          return res\n            .status(400)\n            .json({\n              message: \"Day of week, start time, and end time are required\",\n            });\n        }\n\n        // Create availability slot\n        const availability = await storage.createExpertAvailability({\n          expertId,\n          dayOfWeek,\n          startTime,\n          endTime,\n          timezone: timezone || \"America/New_York\",\n          isActive: true,\n        });\n\n        res.json(availability);\n      } catch (error: any) {\n        console.error(\"Error setting expert availability:\", error);\n        res.status(500).json({ message: \"Failed to set availability\" });\n      }\n    },\n  );\n\n  // Get expert availability\n  app.get(\n    \"/api/experts/availability\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const availability = await storage.getExpertAvailability(expertId);\n        res.json(availability);\n      } catch (error: any) {\n        console.error(\"Error getting expert availability:\", error);\n        res.status(500).json({ message: \"Failed to get availability\" });\n      }\n    },\n  );\n\n  // Update expert availability\n  app.put(\n    \"/api/experts/availability/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const availabilityId = parseInt(req.params.id);\n        const { dayOfWeek, startTime, endTime, timezone, isActive } = req.body;\n\n        // Verify the availability belongs to the expert\n        const existing = await storage.getExpertAvailability(expertId);\n        const targetAvailability = existing.find(\n          (a) => a.id === availabilityId,\n        );\n\n        if (!targetAvailability) {\n          return res\n            .status(404)\n            .json({ message: \"Availability slot not found\" });\n        }\n\n        const updated = await storage.updateExpertAvailability(availabilityId, {\n          dayOfWeek,\n          startTime,\n          endTime,\n          timezone,\n          isActive,\n        });\n\n        res.json(updated);\n      } catch (error: any) {\n        console.error(\"Error updating expert availability:\", error);\n        res.status(500).json({ message: \"Failed to update availability\" });\n      }\n    },\n  );\n\n  // Delete expert availability\n  app.delete(\n    \"/api/experts/availability/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const availabilityId = parseInt(req.params.id);\n\n        // Verify the availability belongs to the expert\n        const existing = await storage.getExpertAvailability(expertId);\n        const targetAvailability = existing.find(\n          (a) => a.id === availabilityId,\n        );\n\n        if (!targetAvailability) {\n          return res\n            .status(404)\n            .json({ message: \"Availability slot not found\" });\n        }\n\n        await storage.deleteExpertAvailability(availabilityId);\n        res.json({ message: \"Availability slot deleted successfully\" });\n      } catch (error: any) {\n        console.error(\"Error deleting expert availability:\", error);\n        res.status(500).json({ message: \"Failed to delete availability\" });\n      }\n    },\n  );\n\n  // Get available time slots for booking (public endpoint)\n  app.get(\"/api/experts/:expertId/available-slots/:date\", async (req, res) => {\n    try {\n      const { expertId, date } = req.params;\n\n      // Validate date format (YYYY-MM-DD)\n      const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n      if (!dateRegex.test(date)) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid date format. Use YYYY-MM-DD\" });\n      }\n\n      // Check if expert exists and is verified\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || expert.verificationStatus !== \"verified\") {\n        return res\n          .status(404)\n          .json({ message: \"Expert not found or not verified\" });\n      }\n\n      const slots = await storage.getAvailableTimeSlots(expertId, date);\n      res.json({ slots });\n    } catch (error: any) {\n      console.error(\"Error getting available slots:\", error);\n      res.status(500).json({ message: \"Failed to get available slots\" });\n    }\n  });\n\n  // Bulk update expert availability (set weekly schedule)\n  app.put(\n    \"/api/experts/availability/bulk\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { schedule } = req.body; // Array of availability objects\n\n        // Validate expert status\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can set availability\" });\n        }\n\n        if (!Array.isArray(schedule)) {\n          return res.status(400).json({ message: \"Schedule must be an array\" });\n        }\n\n        // Clear existing availability\n        const existing = await storage.getExpertAvailability(expertId);\n        for (const avail of existing) {\n          await storage.deleteExpertAvailability(avail.id);\n        }\n\n        // Create new availability slots\n        const newAvailability = [];\n        for (const slot of schedule) {\n          if (slot.startTime && slot.endTime && slot.dayOfWeek !== undefined) {\n            const availability = await storage.createExpertAvailability({\n              expertId,\n              dayOfWeek: slot.dayOfWeek,\n              startTime: slot.startTime,\n              endTime: slot.endTime,\n              timezone: slot.timezone || \"America/New_York\",\n              isActive: true,\n            });\n            newAvailability.push(availability);\n          }\n        }\n\n        res.json(newAvailability);\n      } catch (error: any) {\n        console.error(\"Error updating bulk availability:\", error);\n        res.status(500).json({ message: \"Failed to update availability\" });\n      }\n    },\n  );\n\n  // EXPERT PROFILE ENHANCEMENT ROUTES\n\n  // Update expert consultation settings\n  app.put(\"/api/experts/settings\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n      const {\n        hourlyRate,\n        consultationEnabled,\n        bio,\n        specializations,\n        minSessionDuration,\n        maxSessionDuration,\n        bufferTime,\n        advanceBookingDays,\n        cancellationPolicy,\n      } = req.body;\n\n      // Validate expert status\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert || expert.verificationStatus !== \"verified\") {\n        return res\n          .status(403)\n          .json({ message: \"Only verified experts can update settings\" });\n      }\n\n      // Validate hourly rate\n      if (hourlyRate && (hourlyRate < 1000 || hourlyRate > 100000)) {\n        // $10 - $1000 per hour\n        return res\n          .status(400)\n          .json({ message: \"Hourly rate must be between $10 and $1000\" });\n      }\n\n      // Update expert verification with new settings\n      const updatedExpert = await storage.updateExpertVerification(expert.id, {\n        hourlyRate: hourlyRate\n          ? Math.round(hourlyRate * 100)\n          : expert.hourlyRate, // Convert to cents\n        consultationEnabled:\n          consultationEnabled !== undefined\n            ? consultationEnabled\n            : expert.consultationEnabled,\n        bio: bio !== undefined ? bio : expert.bio,\n        expertiseArea:\n          specializations !== undefined\n            ? specializations.join(\", \")\n            : expert.expertiseArea,\n      });\n\n      // Create or update expert settings (we could create a separate settings table if needed)\n      const settings = {\n        expertId,\n        hourlyRate: Math.round((hourlyRate || expert.hourlyRate / 100) * 100),\n        consultationEnabled:\n          consultationEnabled !== undefined\n            ? consultationEnabled\n            : expert.consultationEnabled,\n        minSessionDuration: minSessionDuration || 30, // Default 30 minutes\n        maxSessionDuration: maxSessionDuration || 120, // Default 2 hours\n        bufferTime: bufferTime || 15, // Default 15 minutes between sessions\n        advanceBookingDays: advanceBookingDays || 30, // Default 30 days advance booking\n        cancellationPolicy:\n          cancellationPolicy || \"24 hours notice required for full refund\",\n      };\n\n      res.json({\n        success: true,\n        expert: updatedExpert,\n        settings,\n      });\n    } catch (error: any) {\n      console.error(\"Error updating expert settings:\", error);\n      res.status(500).json({ message: \"Failed to update expert settings\" });\n    }\n  });\n\n  // Get expert consultation settings\n  app.get(\"/api/experts/settings\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expertId = req.user.id;\n\n      const expert = await storage.getExpertVerification(expertId);\n      if (!expert) {\n        return res\n          .status(404)\n          .json({ message: \"Expert verification not found\" });\n      }\n\n      const availability = await storage.getExpertAvailability(expertId);\n\n      // Get calendar integration status\n      const calendarIntegration =\n        await storage.getCalendarIntegration(expertId);\n\n      // Get Stripe Connect status\n      let stripeStatus = null;\n      if (expert.stripeConnectAccountId) {\n        try {\n          stripeStatus = await stripeService.getConnectAccountStatus(\n            expert.stripeConnectAccountId,\n          );\n        } catch (error) {\n          console.warn(\"Failed to get Stripe status:\", error);\n        }\n      }\n\n      res.json({\n        expert: {\n          id: expert.id,\n          userId: expert.userId,\n          hourlyRate: expert.hourlyRate ? expert.hourlyRate / 100 : 100, // Convert cents to dollars\n          consultationEnabled: expert.consultationEnabled,\n          bio: expert.bio,\n          specializations: expert.expertiseArea\n            ? expert.expertiseArea.split(\", \")\n            : [],\n          verificationStatus: expert.verificationStatus,\n          featuredExpert: expert.featuredExpert,\n        },\n        availability,\n        calendar: {\n          connected: !!calendarIntegration?.isActive,\n          provider: calendarIntegration?.provider,\n          lastSync: calendarIntegration?.lastSyncAt,\n        },\n        stripe: {\n          connected: !!expert.stripeConnectAccountId,\n          accountId: expert.stripeConnectAccountId,\n          status: stripeStatus,\n        },\n        settings: {\n          minSessionDuration: 30,\n          maxSessionDuration: 120,\n          bufferTime: 15,\n          advanceBookingDays: 30,\n          cancellationPolicy: \"24 hours notice required for full refund\",\n        },\n      });\n    } catch (error: any) {\n      console.error(\"Error getting expert settings:\", error);\n      res.status(500).json({ message: \"Failed to get expert settings\" });\n    }\n  });\n\n  // Get expert profile for public booking (no auth required)\n  app.get(\"/api/experts/:expertId/profile\", async (req, res) => {\n    try {\n      // Force fresh data - no caching for approval-sensitive data\n      res.set({\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Pragma': 'no-cache',\n        'Expires': '0'\n      });\n      \n      const { expertId } = req.params;\n\n      const expert = await storage.getExpertVerification(expertId);\n      const user = await storage.getUser(expertId);\n      \n      if (!expert || !user || user.role !== 'expert') {\n        return res\n          .status(404)\n          .json({ message: \"Expert not found\" });\n      }\n\n      // Allow viewing profiles of all experts (regardless of approval status)\n      // Booking buttons will be hidden on frontend for non-approved experts\n\n      // Get expert's reviews\n      const reviews = await storage.getExpertReviews(expertId, 5);\n\n      // Calculate average rating\n      const averageRating =\n        reviews.length > 0\n          ? reviews.reduce((sum, review) => sum + review.rating, 0) /\n            reviews.length\n          : 0;\n\n      // Get availability for next 7 days\n      const today = new Date();\n      const availability = [];\n      for (let i = 0; i < 7; i++) {\n        const date = new Date(today);\n        date.setDate(date.getDate() + i);\n        const dateStr = date.toISOString().split(\"T\")[0];\n\n        try {\n          const slots = await storage.getAvailableTimeSlots(expertId, dateStr);\n          if (slots.length > 0) {\n            availability.push({\n              date: dateStr,\n              availableSlots: slots.length,\n              nextAvailable: slots[0],\n            });\n          }\n        } catch (error) {\n          // Skip this date if there's an error\n        }\n      }\n\n      res.json({\n        id: expert.userId,\n        username: user.username,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        name: `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim(),\n        bio: expert.bio,\n        profession: expert.profession,\n        company: expert.company,\n        expertiseArea: expert.expertiseArea,\n        credentials: expert.credentials,\n        linkedinUrl: expert.linkedinUrl,\n        verifiedAt: expert.verifiedAt,\n        specializations: expert.expertiseArea\n          ? expert.expertiseArea.split(\", \")\n          : [],\n        hourlyRate: expert.consultationRate ? expert.consultationRate / 100 : 100,\n        consultationEnabled: Boolean(expert.allowBooking),\n        profileImageUrl: user.profileImageUrl || expert.profileImageUrl,\n        yearsExperience: expert.yearsExperience,\n        featuredExpert: expert.featuredExpert,\n        // Role and verification fields needed for button logic\n        role: user.role,\n        approved: user.approved,\n        verificationStatus: expert.verificationStatus,\n        // Appointment booking fields\n        allowBooking: expert.allowBooking || false,\n        calendlyLink: expert.calendlyLink,\n        rating: {\n          average: Math.round(averageRating * 10) / 10,\n          count: reviews.length,\n        },\n        reviews: reviews.map((review) => ({\n          id: review.id,\n          rating: review.rating,\n          reviewText: review.reviewText,\n          createdAt: review.createdAt,\n        })),\n        availability,\n        nextAvailable:\n          availability.length > 0 ? availability[0].nextAvailable : null,\n      });\n    } catch (error: any) {\n      console.error(\"Error getting expert profile:\", error);\n      res.status(500).json({ message: \"Failed to get expert profile\" });\n    }\n  });\n\n  // APPOINTMENT MANAGEMENT DASHBOARD ROUTES\n\n  // Get expert dashboard analytics\n  app.get(\n    \"/api/experts/dashboard/analytics\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const { period = \"30\" } = req.query; // days\n\n        // Validate expert\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can access dashboard\" });\n        }\n\n        const days = parseInt(period as string);\n        const startDate = new Date();\n        startDate.setDate(startDate.getDate() - days);\n\n        // Get all appointments for the period\n        const appointments = await storage.getExpertAppointments(expertId);\n        const periodAppointments = appointments.filter(\n          (apt) => new Date(apt.createdAt) >= startDate,\n        );\n\n        // Calculate analytics\n        const totalAppointments = periodAppointments.length;\n        const completedAppointments = periodAppointments.filter(\n          (apt) => apt.status === \"completed\",\n        ).length;\n        const cancelledAppointments = periodAppointments.filter(\n          (apt) => apt.status === \"cancelled\",\n        ).length;\n        const pendingAppointments = periodAppointments.filter(\n          (apt) => apt.status === \"pending\",\n        ).length;\n        const confirmedAppointments = periodAppointments.filter(\n          (apt) => apt.status === \"confirmed\",\n        ).length;\n\n        const totalRevenue = periodAppointments\n          .filter((apt) => apt.status === \"completed\")\n          .reduce((sum, apt) => sum + apt.expertEarnings, 0);\n\n        const averageSessionDuration =\n          periodAppointments.length > 0\n            ? periodAppointments.reduce((sum, apt) => sum + apt.duration, 0) /\n              periodAppointments.length\n            : 0;\n\n        // Get reviews for the period\n        const allReviews = await storage.getExpertReviews(expertId, 100);\n        const periodReviews = allReviews.filter(\n          (review) => new Date(review.createdAt) >= startDate,\n        );\n\n        const averageRating =\n          periodReviews.length > 0\n            ? periodReviews.reduce((sum, review) => sum + review.rating, 0) /\n              periodReviews.length\n            : 0;\n\n        // Upcoming appointments (next 7 days)\n        const upcomingDate = new Date();\n        upcomingDate.setDate(upcomingDate.getDate() + 7);\n        const upcomingAppointments = appointments.filter(\n          (apt) =>\n            new Date(apt.scheduledAt) >= new Date() &&\n            new Date(apt.scheduledAt) <= upcomingDate &&\n            [\"confirmed\", \"pending\"].includes(apt.status),\n        ).length;\n\n        // Daily breakdown for charts\n        const dailyStats = [];\n        for (let i = days - 1; i >= 0; i--) {\n          const date = new Date();\n          date.setDate(date.getDate() - i);\n          const dateStr = date.toISOString().split(\"T\")[0];\n\n          const dayAppointments = periodAppointments.filter(\n            (apt) =>\n              new Date(apt.scheduledAt).toISOString().split(\"T\")[0] === dateStr,\n          );\n\n          dailyStats.push({\n            date: dateStr,\n            appointments: dayAppointments.length,\n            revenue:\n              dayAppointments\n                .filter((apt) => apt.status === \"completed\")\n                .reduce((sum, apt) => sum + apt.expertEarnings, 0) / 100, // Convert to dollars\n            cancellations: dayAppointments.filter(\n              (apt) => apt.status === \"cancelled\",\n            ).length,\n          });\n        }\n\n        res.json({\n          summary: {\n            totalAppointments,\n            completedAppointments,\n            cancelledAppointments,\n            pendingAppointments,\n            confirmedAppointments,\n            totalRevenue: totalRevenue / 100, // Convert to dollars\n            averageSessionDuration: Math.round(averageSessionDuration),\n            averageRating: Math.round(averageRating * 10) / 10,\n            upcomingAppointments,\n            completionRate:\n              totalAppointments > 0\n                ? (completedAppointments / totalAppointments) * 100\n                : 0,\n            cancellationRate:\n              totalAppointments > 0\n                ? (cancelledAppointments / totalAppointments) * 100\n                : 0,\n          },\n          dailyStats,\n          period: {\n            days,\n            startDate: startDate.toISOString(),\n            endDate: new Date().toISOString(),\n          },\n        });\n      } catch (error: any) {\n        console.error(\"Error getting expert analytics:\", error);\n        res.status(500).json({ message: \"Failed to get dashboard analytics\" });\n      }\n    },\n  );\n\n  // Get expert appointments with filtering and pagination\n  app.get(\n    \"/api/experts/dashboard/appointments\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const {\n          status,\n          startDate,\n          endDate,\n          page = 1,\n          limit = 20,\n          sortBy = \"scheduledAt\",\n          sortOrder = \"desc\",\n        } = req.query;\n\n        // Validate expert\n        const expert = await storage.getExpertVerification(expertId);\n        if (!expert || expert.verificationStatus !== \"verified\") {\n          return res\n            .status(403)\n            .json({ message: \"Only verified experts can access appointments\" });\n        }\n\n        let appointments = await storage.getExpertAppointments(expertId);\n\n        // Apply filters\n        if (status && status !== \"all\") {\n          appointments = appointments.filter((apt) => apt.status === status);\n        }\n\n        if (startDate) {\n          appointments = appointments.filter(\n            (apt) => new Date(apt.scheduledAt) >= new Date(startDate as string),\n          );\n        }\n\n        if (endDate) {\n          appointments = appointments.filter(\n            (apt) => new Date(apt.scheduledAt) <= new Date(endDate as string),\n          );\n        }\n\n        // Sort appointments\n        appointments.sort((a, b) => {\n          const aValue = a[sortBy as keyof typeof a];\n          const bValue = b[sortBy as keyof typeof b];\n\n          if (sortOrder === \"desc\") {\n            return aValue > bValue ? -1 : 1;\n          } else {\n            return aValue < bValue ? -1 : 1;\n          }\n        });\n\n        // Pagination\n        const pageNum = parseInt(page as string);\n        const limitNum = parseInt(limit as string);\n        const offset = (pageNum - 1) * limitNum;\n        const paginatedAppointments = appointments.slice(\n          offset,\n          offset + limitNum,\n        );\n\n        // Get client information for each appointment\n        const enrichedAppointments = await Promise.all(\n          paginatedAppointments.map(async (appointment) => {\n            let clientInfo = null;\n            if (appointment.clientId) {\n              try {\n                const client = await storage.getUser(appointment.clientId);\n                if (client) {\n                  clientInfo = {\n                    id: client.id,\n                    name:\n                      `${client.firstName || \"\"} ${client.lastName || \"\"}`.trim() ||\n                      client.username,\n                    email: client.email,\n                  };\n                }\n              } catch (error) {\n                console.warn(\"Failed to get client info:\", error);\n              }\n            }\n\n            return {\n              ...appointment,\n              client: clientInfo || {\n                name: appointment.clientName,\n                email: appointment.clientEmail,\n              },\n              revenue: appointment.expertEarnings / 100, // Convert to dollars\n            };\n          }),\n        );\n\n        res.json({\n          appointments: enrichedAppointments,\n          pagination: {\n            page: pageNum,\n            limit: limitNum,\n            total: appointments.length,\n            pages: Math.ceil(appointments.length / limitNum),\n          },\n          filters: {\n            status: status || \"all\",\n            startDate,\n            endDate,\n            sortBy,\n            sortOrder,\n          },\n        });\n      } catch (error: any) {\n        console.error(\"Error getting expert appointments:\", error);\n        res.status(500).json({ message: \"Failed to get appointments\" });\n      }\n    },\n  );\n\n  // Update appointment details (expert only)\n  app.put(\n    \"/api/experts/dashboard/appointments/:id\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const expertId = req.user.id;\n        const appointmentId = parseInt(req.params.id);\n        const { notes, meetingLink, status } = req.body;\n\n        const appointment = await storage.getAppointmentById(appointmentId);\n        if (!appointment) {\n          return res.status(404).json({ message: \"Appointment not found\" });\n        }\n\n        // Verify expert owns this appointment\n        if (appointment.expertId !== expertId) {\n          return res\n            .status(403)\n            .json({ message: \"Not authorized to modify this appointment\" });\n        }\n\n        // Prepare updates\n        const updates: any = {};\n        if (notes !== undefined) updates.notes = notes;\n        if (meetingLink !== undefined) updates.meetingLink = meetingLink;\n        if (\n          status !== undefined &&\n          [\"pending\", \"confirmed\", \"completed\", \"cancelled\"].includes(status)\n        ) {\n          updates.status = status;\n        }\n\n        const updatedAppointment = await storage.updateAppointment(\n          appointmentId,\n          updates,\n        );\n\n        res.json({\n          success: true,\n          appointment: updatedAppointment,\n        });\n      } catch (error: any) {\n        console.error(\"Error updating appointment:\", error);\n        res.status(500).json({ message: \"Failed to update appointment\" });\n      }\n    },\n  );\n\n  // Admin dashboard - all appointments overview\n  app.get(\n    \"/api/admin/dashboard/appointments\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        // Check admin permission\n        if (req.user.role !== \"admin\") {\n          return res.status(403).json({ message: \"Admin access required\" });\n        }\n\n        const {\n          status,\n          expertId,\n          startDate,\n          endDate,\n          page = 1,\n          limit = 50,\n        } = req.query;\n\n        // Get all appointments with expert and client info\n        const appointments = await storage.getAllAppointmentsWithDetails();\n\n        // Apply filters\n        let filteredAppointments = appointments;\n\n        if (status && status !== \"all\") {\n          filteredAppointments = filteredAppointments.filter(\n            (apt) => apt.status === status,\n          );\n        }\n\n        if (expertId) {\n          filteredAppointments = filteredAppointments.filter(\n            (apt) => apt.expertId === expertId,\n          );\n        }\n\n        if (startDate) {\n          filteredAppointments = filteredAppointments.filter(\n            (apt) => new Date(apt.scheduledAt) >= new Date(startDate as string),\n          );\n        }\n\n        if (endDate) {\n          filteredAppointments = filteredAppointments.filter(\n            (apt) => new Date(apt.scheduledAt) <= new Date(endDate as string),\n          );\n        }\n\n        // Sort by most recent\n        filteredAppointments.sort(\n          (a, b) =>\n            new Date(b.scheduledAt).getTime() -\n            new Date(a.scheduledAt).getTime(),\n        );\n\n        // Pagination\n        const pageNum = parseInt(page as string);\n        const limitNum = parseInt(limit as string);\n        const offset = (pageNum - 1) * limitNum;\n        const paginatedAppointments = filteredAppointments.slice(\n          offset,\n          offset + limitNum,\n        );\n\n        res.json({\n          appointments: paginatedAppointments,\n          pagination: {\n            page: pageNum,\n            limit: limitNum,\n            total: filteredAppointments.length,\n            pages: Math.ceil(filteredAppointments.length / limitNum),\n          },\n        });\n      } catch (error: any) {\n        console.error(\"Error getting admin appointments:\", error);\n        res.status(500).json({ message: \"Failed to get admin appointments\" });\n      }\n    },\n  );\n\n  // Admin analytics - platform overview\n  app.get(\n    \"/api/admin/dashboard/analytics\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        // Check admin permission\n        if (req.user.role !== \"admin\") {\n          return res.status(403).json({ message: \"Admin access required\" });\n        }\n\n        const { period = \"30\" } = req.query;\n        const days = parseInt(period as string);\n        const startDate = new Date();\n        startDate.setDate(startDate.getDate() - days);\n\n        // Get platform statistics\n        const stats = await storage.getPlatformAnalytics(startDate);\n\n        res.json(stats);\n      } catch (error: any) {\n        console.error(\"Error getting admin analytics:\", error);\n        res.status(500).json({ message: \"Failed to get admin analytics\" });\n      }\n    },\n  );\n\n  // Get appointment reviews and feedback\n  app.get(\n    \"/api/appointments/:id/reviews\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const appointmentId = parseInt(req.params.id);\n        const userId = req.user.id;\n\n        const appointment = await storage.getAppointmentById(appointmentId);\n        if (!appointment) {\n          return res.status(404).json({ message: \"Appointment not found\" });\n        }\n\n        // Check if user is involved in this appointment\n        if (\n          appointment.expertId !== userId &&\n          appointment.clientId !== userId\n        ) {\n          return res\n            .status(403)\n            .json({ message: \"Not authorized to view reviews\" });\n        }\n\n        const reviews = await storage.getAppointmentReviews(appointmentId);\n        res.json(reviews);\n      } catch (error: any) {\n        console.error(\"Error getting appointment reviews:\", error);\n        res.status(500).json({ message: \"Failed to get appointment reviews\" });\n      }\n    },\n  );\n\n  // Create appointment review\n  app.post(\n    \"/api/appointments/:id/reviews\",\n    isAuthenticated,\n    async (req: any, res) => {\n      try {\n        const appointmentId = parseInt(req.params.id);\n        const userId = req.user.id;\n        const { rating, reviewText, isPublic = true } = req.body;\n\n        if (!rating || rating < 1 || rating > 5) {\n          return res\n            .status(400)\n            .json({ message: \"Rating must be between 1 and 5\" });\n        }\n\n        const appointment = await storage.getAppointmentById(appointmentId);\n        if (!appointment) {\n          return res.status(404).json({ message: \"Appointment not found\" });\n        }\n\n        // Check if user is involved in this appointment\n        if (\n          appointment.expertId !== userId &&\n          appointment.clientId !== userId\n        ) {\n          return res\n            .status(403)\n            .json({ message: \"Not authorized to review this appointment\" });\n        }\n\n        // Check if appointment is completed\n        if (appointment.status !== \"completed\") {\n          return res\n            .status(400)\n            .json({ message: \"Can only review completed appointments\" });\n        }\n\n        // Determine who is being reviewed\n        const revieweeId =\n          appointment.expertId === userId\n            ? appointment.clientId\n            : appointment.expertId;\n        if (!revieweeId) {\n          return res\n            .status(400)\n            .json({ message: \"Cannot determine review target\" });\n        }\n\n        const review = await storage.createAppointmentReview({\n          appointmentId,\n          reviewerId: userId,\n          revieweeId,\n          rating,\n          reviewText: reviewText || null,\n          isPublic,\n        });\n\n        res.json({\n          success: true,\n          review,\n        });\n      } catch (error: any) {\n        console.error(\"Error creating appointment review:\", error);\n        res.status(500).json({ message: \"Failed to create review\" });\n      }\n    },\n  );\n\n  // Content Sources routes\n  app.get(\"/api/content-sources\", async (req, res) => {\n    try {\n      const sources = await storage.getContentSources();\n      res.json(sources);\n    } catch (error: any) {\n      console.error(\"Error getting content sources:\", error);\n      res.status(500).json({ message: \"Failed to get content sources\" });\n    }\n  });\n\n  // Admin endpoint to get ALL content sources (including inactive)\n  app.get(\n    \"/api/content-sources/all\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const sources = await storage.getAllContentSources();\n        res.json(sources);\n      } catch (error: any) {\n        console.error(\"Error getting all content sources:\", error);\n        res.status(500).json({ message: \"Failed to get content sources\" });\n      }\n    },\n  );\n\n  app.get(\"/api/content-sources/category/:categoryId\", async (req, res) => {\n    try {\n      const { categoryId } = req.params;\n      const sources = await storage.getContentSourcesByCategory(categoryId);\n      res.json(sources);\n    } catch (error: any) {\n      console.error(\"Error getting content sources by category:\", error);\n      res.status(500).json({ message: \"Failed to get content sources\" });\n    }\n  });\n\n  app.post(\"/api/content-sources\", isAdmin, async (req: any, res) => {\n    try {\n      const source = await storage.createContentSource(req.body);\n      res.json(source);\n    } catch (error: any) {\n      console.error(\"Error creating content source:\", error);\n      res.status(500).json({ message: \"Failed to create content source\" });\n    }\n  });\n\n  app.put(\n    \"/api/content-sources/reorder\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const { categoryId, sourceIds } = req.body;\n\n        if (!categoryId || !Array.isArray(sourceIds)) {\n          return res.status(400).json({ message: \"Invalid request data\" });\n        }\n\n        await storage.reorderContentSources(categoryId, sourceIds);\n        res.json({ success: true });\n      } catch (error: any) {\n        console.error(\"Error reordering content sources:\", error);\n        res.status(500).json({ message: \"Failed to reorder content sources\" });\n      }\n    },\n  );\n\n  app.put(\n    \"/api/content-sources/:id\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const id = parseInt(req.params.id);\n        const source = await storage.updateContentSource(id, req.body);\n\n        if (!source) {\n          return res.status(404).json({ message: \"Content source not found\" });\n        }\n\n        res.json(source);\n      } catch (error: any) {\n        console.error(\"Error updating content source:\", error);\n        res.status(500).json({ message: \"Failed to update content source\" });\n      }\n    },\n  );\n\n  app.delete(\n    \"/api/content-sources/:id\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const id = parseInt(req.params.id);\n        await storage.deleteContentSource(id);\n        res.json({ success: true });\n      } catch (error: any) {\n        console.error(\"Error deleting content source:\", error);\n        res.status(500).json({ message: \"Failed to delete content source\" });\n      }\n    },\n  );\n\n  // User favorite content sources routes\n  app.get(\n    \"/api/content-sources/favorites\",\n    clerkAuthWithSync,\n    async (req: any, res) => {\n      try {\n        if (!req.userId) {\n          return res.status(401).json({ message: \"Unauthorized\" });\n        }\n        const userId = req.userId;\n        const favorites = await storage.getUserFavoriteContentSources(userId);\n        res.json(favorites);\n      } catch (error: any) {\n        console.error(\"Error fetching favorite content sources:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to fetch favorite content sources\" });\n      }\n    },\n  );\n\n  app.post(\n    \"/api/content-sources/:id/favorite\",\n    clerkAuthWithSync,\n    async (req: any, res) => {\n      try {\n        if (!req.userId) {\n          return res.status(401).json({ message: \"Unauthorized\" });\n        }\n        const userId = req.userId;\n        const contentSourceId = parseInt(req.params.id);\n\n        if (isNaN(contentSourceId)) {\n          return res.status(400).json({ message: \"Invalid content source ID\" });\n        }\n\n        const isFavorited = await storage.toggleUserFavoriteContentSource(\n          userId,\n          contentSourceId,\n        );\n        res.json({ isFavorited });\n      } catch (error: any) {\n        console.error(\"Error toggling favorite:\", error);\n        res.status(500).json({ message: \"Failed to toggle favorite\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/content-sources/:id/is-favorited\",\n    optionalAuth,\n    async (req: any, res) => {\n      try {\n        const userId = req.userId;\n        const contentSourceId = parseInt(req.params.id);\n\n        if (isNaN(contentSourceId)) {\n          return res.status(400).json({ message: \"Invalid content source ID\" });\n        }\n\n        if (!userId) {\n          return res.json({ isFavorited: false });\n        }\n\n        const isFavorited = await storage.isContentSourceFavoritedByUser(\n          userId,\n          contentSourceId,\n        );\n        res.json({ isFavorited });\n      } catch (error: any) {\n        console.error(\"Error checking favorite status:\", error);\n        res.status(500).json({ message: \"Failed to check favorite status\" });\n      }\n    },\n  );\n\n  // Post favorite endpoints\n  app.get(\"/api/posts/favorites\", clerkAuthWithSync, async (req: any, res) => {\n    try {\n      if (!req.userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const userId = req.userId;\n      const favorites = await storage.getUserFavoritePosts(userId);\n      res.json(favorites);\n    } catch (error: any) {\n      console.error(\"Error fetching favorite posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch favorite posts\" });\n    }\n  });\n\n  app.post(\n    \"/api/posts/:id/favorite\",\n    clerkAuthWithSync,\n    async (req: any, res) => {\n      try {\n        if (!req.userId) {\n          return res.status(401).json({ message: \"Unauthorized\" });\n        }\n        const userId = req.userId;\n        const postId = parseInt(req.params.id);\n\n        if (isNaN(postId)) {\n          return res.status(400).json({ message: \"Invalid post ID\" });\n        }\n\n        const isFavorited = await storage.toggleUserFavoritePost(\n          userId,\n          postId,\n        );\n        res.json({ isFavorited });\n      } catch (error: any) {\n        console.error(\"Error toggling post favorite:\", error);\n        res.status(500).json({ message: \"Failed to toggle favorite\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/posts/:id/is-favorited\",\n    optionalAuth,\n    async (req: any, res) => {\n      try {\n        const userId = req.userId;\n        const postId = parseInt(req.params.id);\n\n        if (isNaN(postId)) {\n          return res.status(400).json({ message: \"Invalid post ID\" });\n        }\n\n        if (!userId) {\n          return res.json({ isFavorited: false });\n        }\n\n        const isFavorited = await storage.isPostFavoritedByUser(userId, postId);\n        res.json({ isFavorited });\n      } catch (error: any) {\n        console.error(\"Error checking post favorite status:\", error);\n        res.status(500).json({ message: \"Failed to check favorite status\" });\n      }\n    },\n  );\n\n  app.get(\"/api/posts/:id/favorite-count\", async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n\n      if (isNaN(postId)) {\n        return res.status(400).json({ message: \"Invalid post ID\" });\n      }\n\n      const count = await storage.getPostFavoriteCount(postId);\n      res.json({ count });\n    } catch (error: any) {\n      console.error(\"Error getting post favorite count:\", error);\n      res.status(500).json({ message: \"Failed to get favorite count\" });\n    }\n  });\n\n  // Q&A Knowledge Routes\n  app.post(\"/api/qa-search\", async (req: any, res) => {\n    try {\n      const { query } = req.body;\n\n      if (!query || query.trim().length === 0) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      const results = await storage.searchQaKnowledge(query);\n\n      let answer: string;\n      let resultFound: boolean;\n\n      if (results.length > 0) {\n        answer = results[0].answer;\n        resultFound = true;\n      } else {\n        answer =\n          \"I don't have a specific answer to that question yet. Please try rephrasing your question or contact our support team for personalized assistance.\";\n        resultFound = false;\n      }\n\n      // Log the search query and answer\n      try {\n        await storage.createSearchLog({\n          query: query.trim(),\n          answer,\n          userId: req.user?.id || null, // null for anonymous users\n          source: \"landing\",\n          resultFound,\n        });\n      } catch (logError) {\n        console.error(\"Error logging search:\", logError);\n        // Don't fail the search if logging fails\n      }\n\n      // Return the most relevant result or null\n      res.json({\n        result: results.length > 0 ? results[0] : null,\n        totalResults: results.length,\n      });\n    } catch (error: any) {\n      console.error(\"Error searching Q&A knowledge:\", error);\n      res.status(500).json({ message: \"Failed to search Q&A knowledge\" });\n    }\n  });\n\n  // RAG-powered Q&A Search\n  app.post(\"/api/rag-search\", async (req: any, res) => {\n    try {\n      const { query } = req.body;\n\n      if (!query || query.trim().length === 0) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      // Import RAG service dynamically to avoid circular dependencies\n      const { generateRagAnswer } = await import(\"./services/rag\");\n\n      const ragResponse = await generateRagAnswer(query.trim());\n\n      // Log the search query and answer\n      try {\n        await storage.createSearchLog({\n          query: query.trim(),\n          answer: ragResponse.answer,\n          userId: req.user?.id || null,\n          source: \"rag\",\n          resultFound: ragResponse.confidence > 0.3,\n        });\n      } catch (logError) {\n        console.error(\"Error logging RAG search:\", logError);\n      }\n\n      res.json({\n        answer: ragResponse.answer,\n        confidence: ragResponse.confidence,\n        sources: ragResponse.sources.map((source) => ({\n          question: source.chunk.metadata.question,\n          content: source.chunk.chunkText.substring(0, 200) + \"...\",\n          score: source.score,\n          source: source.source,\n        })),\n        totalSources: ragResponse.sources.length,\n      });\n    } catch (error: any) {\n      console.error(\"Error in RAG search:\", error);\n      res.status(500).json({\n        message: \"Failed to process RAG search\",\n        error: error.message,\n      });\n    }\n  });\n\n  // Test streaming endpoint for debugging production issues\n  app.get(\"/api/test-stream\", async (req: any, res) => {\n    try {\n      console.log(\"Starting test stream...\");\n\n      // Set headers for Server-Sent Events - crucial for production streaming\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache, no-store, must-revalidate\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n      res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n      res.setHeader(\"Access-Control-Allow-Headers\", \"Cache-Control\");\n      res.setHeader(\"X-Accel-Buffering\", \"no\"); // Disable nginx buffering\n      res.setHeader(\"Transfer-Encoding\", \"chunked\"); // Enable chunked transfer\n\n      // Send initial heartbeat\n      res.write(\n        'data: {\"type\":\"heartbeat\",\"message\":\"Connection established\"}\\n\\n',\n      );\n      res.flush?.();\n\n      // Send test messages with delays\n      for (let i = 1; i <= 5; i++) {\n        await new Promise((resolve) => setTimeout(resolve, 1000)); // 1 second delay\n        res.write(\n          `data: {\"type\":\"test\",\"message\":\"Test message ${i}\",\"timestamp\":\"${new Date().toISOString()}\"}\\n\\n`,\n        );\n        res.flush?.();\n        console.log(`Sent test message ${i}`);\n      }\n\n      // Send end signal\n      res.write('data: {\"type\":\"end\",\"message\":\"Stream complete\"}\\n\\n');\n      res.flush?.();\n      console.log(\"Test stream completed\");\n      res.end();\n    } catch (error: any) {\n      console.error(\"Error in test stream:\", error);\n      res.write(`data: {\"type\":\"error\",\"error\":\"${error.message}\"}\\n\\n`);\n      res.end();\n    }\n  });\n\n  // Helper function to safely stringify JSON for streaming\n  const safeJsonStringify = (obj: any): string => {\n    try {\n      const jsonStr = JSON.stringify(obj);\n      // Replace problematic Unicode characters that could break JSON parsing\n      return jsonStr\n        .replace(/Ã¢â‚¬â„¢/g, \"'\") // Replace smart apostrophe\n        .replace(/Ã¢â‚¬Å“/g, '\"') // Replace smart quote open\n        .replace(/Ã¢â‚¬/g, '\"') // Replace smart quote close\n        .replace(/Ã¢â‚¬\"/g, \"-\") // Replace em dash\n        .replace(/Ã¢â‚¬\"/g, \"-\"); // Replace en dash\n    } catch (error) {\n      console.error(\"Error stringifying JSON:\", error);\n      return JSON.stringify({\n        type: \"error\",\n        error: \"Failed to serialize data\",\n      });\n    }\n  };\n\n  // Helper function to send large objects in smaller chunks to avoid truncation\n  const writeJsonSafely = (res: any, obj: any): void => {\n    const jsonStr = safeJsonStringify(obj);\n\n    // If the JSON is very large (>4KB), we might have issues\n    if (jsonStr.length > 4096) {\n      console.warn(`Large JSON payload detected: ${jsonStr.length} characters`);\n\n      // For metadata objects, try to simplify them\n      if (obj.type === \"metadata\" && obj.sources) {\n        // Send simplified metadata first\n        const simplifiedMetadata = {\n          type: \"metadata\",\n          confidence: obj.confidence,\n          sourceCount: obj.sources.length,\n        };\n        res.write(`data: ${safeJsonStringify(simplifiedMetadata)}\\n\\n`);\n        res.flush?.();\n\n        // Then send sources separately if needed\n        console.log(\"Sent simplified metadata due to large payload\");\n        return;\n      }\n    }\n\n    res.write(`data: ${jsonStr}\\n\\n`);\n    res.flush?.();\n  };\n\n  // RAG-powered Q&A Search with Streaming\n  app.post(\"/api/rag-search-stream\", async (req: any, res) => {\n    try {\n      const { query } = req.body;\n\n      if (!query || query.trim().length === 0) {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      // Set headers for Server-Sent Events - crucial for production streaming\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache, no-store, must-revalidate\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n      res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n      res.setHeader(\"Access-Control-Allow-Headers\", \"Cache-Control\");\n      res.setHeader(\"X-Accel-Buffering\", \"no\"); // Disable nginx buffering\n      res.setHeader(\"Transfer-Encoding\", \"chunked\"); // Enable chunked transfer\n\n      // Import RAG service dynamically to avoid circular dependencies\n      const { generateRagAnswerStream } = await import(\"./services/rag\");\n\n      let fullAnswer = \"\";\n      let metadata: any = null;\n\n      // Send initial heartbeat to establish connection\n      res.write('data: {\"type\":\"heartbeat\"}\\n\\n');\n      res.flush?.(); // Force flush if available\n\n      for await (const chunk of generateRagAnswerStream(query.trim())) {\n        if (chunk.type === \"metadata\") {\n          metadata = chunk;\n          writeJsonSafely(res, chunk);\n        } else if (chunk.type === \"content\") {\n          fullAnswer += (chunk as any).content;\n          writeJsonSafely(res, chunk);\n        } else if (chunk.type === \"error\") {\n          writeJsonSafely(res, chunk);\n          break;\n        }\n      }\n\n      // Send end signal\n      writeJsonSafely(res, { type: \"end\" });\n\n      // Log the search query and answer\n      try {\n        await storage.createSearchLog({\n          query: query.trim(),\n          answer: fullAnswer,\n          userId: req.user?.id || null,\n          source: \"rag_stream\",\n          resultFound: metadata?.confidence > 0.3,\n        });\n      } catch (logError) {\n        console.error(\"Error logging RAG search:\", logError);\n      }\n\n      res.end();\n    } catch (error: any) {\n      console.error(\"Error in RAG search stream:\", error);\n      res.write(\n        `data: ${JSON.stringify({\n          type: \"error\",\n          message: \"Failed to process RAG search\",\n          error: error.message,\n        })}\\n\\n`,\n      );\n      res.end();\n    }\n  });\n\n  // Email AI Answer to User\n  app.post(\"/api/email-answer\", async (req: any, res) => {\n    try {\n      const { firstName, email, question, answer } = req.body;\n\n      // Validate required fields\n      if (!firstName || !email || !question || !answer) {\n        return res.status(400).json({\n          message:\n            \"All fields are required: firstName, email, question, answer\",\n        });\n      }\n\n      // Basic email validation\n      if (!email.includes(\"@\") || !email.includes(\".\")) {\n        return res.status(400).json({\n          message: \"Please provide a valid email address\",\n        });\n      }\n\n      // Trim input data\n      const trimmedData = {\n        firstName: firstName.trim(),\n        email: email.trim(),\n        question: question.trim(),\n        answer: answer.trim(),\n      };\n\n      // Send email using the email service\n      const { emailService } = await import(\"./services/emailService\");\n      const success = await emailService.sendAiAnswerEmail(\n        trimmedData.firstName,\n        trimmedData.email,\n        trimmedData.question,\n        trimmedData.answer,\n      );\n\n      if (!success) {\n        console.error(\"Failed to send AI answer email to:\", trimmedData.email);\n        return res.status(500).json({\n          message: \"Failed to send email. Please try again later.\",\n        });\n      }\n\n      console.log(\n        `AI answer email sent successfully to ${trimmedData.email} for user ${trimmedData.firstName}`,\n      );\n\n      // Log the email request (optional)\n      try {\n        await storage.createSearchLog({\n          query: `Email request: ${trimmedData.question}`,\n          answer: `Emailed to: ${trimmedData.email}`,\n          userId: req.user?.id || null,\n          source: \"email_answer\",\n          resultFound: true,\n        });\n      } catch (logError) {\n        console.error(\"Error logging email request:\", logError);\n        // Don't fail the request if logging fails\n      }\n\n      res.json({\n        success: true,\n        message: \"Email sent successfully\",\n      });\n    } catch (error: any) {\n      console.error(\"Error sending AI answer email:\", error);\n      res.status(500).json({\n        message: \"Failed to send email. Please try again later.\",\n        error:\n          process.env.NODE_ENV === \"development\" ? error.message : undefined,\n      });\n    }\n  });\n\n  // RAG System Management Routes\n  app.post(\"/api/rag/initialize\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const { initializeRagSystem } = await import(\"./services/rag\");\n      await initializeRagSystem();\n\n      res.json({ message: \"RAG system initialized successfully\" });\n    } catch (error: any) {\n      console.error(\"Error initializing RAG system:\", error);\n      res.status(500).json({\n        message: \"Failed to initialize RAG system\",\n        error: error.message,\n      });\n    }\n  });\n\n  app.get(\"/api/rag/stats\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const { getRagStats } = await import(\"./services/rag\");\n      const stats = await getRagStats();\n\n      res.json(stats);\n    } catch (error: any) {\n      console.error(\"Error getting RAG stats:\", error);\n      res.status(500).json({\n        message: \"Failed to get RAG stats\",\n        error: error.message,\n      });\n    }\n  });\n\n  app.post(\"/api/rag/test\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const { testRagSystem } = await import(\"./services/rag\");\n      await testRagSystem();\n\n      res.json({ message: \"RAG system test completed successfully\" });\n    } catch (error: any) {\n      console.error(\"Error testing RAG system:\", error);\n      res.status(500).json({\n        message: \"Failed to test RAG system\",\n        error: error.message,\n      });\n    }\n  });\n\n  // Admin route to add Q&A knowledge\n  app.post(\"/api/qa-knowledge\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const qaItem = await storage.createQaKnowledge(req.body);\n      res.json(qaItem);\n    } catch (error: any) {\n      console.error(\"Error creating Q&A knowledge:\", error);\n      res.status(500).json({ message: \"Failed to create Q&A knowledge\" });\n    }\n  });\n\n  // Admin route to get search logs\n  app.get(\"/api/admin/search-logs\", isAuthenticated, async (req: any, res) => {\n    try {\n      if (req.user.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const limit = parseInt(req.query.limit as string) || 100;\n      const logs = await storage.getSearchLogs(limit);\n      res.json(logs);\n    } catch (error: any) {\n      console.error(\"Error fetching search logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch search logs\" });\n    }\n  });\n\n  // Social media embeds routes\n  app.get(\"/api/social-media-embeds/:type\", async (req, res) => {\n    try {\n      const { type } = req.params;\n      const embeds = await storage.getSocialMediaEmbeds(type);\n      res.json(embeds);\n    } catch (error: any) {\n      console.error(\"Error fetching social media embeds:\", error);\n      res.status(500).json({ message: \"Failed to fetch social media embeds\" });\n    }\n  });\n\n  app.post(\n    \"/api/social-media-embeds\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const validationResult = insertSocialMediaEmbedSchema.safeParse(req.body);\n        if (!validationResult.success) {\n          console.error(\"Validation error:\", validationResult.error);\n          return res.status(400).json({ \n            message: \"Invalid embed data\", \n            errors: validationResult.error.errors \n          });\n        }\n\n        const embed = await storage.createSocialMediaEmbed(validationResult.data);\n        res.json(embed);\n      } catch (error: any) {\n        console.error(\"Error creating social media embed:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to create social media embed\" });\n      }\n    },\n  );\n\n  app.put(\n    \"/api/social-media-embeds/:id\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const id = parseInt(req.params.id);\n        const { embedCode } = req.body;\n        const embed = await storage.updateSocialMediaEmbed(id, embedCode);\n        res.json(embed);\n      } catch (error: any) {\n        console.error(\"Error updating social media embed:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to update social media embed\" });\n      }\n    },\n  );\n\n  app.delete(\n    \"/api/social-media-embeds/:id\",\n    isAdmin,\n    async (req: any, res) => {\n      try {\n        const id = parseInt(req.params.id);\n        await storage.deleteSocialMediaEmbed(id);\n        res.json({ success: true });\n      } catch (error: any) {\n        console.error(\"Error deleting social media embed:\", error);\n        res\n          .status(500)\n          .json({ message: \"Failed to delete social media embed\" });\n      }\n    },\n  );\n\n  // Clerk user registration endpoints\n  app.post(\"/api/update-clerk-metadata\", async (req, res) => {\n    try {\n      const { clerkUserId, metadata } = req.body;\n      \n      if (!clerkUserId) {\n        return res.status(400).json({ message: \"Missing clerkUserId\" });\n      }\n\n      await updateClerkUserMetadata(clerkUserId, metadata);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Failed to update Clerk metadata:\", error);\n      res.status(500).json({ message: \"Failed to update user metadata\" });\n    }\n  });\n\n  app.post(\"/api/register-clerk-user\", async (req, res) => {\n    try {\n      const { \n        clerkUserId, \n        firstName, \n        lastName, \n        email, \n        isHealthcareProfessional,\n        // Professional fields\n        profession,\n        professionalTitle,\n        company,\n        companyAddress,\n        companyEmail,\n        companyWebsite,\n        credentials,\n        licenseNumber,\n        yearsExperience\n      } = req.body;\n      \n      if (!clerkUserId || !email) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      // Create username from email\n      const username = email.split('@')[0] || `user_${clerkUserId.slice(-8)}`;\n\n      // Prepare user data for database\n      const userData: UpsertUser = {\n        id: clerkUserId,\n        username: username,\n        email: email,\n        firstName: firstName,\n        lastName: lastName,\n        password: \"clerk_managed_auth\", // Placeholder since Clerk manages auth\n        role: isHealthcareProfessional ? \"expert\" as UserRole : \"user\" as UserRole,\n        emailVerified: true, // Clerk handles verification\n        defaultProfileType: isHealthcareProfessional ? \"tree\" : undefined,\n      };\n\n      // Create user in our PostgreSQL database\n      const newUser = await storage.upsertUser(userData);\n      \n      // If healthcare professional, create expert verification record\n      if (isHealthcareProfessional && profession && professionalTitle && company) {\n        await storage.createExpertVerification({\n          userId: clerkUserId,\n          profession: profession,\n          professionalTitle: professionalTitle,\n          company: company,\n          companyAddress: companyAddress,\n          companyEmail: companyEmail,\n          companyWebsite: companyWebsite,\n          credentials: credentials,\n          licenseNumber: licenseNumber,\n          yearsExperience: yearsExperience,\n          verificationStatus: \"pending\", // Will need manual verification\n        });\n      }\n      \n      res.json({ \n        success: true, \n        user: {\n          id: newUser.id,\n          username: newUser.username,\n          email: newUser.email,\n          firstName: newUser.firstName,\n          lastName: newUser.lastName,\n          role: newUser.role,\n        }\n      });\n    } catch (error) {\n      console.error(\"Failed to create user in database:\", error);\n      res.status(500).json({ message: \"Failed to create user account\" });\n    }\n  });\n\n  // Check if user profile is complete\n  app.get(\"/api/profile-complete\", clerkAuthWithSync, async (req: Request, res: Response) => {\n    try {\n      // User is already attached to request by clerkAuthWithSync middleware\n      const user = req.user;\n      if (!user) {\n        return res.json({ isComplete: false, reason: \"User not found in database\" });\n      }\n\n      // Define what makes a profile \"complete\" - all required fields\n      const isComplete = !!(\n        user.firstName && \n        user.lastName &&\n        user.email &&\n        user.communityName &&\n        user.city &&\n        user.state &&\n        user.username\n      );\n\n      res.json({ \n        isComplete,\n        user: isComplete ? user : null,\n        reason: isComplete ? null : \"Missing required profile information\"\n      });\n    } catch (error) {\n      console.error(\"Failed to check profile completeness:\", error);\n      res.status(500).json({ message: \"Failed to check profile\" });\n    }\n  });\n\n  // Complete user profile after Clerk authentication\n  app.post(\"/api/complete-profile\", clerkAuthWithSync, async (req: Request, res: Response) => {\n    try {\n      // User is already attached to request by clerkAuthWithSync middleware\n      const userId = req.userId!;\n      const existingUser = req.user;\n\n      const { \n        firstName, \n        lastName, \n        username,\n        communityName, \n        city, \n        state, \n        timezone, \n        introduction,\n        isProfessional,\n        company,\n        companyWebsite,\n        companyPhone,\n        profession,\n        licenseNumber,\n        professionalAssociation,\n        // Appointment booking fields\n        allowBooking,\n        calendlyLink,\n        consultationRate\n      } = req.body;\n\n      if (!firstName || !lastName || !username || !communityName || !city || !state) {\n        return res.status(400).json({ message: \"First name, last name, username, community name, city, and state are required\" });\n      }\n\n      // Validate professional fields if user selected professional\n      if (isProfessional) {\n        if (!company || company.trim() === \"\") {\n          return res.status(400).json({ message: \"Company/Organization is required for professionals\" });\n        }\n        if (!profession || profession.trim() === \"\") {\n          return res.status(400).json({ message: \"Profession is required for professionals\" });\n        }\n        if (companyWebsite && companyWebsite.trim() !== \"\") {\n          try {\n            new URL(companyWebsite);\n          } catch {\n            return res.status(400).json({ message: \"Please enter a valid website URL\" });\n          }\n        }\n        \n        // Validate appointment booking fields\n        if (allowBooking && (!calendlyLink || calendlyLink.trim() === \"\")) {\n          return res.status(400).json({ message: \"Calendly link is required when appointment booking is enabled\" });\n        }\n\n        if (allowBooking && (!consultationRate || consultationRate.trim() === \"\")) {\n          return res.status(400).json({ message: \"Hourly consultation rate is required when appointment booking is enabled\" });\n        }\n        \n        if (calendlyLink && calendlyLink.trim() !== \"\") {\n          try {\n            const url = new URL(calendlyLink);\n            if (url.protocol !== 'https:') {\n              return res.status(400).json({ message: \"Calendly URL must use HTTPS\" });\n            }\n            if (!(url.hostname === 'calendly.com' || url.hostname.endsWith('.calendly.com'))) {\n              return res.status(400).json({ message: \"Please enter a valid Calendly URL (e.g., https://calendly.com/your-username)\" });\n            }\n          } catch {\n            return res.status(400).json({ message: \"Please enter a valid Calendly URL\" });\n          }\n        }\n\n        if (consultationRate && consultationRate.trim() !== \"\") {\n          const rate = parseFloat(consultationRate.trim());\n          if (isNaN(rate) || rate < 50 || rate > 500) {\n            return res.status(400).json({ message: \"Consultation rate must be between $50 and $500\" });\n          }\n        }\n      }\n\n      // Check if username is already taken by another user\n      if (existingUser?.username !== username) {\n        const existingUserByUsername = await storage.getUserByUsername(username);\n        if (existingUserByUsername && existingUserByUsername.id !== userId) {\n          return res.status(409).json({ message: \"Username is already taken. Please choose a different username.\" });\n        }\n      }\n\n      // Get Clerk user's email\n      const clerkUser = await clerkClient.users.getUser(userId);\n      const clerkEmail = clerkUser.emailAddresses?.[0]?.emailAddress || existingUser?.email || \"\";\n\n      // Set role and profile type based on professional status, preserving admin roles\n      const userRole: UserRole = existingUser?.role === 'admin' \n        ? 'admin' \n        : (isProfessional === true \n          ? 'expert' \n          : (isProfessional === false \n            ? 'user' \n            : (existingUser?.role ?? 'user')));\n      \n      const profileType = userRole === 'expert' \n        ? 'tree' \n        : userRole === 'admin' \n          ? (existingUser?.defaultProfileType ?? 'daisy') \n          : (isProfessional === false \n            ? 'daisy' \n            : (existingUser?.defaultProfileType ?? 'daisy'));\n\n      const userData = {\n        id: userId,\n        username: username, // Use provided username\n        email: clerkEmail, // Use Clerk email\n        password: existingUser?.password || \"clerk_managed_auth\",\n        firstName,\n        lastName,\n        communityName: communityName,\n        city: city,\n        state: state,\n        timezone: timezone || \"UTC\",\n        introduction: introduction || null,\n        role: userRole,\n        emailVerified: existingUser?.emailVerified ?? clerkUser.emailAddresses?.some(e => e.verification?.status === 'verified') ?? false,\n        profileImageUrl: existingUser?.profileImageUrl || null,\n        defaultProfileType: profileType,\n        isPremium: existingUser?.isPremium || false,\n        stripeCustomerId: existingUser?.stripeCustomerId || null,\n        stripeSubscriptionId: existingUser?.stripeSubscriptionId || null,\n      };\n\n      const updatedUser = await storage.upsertUser(userData);\n      \n      // Update Clerk metadata to match the professional status (only if role changed)\n      if (userRole !== existingUser?.role || profileType !== existingUser?.defaultProfileType) {\n        try {\n          await updateClerkUserMetadata(userId, {\n            isExpert: userRole === 'expert',\n            role: userRole,\n            defaultProfileType: profileType\n          });\n        } catch (error) {\n          console.error(\"Failed to update Clerk metadata:\", error);\n          // Don't fail the whole request if Clerk metadata update fails\n        }\n      }\n      \n      // Handle expert verification for professional users\n      let expertVerification = null;\n      if (isProfessional) {\n        try {\n          // Check if expert verification already exists\n          expertVerification = await storage.getExpertVerification(userId);\n          \n          if (expertVerification) {\n            // Update existing expert verification record with new data\n            const updateData = {\n              profession: profession || null,\n              company: company || null,\n              companyWebsite: companyWebsite || null,\n              companyPhone: companyPhone || null,\n              licenseNumber: licenseNumber || null,\n              professionalAssociation: professionalAssociation || null,\n              // Appointment booking fields\n              allowBooking: Boolean(allowBooking),\n              calendlyLink: calendlyLink || null,\n              // Consultation rate in cents\n              consultationRate: consultationRate ? Math.round(parseFloat(consultationRate) * 100) : null,\n              // Preserve existing verification status unless it's in a terminal failed state\n              ...(expertVerification.verificationStatus !== 'verified' && \n                  expertVerification.verificationStatus !== 'rejected' && {\n                verificationStatus: 'pending' as const\n              }),\n              // Reset fee status to pending if updating professional details\n              ...(expertVerification.verificationFeeStatus !== 'paid' && {\n                verificationFeeStatus: 'pending' as const\n              })\n            };\n            \n            expertVerification = await storage.updateExpertVerification(expertVerification.id, updateData);\n          } else {\n            // Create new expert verification record\n            const expertData = {\n              userId: userId,\n              profession: profession || null,\n              company: company || null,\n              companyWebsite: companyWebsite || null,\n              companyPhone: companyPhone || null,\n              licenseNumber: licenseNumber || null,\n              professionalAssociation: professionalAssociation || null,\n              // Appointment booking fields\n              allowBooking: Boolean(allowBooking),\n              calendlyLink: calendlyLink || null,\n              // Consultation rate in cents\n              consultationRate: consultationRate ? Math.round(parseFloat(consultationRate) * 100) : null,\n              verificationStatus: 'pending' as const,\n              verificationFeeStatus: 'pending' as const,\n            };\n            \n            expertVerification = await storage.createExpertVerification(expertData);\n          }\n        } catch (error) {\n          console.error(\"Failed to handle expert verification:\", error);\n          // Don't fail the whole request if expert verification fails\n        }\n      } else {\n        // Get existing expert verification if any (non-professional user)\n        try {\n          expertVerification = await storage.getExpertVerification(userId);\n        } catch (error) {\n          // Expert verification might not exist, that's ok for non-professional users\n        }\n      }\n      \n      const userWithVerification = {\n        ...updatedUser,\n        expertVerification\n      };\n      \n      res.json(userWithVerification);\n    } catch (error) {\n      console.error(\"Failed to complete profile:\", error);\n      res.status(500).json({ message: \"Failed to complete profile\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  // Setup GraphQL server\n  await createGraphQLServer(app, httpServer);\n\n  return httpServer;\n}\n\n// Helper function to generate available slots excluding busy times\nfunction generateAvailableSlotsExcludingBusy(busyTimes: any[], date: Date) {\n  const slots = [];\n  const workStart = 9; // 9 AM\n  const workEnd = 17; // 5 PM\n  const slotDuration = 30; // 30 minutes\n\n  for (let hour = workStart; hour < workEnd; hour++) {\n    for (let minute = 0; minute < 60; minute += slotDuration) {\n      const slotStart = new Date(date);\n      slotStart.setHours(hour, minute, 0, 0);\n\n      const slotEnd = new Date(slotStart);\n      slotEnd.setMinutes(slotEnd.getMinutes() + slotDuration);\n\n      // Check if this slot overlaps with any busy time\n      const isBusy = busyTimes.some((busy) => {\n        const busyStart = new Date(busy.start);\n        const busyEnd = new Date(busy.end);\n        return slotStart < busyEnd && slotEnd > busyStart;\n      });\n\n      if (!isBusy) {\n        slots.push({\n          time: `${hour.toString().padStart(2, \"0\")}:${minute.toString().padStart(2, \"0\")}`,\n          available: true,\n        });\n      }\n    }\n  }\n\n  return slots;\n}\n","size_bytes":179468},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }","size_bytes":771},"send-test-email.js":{"content":"import sgMail from '@sendgrid/mail';\n\n// Use the working API key directly\nconst apiKey = process.env.SENDGRID_ASK_EDITH_1_API_KEY;\n\nconsole.log('Setting up SendGrid...');\nsgMail.setApiKey(apiKey);\n\nconst msg = {\n  to: 'papasavvaselias50@gmail.com',\n  from: 'elias@askedith.org', // Using the verified sender\n  subject: 'AskEdith Password Reset Test',\n  text: 'This is a test email from AskEdith. Your password reset functionality is working!',\n  html: `\n    <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n      <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n        <h1 style=\"margin: 0;\">AskEdith Password Reset</h1>\n      </div>\n      <div style=\"padding: 30px; background-color: #f5f5f5;\">\n        <h2>Test Email</h2>\n        <p>This is a test email to confirm SendGrid is working correctly.</p>\n        <p>If you're seeing this, the email service is functioning properly!</p>\n        <p><strong>Sent at:</strong> ${new Date().toISOString()}</p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"https://29702bf1-770c-4095-afdd-dc8fcc65ffbb-00-1s9hnopi7aao4.worf.replit.dev/reset-password?token=test123\" \n             style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n            Test Reset Button\n          </a>\n        </div>\n      </div>\n    </div>\n  `,\n};\n\nconsole.log('Sending email to:', msg.to);\n\nsgMail\n  .send(msg)\n  .then(() => {\n    console.log('âœ“ Email sent successfully!');\n    console.log('Check your inbox at papasavvaselias50@gmail.com');\n  })\n  .catch((error) => {\n    console.error('âœ— Error:', error.message);\n    if (error.response) {\n      console.error('Details:', JSON.stringify(error.response.body, null, 2));\n    }\n  });","size_bytes":1840},"client/src/pages/landing.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Heart,\n  Shield,\n  Users,\n  MessageSquare,\n  Star,\n  CheckCircle,\n  ArrowRight,\n  Clock,\n  UserCheck,\n  Award,\n  Plus,\n  Search,\n} from \"lucide-react\";\n\nimport SignupModal from \"@/components/SignupModal\";\nimport DefaultProfilePicture from \"@/components/DefaultProfilePicture\";\nimport CategoryCard from \"@/components/CategoryCard\";\nimport { EmailAnswerForm } from \"@/components/EmailAnswerForm\";\nimport askEdithHeroImage from \"@assets/AskEdith_for_Replit.png\";\n\n// Import category images\nimport governmentImg from \"@assets/Government.jpg\";\nimport careAtHomeImg from \"@assets/care_at_home.jpg\";\nimport healthCareImg from \"@assets/health_care.jpg\";\nimport seniorLivingImg from \"@assets/new_senior_living_image.png\";\nimport professionalsImg from \"@assets/professionals.jpg\";\nimport payingForCareImg from \"@assets/paying_for_care.jpg\";\nimport ReactMarkdown from \"react-markdown\";\n\n// Map category slugs to images\nconst categoryImages: Record<string, string> = {\n  \"government-resources\": governmentImg,\n  \"home-care\": careAtHomeImg,\n  \"hospital-rehab\": healthCareImg,\n  \"family-finances\": payingForCareImg,\n  professionals: professionalsImg,\n  \"senior-living\": seniorLivingImg,\n  \"paying-for-care\": payingForCareImg,\n};\n\n// Animated Counter Component\nfunction AnimatedCounter({\n  targetValue,\n  categoryId,\n}: {\n  targetValue: number;\n  categoryId: number;\n}) {\n  const [currentValue, setCurrentValue] = useState(0);\n  const [hasAnimated, setHasAnimated] = useState(false);\n  const elementRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (hasAnimated) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && !hasAnimated) {\n          setHasAnimated(true);\n\n          const duration = 1500; // Animation duration in ms\n          const startTime = Date.now();\n          const startValue = 0;\n\n          const animate = () => {\n            const elapsed = Date.now() - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // Easing function for smooth animation\n            const easeOutQuart = 1 - Math.pow(1 - progress, 4);\n            const newValue = Math.round(\n              startValue + (targetValue - startValue) * easeOutQuart,\n            );\n\n            setCurrentValue(newValue);\n\n            if (progress < 1) {\n              requestAnimationFrame(animate);\n            }\n          };\n\n          requestAnimationFrame(animate);\n        }\n      },\n      { threshold: 0.5 },\n    );\n\n    if (elementRef.current) {\n      observer.observe(elementRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [targetValue, hasAnimated]);\n\n  return (\n    <div ref={elementRef} className=\"text-center font-medium\">\n      {currentValue.toLocaleString()}\n    </div>\n  );\n}\n\nexport default function Landing() {\n  const [signupModalOpen, setSignupModalOpen] = useState(false);\n  const [currentPhraseIndex, setCurrentPhraseIndex] = useState(0);\n  const [displayedText, setDisplayedText] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(true);\n  const [windowWidth, setWindowWidth] = useState(\n    typeof window !== \"undefined\" ? window.innerWidth : 1024,\n  );\n  const [animatedCounters, setAnimatedCounters] = useState(new Set());\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResult, setSearchResult] = useState<{\n    question: string;\n    paragraphs: string[];\n  } | null>(null);\n  const [isSearching, setIsSearching] = useState(false);\n  const [visibleParagraphs, setVisibleParagraphs] = useState<number>(0);\n  const [paragraphVisibility, setParagraphVisibility] = useState<{\n    [key: number]: boolean;\n  }>({});\n\n  // Fetch dynamic search phrases from database\n  const { data: searchPhrasesData } = useQuery<{ phrase: string }[]>({\n    queryKey: [\"/api/search-phrases\"],\n    staleTime: 30 * 60 * 1000, // 30 minutes\n  });\n\n  // Extract phrases from API response or fallback to empty array\n  const searchPhrases = searchPhrasesData?.map((item) => item.phrase) || [];\n\n  // Fetch community stats\n  const { data: stats } = useQuery({\n    queryKey: [\"/api/stats\"],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  // Fetch categories for preview\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n    staleTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  // Fetch recent posts for preview\n  const { data: recentPosts } = useQuery({\n    queryKey: [\"/api/posts\"],\n    staleTime: 2 * 60 * 1000, // 2 minutes\n  });\n\n  // Handle window resize for responsive input height\n  useEffect(() => {\n    const handleResize = () => {\n      setWindowWidth(window.innerWidth);\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  // Function to get responsive minimum height\n  const getResponsiveMinHeight = () => {\n    if (windowWidth >= 1024) return \"200px\"; // lg: screens\n    if (windowWidth >= 640) return \"180px\"; // sm: screens\n    return \"160px\"; // mobile screens\n  };\n\n  // Typewriter effect for search placeholder\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout;\n\n    if (isTyping && searchPhrases.length > 0 && !searchResult) {\n      const currentPhrase = searchPhrases[currentPhraseIndex];\n\n      if (currentPhrase && displayedText.length < currentPhrase.length) {\n        timeoutId = setTimeout(() => {\n          setDisplayedText(currentPhrase.slice(0, displayedText.length + 1));\n        }, 50);\n      } else {\n        timeoutId = setTimeout(() => {\n          setIsTyping(false);\n          setDisplayedText(\"\");\n          setCurrentPhraseIndex((prev) => (prev + 1) % searchPhrases.length);\n          setTimeout(() => setIsTyping(true), 500);\n        }, 2500);\n      }\n    }\n\n    return () => {\n      if (timeoutId) clearTimeout(timeoutId);\n    };\n  }, [\n    displayedText,\n    currentPhraseIndex,\n    isTyping,\n    searchPhrases,\n    searchResult,\n  ]);\n\n  // Trigger fade-in for new paragraphs as they arrive\n  useEffect(() => {\n    if (!searchResult) return;\n\n    // When new paragraphs arrive during streaming, fade them in\n    if (searchResult.paragraphs.length > visibleParagraphs) {\n      setVisibleParagraphs(searchResult.paragraphs.length);\n\n      // Trigger fade-in for the new paragraph after a short delay\n      const newParagraphIndex = searchResult.paragraphs.length - 1;\n      setTimeout(() => {\n        setParagraphVisibility((prev) => ({\n          ...prev,\n          [newParagraphIndex]: true,\n        }));\n      }, 50); // Small delay to ensure DOM is updated\n    }\n  }, [searchResult?.paragraphs.length, visibleParagraphs]);\n\n  // Handle search with paragraph streaming\n  const handleSearch = async (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && searchQuery.trim()) {\n      setIsSearching(true);\n      setSearchResult(null);\n      setVisibleParagraphs(0);\n      setParagraphVisibility({});\n\n      try {\n        const response = await fetch(\"/api/rag-search-stream\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ query: searchQuery }),\n        });\n\n        // Response received successfully\n\n        if (!response.ok) {\n          throw new Error(\"Failed to search\");\n        }\n\n        const reader = response.body?.getReader();\n        const decoder = new TextDecoder();\n        let fullContent = \"\";\n        let currentParagraphs: string[] = [];\n        let buffer = \"\"; // Buffer for incomplete chunks\n        let lastUpdateTime = 0;\n        const UPDATE_THROTTLE = 100; // Update UI at most every 100ms\n\n        if (reader) {\n          setSearchResult({\n            question: searchQuery,\n            paragraphs: [],\n          });\n          setSearchQuery(\"\"); // Clear search query when starting\n\n          while (true) {\n            const { done, value } = await reader.read();\n\n            if (done) break;\n\n            const chunk = decoder.decode(value, { stream: true });\n            buffer += chunk;\n\n            // Split by lines but keep incomplete lines in buffer\n            const lines = buffer.split(\"\\n\");\n            buffer = lines.pop() || \"\"; // Keep the last (potentially incomplete) line in buffer\n\n            for (const line of lines) {\n              if (line.startsWith(\"data: \")) {\n                try {\n                  const jsonStr = line.slice(6);\n                  // Skip empty lines\n                  if (!jsonStr.trim()) continue;\n\n                  // Attempt to parse JSON with better error handling\n                  let data;\n                  try {\n                    data = JSON.parse(jsonStr);\n                  } catch (firstParseError) {\n                    // If JSON parsing fails, try to clean the string and parse again\n                    console.warn(\n                      \"First JSON parse failed, attempting to clean:\",\n                      firstParseError,\n                    );\n                    try {\n                      // Replace problematic Unicode characters\n                      const cleanedJson = jsonStr\n                        .replace(/Ã¢â‚¬â„¢/g, \"'\") // Replace smart apostrophe\n                        .replace(/Ã¢â‚¬Å“/g, '\"') // Replace smart quote open\n                        .replace(/Ã¢â‚¬/g, '\"') // Replace smart quote close\n                        .replace(/Ã¢â‚¬\"/g, \"-\") // Replace em dash\n                        .replace(/Ã¢â‚¬\"/g, \"-\"); // Replace en dash\n                      data = JSON.parse(cleanedJson);\n                    } catch (secondParseError) {\n                      console.error(\n                        \"Failed to parse JSON after cleaning:\",\n                        secondParseError,\n                      );\n                      console.error(\"Original line:\", jsonStr);\n                      continue; // Skip this line and continue processing\n                    }\n                  }\n\n                  if (data.type === \"heartbeat\") {\n                    // Heartbeat received - connection established\n                    continue;\n                  } else if (data.type === \"content\") {\n                    fullContent += data.content;\n\n                    // Real-time streaming: Show content as it comes in\n\n                    // For real-time streaming, always show the current content\n                    // Split by paragraphs but also show partial content\n                    let displayParagraphs;\n\n                    if (fullContent.includes(\"\\n\\n\")) {\n                      // Try proper paragraph splits first\n                      displayParagraphs = fullContent\n                        .split(\"\\n\\n\")\n                        .filter((p) => p.trim());\n                    } else if (\n                      fullContent.includes(\"\\n\") &&\n                      fullContent.length > 100\n                    ) {\n                      // Split by single newlines for medium content\n                      displayParagraphs = fullContent\n                        .split(\"\\n\")\n                        .filter((p) => p.trim());\n                    } else {\n                      // Show as single block for short content\n                      displayParagraphs = [fullContent.trim()];\n                    }\n\n                    // Throttle updates for smoother streaming\n                    const now = Date.now();\n                    if (\n                      fullContent.trim() &&\n                      now - lastUpdateTime > UPDATE_THROTTLE\n                    ) {\n                      lastUpdateTime = now;\n                      setSearchResult((prev) =>\n                        prev\n                          ? {\n                              ...prev,\n                              paragraphs: displayParagraphs,\n                            }\n                          : null,\n                      );\n\n                      // Show all available paragraphs immediately\n                      setVisibleParagraphs(displayParagraphs.length);\n                    }\n                  } else if (data.type === \"error\") {\n                    throw new Error(data.error || \"Streaming error\");\n                  } else if (data.type === \"end\") {\n                    // Final cleanup - make sure all content is included\n                    const finalParagraphs = fullContent\n                      .split(\"\\n\")\n                      .filter((p) => p.trim());\n                    if (finalParagraphs.length > 0) {\n                      setSearchResult((prev) =>\n                        prev\n                          ? {\n                              ...prev,\n                              paragraphs: finalParagraphs,\n                            }\n                          : null,\n                      );\n                    }\n                    break;\n                  }\n                } catch (parseError) {\n                  console.error(\"Error parsing streaming data:\", parseError);\n                  // Continue processing other lines even if one fails\n                }\n              }\n            }\n          }\n\n          // Process any remaining buffer content\n          if (buffer.trim() && buffer.startsWith(\"data: \")) {\n            try {\n              const jsonStr = buffer.slice(6);\n              if (jsonStr.trim()) {\n                let data;\n                try {\n                  data = JSON.parse(jsonStr);\n                } catch (firstParseError) {\n                  console.warn(\"Final buffer parse failed:\", firstParseError);\n                  const cleanedJson = jsonStr\n                    .replace(/Ã¢â‚¬â„¢/g, \"'\")\n                    .replace(/Ã¢â‚¬Å“/g, '\"')\n                    .replace(/Ã¢â‚¬/g, '\"')\n                    .replace(/Ã¢â‚¬\"/g, \"-\")\n                    .replace(/Ã¢â‚¬\"/g, \"-\");\n                  data = JSON.parse(cleanedJson);\n                }\n\n                // Handle final data chunk (similar logic as above)\n                if (data.type === \"content\") {\n                  fullContent += data.content;\n                  const finalParagraphs = fullContent\n                    .split(\"\\n\")\n                    .filter((p) => p.trim());\n                  if (finalParagraphs.length > 0) {\n                    setSearchResult((prev) =>\n                      prev\n                        ? {\n                            ...prev,\n                            paragraphs: finalParagraphs,\n                          }\n                        : null,\n                    );\n                  }\n                }\n              }\n            } catch (bufferError) {\n              console.error(\"Error processing final buffer:\", bufferError);\n            }\n          }\n        }\n      } catch (error) {\n        console.error(\"Search error:\", error);\n        setSearchResult({\n          question: searchQuery,\n          paragraphs: [\n            \"I'm having trouble searching right now. Please try again later or contact our support team.\",\n          ],\n        });\n        setSearchQuery(\"\"); // Clear search query after error\n      } finally {\n        setIsSearching(false);\n      }\n    }\n  };\n\n  return (\n    <div id=\"scrollhere\" className=\"min-h-screen bg-gray-50\">\n      {/* Welcome Hero - Split Screen Design */}\n      <section className=\"relative\" style={{ minHeight: \"100vh\" }}>\n        <div className=\"flex flex-col lg:flex-row min-h-screen\">\n          {/* Left Side - Journey Together */}\n          <div className=\"flex-1 flex items-center justify-center bg-[#0B666B] relative min-h-screen pb-12 px-4 sm:px-6 lg:px-8\">\n            <div\n              style={{\n                width: \"80%\",\n                maxWidth: \"900px\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              <div style={{ marginBottom: \"2rem\" }}>\n                {/* Cache bust: Updated Jan 29 2025 */}\n                <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight text-center\">\n                  Journey Together.\n                </h1>\n\n                <p className=\"text-lg sm:text-xl text-white/90 leading-relaxed text-center\">\n                  AskEdith is your Guide to retirement and caregiving. Share and\n                  learn in Forums, access curated News, and consult with Experts\n                  for a stronger retirement.\n                </p>\n              </div>\n\n              <div className=\"relative w-full sm:w-11/12 lg:w-11/12 mx-auto\">\n                <Search className=\"absolute left-4 sm:left-8 top-6 h-8 w-8 sm:h-10 sm:w-10 text-teal-200\" />\n                <div\n                  className=\"w-full h-full rounded-3xl border-0 bg-white/95 backdrop-blur-sm shadow-lg overflow-hidden\"\n                  style={{ position: \"relative\" }}\n                >\n                  <div className=\"w-full h-full pl-8 sm:pl-12 pr-8 sm:pr-12 pt-6 pb-6\">\n                    {!searchResult ? (\n                      <textarea\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && !e.shiftKey) {\n                            e.preventDefault();\n                            handleSearch(e as any);\n                            // scroll page to top smoothly\n                            window.scrollTo({ top: 0, behavior: \"smooth\" });\n                          }\n                        }}\n                        disabled={isSearching}\n                        placeholder={displayedText}\n                        className=\"w-full min-h-full border-0 bg-transparent focus:outline-none placeholder-gray-500 resize-none text-lg sm:text-2xl\"\n                        style={{\n                          lineHeight: \"1.5\",\n                          minHeight: getResponsiveMinHeight(),\n                        }}\n                      />\n                    ) : (\n                      <div className=\"h-full flex flex-col\">\n                        <div\n                          className=\"flex-1 overflow-y-auto\"\n                          style={{\n                            scrollbarWidth: \"thin\",\n                            scrollbarColor: \"#0B666B30 transparent\",\n                          }}\n                        >\n                          <div\n                            style={{ fontSize: \"1.125em\", lineHeight: \"1.5\" }}\n                          >\n                            <div className=\"text-gray-600 mb-4\">\n                              <span className=\"font-semibold\">\n                                Your question:\n                              </span>{\" \"}\n                              {searchResult.question}\n                            </div>\n                            <div>\n                              <span className=\"font-semibold text-gray-600\">\n                                Answer:\n                              </span>\n                              <div className=\"mt-2 prose max-w-none space-y-4 streaming-content\">\n                                {searchResult.paragraphs.map(\n                                  (paragraph, index) => (\n                                    <div\n                                      key={`paragraph-${index}`}\n                                      className=\"paragraph-fade-in visible\"\n                                      style={{\n                                        fontSize: \"1.1rem\",\n                                        lineHeight: \"1.7\",\n                                        color: \"#374151\",\n                                        marginBottom: \"1.5rem\",\n                                      }}\n                                    >\n                                      <ReactMarkdown>{paragraph}</ReactMarkdown>\n                                    </div>\n                                  ),\n                                )}\n                              </div>\n                            </div>\n\n                            {/* Email Answer Form - Only show when response is complete */}\n                            {!isSearching &&\n                              searchResult.paragraphs.length > 0 && (\n                                <div className=\"mt-6\">\n                                  <EmailAnswerForm\n                                    question={searchResult.question}\n                                    answer={searchResult.paragraphs.join(\n                                      \"\\n\\n\",\n                                    )}\n                                    onEmailSent={() => {\n                                      console.log(\n                                        \"Email sent successfully from landing page\",\n                                      );\n                                    }}\n                                  />\n                                </div>\n                              )}\n                          </div>\n                        </div>\n                        <div className=\"mt-4 pt-4 border-t border-gray-200\">\n                          {/* <input\n                            type=\"text\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\") {\n                                e.preventDefault();\n                                handleSearch(e as any);\n                              }\n                            }}\n                            placeholder=\"Ask another question...\"\n                            className=\"w-full border-0 bg-transparent focus:outline-none placeholder-gray-400 placeholder:font-bold placeholder:text-lg font-bold text-lg\"\n                            style={{ fontSize: \"0.75em\" }}\n                          /> */}\n                          <input\n                            type=\"text\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            onKeyDown={(e) => {\n                              if (e.key === \"Enter\") {\n                                e.preventDefault(); // stop default submit/scroll\n                                handleSearch(e as any);\n                                // keep page from scrolling down\n                                window.scrollTo({ top: 0, behavior: \"smooth\" });\n                              }\n                            }}\n                            placeholder=\"Ask another question...\"\n                            className=\"w-full border-0 bg-transparent \n                            focus:outline-none placeholder:text-base text-lg font-medium\"\n                          />\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {isSearching && (\n                <div className=\"mt-6 text-center\">\n                  <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div>\n                  <p className=\"text-white/80 mt-2\">Searching for answers...</p>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right Side - AskEdith Branding */}\n          <div\n            className=\"flex-1 flex flex-col items-center justify-center h-full relative overflow-hidden sticky top-0 pt-12 pb-12\"\n            style={{ backgroundColor: \"#fefbed\", height: \"100vh\" }}\n          >\n            <img\n              src={askEdithHeroImage}\n              alt=\"AskEdith\"\n              className=\"max-w-full max-h-[70%] object-contain\"\n              style={{ marginTop: \"-10px\", clipPath: \"inset(10px 0 0 0)\" }}\n            />\n            <h2 className=\"text-2xl md:text-3xl font-light text-gray-700 mt-4 text-center px-4\">\n              All Things Retirement. All Things Care.\n            </h2>\n          </div>\n        </div>\n      </section>\n\n      {/* Three Key Features */}\n      <section id=\"features\" className=\"py-24 bg-white relative z-10\">\n        <div className=\"w-full px-[30px]\">\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {/* Authentic Stories */}\n            <div className=\"text-center p-6\">\n              <div className=\"w-16 h-16 mx-auto mb-6 rounded-2xl flex items-center justify-center text-white font-bold text-lg bg-[#0B666B]/90\">\n                Real\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n                Authentic Stories\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                We bring together the nation's foremost experts, bloggers,\n                authors, podcasters, and influencers to share their insights and\n                experiences on all things retirement and all things caregiving.\n              </p>\n            </div>\n\n            {/* Always Here */}\n            <div className=\"text-center p-6\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-6 rounded-2xl flex items-center justify-center text-white font-bold text-lg\"\n                style={{ backgroundColor: \"hsl(var(--coral-primary))\" }}\n              >\n                24/7\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n                Always Here\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                Community support around the clock when you need it most\n              </p>\n            </div>\n\n            {/* Protected Space */}\n            <div className=\"text-center p-6\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-6 rounded-2xl flex items-center justify-center text-white font-bold text-lg\"\n                style={{ backgroundColor: \"#4A85D6\" }}\n              >\n                Safe\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">\n                Protected Space\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                Verified community with privacy protection and moderation\n              </p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Safety Guidelines Banner */}\n      <section\n        className=\"py-6\"\n        style={{ backgroundColor: \"hsl(var(--cream-primary))\" }}\n      >\n        <div className=\"px-[30px]\">\n          <div\n            className=\"bg-white rounded-2xl p-6 border-l-4\"\n            style={{ borderColor: \"hsl(var(--gold-primary))\" }}\n          >\n            <div className=\"flex items-start space-x-3\">\n              <div\n                className=\"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold\"\n                style={{ backgroundColor: \"hsl(var(--gold-primary))\" }}\n              >\n                !\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900 mb-2\">\n                  Community Safety Guidelines\n                </h3>\n                <div className=\"space-y-1 text-sm text-gray-600\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Shield className=\"w-4 h-4\" />\n                    <span>\n                      All discussions are public and moderated for safety\n                    </span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <UserCheck className=\"w-4 h-4\" />\n                    <span>\n                      Never share personal contact information (emails, phone\n                      numbers)\n                    </span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <CheckCircle className=\"w-4 h-4\" />\n                    <span>\n                      External links include safety warnings - verify sources\n                      before sharing personal information\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Community Stats - Hidden */}\n      {false && <section className=\"py-16 bg-white\">\n        <div className=\"px-[30px] text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 mb-12\">\n            Our Growing Community\n          </h2>\n\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6 md:gap-8\">\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#E8D5F3\" }}\n              >\n                <Users className=\"w-8 h-8\" style={{ color: \"#8B7ED8\" }} />\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900 mb-1\">\n                <AnimatedCounter targetValue={12450} categoryId={1001} />\n              </div>\n              <div className=\"text-gray-600\">Active Caregivers</div>\n            </div>\n\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#D6E9FF\" }}\n              >\n                <MessageSquare\n                  className=\"w-8 h-8\"\n                  style={{ color: \"#4A85D6\" }}\n                />\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900 mb-1\">\n                <AnimatedCounter targetValue={3280} categoryId={1002} />\n              </div>\n              <div className=\"text-gray-600\">Daily Discussions</div>\n            </div>\n\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#D6F3E8\" }}\n              >\n                <Heart className=\"w-8 h-8\" style={{ color: \"#7CB99B\" }} />\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900 mb-1\">\n                <AnimatedCounter targetValue={580} categoryId={1003} />\n              </div>\n              <div className=\"text-gray-600\">Support Groups</div>\n            </div>\n\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#FFF3D6\" }}\n              >\n                <Award className=\"w-8 h-8\" style={{ color: \"#E6B85C\" }} />\n              </div>\n              <div className=\"text-3xl font-bold text-gray-900 mb-1\">\n                <span className=\"inline-flex items-center\">\n                  <AnimatedCounter targetValue={95} categoryId={1004} />\n                  <span>%</span>\n                </span>\n              </div>\n              <div className=\"text-gray-600\">Questions Answered</div>\n            </div>\n          </div>\n        </div>\n      </section>}\n\n      {/* Community Categories Preview - Hidden */}\n      {false && <section\n        id=\"community-preview\"\n        className=\"py-16\"\n        style={{ backgroundColor: \"hsl(var(--cream-primary))\" }}\n      >\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n              A Community for All Things Retirement & All Things Caregiving\n            </h2>\n            <p className=\"text-xl text-gray-600 max-w-3xl mx-auto\">\n              Whether thinking about retirement or in retirement. Whether\n              planning to care or caring for someone. AskEdith is an organized\n              community with curated topics, expert voices, and resources, to\n              help you engage and hear from others navigating retirement and\n              caring.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {/* Retirement Categories */}\n            <CategoryCard\n              category={{\n                id: 270,\n                name: \"Pension Plans\",\n                slug: \"pension-plans\",\n                description: \"Information and discussions about pension plans\",\n                postCount: 0,\n              }}\n              categoryImage={governmentImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/pension-plans`)\n              }\n            />\n            <CategoryCard\n              category={{\n                id: 271,\n                name: \"401Ks & IRAs\",\n                slug: \"401k-iras\",\n                description: \"Retirement account discussions and guidance\",\n                postCount: 0,\n              }}\n              categoryImage={payingForCareImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/401k-iras`)\n              }\n            />\n            <CategoryCard\n              category={{\n                id: 272,\n                name: \"Accessory Dwelling Units\",\n                slug: \"accessory-dwelling-units\",\n                description: \"ADUs, granny flats, and aging in place solutions\",\n                postCount: 0,\n              }}\n              categoryImage={seniorLivingImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/accessory-dwelling-units`)\n              }\n            />\n\n            {/* Caregiving Categories */}\n            <CategoryCard\n              category={{\n                id: 183,\n                name: \"Senior Living\",\n                slug: \"senior-living\",\n                description:\n                  \"Assisted living, memory care, and housing decisions for aging parents.\",\n                postCount: 0,\n              }}\n              categoryImage={seniorLivingImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/senior-living`)\n              }\n            />\n            <CategoryCard\n              category={{\n                id: 184,\n                name: \"Home Care\",\n                slug: \"home-care\",\n                description:\n                  \"In-home caregiving, daily routines, and managing care at home.\",\n                postCount: 0,\n              }}\n              categoryImage={careAtHomeImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/home-care`)\n              }\n            />\n            <CategoryCard\n              category={{\n                id: 185,\n                name: \"Government Resources\",\n                slug: \"government-resources\",\n                description:\n                  \"Medicare, Medicaid, benefits, and navigating government programs.\",\n                postCount: 0,\n              }}\n              categoryImage={governmentImg}\n              onJoinClick={() => setSignupModalOpen(true)}\n              onExploreClick={() =>\n                (window.location.href = `/category/government-resources`)\n              }\n            />\n          </div>\n\n          {/* And Much More Button */}\n          <div className=\"text-center mt-8\">\n            <Button\n              variant=\"outline\"\n              className=\"px-8 py-3 text-lg font-semibold border-askEdithTeal text-askEdithTeal hover:bg-askEdithTeal hover:text-white\"\n              onClick={() => setSignupModalOpen(true)}\n            >\n              And Much More\n            </Button>\n          </div>\n        </div>\n      </section>}\n\n      {/* Call to Action - Hidden */}\n      {false && <section className=\"py-16 bg-white\">\n        <div className=\"px-[30px] text-center\">\n          <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n            Ready to Connect?\n          </h2>\n          <p className=\"text-xl text-gray-600 mb-8\">\n            Join us. Hear from Others. Share with Others.\"\"\n          </p>\n\n          <Button\n            size=\"lg\"\n            className=\"text-white px-8 py-4 rounded-xl font-semibold text-lg bg-[#0B666B]/95 hover:bg-[#0B666B]\"\n            onClick={() => setSignupModalOpen(true)}\n          >\n            <MessageSquare className=\"w-5 h-5 mr-2\" />\n            Start a New Discussion\n          </Button>\n        </div>\n      </section>}\n\n      {/* Community Values - Hidden */}\n      {false && <section\n        className=\"py-16\"\n        style={{ backgroundColor: \"hsl(var(--cream-primary))\" }}\n      >\n        <div className=\"px-[30px]\">\n          <h2 className=\"text-3xl font-bold text-gray-900 text-center mb-12\">\n            Our Community Values\n          </h2>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-6 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#E8D5F3\" }}\n              >\n                <Heart className=\"w-8 h-8\" style={{ color: \"#8B7ED8\" }} />\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-3\">\n                Compassion First\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                Your journey is unique. We listen without judgment and as a\n                community share knowledge with a positive vibes.\n              </p>\n            </div>\n\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-6 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#FFE8D6\" }}\n              >\n                <Shield className=\"w-8 h-8\" style={{ color: \"#E6845C\" }} />\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-3\">\n                Safe Space\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                Our community maintains strict privacy and safety guidelines to\n                protect all members.\n              </p>\n            </div>\n\n            <div className=\"text-center\">\n              <div\n                className=\"w-16 h-16 mx-auto mb-6 rounded-full flex items-center justify-center\"\n                style={{ backgroundColor: \"#E8D5F3\" }}\n              >\n                <Users className=\"w-8 h-8\" style={{ color: \"#8B7ED8\" }} />\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 mb-3\">\n                Stronger Together\n              </h3>\n              <p className=\"text-gray-600 leading-relaxed\">\n                Sharing experts' insights, community members' experiences to\n                help you have a stronger journey.\n              </p>\n            </div>\n          </div>\n        </div>\n      </section>}\n\n      {/* Recent Discussions - Hidden */}\n      {false && <section className=\"py-16 bg-white\">\n        <div className=\"px-[30px]\">\n          <div className=\"flex justify-between items-center mb-8\">\n            <h2 className=\"text-3xl font-bold text-gray-900\">\n              Recent Discussions\n            </h2>\n            <Button\n              variant=\"outline\"\n              className=\"text-gray-600 hover:text-gray-900\"\n            >\n              View All Discussions\n            </Button>\n          </div>\n\n          <div className=\"space-y-6\">\n            {Array.isArray(recentPosts) && recentPosts.length > 0 ? (\n              recentPosts.slice(0, 3).map((post: any) => (\n                <div\n                  key={post.id}\n                  className=\"border border-gray-200 rounded-lg p-6 hover:shadow-sm transition-shadow\"\n                >\n                  <div className=\"flex items-start space-x-4\">\n                    {post.author?.profileImageUrl ? (\n                      <img\n                        src={post.author.profileImageUrl}\n                        alt={post.author.communityName || \"User\"}\n                        className=\"w-10 h-10 rounded-full object-cover\"\n                      />\n                    ) : (\n                      <DefaultProfilePicture\n                        type={post.author?.defaultProfileType || \"daisy\"}\n                        size={40}\n                        className=\"rounded-full\"\n                      />\n                    )}\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-2 mb-2\">\n                        <span\n                          className=\"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium\"\n                          style={{\n                            backgroundColor:\n                              post.category?.slug === \"government-resources\"\n                                ? \"#F4B94220\"\n                                : post.category?.slug === \"home-care\"\n                                  ? \"#D2524C20\"\n                                  : post.category?.slug === \"hospital-rehab\"\n                                    ? \"#7BB46D20\"\n                                    : post.category?.slug === \"senior-living\"\n                                      ? \"#E67E2220\"\n                                      : post.category?.slug ===\n                                          \"professional-advice\"\n                                        ? \"#4ECDC420\"\n                                        : post.category?.slug ===\n                                            \"paying-for-care\"\n                                          ? \"#0B666B20\"\n                                          : \"#E5E7EB\",\n                            color:\n                              post.category?.slug === \"government-resources\"\n                                ? \"#F4B942\"\n                                : post.category?.slug === \"home-care\"\n                                  ? \"#D2524C\"\n                                  : post.category?.slug === \"hospital-rehab\"\n                                    ? \"#7BB46D\"\n                                    : post.category?.slug === \"senior-living\"\n                                      ? \"#E67E22\"\n                                      : post.category?.slug ===\n                                          \"professional-advice\"\n                                        ? \"#4ECDC4\"\n                                        : post.category?.slug ===\n                                            \"paying-for-care\"\n                                          ? \"#0B666B\"\n                                          : \"#6B7280\",\n                          }}\n                        >\n                          {post.category?.name || \"General\"}\n                        </span>\n                        {post.isResolved && (\n                          <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                            Resolved\n                          </span>\n                        )}\n                      </div>\n\n                      <h3 className=\"font-semibold text-gray-900 mb-2 text-lg leading-tight\">\n                        {post.title}\n                      </h3>\n\n                      <p className=\"text-gray-600 text-sm mb-3 leading-relaxed line-clamp-2\">\n                        {post.content.length > 150\n                          ? `${post.content.substring(0, 150)}...`\n                          : post.content}\n                      </p>\n\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center space-x-1 text-xs text-gray-500\">\n                          <span>\n                            {post.author?.communityName ||\n                              post.author?.firstName ||\n                              \"Anonymous\"}\n                          </span>\n                          <span>â€¢</span>\n                          <span>\n                            {new Date(post.createdAt).toLocaleDateString()}\n                          </span>\n                        </div>\n\n                        <div className=\"flex items-center space-x-4 text-xs text-gray-500\">\n                          <div className=\"flex items-center space-x-1\">\n                            <MessageSquare className=\"w-4 h-4\" />\n                            <span>{post.commentCount || 0}</span>\n                          </div>\n                          <div className=\"flex items-center space-x-1\">\n                            <Heart className=\"w-4 h-4\" />\n                            <span>{post.helpfulVotes || 0}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))\n            ) : (\n              <div className=\"text-center py-12\">\n                <MessageSquare className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                  No discussions yet\n                </h3>\n                <p className=\"text-gray-500 mb-4\">\n                  Be the first to start a conversation!\n                </p>\n                <Button onClick={() => setSignupModalOpen(true)}>\n                  Start First Discussion\n                </Button>\n              </div>\n            )}\n          </div>\n\n          {Array.isArray(recentPosts) && recentPosts.length > 0 && (\n            <div className=\"text-center mt-8\">\n              <Button\n                size=\"lg\"\n                className=\"text-white px-8 py-4 rounded-xl font-semibold text-lg\"\n                style={{ backgroundColor: \"#8B7ED8\" }}\n                onClick={() => setSignupModalOpen(true)}\n              >\n                <Plus className=\"w-5 h-5 mr-2\" />\n                Start a New Discussion\n              </Button>\n            </div>\n          )}\n        </div>\n      </section>}\n\n      {/* Footer */}\n      <footer className=\"py-8 bg-gray-50 border-t border-gray-200\">\n        <div className=\"px-[30px] text-center\">\n          <p className=\"text-sm text-gray-600\">\n            copyright 2025 askedith. all rights reserved.\n          </p>\n        </div>\n      </footer>\n\n      <SignupModal\n        open={signupModalOpen}\n        onClose={() => setSignupModalOpen(false)}\n      />\n    </div>\n  );\n}\n","size_bytes":46662},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","size_bytes":894},"client/src/pages/AdminDashboard.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, X, ExternalLink } from \"lucide-react\"; // Import ExternalLink\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface Application {\n  id: number;\n  profession: string;\n  credentials?: string;\n  bio?: string;\n  createdAt: string;\n  profileImageUrl?: string; // Add profileImageUrl\n  licenseFileUrl?: string;  // Add licenseFileUrl\n  user: {\n    id: string;\n    firstName: string;\n    lastName: string;\n    email: string;\n  };\n}\n\nexport default function AdminDashboard() {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const { data: applications = [], isLoading, error } = useQuery<Application[]>({\n    queryKey: ['/api/admin/expert-applications'],\n  });\n\n  const reviewMutation = useMutation({\n    mutationFn: ({ id, status }: { id: number; status: 'verified' | 'rejected' }) => \n      apiRequest('POST', `/api/admin/expert-applications/${id}/review`, { status }),\n    onSuccess: (data: any, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/expert-applications'] });\n      \n      // Explicitly invalidate the specific expert profile if we have the userId\n      if (data?.application?.userId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/experts', data.application.userId, 'profile'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/experts', data.application.userId] });\n        queryClient.invalidateQueries({ queryKey: ['/api/posts/user', data.application.userId] });\n        queryClient.invalidateQueries({ queryKey: ['/api/posts/by-author', data.application.userId] });\n      }\n      \n      // Invalidate ALL expert-related queries (list, details, profiles) - same broad pattern as user approval\n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          query.queryKey[0] === '/api/experts'\n      });\n      // Invalidate ALL post queries (list and details with expert badges)  \n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          query.queryKey[0] === '/api/posts' || query.queryKey[0] === '/api/posts/user' || query.queryKey[0] === '/api/posts/by-author'\n      });\n      // Invalidate user profile queries that may show expert status\n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          typeof query.queryKey[0] === 'string' && \n          query.queryKey[0].startsWith('/api/users')\n      });\n      toast({\n        title: \"Application Reviewed\",\n        description: \"The application status has been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Review Failed\",\n        description: error.message || \"Could not update application status.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return <div>Loading applications...</div>;\n  }\n\n  if (error) {\n    return <div className=\"text-red-500\">Error fetching applications: {error.message}</div>;\n  }\n\n  return (\n    <div className=\"container mx-auto py-8\">\n      {/* Admin Navigation */}\n      <div className=\"mb-6 flex gap-4\">\n        <a \n          href=\"/admin/dashboard\" \n          className=\"px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700\"\n        >\n          Expert Applications\n        </a>\n        <a \n          href=\"/admin/content-sources\" \n          className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300\"\n        >\n          Content Sources\n        </a>\n        <a \n          href=\"/admin/search-logs\" \n          className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300\"\n        >\n          Search Analytics\n        </a>\n        <a \n          href=\"/admin/social-media-embeds\" \n          className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300\"\n        >\n          Social Media Embeds\n        </a>\n      </div>\n      \n      <Card>\n        <CardHeader>\n          <CardTitle>Expert Application Review</CardTitle>\n          <CardDescription>\n            Review and approve or reject pending expert applications.\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {applications.length === 0 ? (\n              <p className=\"text-gray-500\">No pending applications.</p>\n            ) : (\n              applications.map((app) => (\n                <Card key={app.id} className=\"p-4\">\n                  <div className=\"flex justify-between items-start\">\n                    <div>\n                      <h3 className=\"font-semibold\">{app.user.firstName} {app.user.lastName} - <span className=\"font-normal\">{app.profession}</span></h3>\n                      <p className=\"text-sm text-gray-500\">{app.user.email}</p>\n                      <p className=\"text-sm mt-2\"><strong>Bio:</strong> {app.bio}</p>\n                      <p className=\"text-sm mt-1\"><strong>Credentials:</strong> {app.credentials}</p>\n                      \n                      {/* Display profile image and license file URLs */}\n                      <div className=\"mt-2 space-y-1\">\n                        {app.profileImageUrl && (\n                          <p className=\"text-sm text-gray-600 flex items-center\">\n                            <strong>Profile Image:</strong>\n                            <a href={app.profileImageUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"ml-2 text-blue-600 hover:underline flex items-center\">\n                              View <ExternalLink className=\"w-3 h-3 ml-1\" />\n                            </a>\n                          </p>\n                        )}\n                        {app.licenseFileUrl && (\n                          <p className=\"text-sm text-gray-600 flex items-center\">\n                            <strong>License File:</strong>\n                            <a href={app.licenseFileUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"ml-2 text-blue-600 hover:underline flex items-center\">\n                              View <ExternalLink className=\"w-3 h-3 ml-1\" />\n                            </a>\n                          </p>\n                        )}\n                      </div>\n\n                      <p className=\"text-xs text-gray-400 mt-2\">Submitted on: {new Date(app.createdAt).toLocaleDateString()}</p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"border-green-500 text-green-500 hover:bg-green-50 hover:text-green-600\"\n                        onClick={() => reviewMutation.mutate({ id: app.id, status: 'verified' })}\n                        disabled={reviewMutation.isPending}\n                      >\n                        <Check className=\"w-4 h-4 mr-2\" />\n                        Approve\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"destructive\"\n                        onClick={() => reviewMutation.mutate({ id: app.id, status: 'rejected' })}\n                        disabled={reviewMutation.isPending}\n                      >\n                        <X className=\"w-4 h-4 mr-2\" />\n                        Reject\n                      </Button>\n                    </div>\n                  </div>\n                </Card>\n              ))\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":7777},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/pages/auth-page.tsx":{"content":"import {\n  SignIn,\n  SignUp,\n  useUser,\n  SignedOut,\n  SignedIn,\n} from \"@clerk/clerk-react\";\nimport { useState } from \"react\";\nimport { Redirect } from \"wouter\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Heart, Users, Shield, Star } from \"lucide-react\";\n\nexport default function AuthPage() {\n  const { isSignedIn, isLoaded } = useUser();\n  const [activeTab, setActiveTab] = useState(\"login\");\n\n  // Redirect if already authenticated\n  if (isLoaded && isSignedIn) {\n    return <Redirect to=\"/\" />;\n  }\n\n  // Show loading spinner while Clerk is loading\n  if (!isLoaded) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-orange-50\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"grid lg:grid-cols-2 gap-12 items-center min-h-screen\">\n          {/* Left side - Hero content */}\n          <div className=\"space-y-8\">\n            <div className=\"text-center lg:text-left\">\n              <h1 className=\"text-4xl lg:text-5xl font-bold text-gray-800 mb-4\">\n                Welcome to <span className=\"text-teal-600\">AskEdith</span>\n              </h1>\n              <p className=\"text-xl text-gray-600 mb-8\">\n                Your compassionate community for family caregivers. Get expert\n                advice, share experiences, and find the support you need.\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\n                <div className=\"flex items-center mb-3\">\n                  <Heart className=\"h-6 w-6 text-teal-600 mr-3\" />\n                  <h3 className=\"font-semibold text-gray-800\">\n                    Expert Guidance\n                  </h3>\n                </div>\n                <p className=\"text-gray-600 text-sm\">\n                  Connect with verified healthcare professionals and caregiving\n                  experts\n                </p>\n              </div>\n\n              <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\n                <div className=\"flex items-center mb-3\">\n                  <Users className=\"h-6 w-6 text-teal-600 mr-3\" />\n                  <h3 className=\"font-semibold text-gray-800\">\n                    Supportive Community\n                  </h3>\n                </div>\n                <p className=\"text-gray-600 text-sm\">\n                  Share experiences with other family caregivers who understand\n                  your journey\n                </p>\n              </div>\n\n              <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\n                <div className=\"flex items-center mb-3\">\n                  <Shield className=\"h-6 w-6 text-teal-600 mr-3\" />\n                  <h3 className=\"font-semibold text-gray-800\">\n                    Safe & Private\n                  </h3>\n                </div>\n                <p className=\"text-gray-600 text-sm\">\n                  Your privacy is protected with secure, confidential\n                  discussions\n                </p>\n              </div>\n\n              <div className=\"bg-white rounded-lg p-6 shadow-sm border border-gray-100\">\n                <div className=\"flex items-center mb-3\">\n                  <Star className=\"h-6 w-6 text-teal-600 mr-3\" />\n                  <h3 className=\"font-semibold text-gray-800\">\n                    Trusted Resources\n                  </h3>\n                </div>\n                <p className=\"text-gray-600 text-sm\">\n                  Access curated resources and evidence-based caregiving\n                  information\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Right side - Clerk Auth components */}\n          <div className=\"flex justify-center\">\n            <Card className=\"w-full max-w-md shadow-lg border-0\">\n              <CardHeader className=\"text-center pb-4\">\n                <CardTitle className=\"text-2xl font-bold text-gray-800\">\n                  Join AskEdith\n                </CardTitle>\n                <CardDescription className=\"text-gray-600\">\n                  Create your account or sign in to get started\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <SignedOut>\n                  <Tabs value={activeTab} onValueChange={setActiveTab}>\n                    <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n                      <TabsTrigger value=\"login\" data-testid=\"tab-signin\">\n                        Sign In\n                      </TabsTrigger>\n                      <TabsTrigger value=\"register\" data-testid=\"tab-signup\">\n                        Join Now\n                      </TabsTrigger>\n                    </TabsList>\n\n                    <TabsContent value=\"login\">\n                      <div\n                        className=\"flex justify-center\"\n                        data-testid=\"clerk-signin-container\"\n                      >\n                        <SignIn\n                          fallbackRedirectUrl=\"/\"\n                          signUpUrl=\"/auth\"\n                          appearance={{\n                            elements: {\n                              formButtonPrimary:\n                                \"bg-teal-600 hover:bg-teal-700 text-white\",\n                              card: \"shadow-none border-0 w-full\",\n                              headerTitle: \"hidden\",\n                              headerSubtitle: \"hidden\",\n                              socialButtonsBlockButton:\n                                \"border border-gray-300 text-gray-700 hover:bg-gray-50 w-full mb-2\",\n                              socialButtonsBlockButtonText: \"text-gray-700\",\n                              formFieldInput:\n                                \"border-gray-300 focus:border-teal-500 focus:ring-teal-500\",\n                              footerActionLink:\n                                \"text-teal-600 hover:text-teal-700\",\n                              dividerLine: \"bg-gray-200\",\n                              dividerText: \"text-gray-500\",\n                              socialButtonsProviderIcon: \"w-4 h-4\",\n                            },\n                            layout: {\n                              socialButtonsPlacement: \"top\",\n                              showOptionalFields: false,\n                            },\n                          }}\n                        />\n                      </div>\n                    </TabsContent>\n\n                    <TabsContent value=\"register\">\n                      <div\n                        className=\"flex justify-center\"\n                        data-testid=\"clerk-signup-container\"\n                      >\n                        <SignUp\n                          fallbackRedirectUrl=\"/\"\n                          signInUrl=\"/auth\"\n                          appearance={{\n                            elements: {\n                              formButtonPrimary:\n                                \"bg-teal-600 hover:bg-teal-700 text-white\",\n                              card: \"shadow-none border-0 w-full\",\n                              headerTitle: \"hidden\",\n                              headerSubtitle: \"hidden\",\n                              socialButtonsBlockButton:\n                                \"border border-gray-300 text-gray-700 hover:bg-gray-50 w-full mb-2\",\n                              socialButtonsBlockButtonText: \"text-gray-700\",\n                              formFieldInput:\n                                \"border-gray-300 focus:border-teal-500 focus:ring-teal-500\",\n                              footerActionLink:\n                                \"text-teal-600 hover:text-teal-700\",\n                              dividerLine: \"bg-gray-200\",\n                              dividerText: \"text-gray-500\",\n                              socialButtonsProviderIcon: \"w-4 h-4\",\n                            },\n                            layout: {\n                              socialButtonsPlacement: \"top\",\n                              showOptionalFields: false,\n                            },\n                          }}\n                        />\n                      </div>\n                    </TabsContent>\n                  </Tabs>\n                </SignedOut>\n\n                <SignedIn>\n                  <div className=\"text-center\">\n                    <p className=\"text-gray-600\">You are already signed in!</p>\n                    <Redirect to=\"/\" />\n                  </div>\n                </SignedIn>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9034},"SOCIAL_MEDIA_BUTTONS_ISSUE.md":{"content":"# Social Media Buttons Issue - Documentation for Human Developer\n\n## Problem Description\nThe social media buttons (\"Today's News\", \"LinkedIn\", \"X Posts\") are not appearing on the home page despite being present in the code.\n\n## Current Implementation Location\nFile: `client/src/pages/home.tsx`\nLines: 292-340 (approximately)\n\n## Expected Behavior\n- Three teal buttons should appear on the right side of the \"Top Discussions\" heading\n- Buttons should have:\n  - Background color: #0B666B (teal)\n  - Text color: white\n  - Right-aligned in the header area\n\n## Current Code Structure\n```jsx\n<div className=\"flex items-center justify-between mb-4\">\n  <h3 className=\"text-2xl font-bold text-gray-900\">\n    {/* Discussion title */}\n  </h3>\n  <div className=\"flex items-center gap-2 relative z-50\">\n    <button style={{ backgroundColor: '#0B666B', color: 'white' }}>\n      Today's News\n    </button>\n    {/* LinkedIn and X Posts buttons */}\n  </div>\n</div>\n```\n\n## Debugging Steps Already Tried\n1. Added inline styles to override any CSS conflicts\n2. Added z-index: 50 to ensure buttons are above other elements\n3. Added visible yellow indicator to confirm the container is rendering\n4. Used both className and inline style approaches\n5. Added black borders for visibility testing\n\n## Related Issue\nCategory filtering in the sidebar also appears to be not working properly. The onClick handlers are logging correctly but posts may not be updating when a category is selected.\n\n## Backend Implementation Status\nThe backend for social media embeds is fully implemented:\n- Database table: `social_media_embeds`\n- API routes: `/api/social-media-embeds/:type`\n- Admin panel: `/admin/social-media-embeds`\n\n## Suggested Next Steps\n1. Check browser DevTools to see if the button elements are in the DOM but hidden\n2. Verify no CSS is overriding the display or visibility\n3. Check if there's a parent element with overflow:hidden cutting off the buttons\n4. Confirm the MainLayout component isn't affecting the layout\n5. Test in an incognito window to rule out caching issues\n\n## Previous Success\nThis feature was successfully implemented before, so there may be a regression or conflict with recent changes.","size_bytes":2189},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"server/moderation.ts":{"content":"import OpenAI from \"openai\";\nimport { db } from \"./db\";\nimport { moderationResults } from \"@shared/schema\";\nimport type { InsertModerationResult } from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\n// the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\ninterface ModerationResponse {\n  score: number;\n  flaggedCategories: string[];\n  status: \"approved\" | \"flagged\" | \"rejected\";\n  reason: string;\n}\n\nexport async function moderateContent(\n  content: string,\n  contentType: \"post\" | \"comment\",\n  contentId: string\n): Promise<ModerationResponse> {\n  try {\n    const prompt = `\nYou are a content moderator for a supportive caregiving community where family members help each other with eldercare challenges. Please analyze this ${contentType} for appropriateness.\n\nContent to analyze: \"${content}\"\n\nEvaluate for:\n1. Harassment, bullying, or personal attacks\n2. Hate speech or discrimination\n3. Spam or promotional content\n4. Medical misinformation that could be harmful\n5. Personal information that should be protected\n6. Off-topic content not related to caregiving\n7. Inappropriate language or content\n\nRespond in JSON format with:\n{\n  \"score\": (0-1, where 1 is most problematic),\n  \"flaggedCategories\": [\"category1\", \"category2\"],\n  \"status\": \"approved|flagged|rejected\",\n  \"reason\": \"brief explanation\"\n}\n\nGuidelines:\n- \"approved\": Safe, supportive content (score 0-0.3)\n- \"flagged\": Needs human review (score 0.3-0.7)  \n- \"rejected\": Clear violation (score 0.7-1.0)\n- Be supportive of emotional expressions and vulnerable sharing\n- Allow discussions of difficult caregiving situations\n- Protect against harmful medical advice\n`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a content moderator focused on maintaining a safe, supportive caregiving community.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.3,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    // Store moderation result in database\n    const moderationData: InsertModerationResult = {\n      contentId,\n      contentType,\n      moderationScore: result.score || 0,\n      flaggedCategories: result.flaggedCategories || [],\n      moderationStatus: result.status || \"approved\",\n      aiResponse: response.choices[0].message.content,\n    };\n\n    await db.insert(moderationResults).values(moderationData);\n\n    return {\n      score: result.score || 0,\n      flaggedCategories: result.flaggedCategories || [],\n      status: result.status || \"approved\",\n      reason: result.reason || \"Content reviewed successfully\"\n    };\n\n  } catch (error) {\n    console.error(\"Moderation error:\", error);\n    \n    // Default to flagged for manual review if AI fails\n    const fallbackData: InsertModerationResult = {\n      contentId,\n      contentType,\n      moderationScore: 0.5,\n      flaggedCategories: [\"ai_error\"],\n      moderationStatus: \"flagged\",\n      aiResponse: `AI moderation failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    };\n\n    await db.insert(moderationResults).values(fallbackData);\n\n    return {\n      score: 0.5,\n      flaggedCategories: [\"ai_error\"],\n      status: \"flagged\",\n      reason: \"Automatic moderation unavailable, flagged for manual review\"\n    };\n  }\n}\n\nexport async function getModerationStatus(contentId: string): Promise<ModerationResponse | null> {\n  try {\n    const result = await db\n      .select()\n      .from(moderationResults)\n      .where(eq(moderationResults.contentId, contentId))\n      .orderBy(desc(moderationResults.createdAt))\n      .limit(1);\n\n    if (result.length === 0) return null;\n\n    const mod = result[0];\n    return {\n      score: mod.moderationScore,\n      flaggedCategories: mod.flaggedCategories || [],\n      status: mod.moderationStatus as \"approved\" | \"flagged\" | \"rejected\",\n      reason: mod.aiResponse || \"No reason provided\"\n    };\n  } catch (error) {\n    console.error(\"Error getting moderation status:\", error);\n    return null;\n  }\n}","size_bytes":4312},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1062},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/CategoryCard.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { MessageSquare } from \"lucide-react\";\n\n// Caduceus Medical Icon Component\nconst CaduceusIcon = ({ className }: { className?: string }) => (\n  <svg viewBox=\"0 0 100 100\" className={className} fill=\"currentColor\">\n    <path d=\"M35 25 Q25 20 15 25 Q20 15 30 20 Q35 15 40 20 L35 25\" />\n    <path d=\"M65 25 Q75 20 85 25 Q80 15 70 20 Q65 15 60 20 L65 25\" />\n    <line x1=\"50\" y1=\"20\" x2=\"50\" y2=\"90\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\"/>\n    <circle cx=\"50\" cy=\"20\" r=\"4\" />\n    <path d=\"M40 35 Q55 40 45 50 Q35 55 50 60 Q65 65 55 75\" \n          fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n    <path d=\"M60 35 Q45 40 55 50 Q65 55 50 60 Q35 65 45 75\" \n          fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\"/>\n    <circle cx=\"45\" cy=\"75\" r=\"3\" />\n    <circle cx=\"55\" cy=\"75\" r=\"3\" />\n    <circle cx=\"44\" cy=\"74\" r=\"0.8\" fill=\"white\"/>\n    <circle cx=\"56\" cy=\"74\" r=\"0.8\" fill=\"white\"/>\n    <circle cx=\"50\" cy=\"85\" r=\"4\" />\n  </svg>\n);\n\n// Animated Counter Component\nfunction AnimatedCounter({ targetValue, categoryId, compact = false }: { targetValue: number; categoryId: number; compact?: boolean }) {\n  const [currentValue, setCurrentValue] = useState(0);\n  const [hasAnimated, setHasAnimated] = useState(false);\n  const elementRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (hasAnimated) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting && !hasAnimated) {\n            setHasAnimated(true);\n            animateCounter();\n          }\n        });\n      },\n      { threshold: 0.1 }\n    );\n\n    if (elementRef.current) {\n      observer.observe(elementRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, [hasAnimated]);\n\n  const animateCounter = () => {\n    const duration = 2000;\n    const increment = targetValue / (duration / 16);\n    let current = 0;\n\n    const timer = setInterval(() => {\n      current += increment;\n      if (current >= targetValue) {\n        setCurrentValue(targetValue);\n        clearInterval(timer);\n      } else {\n        setCurrentValue(Math.floor(current));\n      }\n    }, 16);\n  };\n\n  return (\n    <div ref={elementRef} className={`font-bold ${compact ? 'text-xs' : 'text-sm'}`}>\n      {currentValue.toLocaleString()}\n    </div>\n  );\n}\n\ninterface CategoryCardProps {\n  category: {\n    id: number;\n    name: string;\n    slug: string;\n    description: string;\n    postCount?: number;\n  };\n  categoryImage?: string;\n  onJoinClick?: () => void;\n  onExploreClick?: () => void;\n  compact?: boolean; // Add compact mode for narrower sections\n}\n\nexport default function CategoryCard({ \n  category, \n  categoryImage, \n  onJoinClick, \n  onExploreClick,\n  compact = false\n}: CategoryCardProps) {\n  // Get button colors based on category slug\n  const getButtonColor = (slug: string) => {\n    switch (slug) {\n      case 'government-resources': return '#F4B942';\n      case 'home-care': return '#D2524C';\n      case 'hospital-rehab': return '#7BB46D';\n      case 'senior-living': return '#E67E22';\n      case 'professional-advice': return '#4ECDC4';\n      case 'paying-for-care': return '#0B666B';\n      case 'health-conditions': return '#DC2626';\n      case 'family-finances': return '#16A34A';\n      case 'professionals': return '#2563EB';\n      default: return '#0B666B';\n    }\n  };\n\n  const buttonColor = getButtonColor(category.slug);\n\n  return (\n    <div className={`bg-white rounded-2xl shadow-sm hover:shadow-md transition-shadow ${compact ? 'p-6 min-h-[180px]' : 'p-8 min-h-[200px]'}`}>\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center space-x-3\">\n          <div className={`rounded-full flex items-center justify-center bg-gray-100 flex-shrink-0 ${compact ? 'w-10 h-10' : 'w-12 h-12'}`}>\n            {category.slug === 'health-conditions' ? (\n              <CaduceusIcon className={`text-red-600 ${compact ? 'w-5 h-5' : 'w-6 h-6'}`} />\n            ) : (\n              <img \n                src={categoryImage || ''}\n                alt={category.name}\n                className={`object-cover rounded-full ${compact ? 'w-6 h-6' : 'w-8 h-8'}`}\n              />\n            )}\n          </div>\n          <div>\n            <h3 className={`font-semibold text-gray-900 leading-tight ${compact ? 'text-sm' : 'text-base'}`}>\n              {category.name}\n            </h3>\n          </div>\n        </div>\n        <div className={`flex flex-col items-center text-gray-500 ${compact ? 'text-xs' : 'text-sm'}`}>\n          <div className=\"flex items-center space-x-1 mb-1\">\n            <MessageSquare className={`${compact ? 'w-3 h-3' : 'w-4 h-4'}`} />\n            <span>posts</span>\n          </div>\n          <AnimatedCounter \n            targetValue={category.postCount || 0}\n            categoryId={category.id}\n            compact={compact}\n          />\n        </div>\n      </div>\n\n      <p className={`text-gray-600 leading-relaxed ${compact ? 'text-sm mb-4' : 'text-base mb-6'}`}>\n        {category.description}\n      </p>\n\n      <div className=\"flex w-full rounded-lg overflow-hidden border border-gray-200 mt-4\">\n        <button \n          className=\"flex-1 text-white text-sm font-semibold py-3 hover:opacity-90 transition-opacity\"\n          style={{ backgroundColor: buttonColor }}\n          onClick={onJoinClick}\n        >\n          Join\n        </button>\n        <div className=\"w-px bg-white/30\"></div>\n        <button \n          className=\"flex-1 text-white text-sm font-semibold py-3 hover:opacity-90 transition-opacity\"\n          style={{ backgroundColor: buttonColor }}\n          onClick={onExploreClick}\n        >\n          Explore\n        </button>\n      </div>\n    </div>\n  );\n}","size_bytes":5837},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/pages/BookAppointment.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { useLocation, useParams, useRoute } from 'wouter';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\n// Initialize Stripe\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY || '');\n\ninterface Expert {\n  id: string;\n  name: string;\n  bio: string;\n  profession: string;\n  specializations: string[];\n  hourlyRate: number;\n  profileImageUrl?: string;\n  rating: {\n    average: number;\n    count: number;\n  };\n  nextAvailable: string | null;\n}\n\ninterface TimeSlot {\n  time: string;\n  available: boolean;\n}\n\n// Main booking component\nexport default function BookAppointment() {\n  const { expertId } = useParams();\n  const [location, navigate] = useLocation();\n  \n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        <Elements stripe={stripePromise}>\n          <BookingFlow expertId={expertId!} />\n        </Elements>\n      </div>\n    </div>\n  );\n}\n\n// Booking flow component\nfunction BookingFlow({ expertId }: { expertId: string }) {\n  const [step, setStep] = useState(1);\n  const [userTimezone, setUserTimezone] = useState(() => {\n    try {\n      return Intl.DateTimeFormat().resolvedOptions().timeZone;\n    } catch {\n      return 'UTC';\n    }\n  });\n  \n  const [bookingData, setBookingData] = useState({\n    date: '',\n    time: '',\n    utcTime: '', // Store UTC time for booking\n    duration: 60,\n    notes: '',\n    clientName: '',\n    clientEmail: '',\n    timezone: userTimezone\n  });\n\n  // Fetch expert data\n  const { data: expert, isLoading: expertLoading } = useQuery({\n    queryKey: ['expert', expertId],\n    queryFn: async () => {\n      const response = await fetch(`/api/experts/${expertId}/profile`);\n      if (!response.ok) throw new Error('Failed to fetch expert');\n      return response.json() as Promise<Expert>;\n    }\n  });\n\n  if (expertLoading) {\n    return <div className=\"text-center py-12\">Loading expert information...</div>;\n  }\n\n  if (!expert) {\n    return <div className=\"text-center py-12\">Expert not found</div>;\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg overflow-hidden\">\n      {/* Header */}\n      <div className=\"bg-blue-600 text-white px-6 py-4\">\n        <div className=\"flex justify-between items-start\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Book Consultation</h1>\n            <p className=\"text-blue-100\">Step {step} of 4</p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-sm text-blue-200\">Your timezone</p>\n            <p className=\"text-sm font-mono\">{userTimezone}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Progress bar */}\n      <div className=\"bg-gray-200 h-2\">\n        <div \n          className=\"bg-blue-600 h-2 transition-all duration-300\" \n          style={{ width: `${(step / 4) * 100}%` }}\n        />\n      </div>\n\n      {/* Expert info */}\n      <div className=\"p-6 border-b border-gray-200\">\n        <div className=\"flex items-center space-x-4\">\n          {expert.profileImageUrl && (\n            <img \n              src={expert.profileImageUrl} \n              alt={expert.name}\n              className=\"w-16 h-16 rounded-full object-cover\"\n            />\n          )}\n          <div>\n            <h2 className=\"text-xl font-semibold\">{expert.name}</h2>\n            <p className=\"text-gray-600\">{expert.profession}</p>\n            <div className=\"flex items-center space-x-2 mt-1\">\n              <span className=\"text-yellow-500\">â˜…</span>\n              <span>{expert.rating.average.toFixed(1)}</span>\n              <span className=\"text-gray-500\">({expert.rating.count} reviews)</span>\n              <span className=\"text-gray-300\">â€¢</span>\n              <span className=\"font-medium\">${expert.hourlyRate}/hour</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Booking steps */}\n      <div className=\"p-6\">\n        {step === 1 && (\n          <DateSelection \n            expertId={expertId}\n            selectedDate={bookingData.date}\n            onDateSelect={(date) => {\n              setBookingData(prev => ({ ...prev, date }));\n              setStep(2);\n            }}\n          />\n        )}\n\n        {step === 2 && (\n          <TimeSelection \n            expertId={expertId}\n            selectedDate={bookingData.date}\n            selectedTime={bookingData.time}\n            duration={bookingData.duration}\n            userTimezone={userTimezone}\n            onTimeSelect={(time, utcTime) => {\n              setBookingData(prev => ({ ...prev, time, utcTime }));\n              setStep(3);\n            }}\n            onDurationChange={(duration) => {\n              setBookingData(prev => ({ ...prev, duration }));\n            }}\n            onBack={() => setStep(1)}\n          />\n        )}\n\n        {step === 3 && (\n          <BookingDetails \n            data={bookingData}\n            onChange={(updates) => setBookingData(prev => ({ ...prev, ...updates }))}\n            onNext={() => setStep(4)}\n            onBack={() => setStep(2)}\n          />\n        )}\n\n        {step === 4 && (\n          <PaymentStep \n            expert={expert}\n            bookingData={bookingData}\n            onBack={() => setStep(3)}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Date selection component\nfunction DateSelection({ \n  expertId, \n  selectedDate, \n  onDateSelect \n}: { \n  expertId: string; \n  selectedDate: string; \n  onDateSelect: (date: string) => void; \n}) {\n  const [availableDates, setAvailableDates] = useState<string[]>([]);\n\n  useEffect(() => {\n    // Generate next 14 days\n    const dates = [];\n    for (let i = 0; i < 14; i++) {\n      const date = new Date();\n      date.setDate(date.getDate() + i);\n      dates.push(date.toISOString().split('T')[0]);\n    }\n    setAvailableDates(dates);\n  }, []);\n\n  return (\n    <div>\n      <h3 className=\"text-lg font-semibold mb-4\">Select Date</h3>\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n        {availableDates.map((date) => {\n          const dateObj = new Date(date);\n          const isToday = date === new Date().toISOString().split('T')[0];\n          const isPast = dateObj < new Date();\n          \n          return (\n            <button\n              key={date}\n              disabled={isPast}\n              onClick={() => onDateSelect(date)}\n              className={`p-3 rounded-lg border text-center transition-colors ${\n                isPast \n                  ? 'bg-gray-100 text-gray-400 cursor-not-allowed' \n                  : selectedDate === date\n                    ? 'bg-blue-600 text-white border-blue-600'\n                    : 'bg-white border-gray-300 hover:border-blue-400 hover:bg-blue-50'\n              }`}\n            >\n              <div className=\"font-medium\">\n                {isToday ? 'Today' : dateObj.toLocaleDateString('en-US', { weekday: 'short' })}\n              </div>\n              <div className=\"text-sm\">\n                {dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n// Time selection component\nfunction TimeSelection({ \n  expertId, \n  selectedDate, \n  selectedTime, \n  duration,\n  userTimezone,\n  onTimeSelect, \n  onDurationChange,\n  onBack \n}: { \n  expertId: string; \n  selectedDate: string; \n  selectedTime: string; \n  duration: number;\n  userTimezone: string;\n  onTimeSelect: (time: string, utcTime: string) => void; \n  onDurationChange: (duration: number) => void;\n  onBack: () => void; \n}) {\n  const { data: timeSlots, isLoading } = useQuery({\n    queryKey: ['timeSlots', expertId, selectedDate, userTimezone],\n    queryFn: async () => {\n      const response = await fetch(`/api/experts/${expertId}/available-slots/${selectedDate}?timezone=${encodeURIComponent(userTimezone)}`);\n      if (!response.ok) throw new Error('Failed to fetch time slots');\n      const data = await response.json();\n      return data.slots || [];\n    },\n    enabled: !!selectedDate\n  });\n\n  if (isLoading) {\n    return <div className=\"text-center py-8\">Loading available times...</div>;\n  }\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">Select Time</h3>\n        <button \n          onClick={onBack}\n          className=\"text-blue-600 hover:text-blue-800\"\n        >\n          â† Back to dates\n        </button>\n      </div>\n\n      <div className=\"mb-6\">\n        <label className=\"block text-sm font-medium mb-2\">Session Duration</label>\n        <select \n          value={duration}\n          onChange={(e) => onDurationChange(parseInt(e.target.value))}\n          className=\"border border-gray-300 rounded-md px-3 py-2\"\n        >\n          <option value={30}>30 minutes</option>\n          <option value={60}>1 hour</option>\n          <option value={90}>1.5 hours</option>\n          <option value={120}>2 hours</option>\n        </select>\n      </div>\n\n      {timeSlots && timeSlots.length > 0 ? (\n        <div className=\"grid grid-cols-3 md:grid-cols-4 gap-3\">\n          {timeSlots.slice(0, 12).map((slot: any) => {\n            // Handle both old format (string) and new format (object with timezone info)\n            const isNewFormat = typeof slot === 'object' && slot.displayTime;\n            const displayTime = isNewFormat ? slot.displayTime : new Date(slot).toLocaleTimeString('en-US', { \n              hour: 'numeric', \n              minute: '2-digit',\n              hour12: true \n            });\n            const slotKey = isNewFormat ? slot.utcTime : slot;\n            const timeValue = isNewFormat ? slot.time : slot;\n            const utcTime = isNewFormat ? slot.utcTime : slot;\n            \n            return (\n              <button\n                key={slotKey}\n                onClick={() => onTimeSelect(timeValue, utcTime)}\n                className={`p-3 rounded-lg border text-center transition-colors ${\n                  selectedTime === timeValue\n                    ? 'bg-blue-600 text-white border-blue-600'\n                    : 'bg-white border-gray-300 hover:border-blue-400 hover:bg-blue-50'\n                }`}\n              >\n                <div className=\"font-medium\">{displayTime}</div>\n                {isNewFormat && (\n                  <div className=\"text-xs text-gray-500 mt-1\">\n                    Your time\n                  </div>\n                )}\n              </button>\n            );\n          })}\n        </div>\n      ) : (\n        <div className=\"text-center py-8 text-gray-500\">\n          No available time slots for this date. Please select another date.\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Booking details component\nfunction BookingDetails({ \n  data, \n  onChange, \n  onNext, \n  onBack \n}: { \n  data: any; \n  onChange: (updates: any) => void; \n  onNext: () => void; \n  onBack: () => void; \n}) {\n  const canProceed = data.clientName && data.clientEmail;\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">Your Details</h3>\n        <button \n          onClick={onBack}\n          className=\"text-blue-600 hover:text-blue-800\"\n        >\n          â† Back to times\n        </button>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Full Name *</label>\n          <input \n            type=\"text\"\n            value={data.clientName}\n            onChange={(e) => onChange({ clientName: e.target.value })}\n            className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n            placeholder=\"Enter your full name\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Email Address *</label>\n          <input \n            type=\"email\"\n            value={data.clientEmail}\n            onChange={(e) => onChange({ clientEmail: e.target.value })}\n            className=\"w-full border border-gray-300 rounded-md px-3 py-2\"\n            placeholder=\"Enter your email address\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">Notes (Optional)</label>\n          <textarea \n            value={data.notes}\n            onChange={(e) => onChange({ notes: e.target.value })}\n            className=\"w-full border border-gray-300 rounded-md px-3 py-2 h-24\"\n            placeholder=\"Anything you'd like the expert to know before your consultation?\"\n          />\n        </div>\n\n        <button \n          onClick={onNext}\n          disabled={!canProceed}\n          className={`w-full py-3 rounded-lg font-medium transition-colors ${\n            canProceed \n              ? 'bg-blue-600 text-white hover:bg-blue-700' \n              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n          }`}\n        >\n          Continue to Payment\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// Payment component\nfunction PaymentStep({ \n  expert, \n  bookingData, \n  onBack \n}: { \n  expert: Expert; \n  bookingData: any; \n  onBack: () => void; \n}) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [, navigate] = useLocation();\n\n  const totalAmount = (expert.hourlyRate * bookingData.duration / 60);\n\n  const bookingMutation = useMutation({\n    mutationFn: async () => {\n      if (!stripe || !elements) throw new Error('Stripe not loaded');\n\n      const cardElement = elements.getElement(CardElement);\n      if (!cardElement) throw new Error('Card element not found');\n\n      // Create appointment booking\n      const response = await fetch('/api/appointments/book', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          expertId: expert.id,\n          clientName: bookingData.clientName,\n          clientEmail: bookingData.clientEmail,\n          scheduledAt: bookingData.utcTime || bookingData.time, // Use UTC time if available\n          scheduledAtTimezone: bookingData.timezone,\n          duration: bookingData.duration,\n          notes: bookingData.notes,\n          totalAmount: Math.round(totalAmount * 100) // Convert to cents\n        })\n      });\n\n      if (!response.ok) throw new Error('Failed to create booking');\n      const { clientSecret, appointmentId } = await response.json();\n\n      // Confirm payment\n      const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardElement,\n          billing_details: {\n            name: bookingData.clientName,\n            email: bookingData.clientEmail\n          }\n        }\n      });\n\n      if (error) throw error;\n\n      // Confirm the appointment\n      await fetch(`/api/appointments/${appointmentId}/confirm`, {\n        method: 'POST'\n      });\n\n      return { appointmentId, paymentIntent };\n    },\n    onSuccess: (data) => {\n      navigate(`/appointment-confirmation/${data.appointmentId}`);\n    }\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsProcessing(true);\n    \n    try {\n      await bookingMutation.mutateAsync();\n    } catch (error) {\n      console.error('Payment failed:', error);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <div>\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">Payment</h3>\n        <button \n          onClick={onBack}\n          className=\"text-blue-600 hover:text-blue-800\"\n        >\n          â† Back to details\n        </button>\n      </div>\n\n      {/* Booking summary */}\n      <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n        <h4 className=\"font-medium mb-2\">Booking Summary</h4>\n        <div className=\"space-y-1 text-sm\">\n          <div className=\"flex justify-between\">\n            <span>Date:</span>\n            <span>{new Date(bookingData.date).toLocaleDateString()}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>Time:</span>\n            <div className=\"text-right\">\n              <div>\n                {bookingData.utcTime \n                  ? new Date(bookingData.utcTime).toLocaleTimeString('en-US', { \n                      hour: 'numeric', \n                      minute: '2-digit',\n                      hour12: true,\n                      timeZone: bookingData.timezone \n                    })\n                  : new Date(bookingData.time).toLocaleTimeString('en-US', { \n                      hour: 'numeric', \n                      minute: '2-digit',\n                      hour12: true \n                    })\n                }\n              </div>\n              <div className=\"text-xs text-gray-500\">\n                {bookingData.timezone}\n              </div>\n            </div>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>Duration:</span>\n            <span>{bookingData.duration} minutes</span>\n          </div>\n          <div className=\"flex justify-between font-medium\">\n            <span>Total:</span>\n            <span>${totalAmount.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <form onSubmit={handleSubmit}>\n        <div className=\"mb-4\">\n          <label className=\"block text-sm font-medium mb-2\">Card Information</label>\n          <div className=\"border border-gray-300 rounded-md p-3\">\n            <CardElement \n              options={{\n                style: {\n                  base: {\n                    fontSize: '16px',\n                    color: '#424770',\n                    '::placeholder': {\n                      color: '#aab7c4',\n                    },\n                  },\n                },\n              }}\n            />\n          </div>\n        </div>\n\n        <button \n          type=\"submit\"\n          disabled={!stripe || isProcessing || bookingMutation.isPending}\n          className={`w-full py-3 rounded-lg font-medium transition-colors ${\n            isProcessing || bookingMutation.isPending\n              ? 'bg-gray-300 text-gray-500 cursor-not-allowed' \n              : 'bg-green-600 text-white hover:bg-green-700'\n          }`}\n        >\n          {isProcessing || bookingMutation.isPending ? (\n            'Processing...'\n          ) : (\n            `Pay $${totalAmount.toFixed(2)} & Book Consultation`\n          )}\n        </button>\n\n        {bookingMutation.error && (\n          <div className=\"mt-4 p-3 bg-red-100 border border-red-300 rounded-md text-red-700 text-sm\">\n            {bookingMutation.error.message}\n          </div>\n        )}\n      </form>\n    </div>\n  );\n}","size_bytes":18793},"server/services/emailService.ts":{"content":"import sgMail from \"@sendgrid/mail\";\n\n// Initialize SendGrid\nconst sendgridApiKey = process.env.SENDGRID_API_KEY;\n\nif (sendgridApiKey) {\n  console.log(\"SendGrid API key configured successfully\");\n  sgMail.setApiKey(sendgridApiKey);\n} else {\n  console.warn(\"SendGrid API key not configured - email sending disabled\");\n}\n\ninterface EmailOptions {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n}\n\nexport const emailService = {\n  async sendEmail(options: EmailOptions): Promise<boolean> {\n    const apiKey = process.env.SENDGRID_API_KEY;\n    if (!apiKey) {\n      console.log(\"Email service not configured. Would have sent:\", options);\n      return false;\n    }\n\n    try {\n      // Use verified SendGrid sender email - hardcoded to avoid corrupted env var\n      const fromEmail = \"elias@askedith.org\";\n\n      const msg = {\n        to: options.to,\n        from: fromEmail,\n        subject: options.subject,\n        text: options.text || options.html.replace(/<[^>]*>/g, \"\"),\n        html: options.html,\n      };\n\n      await sgMail.send(msg);\n      console.log(`Email sent successfully to ${options.to}`);\n      return true;\n    } catch (error: any) {\n      console.error(\"SendGrid error:\", error);\n      if (error.response) {\n        console.error(\n          \"SendGrid response body:\",\n          JSON.stringify(error.response.body, null, 2),\n        );\n      }\n      return false;\n    }\n  },\n\n  async sendVerificationEmail(\n    email: string,\n    username: string,\n    verificationToken: string,\n  ): Promise<boolean> {\n    const verificationUrl = `${process.env.APP_URL || \"http://localhost:5000\"}/verify-email?token=${verificationToken}`;\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n          <h1 style=\"margin: 0;\">Welcome to AskEdith!</h1>\n        </div>\n        <div style=\"padding: 30px; background-color: #f5f5f5;\">\n          <h2 style=\"color: #333;\">Hi ${username},</h2>\n          <p style=\"color: #666; line-height: 1.6;\">\n            Thank you for joining our caregiving community. Please verify your email address to complete your registration.\n          </p>\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${verificationUrl}\" style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n              Verify Email Address\n            </a>\n          </div>\n          <p style=\"color: #666; font-size: 14px;\">\n            If the button doesn't work, copy and paste this link into your browser:<br>\n            <a href=\"${verificationUrl}\" style=\"color: #0B666B;\">${verificationUrl}</a>\n          </p>\n          <p style=\"color: #666; font-size: 14px;\">\n            This link will expire in 24 hours.\n          </p>\n        </div>\n        <div style=\"background-color: #333; color: #999; padding: 20px; text-align: center; font-size: 12px;\">\n          <p style=\"margin: 0;\">Â© 2025 AskEdith. All rights reserved.</p>\n        </div>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: \"Verify your AskEdith account\",\n      html,\n    });\n  },\n\n  async sendPasswordResetEmail(\n    email: string,\n    username: string,\n    resetToken: string,\n  ): Promise<boolean> {\n    // Use the Replit domain for password reset links\n    const baseUrl = process.env.REPLIT_DOMAINS\n      ? `https://${process.env.REPLIT_DOMAINS.split(\",\")[0]}`\n      : \"http://localhost:5000\";\n    const resetUrl = `${baseUrl}/reset-password?token=${resetToken}`;\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n          <h1 style=\"margin: 0;\">Password Reset Request</h1>\n        </div>\n        <div style=\"padding: 30px; background-color: #f5f5f5;\">\n          <h2 style=\"color: #333;\">Hi ${username},</h2>\n          <p style=\"color: #666; line-height: 1.6;\">\n            We received a request to reset your password. If you didn't make this request, you can safely ignore this email.\n          </p>\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${resetUrl}\" style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n              Reset Password\n            </a>\n          </div>\n          <p style=\"color: #666; font-size: 14px;\">\n            If the button doesn't work, copy and paste this link into your browser:<br>\n            <a href=\"${resetUrl}\" style=\"color: #0B666B;\">${resetUrl}</a>\n          </p>\n          <p style=\"color: #666; font-size: 14px;\">\n            This link will expire in 1 hour for security reasons.\n          </p>\n        </div>\n        <div style=\"background-color: #333; color: #999; padding: 20px; text-align: center; font-size: 12px;\">\n          <p style=\"margin: 0;\">Â© 2025 AskEdith. All rights reserved.</p>\n        </div>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: \"Reset your AskEdith password\",\n      html,\n    });\n  },\n\n  async sendWelcomeEmail(email: string, username: string): Promise<boolean> {\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n          <h1 style=\"margin: 0;\">Welcome to AskEdith!</h1>\n        </div>\n        <div style=\"padding: 30px; background-color: #f5f5f5;\">\n          <h2 style=\"color: #333;\">Hi ${username},</h2>\n          <p style=\"color: #666; line-height: 1.6;\">\n            Your email has been verified and your account is now active. Welcome to our caregiving community!\n          </p>\n          <h3 style=\"color: #333;\">Getting Started:</h3>\n          <ul style=\"color: #666; line-height: 1.8;\">\n            <li>Browse our discussion forums to connect with other caregivers</li>\n            <li>Book consultations with verified experts</li>\n            <li>Share your experiences and get support</li>\n            <li>Access curated resources in \"This Week by...\"</li>\n          </ul>\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${process.env.APP_URL || \"http://localhost:5000\"}\" style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n              Visit Community\n            </a>\n          </div>\n        </div>\n        <div style=\"background-color: #333; color: #999; padding: 20px; text-align: center; font-size: 12px;\">\n          <p style=\"margin: 0;\">Â© 2025 AskEdith. All rights reserved.</p>\n        </div>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: \"Welcome to AskEdith Community\",\n      html,\n    });\n  },\n\n  async sendAiAnswerEmail(\n    firstName: string,\n    email: string,\n    question: string,\n    answer: string,\n  ): Promise<boolean> {\n    // Convert markdown-style answer to HTML\n    const htmlAnswer = answer\n      .replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\")\n      .replace(/\\*(.*?)\\*/g, \"<em>$1</em>\")\n      .replace(/\\n\\n/g, \"</p><p>\")\n      .replace(/\\n/g, \"<br>\");\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <div style=\"background-color: #0B666B; color: white; padding: 20px; text-align: center;\">\n          <h1 style=\"margin: 0;\">Your AskEdith Answer</h1>\n        </div>\n        <div style=\"padding: 30px; background-color: #f5f5f5;\">\n          <h2 style=\"color: #333;\">Hi ${firstName},</h2>\n          <p style=\"color: #666; line-height: 1.6;\">\n            Thank you for visiting AskEdith. Edith's answer is listed below. We are in test-mode as we just launched. Our mission is to provide you clean and crisp answers with information you truly want to see. If Edith's answer left you searching for more, please send a note to Elias Papasavvas, the Founder of AskEdith at hi@askedith.org. We will very quickly adjust and improve. Search engines are overrun with click-bait articles and articles with agendas. AskEdith is on a mission to give retirees and adult caregivers the information they need without the noise!\n          </p>\n\n          <div style=\"background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #0B666B;\">\n            <h3 style=\"color: #333; margin-top: 0;\">Your Question:</h3>\n            <p style=\"color: #666; font-style: italic;\">\"${question}\"</p>\n          </div>\n\n          <div style=\"background-color: white; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n            <h3 style=\"color: #333; margin-top: 0;\">AI Answer:</h3>\n            <div style=\"color: #444; line-height: 1.6;\">\n              <p>${htmlAnswer}</p>\n            </div>\n          </div>\n\n          <p style=\"color: #666; font-size: 14px; margin-top: 30px;\">\n            This answer was generated by AskEdith's AI system using our comprehensive knowledge base about elder care, ADUs, and retirement planning.\n          </p>\n\n          <div style=\"text-align: center; margin: 30px 0;\">\n            <a href=\"${process.env.APP_URL || \"http://localhost:5000\"}/ai-search\" style=\"background-color: #0B666B; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">\n              Ask Another Question\n            </a>\n          </div>\n        </div>\n        <div style=\"background-color: #333; color: #999; padding: 20px; text-align: center; font-size: 12px;\">\n          <p style=\"margin: 0;\">Â© 2025 AskEdith. All rights reserved.</p>\n          <p style=\"margin: 5px 0 0 0;\">This email was sent because you requested to receive an AI answer via email.</p>\n        </div>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: `Your AskEdith Answer: ${question.substring(0, 50)}${question.length > 50 ? \"...\" : \"\"}`,\n      html,\n    });\n  },\n};\n","size_bytes":10121},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/pages/BookConsultationNew.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Calendar, Clock, DollarSign, CreditCard, User, Mail, MessageSquare, CheckCircle } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, PaymentElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { useToast } from \"@/hooks/use-toast\";\nimport DefaultProfilePicture from \"@/components/DefaultProfilePicture\";\n\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst bookingSchema = z.object({\n  scheduledAt: z.string().min(1, \"Please select a date and time\"),\n  duration: z.number().min(30, \"Minimum duration is 30 minutes\").max(120, \"Maximum duration is 2 hours\"),\n  notes: z.string().optional(),\n  clientEmail: z.string().email(\"Please enter a valid email address\"),\n  clientName: z.string().min(2, \"Please enter your full name\"),\n});\n\ntype BookingForm = z.infer<typeof bookingSchema>;\n\nconst BookingFormWithPayment = ({ \n  expert, \n  onSuccess \n}: { \n  expert: any;\n  onSuccess: () => void;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [selectedDate, setSelectedDate] = useState(\"\");\n  const [selectedTime, setSelectedTime] = useState(\"\");\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const form = useForm<BookingForm>({\n    resolver: zodResolver(bookingSchema),\n    defaultValues: {\n      duration: 60,\n      notes: \"\",\n      clientEmail: user?.email || \"\",\n      clientName: user ? `${user.firstName} ${user.lastName}` : \"\",\n    },\n  });\n\n  const handleSubmit = async (data: BookingForm) => {\n    if (!stripe || !elements) {\n      toast({\n        title: \"Error\",\n        description: \"Payment system not ready. Please refresh and try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    // First, confirm the payment\n    const { error: paymentError } = await stripe.confirmPayment({\n      elements,\n      confirmParams: {\n        return_url: `${window.location.origin}/consultation-success`,\n      },\n      redirect: \"if_required\",\n    });\n\n    if (paymentError) {\n      toast({\n        title: \"Payment Failed\",\n        description: paymentError.message,\n        variant: \"destructive\",\n      });\n      setIsProcessing(false);\n      return;\n    }\n\n    // If payment successful, finalize the booking\n    try {\n      const scheduledAt = `${selectedDate}T${selectedTime}:00`;\n      await apiRequest(\"POST\", \"/api/consultations/finalize\", {\n        ...data,\n        scheduledAt,\n        expertId: expert.id,\n      });\n\n      toast({\n        title: \"Success!\",\n        description: \"Your consultation has been booked successfully.\",\n      });\n      \n      onSuccess();\n    } catch (error: any) {\n      toast({\n        title: \"Booking Failed\",\n        description: error.message || \"Payment successful but booking failed. Please contact support.\",\n        variant: \"destructive\",\n      });\n    }\n\n    setIsProcessing(false);\n  };\n\n  // Generate time slots\n  const generateTimeSlots = () => {\n    const slots = [];\n    for (let hour = 9; hour <= 17; hour++) {\n      slots.push(`${hour.toString().padStart(2, '0')}:00`);\n      if (hour < 17) {\n        slots.push(`${hour.toString().padStart(2, '0')}:30`);\n      }\n    }\n    return slots;\n  };\n\n  const timeSlots = generateTimeSlots();\n  const hourlyRate = 100; // Fixed $100/hour rate\n\n  return (\n    <Form {...form}>\n      <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n        {/* Date & Time Selection */}\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Select Date</label>\n            <Input\n              type=\"date\"\n              min={new Date().toISOString().split('T')[0]}\n              max={new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}\n              value={selectedDate}\n              onChange={(e) => {\n                setSelectedDate(e.target.value);\n                form.setValue('scheduledAt', `${e.target.value}T${selectedTime || '09:00'}:00`);\n              }}\n              className=\"w-full\"\n              required\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Select Time</label>\n            <select\n              value={selectedTime}\n              onChange={(e) => {\n                setSelectedTime(e.target.value);\n                if (selectedDate) {\n                  form.setValue('scheduledAt', `${selectedDate}T${e.target.value}:00`);\n                }\n              }}\n              className=\"w-full h-10 px-3 rounded-md border border-input bg-background\"\n              required\n            >\n              <option value=\"\">Choose a time</option>\n              {timeSlots.map((slot) => (\n                <option key={slot} value={slot}>\n                  {slot}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        {/* Duration Selection */}\n        <FormField\n          control={form.control}\n          name=\"duration\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>Session Duration</FormLabel>\n              <FormControl>\n                <select\n                  {...field}\n                  onChange={(e) => field.onChange(parseInt(e.target.value))}\n                  className=\"w-full h-10 px-3 rounded-md border border-input bg-background\"\n                >\n                  <option value=\"30\">30 minutes</option>\n                  <option value=\"60\">60 minutes</option>\n                  <option value=\"90\">90 minutes</option>\n                  <option value=\"120\">2 hours</option>\n                </select>\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Contact Information */}\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          <FormField\n            control={form.control}\n            name=\"clientName\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Your Name</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"John Doe\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"clientEmail\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Email Address</FormLabel>\n                <FormControl>\n                  <Input type=\"email\" placeholder=\"john@example.com\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n        </div>\n\n        {/* Notes */}\n        <FormField\n          control={form.control}\n          name=\"notes\"\n          render={({ field }) => (\n            <FormItem>\n              <FormLabel>What would you like to discuss? (Optional)</FormLabel>\n              <FormControl>\n                <Textarea \n                  placeholder=\"Brief description of what you'd like to cover...\"\n                  className=\"min-h-[100px]\"\n                  {...field} \n                />\n              </FormControl>\n              <FormMessage />\n            </FormItem>\n          )}\n        />\n\n        {/* Cost Summary */}\n        {form.watch('duration') && (\n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <h4 className=\"font-semibold mb-2\">Cost Summary</h4>\n            <div className=\"flex justify-between items-center\">\n              <span>{form.watch('duration')} minute consultation</span>\n              <span className=\"font-bold\">\n                ${((hourlyRate * form.watch('duration')) / 60).toFixed(2)}\n              </span>\n            </div>\n          </div>\n        )}\n\n        {/* Payment Section */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold\">Payment Information</h3>\n          <div className=\"border rounded-lg p-4\">\n            <PaymentElement />\n          </div>\n        </div>\n\n        <Button \n          type=\"submit\" \n          disabled={!selectedDate || !selectedTime || isProcessing || !stripe || !elements}\n          className=\"w-full\"\n          size=\"lg\"\n        >\n          {isProcessing ? (\n            <>\n              <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n              Processing...\n            </>\n          ) : (\n            <>\n              <CreditCard className=\"w-4 h-4 mr-2\" />\n              Book & Pay ${((hourlyRate * form.watch('duration')) / 60).toFixed(2)}\n            </>\n          )}\n        </Button>\n      </form>\n    </Form>\n  );\n};\n\nexport default function BookConsultation() {\n  const { expertId } = useParams();\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'booking' | 'success'>('booking');\n  const [clientSecret, setClientSecret] = useState(\"\");\n\n  // Fetch expert details\n  const { data: expert, isLoading: expertLoading } = useQuery({\n    queryKey: [`/api/experts/${expertId}`],\n    enabled: !!expertId,\n  });\n\n  // Initialize payment intent\n  const [paymentError, setPaymentError] = useState(false);\n  \n  useEffect(() => {\n    if (expert && isAuthenticated && !clientSecret && !paymentError) {\n      const initializePayment = async () => {\n        try {\n          const duration = 60; // Default 60 minutes\n          // Fixed rate of $100/hour\n          const rate = 10000; // $100 in cents\n          const totalAmount = Math.round((rate * duration) / 60);\n          \n          console.log(\"Initializing payment:\", { \n            expertId, \n            duration, \n            rate, \n            totalAmount,\n            expert \n          });\n          \n          const response = await apiRequest(\"POST\", \"/api/consultations/create-payment\", { \n            expertId: expertId!,\n            duration,\n            totalAmount,\n          });\n          \n          console.log(\"Payment response:\", response);\n          \n          if (response.clientSecret) {\n            setClientSecret(response.clientSecret);\n          } else {\n            throw new Error(\"No client secret received\");\n          }\n        } catch (error: any) {\n          console.error(\"Failed to initialize payment:\", error);\n          setPaymentError(true);\n          toast({\n            title: \"Error\",\n            description: error.message || \"Failed to initialize payment. Please refresh and try again.\",\n            variant: \"destructive\",\n          });\n        }\n      };\n      \n      initializePayment();\n    }\n  }, [expert, isAuthenticated, expertId, clientSecret, paymentError]);\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <User className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to book a consultation.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (expertLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading expert information...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (paymentError) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <h2 className=\"text-2xl font-semibold mb-4\">Payment System Error</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Unable to initialize the payment system. Please try again later or contact support.\n            </p>\n            <Button onClick={() => window.location.reload()}>\n              Try Again\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!expert) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <h2 className=\"text-2xl font-semibold mb-4\">Expert Not Found</h2>\n            <p className=\"text-gray-600 mb-6\">\n              The expert you're looking for doesn't exist or isn't available for consultations.\n            </p>\n            <Button onClick={() => window.history.back()}>\n              Go Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!expert.consultationEnabled) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <h2 className=\"text-2xl font-semibold mb-4\">Consultations Not Available</h2>\n            <p className=\"text-gray-600 mb-6\">\n              This expert is not currently accepting consultation bookings.\n            </p>\n            <Button onClick={() => window.history.back()}>\n              Go Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Consultation Booked Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Your consultation with {expert.firstName} {expert.lastName} has been confirmed. \n              You'll receive a confirmation email with meeting details shortly.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/'}>\n                Return to Home\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View My Bookings\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <div className=\"mb-4\">\n              {expert.photoUrl ? (\n                <img\n                  src={expert.photoUrl}\n                  alt={expert.name}\n                  className=\"w-24 h-24 rounded-full mx-auto object-cover\"\n                />\n              ) : (\n                <DefaultProfilePicture\n                  name={expert.name}\n                  className=\"w-24 h-24 mx-auto\"\n                  theme={expert.profileTheme}\n                />\n              )}\n            </div>\n            <CardTitle className=\"text-2xl\">Book a Consultation with {expert.name}</CardTitle>\n            <CardDescription>\n              {expert.badge && (\n                <Badge variant=\"secondary\" className=\"mt-2\">\n                  {expert.badge} Expert\n                </Badge>\n              )}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {clientSecret ? (\n              <Elements stripe={stripePromise} options={{ clientSecret }}>\n                <BookingFormWithPayment \n                  expert={expert}\n                  onSuccess={() => setStep('success')}\n                />\n              </Elements>\n            ) : (\n              <div className=\"text-center py-8\">\n                <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n                <p className=\"text-gray-600\">Setting up payment system...</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":17606},"client/src/components/MainLayout.tsx":{"content":"import { ReactNode } from \"react\";\nimport DynamicDiscussionTopicsSidebar from \"./DynamicDiscussionTopicsSidebar\";\nimport SearchHeader from \"./SearchHeader\";\nimport EmailVerificationBanner from \"./EmailVerificationBanner\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface MainLayoutProps {\n  children: ReactNode;\n  showSidebar?: boolean;\n  showSearchHeader?: boolean;\n  searchHeaderTitle?: string;\n  showActionButtons?: boolean;\n  sortBy?: \"hot\" | \"new\" | \"top\";\n  onSortChange?: (sort: \"hot\" | \"new\" | \"top\") => void;\n  onSearch?: (query: string) => void;\n}\n\nexport default function MainLayout({ \n  children, \n  showSidebar = true,\n  showSearchHeader = true,\n  searchHeaderTitle,\n  showActionButtons = true,\n  sortBy,\n  onSortChange,\n  onSearch\n}: MainLayoutProps) {\n  const { user, isAuthenticated } = useAuth();\n  const showEmailBanner = isAuthenticated && user && !user.emailVerified;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {showSearchHeader && (\n        <SearchHeader \n          title={searchHeaderTitle}\n          showActionButtons={showActionButtons}\n          sortBy={sortBy}\n          onSortChange={onSortChange}\n          onSearch={onSearch}\n        />\n      )}\n      {showEmailBanner && user?.email && (\n        <div className=\"px-[30px] pt-4\">\n          <EmailVerificationBanner email={user.email} />\n        </div>\n      )}\n      <div className=\"px-[30px] py-8\">\n        <div className=\"grid lg:grid-cols-12 gap-8\">\n          {/* Left Sidebar - 25% width (3/12) */}\n          {showSidebar && (\n            <div className=\"lg:col-span-3\">\n              <DynamicDiscussionTopicsSidebar />\n            </div>\n          )}\n          \n          {/* Main Content - 55% width (7/12) */}\n          <div className={showSidebar ? \"lg:col-span-7\" : \"lg:col-span-12\"}>\n            {children}\n          </div>\n\n          {/* Right Sidebar - 20% width (2/12) for Advertisers */}\n          {showSidebar && (\n            <div className=\"lg:col-span-2\">\n              <div className=\"bg-gray-50 rounded-xl border border-white shadow-sm p-6\" style={{ minHeight: '800px' }}>\n                <div className=\"text-center text-gray-500 text-xs\">\n                  Ads\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":2309},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    // Check if response is HTML (indicating routing issue)\n    const contentType = res.headers.get('content-type');\n    if (contentType && contentType.includes('text/html')) {\n      throw new Error(`${res.status}: API routing error - received HTML instead of JSON`);\n    }\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest<T = any>(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<T> {\n  // Force API requests to bypass frontend routing\n  const apiUrl = url.startsWith('/api/') ? url : `/api${url}`;\n  \n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n    \"Accept\": \"application/json\",\n  };\n  \n  // Try to get the session token from Clerk if available\n  if (typeof window !== 'undefined' && (window as any).Clerk) {\n    try {\n      const sessionToken = await (window as any).Clerk.session?.getToken();\n      if (sessionToken) {\n        headers['Authorization'] = `Bearer ${sessionToken}`;\n      }\n    } catch (error) {\n      console.debug('Could not get Clerk session token:', error);\n    }\n  }\n  \n  const res = await fetch(apiUrl, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: 'include',\n  });\n\n  await throwIfResNotOk(res);\n  return await res.json();\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    let url = queryKey[0] as string;\n    \n    // Handle array-based query keys for parameterized URLs\n    if (queryKey.length > 1) {\n      const params = queryKey.slice(1);\n      // If it's a posts by author query, construct the proper URL\n      if (url === '/api/posts/by-author') {\n        url = `${url}/${params[0]}`;\n      }\n      // If it's user posts query, construct the proper URL\n      if (url === '/api/posts/user') {\n        url = `/api/posts/by-author/${params[0]}`;\n      }\n      // If it's an expert profile query, construct the proper URL\n      if (url === '/api/experts') {\n        if (params.length === 2 && params[1] === 'profile') {\n          url = `${url}/${params[0]}/profile`;\n        } else {\n          url = `${url}/${params[0]}`;\n        }\n      }\n      // If it's a categories by parent query, construct the proper URL\n      if (url === '/api/categories/parent') {\n        url = `${url}/${params[0]}`;\n      }\n    }\n    \n    // Get the session token from Clerk for authenticated requests\n    const headers: Record<string, string> = {};\n    \n    if (typeof window !== 'undefined' && (window as any).Clerk) {\n      try {\n        const sessionToken = await (window as any).Clerk.session?.getToken();\n        if (sessionToken) {\n          headers['Authorization'] = `Bearer ${sessionToken}`;\n        }\n      } catch (error) {\n        console.debug('Could not get Clerk session token:', error);\n      }\n    }\n    \n    const res = await fetch(url, {\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: true,\n      staleTime: 0,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":3687},"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser, UpsertUser, UserRole } from \"@shared/schema\";\nimport connectPg from \"connect-pg-simple\";\nimport { emailService } from \"./services/emailService\";\nimport jwt from \"jsonwebtoken\";\nimport { loginLimiter, registrationLimiter, passwordResetLimiter } from \"./middleware/rateLimiter\";\nimport { clerkAuth } from \"./middleware/clerkAuth\";\n\n// Extend Express User type to include role\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {\n      role: UserRole;\n    }\n  }\n}\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nasync function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nexport function setupAuth(app: Express) {\n  // Apply Clerk authentication middleware globally\n  app.use(clerkAuth);\n  \n  // Use memory store as fallback if database connection fails\n  let store;\n  try {\n    const PostgresSessionStore = connectPg(session);\n    store = new PostgresSessionStore({\n      conString: process.env.DATABASE_URL,\n      tableName: \"sessions\",\n      createTableIfMissing: false, // Drizzle ORM is responsible for schema management\n    });\n  } catch (error: any) {\n    console.warn('Failed to connect to PostgreSQL session store, using memory store:', error?.message || String(error));\n    // Memory store will be used as default\n  }\n  \n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET || \"askedith-dev-secret-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    store: store,\n    cookie: {\n      secure: false, // Set to true in production with HTTPS\n      httpOnly: true,\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    },\n  };\n\n  app.set(\"trust proxy\", 1);\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        console.log('Login attempt for username:', username);\n        \n        // Try to find user by username first\n        let user = await storage.getUserByUsername(username);\n        \n        // If not found by username, try by email\n        if (!user && username.includes('@')) {\n          console.log('Trying to find user by email:', username);\n          user = await storage.getUserByEmail(username);\n        }\n        \n        if (!user) {\n          console.log('User not found');\n          return done(null, false);\n        }\n        \n        console.log('User found:', user.username, 'Email:', user.email);\n        const passwordMatch = await comparePasswords(password, user.password);\n        console.log('Password match result:', passwordMatch);\n        \n        if (!passwordMatch) {\n          return done(null, false);\n        } else {\n          return done(null, user);\n        }\n      } catch (error) {\n        console.error('Passport auth error:', error);\n        return done(error);\n      }\n    }),\n  );\n\n  passport.serializeUser((user: Express.User, done) => {\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: string, done) => {\n    try {\n      const user = await storage.getUser(id);\n      if (!user) {\n        return done(null, null);\n      }\n      // Ensure the user has a role, default to 'user' if not set\n      const userWithRole = {\n        ...user,\n        role: (user.role || 'user') as UserRole\n      };\n      done(null, userWithRole);\n    } catch (error) {\n      done(error);\n    }\n  });\n\n  // In the /api/register route handler\n  app.post(\"/api/register\", registrationLimiter, async (req, res, next) => {\n    try {\n      const { \n        username, \n        email, \n        password, \n        firstName, \n        lastName, \n        role,\n        communityName,\n        city,\n        state,\n        introduction\n      }: {\n        username: string;\n        email: string;\n        password: string;\n        firstName: string;\n        lastName: string;\n        role?: string;\n        communityName?: string;\n        city?: string;\n        state?: string;\n        introduction?: string;\n      } = req.body;\n\n      // Check if username or email already exists\n      const existingUser = await storage.getUserByUsername(username) || await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username or email already exists\" });\n      }\n\n      // Validate and set role\n      const requestedRole = [\"user\", \"expert\"].includes(role || '') ? role as UserRole : \"user\";\n      const defaultProfileType = requestedRole === \"expert\" ? \"tree\" : \"daisy\";\n\n      // Hash password\n      const hashedPassword = await hashPassword(password);\n\n      // Create user with the requested role\n      const user = await storage.createUser({\n        id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n        username,\n        email,\n        password: hashedPassword,\n        firstName,\n        lastName,\n        communityName,\n        city,\n        state,\n        introduction,\n        role: requestedRole,\n        defaultProfileType,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      });\n\n      // Generate verification token\n      const verificationToken = randomBytes(32).toString('hex');\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\n\n      // Save verification token\n      await storage.createEmailVerificationToken({\n        userId: user.id,\n        token: verificationToken,\n        expiresAt\n      });\n\n      // Send verification email\n      await emailService.sendVerificationEmail(email, username, verificationToken);\n\n      // Log in the user\n      req.login(user, (err) => {\n        if (err) return next(err);\n        // Don't send back the password hash\n        const { password: _, ...userWithoutPassword } = user;\n        res.status(201).json(userWithoutPassword);\n      });\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ message: \"Registration failed\" });\n    }\n  });\n\n  app.post(\"/api/login\", loginLimiter, (req, res, next) => {\n    passport.authenticate(\"local\", (err: any, user: any, info: any) => {\n      if (err) {\n        return res.status(500).json({ message: \"Authentication error\" });\n      }\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid username or password\" });\n      }\n      req.login(user, async (err) => {\n        if (err) {\n          return res.status(500).json({ message: \"Login failed\" });\n        }\n        try {\n          const expertVerification = await storage.getExpertVerification(user.id);\n          const { password: _, ...userWithoutPassword } = user;\n          return res.status(200).json({ ...userWithoutPassword, expertVerification: expertVerification || null });\n        } catch (error) {\n          console.error(\"Error getting expert verification:\", error);\n          const { password: _, ...userWithoutPassword } = user;\n          return res.status(200).json({ ...userWithoutPassword, expertVerification: null });\n        }\n      });\n    })(req, res, next);\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      res.redirect('/');\n    });\n  });\n\n  app.get(\"/api/logout\", (req, res, next) => {\n    req.logout((err) => {\n      if (err) return next(err);\n      res.redirect('/');\n    });\n  });\n\n  // Updated /api/user endpoint to use Clerk authentication\n  app.get(\"/api/user\", async (req, res) => {\n    try {\n      // Import Clerk functions and user sync\n      const { getAuth } = await import(\"@clerk/express\");\n      const { getUserWithSync } = await import(\"./services/userSync\");\n      \n      // Get auth info from Clerk middleware\n      const auth = getAuth(req);\n      \n      if (!auth.isAuthenticated || !auth.userId) {\n        return res.sendStatus(401);\n      }\n\n      // Get user from database with automatic sync from Clerk if needed\n      const user = await getUserWithSync(auth.userId);\n      const expertVerification = await storage.getExpertVerification(user.id);\n      \n      // Remove password from response\n      const { password: _, ...userWithoutPassword } = user;\n      \n      res.json({\n        ...userWithoutPassword,\n        expertVerification: expertVerification || null,\n      });\n    } catch (error) {\n      console.error(\"Error in /api/user endpoint:\", error);\n      res.status(500).json({ message: \"Failed to get user data\" });\n    }\n  });\n\n  // Email verification request endpoint\n  app.post(\"/api/request-verification\", isAuthenticated, async (req: any, res) => {\n    try {\n      const user = req.user;\n      \n      if (user.emailVerified) {\n        return res.status(400).json({ message: \"Email already verified\" });\n      }\n\n      // Generate verification token\n      const token = randomBytes(32).toString('hex');\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\n\n      // Save token to database\n      await storage.createEmailVerificationToken({\n        userId: user.id,\n        token,\n        expiresAt\n      });\n\n      // Send verification email\n      await emailService.sendVerificationEmail(user.email, user.username, token);\n\n      res.json({ message: \"Verification email sent\" });\n    } catch (error) {\n      console.error(\"Verification request error:\", error);\n      res.status(500).json({ message: \"Failed to send verification email\" });\n    }\n  });\n\n  // Email verification endpoint\n  app.get(\"/api/verify-email\", async (req, res) => {\n    try {\n      const { token } = req.query;\n      \n      if (!token || typeof token !== 'string') {\n        return res.status(400).json({ message: \"Invalid verification token\" });\n      }\n\n      // Get token from database\n      const verificationToken = await storage.getEmailVerificationToken(token);\n      \n      if (!verificationToken) {\n        return res.status(400).json({ message: \"Invalid or expired token\" });\n      }\n\n      // Check if token is expired\n      if (new Date() > verificationToken.expiresAt) {\n        await storage.deleteEmailVerificationToken(token);\n        return res.status(400).json({ message: \"Token has expired\" });\n      }\n\n      // Verify user's email\n      await storage.verifyUserEmail(verificationToken.userId);\n      \n      // Delete the used token\n      await storage.deleteEmailVerificationToken(token);\n\n      // Get user details for welcome email\n      const user = await storage.getUser(verificationToken.userId);\n      if (user) {\n        await emailService.sendWelcomeEmail(user.email!, user.username);\n      }\n\n      res.redirect('/verify-success');\n    } catch (error) {\n      console.error(\"Email verification error:\", error);\n      res.status(500).json({ message: \"Failed to verify email\" });\n    }\n  });\n\n  // Password reset request endpoint\n  app.post(\"/api/forgot-password\", passwordResetLimiter, async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n\n      // Find user by email\n      const user = await storage.getUserByEmail(email);\n      \n      if (!user) {\n        // Don't reveal if email exists\n        return res.json({ message: \"If an account exists with this email, a password reset link has been sent\" });\n      }\n\n      // Generate reset token\n      const token = randomBytes(32).toString('hex');\n      const expiresAt = new Date(Date.now() + 60 * 60 * 1000); // 1 hour\n\n      // Save token to database\n      await storage.createPasswordResetToken({\n        userId: user.id,\n        token,\n        expiresAt\n      });\n\n      // Send password reset email\n      console.log('Sending password reset email to:', user.email);\n      console.log('Username:', user.username);\n      console.log('Token:', token);\n      \n      const emailSent = await emailService.sendPasswordResetEmail(user.email!, user.username, token);\n      console.log('Email sent result:', emailSent);\n\n      res.json({ message: \"If an account exists with this email, a password reset link has been sent\" });\n    } catch (error) {\n      console.error(\"Password reset request error:\", error);\n      res.status(500).json({ message: \"Failed to process password reset request\" });\n    }\n  });\n\n  // Password reset endpoint\n  app.post(\"/api/reset-password\", async (req, res) => {\n    try {\n      console.log(\"Password reset request body:\", req.body);\n      const { token, newPassword } = req.body;\n      \n      if (!token || !newPassword) {\n        return res.status(400).json({ message: \"Token and new password are required\" });\n      }\n\n      // Get token from database\n      const resetToken = await storage.getPasswordResetToken(token);\n      \n      if (!resetToken) {\n        return res.status(400).json({ message: \"Invalid or expired token\" });\n      }\n\n      // Check if token is expired\n      if (new Date() > resetToken.expiresAt) {\n        await storage.deletePasswordResetToken(token);\n        return res.status(400).json({ message: \"Token has expired\" });\n      }\n\n      // Hash new password\n      const hashedPassword = await hashPassword(newPassword);\n      console.log('Password reset - New password hashed, length:', hashedPassword.length);\n      \n      // Update user's password\n      await storage.updateUserPassword(resetToken.userId, hashedPassword);\n      console.log('Password updated for user:', resetToken.userId);\n      \n      // Delete the used token\n      await storage.deletePasswordResetToken(token);\n\n      res.json({ message: \"Password reset successful\" });\n    } catch (error) {\n      console.error(\"Password reset error:\", error);\n      res.status(500).json({ message: \"Failed to reset password\" });\n    }\n  });\n}\n\n// Authentication middleware\nexport function isAuthenticated(req: any, res: any, next: any) {\n  if (req.isAuthenticated()) {\n    return next();\n  }\n  res.status(401).json({ message: \"Unauthorized\" });\n}","size_bytes":14539},"client/src/components/ForumSearchModal.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Search, Users, Calendar } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface ForumSearchModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelectForum: (forum: any) => void;\n}\n\nexport function ForumSearchModal({ open, onOpenChange, onSelectForum }: ForumSearchModalProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  // Update ForumSearchModal.tsx to connect to real API\n  const { data: searchResults = [] } = useQuery({\n    queryKey: ['/api/forums/search', searchQuery],\n    queryFn: async () => {\n      if (searchQuery.length < 2) return [];\n      const response = await fetch(`/api/forums/search?q=${encodeURIComponent(searchQuery)}`);\n      return response.json();\n    },\n    enabled: searchQuery.length >= 2,\n  });\n\n  const handleSelectForum = (forum: any) => {\n    onSelectForum(forum);\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px] max-h-[80vh]\">\n        <DialogHeader>\n          <DialogTitle>Search Forums</DialogTitle>\n          <DialogDescription>\n            Find community forums created by other users. These don't appear in the main sidebar but are discoverable through search.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n            <Input\n              placeholder=\"Search for forums...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n          \n          {searchQuery.length < 2 && (\n            <div className=\"text-center py-8 text-gray-500\">\n              Type at least 2 characters to search for forums\n            </div>\n          )}\n          \n          {searchQuery.length >= 2 && searchResults.length === 0 && (\n            <div className=\"text-center py-8 text-gray-500\">\n              No forums found matching \"{searchQuery}\"\n            </div>\n          )}\n          \n          {searchResults.length > 0 && (\n            <div className=\"space-y-3 max-h-[400px] overflow-y-auto\">\n              {searchResults.map((forum: any) => (\n                <div\n                  key={forum.id}\n                  className=\"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors\"\n                  onClick={() => handleSelectForum(forum)}\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-medium text-gray-900\">{forum.name}</h3>\n                      {forum.description && (\n                        <p className=\"text-sm text-gray-600 mt-1\">{forum.description}</p>\n                      )}\n                      <div className=\"flex items-center space-x-4 mt-2\">\n                        <div className=\"flex items-center text-xs text-gray-500\">\n                          <Users className=\"w-3 h-3 mr-1\" />\n                          {forum.postCount || 0} posts\n                        </div>\n                        {forum.createdAt && (\n                          <div className=\"flex items-center text-xs text-gray-500\">\n                            <Calendar className=\"w-3 h-3 mr-1\" />\n                            Created {new Date(forum.createdAt).toLocaleDateString()}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    {!forum.isOfficial && (\n                      <Badge variant=\"secondary\" className=\"ml-2\">\n                        Community\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":4307},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"deploy.sh":{"content":"#!/bin/bash\n# Deployment script to fix the static file serving issue\n\necho \"Building the application for production...\"\nNODE_ENV=production npm run build\n\necho \"Ensuring static files are in the correct location for deployment...\"\n# The production server looks for files in server/public relative to the bundled server\n# When the server is bundled into dist/index.js, it expects public files to be at dist/public\n# But Replit deployment might expect them elsewhere, so we copy to both locations\n\n# Copy to server/public (for local testing)\nmkdir -p server/public\ncp -r dist/public/* server/public/\n\n# Ensure dist/public exists for the bundled server\necho \"Static files ready at:\"\necho \"  - dist/public/ (for bundled server)\"\necho \"  - server/public/ (for backup)\"\n\necho \"\"\necho \"Build complete! The application is ready for deployment.\"\necho \"\"\necho \"For Replit deployment, use the start script:\"\necho \"npm start\"\necho \"\"\necho \"Or manually:\"\necho \"NODE_ENV=production node dist/index.js\"","size_bytes":986},"client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}","size_bytes":5614},"server/sessionStore.ts":{"content":"import session from \"express-session\";\nimport { RedisStore } from \"connect-redis\";\nimport MemoryStore from \"memorystore\";\nimport { redisClient } from \"./redis\";\n\nexport function createRedisSessionStore() {\n  const sessionTtl = 7 * 24 * 60 * 60; // 1 week in seconds\n  \n  let store;\n  \n  try {\n    // Try Redis first\n    store = new RedisStore({\n      client: redisClient,\n      prefix: \"sess:\",\n      ttl: sessionTtl,\n    });\n    console.log('Using Redis for session storage');\n  } catch (error) {\n    // Fallback to memory store\n    console.log('Redis unavailable, using memory store for sessions');\n    const MemStore = MemoryStore(session);\n    store = new MemStore({\n      checkPeriod: 86400000 // prune expired entries every 24h\n    });\n  }\n\n  return session({\n    secret: process.env.SESSION_SECRET || 'fallback-secret-key',\n    store: store,\n    resave: false,\n    saveUninitialized: false,\n    rolling: true, // Reset expiration on activity\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      maxAge: sessionTtl * 1000, // Convert to milliseconds\n      sameSite: 'lax'\n    },\n  });\n}","size_bytes":1134},"client/src/pages/ExpertApplicationSimple.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { CheckCircle, Clock, XCircle, CreditCard } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst expertApplicationSchema = z.object({\n  profession: z.string().min(2, \"Profession is required\"),\n  expertiseArea: z.string().min(5, \"Please describe your areas of expertise\"),\n  yearsOfExperience: z.number().min(1, \"Years of experience must be at least 1\").max(50, \"Please enter a realistic number\"),\n  credentials: z.string().min(10, \"Please provide your credentials and qualifications\"),\n  bio: z.string().min(50, \"Please provide a detailed bio (at least 50 characters)\"),\n  licenseNumber: z.string().min(1, \"License number is required\"),\n  company: z.string().min(2, \"Company/Organization name is required\"),\n  companyAddress: z.string().min(10, \"Company address is required\"),\n  companyEmail: z.string().email(\"Please enter a valid company email\"),\n  consultationRate: z.number().min(50, \"Minimum consultation rate is $50/hour\").max(500, \"Maximum rate is $500/hour\"),\n  consultationEnabled: z.boolean().default(true),\n  reasonForApplying: z.string().min(20, \"Please explain why you want to become a verified expert\"),\n});\n\ntype ExpertApplicationForm = z.infer<typeof expertApplicationSchema>;\n\nconst SimplePaymentForm = ({ \n  applicationData, \n  onSuccess \n}: { \n  applicationData: ExpertApplicationForm;\n  onSuccess: () => void;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      // Create payment method\n      const cardElement = elements.getElement(CardElement);\n      if (!cardElement) {\n        throw new Error(\"Card element not found\");\n      }\n\n      const { error, paymentMethod } = await stripe.createPaymentMethod({\n        type: 'card',\n        card: cardElement,\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      // Submit application with payment method\n      const response = await apiRequest(\"POST\", \"/api/experts/apply-with-payment-method\", {\n        paymentMethodId: paymentMethod.id,\n        ...applicationData\n      });\n\n      if (response.requiresAction) {\n        // Handle 3D Secure\n        const result = await stripe.confirmCardPayment(response.clientSecret);\n        if (result.error) {\n          throw result.error;\n        }\n      }\n\n      toast({\n        title: \"Success!\",\n        description: \"Your expert application has been submitted successfully.\",\n      });\n      \n      onSuccess();\n    } catch (error: any) {\n      setIsProcessing(false);\n      toast({\n        title: \"Payment Failed\",\n        description: error.message || \"Failed to process payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"border rounded-lg p-4\">\n        <CardElement \n          options={{\n            style: {\n              base: {\n                fontSize: '16px',\n                color: '#424770',\n                '::placeholder': {\n                  color: '#aab7c4',\n                },\n              },\n              invalid: {\n                color: '#9e2146',\n              },\n            },\n          }}\n        />\n      </div>\n      <Button type=\"submit\" disabled={!stripe || isProcessing} className=\"w-full\">\n        {isProcessing ? (\n          <>\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n            Processing...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"mr-2 h-4 w-4\" />\n            Pay $100 and Submit Application\n          </>\n        )}\n      </Button>\n    </form>\n  );\n};\n\nexport default function ExpertApplicationSimple() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'form' | 'payment' | 'success'>('form');\n  const [applicationData, setApplicationData] = useState<ExpertApplicationForm | null>(null);\n\n  const form = useForm<ExpertApplicationForm>({\n    resolver: zodResolver(expertApplicationSchema),\n    defaultValues: {\n      consultationEnabled: true,\n      consultationRate: 100,\n      yearsOfExperience: 1,\n    },\n  });\n\n  // Check if user already has an application\n  const { data: existingApplication, isLoading } = useQuery({\n    queryKey: ['/api/experts/my-application'],\n    enabled: !!user,\n  });\n\n  const onSubmit = (data: ExpertApplicationForm) => {\n    setApplicationData(data);\n    setStep('payment');\n  };\n\n  const onPaymentSuccess = () => {\n    setStep('success');\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (existingApplication) {\n    const getStatusIcon = (status: string) => {\n      switch(status) {\n        case 'verified':\n          return <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />;\n        case 'pending':\n          return <Clock className=\"h-16 w-16 mx-auto mb-4 text-yellow-500\" />;\n        case 'rejected':\n          return <XCircle className=\"h-16 w-16 mx-auto mb-4 text-red-500\" />;\n        default:\n          return <Clock className=\"h-16 w-16 mx-auto mb-4 text-gray-500\" />;\n      }\n    };\n\n    const getStatusMessage = (status: string) => {\n      switch(status) {\n        case 'verified':\n          return {\n            title: \"You're Already Verified!\",\n            description: \"Congratulations! You are already a verified expert on AskEdith.\",\n            action: \"View Your Profile\"\n          };\n        case 'pending':\n          return {\n            title: \"Application Under Review\",\n            description: \"Your expert verification application is currently being reviewed by our team.\",\n            action: \"Update Application\"\n          };\n        case 'rejected':\n          return {\n            title: \"Application Not Approved\",\n            description: \"Your previous application was not approved. You can submit a new application with updated information.\",\n            action: \"Reapply\"\n          };\n        default:\n          return {\n            title: \"Application Submitted\",\n            description: \"Your application has been submitted.\",\n            action: \"View Status\"\n          };\n      }\n    };\n\n    const statusInfo = getStatusMessage(existingApplication.verificationStatus);\n\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            {getStatusIcon(existingApplication.verificationStatus)}\n            <h2 className=\"text-2xl font-semibold mt-4 mb-2\">{statusInfo.title}</h2>\n            <p className=\"text-gray-600 mb-6\">{statusInfo.description}</p>\n            \n            <div className=\"bg-gray-50 rounded-lg p-4 mb-6 text-left\">\n              <h3 className=\"font-semibold mb-2\">Application Details:</h3>\n              <div className=\"space-y-1 text-sm\">\n                <p><span className=\"font-medium\">Profession:</span> {existingApplication.profession}</p>\n                <p><span className=\"font-medium\">Expertise:</span> {existingApplication.expertiseArea}</p>\n                <p><span className=\"font-medium\">Experience:</span> {existingApplication.yearsExperience} years</p>\n                <p><span className=\"font-medium\">Status:</span> \n                  <Badge className=\"ml-2\" variant={\n                    existingApplication.verificationStatus === 'verified' ? 'default' :\n                    existingApplication.verificationStatus === 'pending' ? 'secondary' : 'destructive'\n                  }>\n                    {existingApplication.verificationStatus}\n                  </Badge>\n                </p>\n              </div>\n            </div>\n\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/community'}>\n                Explore Community\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                Go to Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Application Submitted Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Thank you for your payment and application. Our team will review your credentials and get back to you within 3-5 business days.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/community'}>\n                Explore Community\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'payment' && applicationData) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n        <div className=\"max-w-2xl mx-auto\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5\" />\n                Complete Your Expert Verification\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-gray-600 mb-6\">\n                One-time verification fee of $100 ensures quality and authenticity of our expert community.\n              </p>\n              <Elements stripe={stripePromise}>\n                <SimplePaymentForm \n                  applicationData={applicationData} \n                  onSuccess={onPaymentSuccess}\n                />\n              </Elements>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-2xl mx-auto\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Apply for Expert Verification</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"profession\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Profession</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., Financial Advisor, Elder Law Attorney\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"expertiseArea\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Areas of Expertise</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Describe your specific areas of expertise...\"\n                          className=\"resize-none\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"yearsOfExperience\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Years of Experience</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          {...field} \n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"credentials\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Credentials & Qualifications</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"List your credentials, certifications, and qualifications...\"\n                          className=\"resize-none\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"bio\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Professional Bio</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Tell us about yourself and your professional background...\"\n                          className=\"resize-none h-32\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormDescription>\n                        This will be displayed on your expert profile\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"licenseNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>License Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Your professional license number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"border-t pt-6\">\n                  <h3 className=\"text-lg font-semibold mb-4\">Company Information</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"company\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Company/Organization Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Your company or organization name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyAddress\"\n                    render={({ field }) => (\n                      <FormItem className=\"mt-4\">\n                        <FormLabel>Company Address</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Full company address\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyEmail\"\n                    render={({ field }) => (\n                      <FormItem className=\"mt-4\">\n                        <FormLabel>Company Email</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"company@example.com\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"border-t pt-6\">\n                  <h3 className=\"text-lg font-semibold mb-4\">Consultation Settings</h3>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"consultationRate\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Hourly Consultation Rate ($)</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"100\"\n                            {...field}\n                            onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Your hourly rate for consultations (USD)\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"reasonForApplying\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Why do you want to become a verified expert?</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Explain your motivation for joining our expert community...\"\n                          className=\"resize-none\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button type=\"submit\" className=\"w-full\">\n                  Continue to Payment\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":19732},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, ReactNode, useContext, useState, useEffect } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  QueryClient,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { insertUserSchema, User as SelectUser, UpsertUser, ExpertVerification, UserRole } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { useUser, useClerk } from \"@clerk/clerk-react\";\n\ntype InsertUser = z.infer<typeof insertUserSchema>;\n\ntype RegisterCredentials = InsertUser & { isExpert?: boolean; };\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype UserWithVerification = SelectUser & { \n  role: UserRole;\n  expertVerification: ExpertVerification | null \n};\n\ntype AuthContextType = {\n  user: UserWithVerification | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  isProfileComplete: boolean;\n  needsOnboarding: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<UserWithVerification, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<UserWithVerification, Error, RegisterCredentials>;\n};\n\ntype LoginData = Pick<UpsertUser, \"username\" | \"password\">;\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  const { user: clerkUser, isLoaded: clerkLoaded } = useUser();\n  const { signOut } = useClerk();\n  \n  // Add timeout for Clerk initialization to prevent infinite loading\n  const [clerkTimeout, setClerkTimeout] = useState(false);\n  \n  useEffect(() => {\n    // If Clerk doesn't load within 10 seconds, assume it failed and continue\n    const timeout = setTimeout(() => {\n      if (!clerkLoaded) {\n        console.warn('Clerk initialization timeout - continuing without auth');\n        setClerkTimeout(true);\n      }\n    }, 10000);\n    \n    return () => clearTimeout(timeout);\n  }, [clerkLoaded]);\n  \n  // Get user data from our database based on Clerk authentication\n  const {\n    data: user,\n    error,\n    isLoading: userQueryLoading,\n  } = useQuery<UserWithVerification | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    retry: false,\n    refetchOnWindowFocus: false,\n    staleTime: 15 * 60 * 1000, // 15 minutes - user data changes rarely\n    enabled: clerkLoaded && !!clerkUser, // Only run query if Clerk user is loaded and authenticated\n  });\n\n  // Check profile completeness when user is authenticated\n  const {\n    data: profileCheck,\n    isLoading: profileCheckLoading,\n  } = useQuery({\n    queryKey: [\"/api/profile-complete\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    retry: false,\n    enabled: clerkLoaded && !!clerkUser, // Check whenever Clerk user exists\n  });\n\n  // Allow app to continue if Clerk times out\n  const isLoading = (!clerkLoaded && !clerkTimeout) || (clerkLoaded && !!clerkUser && (userQueryLoading || profileCheckLoading));\n  \n  // Determine if user needs onboarding - check for all required fields\n  const isProfileComplete = !!(user?.firstName && user?.lastName && user?.email && user?.communityName && user?.city && user?.state && user?.username);\n  const needsOnboarding = Boolean(clerkLoaded && !!clerkUser && (\n    (!user && (profileCheck as any)?.isComplete === false) || \n    (user && !isProfileComplete)\n  ));\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      return await apiRequest(\"POST\", \"/api/login\", credentials);\n    },\n    onSuccess: (user: UserWithVerification) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: RegisterCredentials) => {\n      try {\n        const userData = await apiRequest(\"POST\", \"/api/register\", credentials);\n        return userData;\n      } catch (error) {\n        throw error;\n      }\n    },\n    onSuccess: (user: UserWithVerification) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n      toast({\n        title: \"Account created successfully!\",\n        description: `Welcome to AskEdith, ${user.firstName || user.username}!`,\n      });\n      // If professional user, redirect to expert application\n      if (user.defaultProfileType === 'tree') {\n        setTimeout(() => {\n          window.location.href = '/expert-application-with-payment';\n        }, 1500);\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message.includes('API routing error') \n          ? \"Connection issue - please try again\" \n          : error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      // Use Clerk's signOut instead of custom logout\n      await signOut();\n      queryClient.setQueryData([\"/api/user\"], null);\n    },\n    onSuccess: () => {\n      queryClient.setQueryData([\"/api/user\"], null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Logout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        isAuthenticated: !!(clerkUser && user),\n        isProfileComplete,\n        needsOnboarding,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}","size_bytes":5902},"client/src/pages/ExpertAvailability.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { Calendar, Clock, Trash2, Plus } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nconst DAYS_OF_WEEK = [\n  { value: 0, label: \"Sunday\" },\n  { value: 1, label: \"Monday\" },\n  { value: 2, label: \"Tuesday\" },\n  { value: 3, label: \"Wednesday\" },\n  { value: 4, label: \"Thursday\" },\n  { value: 5, label: \"Friday\" },\n  { value: 6, label: \"Saturday\" },\n];\n\nconst TIME_SLOTS = [\n  \"06:00\", \"06:30\", \"07:00\", \"07:30\", \"08:00\", \"08:30\",\n  \"09:00\", \"09:30\", \"10:00\", \"10:30\", \"11:00\", \"11:30\",\n  \"12:00\", \"12:30\", \"13:00\", \"13:30\", \"14:00\", \"14:30\",\n  \"15:00\", \"15:30\", \"16:00\", \"16:30\", \"17:00\", \"17:30\",\n  \"18:00\", \"18:30\", \"19:00\", \"19:30\", \"20:00\", \"20:30\",\n  \"21:00\", \"21:30\", \"22:00\"\n];\n\ninterface AvailabilitySlot {\n  id: number;\n  dayOfWeek: number;\n  startTime: string;\n  endTime: string;\n  timezone: string;\n}\n\nexport default function ExpertAvailability() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [newSlot, setNewSlot] = useState({\n    dayOfWeek: 1,\n    startTime: \"09:00\",\n    endTime: \"17:00\",\n  });\n\n  // Check if user is verified expert\n  const { data: expertData, isLoading: expertLoading } = useQuery({\n    queryKey: [\"/api/experts/me\"],\n  });\n\n  // Get current availability\n  const { data: availability, isLoading: availabilityLoading } = useQuery({\n    queryKey: [\"/api/experts/my-availability\"],\n    enabled: !!expertData,\n  });\n\n  // Get user's timezone\n  const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n  // Add availability mutation\n  const addAvailabilityMutation = useMutation({\n    mutationFn: (data: any) => apiRequest(\"POST\", \"/api/experts/availability\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts/my-availability\"] });\n      toast({\n        title: \"Availability Added\",\n        description: \"Your available hours have been updated.\",\n      });\n      // Reset form\n      setNewSlot({\n        dayOfWeek: 1,\n        startTime: \"09:00\",\n        endTime: \"17:00\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to add availability\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete availability mutation\n  const deleteAvailabilityMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/experts/availability/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/experts/my-availability\"] });\n      toast({\n        title: \"Availability Removed\",\n        description: \"Your available hours have been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to remove availability\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle form submission\n  const handleAddSlot = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Validate times\n    const [startHour, startMin] = newSlot.startTime.split(\":\").map(Number);\n    const [endHour, endMin] = newSlot.endTime.split(\":\").map(Number);\n    const startMinutes = startHour * 60 + startMin;\n    const endMinutes = endHour * 60 + endMin;\n    \n    if (endMinutes <= startMinutes) {\n      toast({\n        title: \"Invalid Time Range\",\n        description: \"End time must be after start time\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    addAvailabilityMutation.mutate({\n      ...newSlot,\n      timezone: userTimezone,\n    });\n  };\n\n  if (expertLoading || availabilityLoading) {\n    return (\n      <div className=\"container mx-auto py-8\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/4 mb-4\"></div>\n          <div className=\"h-64 bg-gray-200 rounded\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!expertData || expertData.verificationStatus !== \"verified\") {\n    return (\n      <div className=\"container mx-auto py-8\">\n        <Alert>\n          <AlertDescription>\n            Only verified experts can manage their availability.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 max-w-4xl\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n            <Calendar className=\"h-8 w-8\" />\n            Manage Your Availability\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Set your regular weekly hours for consultations\n          </p>\n        </div>\n        <Button\n          variant=\"outline\"\n          onClick={() => setLocation(\"/expert-dashboard\")}\n        >\n          Back to Dashboard\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6\">\n        {/* Add new availability slot */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Add Available Hours</CardTitle>\n            <CardDescription>\n              Set recurring weekly time slots when you're available for consultations.\n              Times are displayed in your local timezone: {userTimezone}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleAddSlot} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"dayOfWeek\">Day of Week</Label>\n                  <Select\n                    value={newSlot.dayOfWeek.toString()}\n                    onValueChange={(value) => \n                      setNewSlot({ ...newSlot, dayOfWeek: parseInt(value) })\n                    }\n                  >\n                    <SelectTrigger id=\"dayOfWeek\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {DAYS_OF_WEEK.map((day) => (\n                        <SelectItem key={day.value} value={day.value.toString()}>\n                          {day.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"startTime\">Start Time</Label>\n                  <Select\n                    value={newSlot.startTime}\n                    onValueChange={(value) => \n                      setNewSlot({ ...newSlot, startTime: value })\n                    }\n                  >\n                    <SelectTrigger id=\"startTime\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {TIME_SLOTS.map((time) => (\n                        <SelectItem key={time} value={time}>\n                          {time}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"endTime\">End Time</Label>\n                  <Select\n                    value={newSlot.endTime}\n                    onValueChange={(value) => \n                      setNewSlot({ ...newSlot, endTime: value })\n                    }\n                  >\n                    <SelectTrigger id=\"endTime\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {TIME_SLOTS.map((time) => (\n                        <SelectItem key={time} value={time}>\n                          {time}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              \n              <Button \n                type=\"submit\" \n                disabled={addAvailabilityMutation.isPending}\n                className=\"w-full md:w-auto\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Availability\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Current availability */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Your Weekly Schedule</CardTitle>\n            <CardDescription>\n              These are your recurring available hours each week\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {availability && availability.length > 0 ? (\n              <div className=\"space-y-2\">\n                {availability\n                  .sort((a: AvailabilitySlot, b: AvailabilitySlot) => {\n                    if (a.dayOfWeek !== b.dayOfWeek) {\n                      return a.dayOfWeek - b.dayOfWeek;\n                    }\n                    return a.startTime.localeCompare(b.startTime);\n                  })\n                  .map((slot: AvailabilitySlot) => (\n                    <div\n                      key={slot.id}\n                      className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"font-medium\">\n                          {DAYS_OF_WEEK.find(d => d.value === slot.dayOfWeek)?.label}\n                        </span>\n                        <span className=\"text-muted-foreground\">\n                          {slot.startTime} - {slot.endTime}\n                        </span>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => deleteAvailabilityMutation.mutate(slot.id)}\n                        disabled={deleteAvailabilityMutation.isPending}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Clock className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                <p>No availability set yet</p>\n                <p className=\"text-sm mt-1\">Add your available hours above to start accepting bookings</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Instructions */}\n        <Card>\n          <CardHeader>\n            <CardTitle>How It Works</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3 text-sm text-muted-foreground\">\n            <p>\n              â€¢ Set your regular weekly hours when you're available for consultations\n            </p>\n            <p>\n              â€¢ Clients will see available time slots based on your schedule\n            </p>\n            <p>\n              â€¢ Booked appointments automatically block those time slots\n            </p>\n            <p>\n              â€¢ You can block specific dates separately for holidays or time off\n            </p>\n            <p>\n              â€¢ All times are shown in your local timezone: {userTimezone}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":11899},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"import-qa-knowledge.js":{"content":"const fs = require('fs');\nconst csv = require('csv-parse/sync');\nconst { db } = require('./server/db');\nconst { qaKnowledge } = require('./dist/shared/schema');\n\nasync function importQAKnowledge(csvFilePath) {\n  try {\n    // Read the CSV file\n    const fileContent = fs.readFileSync(csvFilePath, 'utf-8');\n    \n    // Parse CSV - assuming first row is headers\n    const records = csv.parse(fileContent, {\n      columns: true,\n      skip_empty_lines: true,\n      trim: true\n    });\n    \n    console.log(`Found ${records.length} Q&A pairs to import`);\n    \n    let imported = 0;\n    let skipped = 0;\n    \n    // Import each Q&A pair\n    for (const record of records) {\n      // Get question from Column A and answer from Column B\n      // Adjust these field names based on your actual CSV headers\n      const question = record['Column A'] || record['Question'] || record['question'] || record.A;\n      const answer = record['Column B'] || record['Answer'] || record['answer'] || record.B;\n      \n      if (!question || !answer) {\n        console.log(`Skipping row - missing question or answer`);\n        skipped++;\n        continue;\n      }\n      \n      try {\n        await db.insert(qaKnowledge).values({\n          question: question.trim(),\n          answer: answer.trim()\n        });\n        imported++;\n        \n        if (imported % 10 === 0) {\n          console.log(`Progress: ${imported} imported...`);\n        }\n      } catch (error) {\n        console.error(`Error importing Q&A: \"${question.substring(0, 50)}...\"`, error.message);\n        skipped++;\n      }\n    }\n    \n    console.log(`\\nImport complete!`);\n    console.log(`Successfully imported: ${imported} Q&A pairs`);\n    console.log(`Skipped: ${skipped} rows`);\n    \n  } catch (error) {\n    console.error('Error reading or parsing CSV file:', error);\n    process.exit(1);\n  }\n}\n\n// Check if CSV file path is provided\nif (process.argv.length < 3) {\n  console.log('Usage: node import-qa-knowledge.js <path-to-csv-file>');\n  console.log('Example: node import-qa-knowledge.js questions.csv');\n  process.exit(1);\n}\n\nconst csvPath = process.argv[2];\n\n// Check if file exists\nif (!fs.existsSync(csvPath)) {\n  console.error(`Error: File not found: ${csvPath}`);\n  process.exit(1);\n}\n\n// Run the import\nimportQAKnowledge(csvPath)\n  .then(() => {\n    console.log('Done!');\n    process.exit(0);\n  })\n  .catch(error => {\n    console.error('Import failed:', error);\n    process.exit(1);\n  });","size_bytes":2443},"client/src/components/NewPostModal.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { X, AlertTriangle, LogIn } from \"lucide-react\";\n\ninterface NewPostModalProps {\n  open: boolean;\n  onClose: () => void;\n  mode?: 'post' | 'topic';\n}\n\nexport default function NewPostModal({ open, onClose, mode = 'post' }: NewPostModalProps) {\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [selectedForumId, setSelectedForumId] = useState(\"\");\n  const [selectedDiscussionId, setSelectedDiscussionId] = useState(\"\");\n  const [selectedTopicId, setSelectedTopicId] = useState(\"\");\n  const [newTopicName, setNewTopicName] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading } = useAuth();\n\n  // Fetch forums (level 0 categories)\n  const { data: forums = [] } = useQuery({\n    queryKey: [\"/api/categories/level/0\"],\n  });\n\n  // Fetch category hierarchy for discussions and topics\n  const { data: categoryHierarchy = [] } = useQuery({\n    queryKey: [\"/api/categories/hierarchy\"],\n  });\n\n  // Get discussions for selected forum\n  const getDiscussionsForForum = (forumId: string) => {\n    if (!forumId || !Array.isArray(categoryHierarchy)) return [];\n    const forum = categoryHierarchy.find((f: any) => f.id.toString() === forumId);\n    return forum?.children || [];\n  };\n\n  // Get topics for selected discussion\n  const getTopicsForDiscussion = (discussionId: string) => {\n    if (!discussionId || !selectedForumId || !Array.isArray(categoryHierarchy)) return [];\n    const forum = categoryHierarchy.find((f: any) => f.id.toString() === selectedForumId);\n    const discussion = forum?.children?.find((d: any) => d.id.toString() === discussionId);\n    return discussion?.children || [];\n  };\n\n  const discussions = getDiscussionsForForum(selectedForumId);\n  const topics = getTopicsForDiscussion(selectedDiscussionId);\n\n  const createPostMutation = useMutation({\n    mutationFn: async (data: { title: string; content: string; categoryId: number }) => {\n      return await apiRequest(\"POST\", \"/api/posts\", data);\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n      \n      if (data.moderationNote) {\n        toast({\n          title: \"Post Created with Review Notice\",\n          description: data.moderationNote,\n          variant: \"default\",\n        });\n      } else {\n        toast({\n          title: \"Success!\",\n          description: \"Your discussion has been posted successfully.\",\n        });\n      }\n      \n      handleClose();\n    },\n    onError: (error: any) => {\n      if (error.message?.includes(\"content policy\")) {\n        toast({\n          title: \"Post Cannot Be Published\",\n          description: \"Your post contains content that violates our community guidelines. Please revise and try again.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Error\",\n          description: \"Failed to create post. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Determine target category: Topic > Discussion > Forum\n    const targetCategoryId = selectedTopicId || selectedDiscussionId || selectedForumId;\n    \n    if (!title.trim() || !content.trim() || !selectedForumId) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please select a forum and fill in all fields before posting.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // If discussions are available but none selected, require discussion selection\n    if (discussions.length > 0 && !selectedDiscussionId) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please select a discussion from the available options.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Topic selection is always optional - user can post to Forum or Discussion level\n\n    createPostMutation.mutate({\n      title: title.trim(),\n      content: content.trim(),\n      categoryId: parseInt(targetCategoryId),\n    });\n  };\n\n  const handleClose = () => {\n    setTitle(\"\");\n    setContent(\"\");\n    setSelectedForumId(\"\");\n    setSelectedDiscussionId(\"\");\n    setSelectedTopicId(\"\");\n    setNewTopicName(\"\");\n    onClose();\n  };\n\n  // Reset child selections when parent changes\n  const handleForumChange = (value: string) => {\n    setSelectedForumId(value);\n    setSelectedDiscussionId(\"\");\n    setSelectedTopicId(\"\");\n  };\n\n  const handleDiscussionChange = (value: string) => {\n    setSelectedDiscussionId(value);\n    setSelectedTopicId(\"\");\n  };\n\n  // Show login prompt if not authenticated\n  if (!isAuthenticated && !isLoading) {\n    return (\n      <Dialog open={open} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center justify-between\">\n              Join the Conversation\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleClose}\n                className=\"h-6 w-6 p-0\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </DialogTitle>\n            <DialogDescription>\n              Sign in to share your experiences and connect with other caregivers.\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"text-center py-8\">\n            <LogIn className=\"w-12 h-12 text-teal-500 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n              Ready to Share Your Story?\n            </h3>\n            <p className=\"text-gray-600 mb-6\">\n              Join thousands of caregivers who have found support and answers in our community.\n            </p>\n            <div className=\"space-y-3\">\n              <Button \n                onClick={() => window.location.href = '/auth'}\n                className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\"\n              >\n                Sign In to Continue\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={handleClose}\n                className=\"w-full\"\n              >\n                Browse as Guest\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[600px] bg-teal-50\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            Start a New Discussion\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClose}\n              className=\"h-6 w-6 p-0\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </DialogTitle>\n          <DialogDescription>\n            Share your caregiving experience and connect with others facing similar challenges.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Cascading Selection: Forum â†’ Discussion â†’ Topic */}\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"forum\">Forum</Label>\n              <Select value={selectedForumId} onValueChange={handleForumChange}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select a Forum\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {Array.isArray(forums) && forums.map((forum: any) => (\n                    <SelectItem key={forum.id} value={forum.id.toString()}>\n                      {forum.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"discussion\">Discussion {discussions.length === 0 && selectedForumId && \"(Optional - will post to Forum)\"}</Label>\n              {discussions.length > 0 ? (\n                <Select value={selectedDiscussionId} onValueChange={handleDiscussionChange} disabled={!selectedForumId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a Discussion\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {discussions.map((discussion: any) => (\n                      <SelectItem key={discussion.id} value={discussion.id.toString()}>\n                        {discussion.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              ) : (\n                <div className=\"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-600\">\n                  {selectedForumId ? \n                    \"No specific discussions available. Your post will be added directly to the selected forum.\" : \n                    \"Select a forum first to see available discussions.\"\n                  }\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"topic\">Topic (Optional)</Label>\n              {mode === 'topic' ? (\n                <Input\n                  id=\"topic\"\n                  value={newTopicName}\n                  onChange={(e) => setNewTopicName(e.target.value)}\n                  placeholder=\"Enter Your Topic Name\"\n                  disabled={!selectedDiscussionId}\n                />\n              ) : topics.length > 0 ? (\n                <Select value={selectedTopicId} onValueChange={setSelectedTopicId} disabled={!selectedDiscussionId}>\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a Topic (Optional)\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {topics.map((topic: any) => (\n                      <SelectItem key={topic.id} value={topic.id.toString()}>\n                        {topic.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              ) : (\n                <div className=\"p-3 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-600\">\n                  {selectedDiscussionId ? \n                    \"No specific topics available. Your post will be added directly to the selected discussion.\" : \n                    \"Select a discussion first to see available topics.\"\n                  }\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"title\">Post Title</Label>\n            <Input\n              id=\"title\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              placeholder=\"What would you like to discuss?\"\n              maxLength={200}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"content\">Your Question or Story</Label>\n            <Textarea\n              id=\"content\"\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              placeholder=\"Share your experience, ask for advice, or start a discussion...\"\n              rows={6}\n              maxLength={2000}\n            />\n            <div className=\"text-xs text-gray-500 flex items-center gap-1\">\n              <AlertTriangle className=\"w-3 h-3\" />\n              Remember to protect personal information and avoid sharing specific medical details\n            </div>\n          </div>\n\n          <div className=\"flex gap-3 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={handleClose}\n              className=\"flex-1\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={createPostMutation.isPending}\n              className=\"flex-1 bg-teal-600 hover:bg-teal-700\"\n            >\n              {createPostMutation.isPending ? \"Posting...\" : \"Post Discussion\"}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":12931},"DATABASE_SETUP_GUIDE.md":{"content":"# Development Database Setup Guide\n\n## Current Status\n\nâœ… **Production database backup created**: `production_db_backup.sql` (3,370 lines)\nâœ… **Switching scripts created**: Ready to use\nâ³ **Development database**: Needs to be created in Replit UI\n\n---\n\n## Step-by-Step Setup Instructions\n\n### Step 1: Create Development Database in Replit\n\n1. **In your Replit workspace**, look for the **\"Database\"** tool in the left sidebar\n2. Click **\"Add database\"** or **\"Create new database\"**\n3. Select **PostgreSQL**\n4. Name it: **askedithdev**\n5. **Copy the connection string** Replit provides (looks like: `postgresql://user:password@host/database`)\n\n### Step 2: Add Development Database URL to Secrets\n\n1. In Replit, find **\"Secrets\"** (Tools â†’ Secrets, or lock icon in sidebar)\n2. Add two secrets:\n   \n   **Secret 1:**\n   - Key: `DATABASE_URL_PRODUCTION`\n   - Value: Your current production database URL (copy from existing `DATABASE_URL`)\n   \n   **Secret 2:**\n   - Key: `DATABASE_URL_DEV`\n   - Value: The connection string from your new \"askedithdev\" database\n\n3. **Keep the existing `DATABASE_URL` secret** - don't delete it!\n\n### Step 3: Import Production Data to Development Database\n\nRun this command in the Shell:\n\n```bash\n./import-to-dev-database.sh\n```\n\nThis will:\n- Import all 29 tables from production\n- Copy all existing data\n- Set up the same schema, indexes, and constraints\n\n### Step 4: Configure Your Environment\n\nEdit `.env` (or create it if it doesn't exist) to control which database to use:\n\n**For Development:**\n```bash\nDATABASE_URL=$DATABASE_URL_DEV\n```\n\n**For Production:**\n```bash\nDATABASE_URL=$DATABASE_URL_PRODUCTION\n```\n\n---\n\n## How to Switch Between Databases\n\n### Method 1: Using the Switch Script\n\n**Switch to Development:**\n```bash\nDATABASE_URL=$DATABASE_URL_DEV npm run dev\n```\n\n**Switch to Production:**\n```bash\nDATABASE_URL=$DATABASE_URL_PRODUCTION npm run dev\n```\n\n### Method 2: Environment Variables\n\nSet before running:\n```bash\n# Use development\nexport DATABASE_URL=$DATABASE_URL_DEV\nnpm run dev\n\n# Use production\nexport DATABASE_URL=$DATABASE_URL_PRODUCTION\nnpm run start\n```\n\n### Method 3: Modify .replit File\n\nYou can temporarily edit `.replit` file:\n\n**For Development:**\n```toml\n[env]\nDATABASE_URL = \"${DATABASE_URL_DEV}\"\n```\n\n**For Production:**\n```toml\n[env]\nDATABASE_URL = \"${DATABASE_URL_PRODUCTION}\"\n```\n\n---\n\n## Connection Details\n\n### Production Database\n- **Connection**: Your current Neon database\n- **Environment Variable**: `DATABASE_URL_PRODUCTION`\n- **Tables**: 29 tables (users, posts, categories, etc.)\n- **Use for**: Live published app\n\n### Development Database  \n- **Connection**: New \"askedithdev\" database (to be created)\n- **Environment Variable**: `DATABASE_URL_DEV`\n- **Tables**: Same 29 tables (imported from production)\n- **Use for**: Testing, development, experiments\n\n---\n\n## Safety Tips\n\n1. **Always use DEV for testing** - Never test destructive operations on production!\n2. **Backup before changes** - Run `pg_dump` before major schema changes\n3. **Keep secrets secure** - Never commit database URLs to git\n4. **Regular sync** - Periodically refresh dev database from production\n\n---\n\n## Quick Reference Commands\n\n```bash\n# Create fresh backup of production\npg_dump \"$DATABASE_URL_PRODUCTION\" --no-owner --no-acl > production_db_backup.sql\n\n# Import backup to development\npsql \"$DATABASE_URL_DEV\" < production_db_backup.sql\n\n# Check which database is active\necho $DATABASE_URL\n\n# Run with specific database\nDATABASE_URL=$DATABASE_URL_DEV npm run dev\nDATABASE_URL=$DATABASE_URL_PRODUCTION npm start\n\n# Connect to database directly\npsql \"$DATABASE_URL_DEV\"        # Development\npsql \"$DATABASE_URL_PRODUCTION\" # Production\n```\n\n---\n\n## Troubleshooting\n\n**Problem**: Import fails with \"database does not exist\"\n- **Solution**: Make sure you created the \"askedithdev\" database in Replit first\n\n**Problem**: Permission errors during import\n- **Solution**: The backup uses `--no-owner --no-acl` flags, should work automatically\n\n**Problem**: Can't find DATABASE_URL_DEV\n- **Solution**: Check that you added it to Replit Secrets (not just environment variables)\n\n---\n\n## Next Steps\n\n1. âœ… Create \"askedithdev\" database in Replit UI\n2. âœ… Add `DATABASE_URL_DEV` secret with the connection string\n3. âœ… Run `./import-to-dev-database.sh` to populate it\n4. âœ… Test with `DATABASE_URL=$DATABASE_URL_DEV npm run dev`\n5. âœ… Confirm dev database works, then switch back to production for live app\n\n---\n\n**Need help?** Ask me if you have questions about any of these steps!\n","size_bytes":4534},"client/src/pages/profile.tsx":{"content":"import { useRoute } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { \n  User, \n  MapPin, \n  Calendar, \n  MessageSquare, \n  ThumbsUp,\n  Clock,\n  ArrowUp,\n  ArrowDown,\n  CheckCircle,\n  Star,\n  Shield,\n  UserCheck\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function ProfilePage() {\n  const [match, params] = useRoute(\"/profile/:id\");\n  const { user: currentUser } = useAuth();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const userId = params?.id || currentUser?.id;\n\n  // If no specific user ID and we have current user, use current user data directly\n  const shouldFetchUser = userId && userId !== currentUser?.id;\n  \n  // Fetch user profile data only if it's not the current user\n  const { data: fetchedUser, isLoading: userLoading } = useQuery({\n    queryKey: [`/api/users/${userId}`],\n    enabled: !!shouldFetchUser,\n    retry: false,\n  });\n  \n  // Use current user data if viewing own profile, otherwise use fetched user\n  const user: any = shouldFetchUser ? fetchedUser : currentUser;\n\n  // Fetch user's posts\n  const { data: userPosts = [], isLoading: postsLoading } = useQuery<any[]>({\n    queryKey: [`/api/posts/user/${userId}`],\n    enabled: !!userId,\n    retry: false,\n  });\n\n  // Admin functionality: Fetch unapproved experts (only for admins viewing their own profile)\n  const isAdminViewingOwnProfile = !shouldFetchUser && currentUser?.role === 'admin';\n  const { data: unapprovedExperts = [], isLoading: unapprovedLoading } = useQuery<any[]>({\n    queryKey: ['/api/admin/unapproved-experts'],\n    enabled: isAdminViewingOwnProfile,\n    retry: false,\n  });\n\n  // Admin functionality: Approve user mutation\n  const approveMutation = useMutation({\n    mutationFn: (userId: string) => apiRequest('POST', `/api/admin/approve-user/${userId}`, {}),\n    onSuccess: () => {\n      // Comprehensive cache invalidation for real-time badge updates\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/unapproved-experts'] });\n      // Invalidate ALL expert-related queries (list, details, profiles)\n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          typeof query.queryKey[0] === 'string' && \n          query.queryKey[0].startsWith('/api/experts')\n      });\n      // Invalidate ALL post queries (list and details with expert badges)  \n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          typeof query.queryKey[0] === 'string' && \n          query.queryKey[0].startsWith('/api/posts')\n      });\n      // Invalidate user profile queries that may show expert status\n      queryClient.invalidateQueries({ \n        predicate: (query) => \n          typeof query.queryKey[0] === 'string' && \n          query.queryKey[0].startsWith('/api/users')\n      });\n      toast({\n        title: \"User Approved\",\n        description: \"The expert has been approved successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Approval Failed\",\n        description: error.message || \"Could not approve user.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatTimeAgo = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInHours = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60));\n    \n    if (diffInHours < 1) return 'just now';\n    if (diffInHours < 24) return `${diffInHours} hour${diffInHours === 1 ? '' : 's'} ago`;\n    \n    const diffInDays = Math.floor(diffInHours / 24);\n    if (diffInDays < 7) return `${diffInDays} day${diffInDays === 1 ? '' : 's'} ago`;\n    \n    return date.toLocaleDateString();\n  };\n\n  const getTimeColor = (timeAgo: string) => {\n    if (timeAgo && timeAgo.includes('hour')) return 'text-green-600';\n    if (timeAgo && timeAgo.includes('day')) return 'text-orange-600';\n    return 'text-gray-600';\n  };\n\n  if (userLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">User Not Found</h1>\n          <p className=\"text-gray-600 mb-4\">The user profile you're looking for doesn't exist.</p>\n          <Link href=\"/\">\n            <Button>Return Home</Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <div className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center space-x-4\">\n            {user.profileImageUrl ? (\n              <img\n                src={user.profileImageUrl}\n                alt={`${user.firstName} ${user.lastName}`}\n                className=\"w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg\"\n              />\n            ) : (\n              <div className=\"w-20 h-20 rounded-full bg-gray-300 flex items-center justify-center border-4 border-white shadow-lg\">\n                <User className=\"w-8 h-8 text-gray-600\" />\n              </div>\n            )}\n            <div className=\"flex-1\">\n              <h1 className=\"text-3xl font-bold text-teal-700\">\n                {user.firstName} {user.lastName}\n              </h1>\n              <div className=\"flex items-center mt-2 space-x-4 text-sm text-gray-500\">\n                <div className=\"flex items-center\">\n                  <Calendar className=\"w-4 h-4 mr-1\" />\n                  Joined {new Date(user.createdAt).toLocaleDateString()}\n                </div>\n                {user.location && (\n                  <div className=\"flex items-center\">\n                    <MapPin className=\"w-4 h-4 mr-1\" />\n                    {user.location}\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          \n          {/* User Stats */}\n          <div className=\"lg:col-span-1 space-y-6\">\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n              <h2 className=\"text-lg font-semibold text-teal-700 mb-4\">Community Contributions</h2>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <MessageSquare className=\"w-5 h-5 text-gray-400 mr-2\" />\n                    <span className=\"text-gray-600\">Posts</span>\n                  </div>\n                  <span className=\"font-semibold text-gray-900\">{userPosts.length}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center\">\n                    <ThumbsUp className=\"w-5 h-5 text-gray-400 mr-2\" />\n                    <span className=\"text-gray-600\">Total Helpful Votes</span>\n                  </div>\n                  <span className=\"font-semibold text-gray-900\">\n                    {userPosts.reduce((total, post) => total + (post.helpfulVotes || 0), 0)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* My Bookings - Only show for current user viewing their own profile */}\n            {!shouldFetchUser && (\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n                <h2 className=\"text-lg font-semibold text-teal-700 mb-4\">My Consultations</h2>\n                <Link href=\"/my-bookings\">\n                  <Button className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\">\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    View My Bookings\n                  </Button>\n                </Link>\n              </div>\n            )}\n\n            {/* Social Media Embeds - Only show for admins viewing their own profile */}\n            {isAdminViewingOwnProfile && (\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n                <h2 className=\"text-lg font-semibold text-teal-700 mb-4\">Social Media Embeds</h2>\n                <Link href=\"/admin/social-media-embeds\">\n                  <Button className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\">\n                    <Calendar className=\"w-4 h-4 mr-2\" />\n                    Manage Embeds\n                  </Button>\n                </Link>\n              </div>\n            )}\n\n            {/* Manage Sources - Only show for admins viewing their own profile */}\n            {isAdminViewingOwnProfile && (\n              <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n                <h2 className=\"text-lg font-semibold text-teal-700 mb-4\">Content Sources</h2>\n                <Link href=\"/admin/content-sources\">\n                  <Button className=\"w-full bg-teal-600 hover:bg-teal-700 text-white\">\n                    Manage Sources\n                  </Button>\n                </Link>\n              </div>\n            )}\n\n            {/* About Me Section */}\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n              <h2 className=\"text-lg font-semibold text-teal-700 mb-4\">About Me</h2>\n              {user?.introduction ? (\n                <div className=\"space-y-3\">\n                  <p className=\"text-gray-700 leading-relaxed\">{user.introduction}</p>\n                  {user.caregivingRole && (\n                    <div className=\"pt-2 border-t border-gray-100\">\n                      <span className=\"text-sm font-medium text-gray-600\">Caregiving Role:</span>\n                      <span className=\"text-sm text-gray-700 ml-2\">{user.caregivingRole}</span>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <p className=\"text-gray-500 italic\">No introduction provided yet.</p>\n              )}\n            </div>\n          </div>\n\n          {/* User Posts */}\n          <div className=\"lg:col-span-2 space-y-6\">\n            {/* Admin Approval Section - Show above Recent Posts for admins */}\n            {isAdminViewingOwnProfile && (\n              <Card className=\"bg-white shadow-sm border border-gray-200\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"text-lg font-semibold text-teal-700 flex items-center\">\n                    <Shield className=\"w-5 h-5 mr-2\" />\n                    Pending Members\n                  </CardTitle>\n                  <CardDescription>\n                    Review and approve expert applications\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {unapprovedLoading ? (\n                    <div className=\"text-center py-4\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-teal-600 mx-auto\"></div>\n                    </div>\n                  ) : unapprovedExperts.length === 0 ? (\n                    <p className=\"text-gray-500 text-sm\">No pending expert approvals</p>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      <div className=\"border border-gray-200 rounded-lg\">\n                        <Table>\n                          <TableHeader>\n                            <TableRow>\n                              <TableHead className=\"w-[200px]\">Name</TableHead>\n                              <TableHead className=\"w-[250px]\">Email</TableHead>\n                              <TableHead className=\"w-[150px]\">Joined Date</TableHead>\n                              <TableHead className=\"w-[120px] text-right\">Action</TableHead>\n                            </TableRow>\n                          </TableHeader>\n                          <TableBody>\n                            {unapprovedExperts.map((expert: any) => (\n                              <TableRow key={expert.id} className=\"hover:bg-gray-50\">\n                                <TableCell className=\"font-medium text-sm\">\n                                  {expert.firstName} {expert.lastName}\n                                </TableCell>\n                                <TableCell className=\"text-sm text-gray-600\">\n                                  {expert.email}\n                                </TableCell>\n                                <TableCell className=\"text-sm text-gray-600\">\n                                  {new Date(expert.createdAt).toLocaleDateString()}\n                                </TableCell>\n                                <TableCell className=\"text-right\">\n                                  <Button\n                                    size=\"sm\"\n                                    className=\"bg-teal-600 hover:bg-teal-700 text-white\"\n                                    onClick={() => approveMutation.mutate(expert.id)}\n                                    disabled={approveMutation.isPending}\n                                    data-testid={`button-approve-${expert.id}`}\n                                  >\n                                    <UserCheck className=\"w-4 h-4 mr-1\" />\n                                    Approve\n                                  </Button>\n                                </TableCell>\n                              </TableRow>\n                            ))}\n                          </TableBody>\n                        </Table>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200\">\n              <div className=\"px-6 py-4 border-b border-gray-200\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Recent Posts</h2>\n              </div>\n              \n              <div className=\"divide-y divide-gray-200\">\n                {postsLoading ? (\n                  <div className=\"p-6 text-center\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600 mx-auto\"></div>\n                  </div>\n                ) : userPosts.length > 0 ? (\n                  userPosts.map((post) => (\n                    <div key={post.id} className=\"p-6 hover:bg-gray-50 transition-colors\">\n                      <div className=\"flex space-x-4\">\n                        {/* Vote buttons */}\n                        <div className=\"flex flex-col items-center space-y-1 min-w-[40px]\">\n                          <button className=\"p-1 rounded transition-colors text-gray-400 hover:text-orange-600 hover:bg-orange-50\">\n                            <ArrowUp className=\"w-4 h-4\" />\n                          </button>\n                          <span className=\"text-sm font-medium text-gray-900\">\n                            {post.helpfulVotes || 0}\n                          </span>\n                          <button className=\"p-1 rounded transition-colors text-gray-400 hover:text-blue-600 hover:bg-blue-50\">\n                            <ArrowDown className=\"w-4 h-4\" />\n                          </button>\n                        </div>\n\n                        {/* Post content */}\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-start justify-between mb-2\">\n                            <Link href={`/post/${post.id}`}>\n                              <h3 className=\"text-lg font-semibold text-gray-900 hover:text-teal-700 cursor-pointer\">\n                                {post.title}\n                              </h3>\n                            </Link>\n                            {post.isResolved && (\n                              <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700 ml-4\">\n                                <CheckCircle className=\"w-3 h-3 mr-1\" />\n                                Resolved\n                              </Badge>\n                            )}\n                          </div>\n                          \n                          <p className=\"text-gray-600 mb-3 line-clamp-2\">\n                            {post.content}\n                          </p>\n                          \n                          <div className=\"flex items-center justify-between text-sm\">\n                            <div className=\"flex items-center space-x-4\">\n                              <Badge variant=\"outline\" className=\"text-teal-700 border-teal-200\">\n                                {post.category?.name || 'General'}\n                              </Badge>\n                              <div className={`flex items-center ${getTimeColor(formatTimeAgo(post.createdAt))}`}>\n                                <Clock className=\"w-4 h-4 mr-1\" />\n                                {formatTimeAgo(post.createdAt)}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center space-x-1 text-gray-500\">\n                              <MessageSquare className=\"w-4 h-4\" />\n                              <span>{post.commentCount || 0} comments</span>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\"p-6 text-center text-gray-500\">\n                    <MessageSquare className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n                    <p>No posts yet</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":18428},"server/index.ts":{"content":"import 'dotenv/config';\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { clerkAuth } from \"./middleware/clerkAuth\";\nimport fs from 'fs';\nimport path from 'path';\n\nconst app = express();\n\n// Add Clerk authentication middleware first\napp.use(clerkAuth);\n\n// Special handling for Stripe webhooks - they need raw body\napp.use('/api/stripe/webhook', express.raw({ type: 'application/json' }));\n\n// General JSON middleware for all other routes\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n// Add process error handlers to prevent silent crashes\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught Exception:', error);\n  process.exit(1);\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n  process.exit(1);\n});\n\n(async () => {\n  try {\n    const server = await registerRoutes(app);\n\n    app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n      const status = err.status || err.statusCode || 500;\n      const message = err.message || \"Internal Server Error\";\n\n      res.status(status).json({ message });\n      throw err;\n    });\n\n    // importantly only setup vite in development and after\n    // setting up all the other routes so the catch-all route\n    // doesn't interfere with the other routes\n    const isProduction = process.env.NODE_ENV === \"production\";\n    \n    // Check if built files exist to force production mode\n    const distPublicDir = path.resolve(import.meta.dirname, '..', 'dist', 'public');\n    const hasBuiltFiles = fs.existsSync(path.join(distPublicDir, 'index.html'));\n    \n    // Force production mode if built files exist, even if NODE_ENV isn't set\n    if (!isProduction && !hasBuiltFiles) {\n      await setupVite(app, server);\n    } else {\n      console.log(`Serving static files in ${isProduction ? 'production' : 'built'} mode`);\n      serveStatic(app);\n    }\n\n    // ALWAYS serve the app on port 5000\n    // this serves both the API and the client.\n    // It is the only port that is not firewalled.\n    const port = 5000;\n    const host = \"0.0.0.0\";\n\n    // Use standard Express app.listen() method instead of server.listen()\n    app.listen(port, host, () => {\n      log(`serving on ${host}:${port}`);\n      console.log(`âœ“ Server successfully started on port ${port}`);\n    });\n\n  } catch (error) {\n    console.error('Failed to start server:', error);\n    process.exit(1);\n  }\n})().catch((error) => {\n  console.error('Unhandled startup error:', error);\n  process.exit(1);\n});\n","size_bytes":3458},"client/src/pages/ExpertDirectory.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Search, MapPin, CheckCircle, Star, Globe, Linkedin, UserPlus, Clock } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport SignupModal from \"@/components/SignupModal\";\nimport MainLayout from \"@/components/MainLayout\";\n\nexport default function ExpertDirectory() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedExpertise, setSelectedExpertise] = useState(\"all\");\n  const [signupModalOpen, setSignupModalOpen] = useState(false);\n  const [isProfessionalSignup, setIsProfessionalSignup] = useState(false);\n  const { isAuthenticated } = useAuth();\n\n  const handleExpertSignup = () => {\n    setIsProfessionalSignup(true);\n    setSignupModalOpen(true);\n  };\n\n  // Use new all experts endpoint to show all experts regardless of verification status\n  const { data: experts, isLoading } = useQuery({\n    queryKey: ['/api/experts'],\n  });\n\n  const { data: featuredExperts, isLoading: featuredLoading } = useQuery({\n    queryKey: ['/api/experts/featured'],\n  });\n\n  const filteredExperts = experts?.filter((expert: any) => {\n    const matchesSearch = searchTerm === \"\" || \n      expert.profession?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expert.expertiseArea?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expert.user?.firstName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expert.user?.lastName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      expert.location?.toLowerCase().includes(searchTerm.toLowerCase());\n\n    const matchesExpertise = selectedExpertise === \"all\" || \n      expert.expertiseArea?.toLowerCase().includes(selectedExpertise.toLowerCase());\n\n    return matchesSearch && matchesExpertise;\n  }) || [];\n\n  const getInitials = (firstName?: string, lastName?: string) => {\n    if (!firstName && !lastName) return \"EX\";\n    return `${firstName?.[0] || ''}${lastName?.[0] || ''}`.toUpperCase();\n  };\n\n  const expertiseAreas = Array.from(\n    new Set(experts?.map((expert: any) => expert.expertiseArea).filter(Boolean))\n  );\n\n  if (isLoading || featuredLoading) {\n    return (\n      <MainLayout>\n        <div className=\"flex items-center justify-center min-h-[400px]\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-teal-600 border-t-transparent rounded-full\" />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout>\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Expert Directory</h1>\n            <p className=\"text-gray-600\">Connect with verified caregiving professionals and experts</p>\n          </div>\n          <div className=\"flex space-x-4\">\n            {!isAuthenticated && (\n              <Button \n                variant=\"outline\" \n                onClick={handleExpertSignup}\n                className=\"flex items-center gap-2\"\n              >\n                <UserPlus className=\"w-4 h-4\" />\n                Join as Expert\n              </Button>\n            )}\n            {isAuthenticated && (\n              <Link href=\"/expert/apply\">\n                <Button className=\"bg-teal-600 hover:bg-teal-700\">\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Apply as Expert\n                </Button>\n              </Link>\n            )}\n          </div>\n        </div>\n\n        {/* Search and Filter */}\n        <Card className=\"mb-8\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex flex-col md:flex-row gap-4\">\n              <div className=\"flex-1 relative\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Search by name, profession, or expertise...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n              <select\n                value={selectedExpertise}\n                onChange={(e) => setSelectedExpertise(e.target.value)}\n                className=\"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-teal-500\"\n              >\n                <option value=\"all\">All Expertise Areas</option>\n                {expertiseAreas.map((area: string) => (\n                  <option key={area} value={area}>\n                    {area}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Tabs defaultValue=\"all\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"all\">All Experts ({filteredExperts.length})</TabsTrigger>\n            <TabsTrigger value=\"featured\">Featured ({featuredExperts?.length || 0})</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"all\" className=\"mt-6\">\n            {filteredExperts.length === 0 ? (\n              <Card>\n                <CardContent className=\"p-8 text-center\">\n                  <div className=\"text-gray-500\">\n                    {searchTerm || selectedExpertise !== \"all\" \n                      ? \"No experts found matching your criteria\"\n                      : \"No verified experts found\"\n                    }\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {filteredExperts.map((expert: any) => (\n                  <ExpertCard key={expert.id} expert={expert} />\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"featured\" className=\"mt-6\">\n            {featuredExperts?.length === 0 ? (\n              <Card>\n                <CardContent className=\"p-8 text-center\">\n                  <div className=\"text-gray-500\">No featured experts at this time</div>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {featuredExperts?.map((expert: any) => (\n                  <ExpertCard key={expert.id} expert={expert} featured />\n                ))}\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <SignupModal \n        open={signupModalOpen}\n        onOpenChange={setSignupModalOpen}\n        isProfessional={isProfessionalSignup}\n      />\n    </MainLayout>\n  );\n}\n\n// Determine expert status based on role, approval, and verification\nconst getExpertStatus = (expert: any) => {\n  if (expert.user?.role !== 'expert') return null;\n  \n  if (expert.user?.approved === 'no') {\n    return { type: 'waiting', label: 'Waiting for Approval', color: 'bg-orange-100 text-orange-700' };\n  }\n  \n  if (expert.user?.approved === 'yes' && expert.verificationStatus === 'verified') {\n    return { type: 'verified', label: 'Verified Expert', color: 'bg-green-100 text-green-700' };\n  }\n  \n  if (expert.user?.approved === 'yes') {\n    return { type: 'approved', label: 'Verified Expert', color: 'bg-blue-100 text-blue-700' };\n  }\n  \n  return null;\n};\n\nfunction ExpertCard({ expert, featured = false }: { expert: any; featured?: boolean }) {\n  const getInitials = (firstName?: string, lastName?: string) => {\n    if (!firstName && !lastName) return \"EX\";\n    return `${firstName?.[0] || ''}${lastName?.[0] || ''}`.toUpperCase();\n  };\n\n  const expertStatus = getExpertStatus(expert);\n\n  return (\n    <Card className=\"h-full hover:shadow-lg transition-shadow\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"relative\">\n              <Avatar className=\"h-12 w-12\">\n                <AvatarImage src={expert.profileImageUrl || expert.user?.profileImageUrl} />\n                <AvatarFallback className=\"bg-teal-100 text-teal-700\">\n                  {getInitials(expert.user?.firstName, expert.user?.lastName)}\n                </AvatarFallback>\n              </Avatar>\n              {expertStatus?.type === 'verified' && (\n                <div className=\"absolute -bottom-1 -right-1 bg-green-500 rounded-full p-1\">\n                  <CheckCircle className=\"h-3 w-3 text-white\" />\n                </div>\n              )}\n            </div>\n            <div>\n              <CardTitle className=\"text-lg\">\n                {expert.user?.firstName} {expert.user?.lastName}\n              </CardTitle>\n              <p className=\"text-sm text-gray-600\">{expert.profession}</p>\n              {expertStatus && (\n                <Badge \n                  className={`${expertStatus.color} text-xs mt-1 flex items-center gap-1`}\n                  data-testid={`badge-expert-${expertStatus.type}`}\n                >\n                  {expertStatus.type === 'verified' && <CheckCircle className=\"w-3 h-3\" />}\n                  {expertStatus.type === 'waiting' && <Clock className=\"w-3 h-3\" />}\n                  {expertStatus.type === 'approved' && <Star className=\"w-3 h-3\" />}\n                  {expertStatus.label}\n                </Badge>\n              )}\n            </div>\n          </div>\n          {featured && (\n            <Badge variant=\"default\" className=\"bg-yellow-100 text-yellow-800\">\n              <Star className=\"w-3 h-3 mr-1\" />\n              Featured\n            </Badge>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"pt-0\">\n        <div className=\"space-y-3\">\n          {expert.expertiseArea && (\n            <div>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {expert.expertiseArea}\n              </Badge>\n            </div>\n          )}\n\n          {expert.yearsExperience && (\n            <p className=\"text-sm text-gray-600\">\n              {expert.yearsExperience} years of experience\n            </p>\n          )}\n\n          {expert.credentials && (\n            <p className=\"text-sm text-gray-600\">\n              <strong>Credentials:</strong> {expert.credentials}\n            </p>\n          )}\n\n          {expert.bio && (\n            <p className=\"text-sm text-gray-600 line-clamp-3\">\n              {expert.bio}\n            </p>\n          )}\n\n          <div className=\"flex flex-wrap gap-2 pt-2\">\n            {expert.website && (\n              <a\n                href={expert.website}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"text-teal-600 hover:text-teal-700\"\n              >\n                <Globe className=\"h-4 w-4\" />\n              </a>\n            )}\n            {expert.linkedinUrl && (\n              <a\n                href={expert.linkedinUrl}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"text-teal-600 hover:text-teal-700\"\n              >\n                <Linkedin className=\"h-4 w-4\" />\n              </a>\n            )}\n          </div>\n\n          <div className=\"flex justify-between items-center pt-4 border-t\">\n            <Link href={`/expert/${expert.userId}`}>\n              <Button variant=\"outline\" size=\"sm\">\n                View Profile\n              </Button>\n            </Link>\n            {expert.consultationEnabled && expert.consultationRate && (\n              <Link href={`/book-consultation/${expert.userId}`}>\n                <Button size=\"sm\" className=\"bg-teal-600 hover:bg-teal-700\">\n                  Book Call\n                </Button>\n              </Link>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":12146},"server/services/rag/vectorStore.ts":{"content":"import { db } from '../../db';\nimport { sql } from 'drizzle-orm';\nimport { qaEmbeddings, type QaEmbeddings } from '@shared/schema';\nimport { QaChunk, SearchResult, SearchConfig } from './types';\n\nexport class VectorStore {\n  private config: SearchConfig;\n\n  constructor(config: SearchConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the vector store (verify tables and indexes exist)\n   */\n  async initialize(): Promise<void> {\n    try {\n      // Verify the table exists by trying to query it\n      await db.select({ id: qaEmbeddings.id }).from(qaEmbeddings).limit(1);\n      console.log('Vector store initialized successfully');\n    } catch (error) {\n      console.error('Error initializing vector store:', error);\n      throw new Error('qa_embeddings table not found. Please run \"npm run db:push\" first.');\n    }\n  }\n\n  /**\n   * Store chunks with embeddings in the database\n   */\n  async storeChunks(chunks: QaChunk[]): Promise<void> {\n    try {\n      const embeddingsToInsert = chunks.map(chunk => ({\n        chunkText: chunk.chunkText,\n        embedding: chunk.embedding ? JSON.stringify(chunk.embedding) : null,\n        metadata: chunk.metadata\n      }));\n\n      await db.insert(qaEmbeddings).values(embeddingsToInsert);\n      console.log(`Stored ${chunks.length} chunks in vector store`);\n    } catch (error) {\n      console.error('Error storing chunks:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Search for similar chunks using vector similarity\n   */\n  async similaritySearch(\n    queryEmbedding: number[],\n    config?: Partial<SearchConfig>\n  ): Promise<SearchResult[]> {\n    const searchConfig = { ...this.config, ...config };\n\n    try {\n      const results = await db.execute(sql`\n        SELECT\n          id,\n          chunk_text,\n          metadata,\n          1 - (embedding::vector <=> ${JSON.stringify(queryEmbedding)}::vector) as similarity_score\n        FROM qa_embeddings\n        WHERE 1 - (embedding::vector <=> ${JSON.stringify(queryEmbedding)}::vector) > ${searchConfig.similarityThreshold}\n        ORDER BY embedding::vector <=> ${JSON.stringify(queryEmbedding)}::vector\n        LIMIT ${searchConfig.topK}\n      `);\n\n      return results.rows.map((row: any) => ({\n        chunk: {\n          id: row.id,\n          chunkText: row.chunk_text,\n          metadata: row.metadata,\n        },\n        score: row.similarity_score,\n        source: row.metadata.source || 'Unknown',\n      }));\n    } catch (error) {\n      console.error('Error in similarity search:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Hybrid search combining vector similarity and keyword matching\n   */\n  async hybridSearch(\n    query: string,\n    queryEmbedding: number[],\n    config?: Partial<SearchConfig>\n  ): Promise<SearchResult[]> {\n    const searchConfig = { ...this.config, ...config };\n\n    try {\n      // Perform vector similarity search\n      const vectorResults = await this.similaritySearch(queryEmbedding, config);\n\n      // Perform keyword search\n      const keywordResults = await db.execute(sql`\n        SELECT\n          id,\n          chunk_text,\n          metadata,\n          ts_rank(to_tsvector('english', chunk_text), plainto_tsquery('english', ${query})) as keyword_score\n        FROM qa_embeddings\n        WHERE to_tsvector('english', chunk_text) @@ plainto_tsquery('english', ${query})\n        ORDER BY keyword_score DESC\n        LIMIT ${searchConfig.topK}\n      `);\n\n      // Combine and rank results\n      const combinedResults = new Map<number, SearchResult>();\n\n      // Add vector results\n      vectorResults.forEach((result, index) => {\n        combinedResults.set(result.chunk.id!, {\n          ...result,\n          score: result.score * 0.7, // Weight vector similarity at 70%\n        });\n      });\n\n      // Add keyword results\n      keywordResults.rows.forEach((row: any, index: number) => {\n        const existing = combinedResults.get(row.id);\n        if (existing) {\n          existing.score += row.keyword_score * 0.3; // Weight keyword matching at 30%\n        } else {\n          combinedResults.set(row.id, {\n            chunk: {\n              id: row.id,\n              chunkText: row.chunk_text,\n              metadata: row.metadata,\n            },\n            score: row.keyword_score * 0.3,\n            source: row.metadata.source || 'Unknown',\n          });\n        }\n      });\n\n      // Sort by combined score and return top results\n      return Array.from(combinedResults.values())\n        .sort((a, b) => b.score - a.score)\n        .slice(0, searchConfig.topK);\n    } catch (error) {\n      console.error('Error in hybrid search:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get chunk by ID\n   */\n  async getChunkById(id: number): Promise<QaChunk | null> {\n    try {\n      const result = await db\n        .select()\n        .from(qaEmbeddings)\n        .where(sql`${qaEmbeddings.id} = ${id}`)\n        .limit(1);\n\n      if (result.length === 0) {\n        return null;\n      }\n\n      const row = result[0];\n      return {\n        id: row.id,\n        chunkText: row.chunkText,\n        metadata: row.metadata as QaChunk['metadata'],\n        createdAt: row.createdAt || undefined,\n      };\n    } catch (error) {\n      console.error('Error getting chunk by ID:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Delete chunks by QA ID\n   */\n  async deleteChunksByQaId(qaId: number): Promise<void> {\n    try {\n      await db.delete(qaEmbeddings).where(sql`${qaEmbeddings.qaId} = ${qaId}`);\n    } catch (error) {\n      console.error('Error deleting chunks by QA ID:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Clear all data from the vector store\n   */\n  async clearVectorStore(): Promise<void> {\n    try {\n      await db.delete(qaEmbeddings);\n      console.log('Vector store cleared successfully');\n    } catch (error) {\n      console.error('Error clearing vector store:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get statistics about the vector store\n   */\n  async getStats(): Promise<{\n    totalChunks: number;\n    totalQAs: number;\n    averageChunksPerQA: number;\n  }> {\n    try {\n      const stats = await db.execute(sql`\n        SELECT\n          COUNT(*) as total_chunks,\n          COUNT(DISTINCT id) as total_qas,\n          ROUND(COUNT(*)::numeric / COUNT(DISTINCT id), 2) as avg_chunks_per_qa\n        FROM qa_embeddings\n      `);\n\n      const row = stats.rows[0] as any;\n      return {\n        totalChunks: parseInt(String(row.total_chunks)),\n        totalQAs: parseInt(String(row.total_qas)),\n        averageChunksPerQA: parseFloat(String(row.avg_chunks_per_qa)),\n      };\n    } catch (error) {\n      console.error('Error getting vector store stats:', error);\n      throw error;\n    }\n  }\n}\n","size_bytes":6669},"test-redis.js":{"content":"// Test script to prove Redis implementation is real\nimport { createClient } from 'redis';\n\nasync function testRedis() {\n  console.log('Testing Redis implementation...');\n  \n  // Create Redis client (same config as our implementation)\n  const client = createClient({\n    url: 'redis://localhost:6379',\n    socket: {\n      reconnectStrategy: (retries) => Math.min(retries * 50, 500)\n    }\n  });\n\n  try {\n    // Connect to Redis\n    await client.connect();\n    console.log('âœ“ Connected to Redis');\n\n    // Test SET operation\n    await client.setEx('test:key', 60, JSON.stringify({ message: 'Redis is working!', timestamp: Date.now() }));\n    console.log('âœ“ SET operation successful');\n\n    // Test GET operation\n    const value = await client.get('test:key');\n    const parsed = JSON.parse(value);\n    console.log('âœ“ GET operation successful:', parsed);\n\n    // Test DEL operation\n    await client.del('test:key');\n    console.log('âœ“ DEL operation successful');\n\n    // Test our cache key patterns\n    const cacheKey = `posts:all:20:0`;\n    await client.setEx(cacheKey, 300, JSON.stringify([{id: 1, title: 'Test Post'}]));\n    const cachedPosts = await client.get(cacheKey);\n    console.log('âœ“ Cache pattern test successful:', JSON.parse(cachedPosts));\n\n    await client.disconnect();\n    console.log('âœ“ Disconnected from Redis');\n    console.log('\\nðŸŽ‰ Redis implementation is REAL and working!');\n\n  } catch (error) {\n    console.error('âŒ Redis test failed:', error.message);\n    console.log('Redis may not be running. Starting Redis server...');\n    \n    // Try to start Redis\n    const { exec } = require('child_process');\n    exec('redis-server --port 6379 --daemonize yes', (error, stdout, stderr) => {\n      if (error) {\n        console.log('Could not start Redis automatically. Manual start required.');\n      } else {\n        console.log('Redis server started. Re-run test.');\n      }\n    });\n  }\n}\n\ntestRedis();","size_bytes":1934},"server/dbConnection.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\n// Configure Neon WebSocket\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nlet dbInstance: ReturnType<typeof drizzle> | null = null;\nlet poolInstance: Pool | null = null;\n\nasync function initializeDatabase() {\n  if (dbInstance) {\n    return dbInstance;\n  }\n\n  try {\n    // Create pool with connection retry settings\n    poolInstance = new Pool({ \n      connectionString: process.env.DATABASE_URL,\n      connectionTimeoutMillis: 15000,\n      idleTimeoutMillis: 30000,\n      max: 3,\n    });\n\n    // Handle pool connection errors gracefully\n    poolInstance.on('error', (err) => {\n      console.warn('Database pool error:', err.message);\n    });\n\n    // Test the connection\n    const client = await poolInstance.connect();\n    await client.query('SELECT 1');\n    client.release();\n\n    dbInstance = drizzle({ client: poolInstance, schema });\n    console.log('Database connection established successfully');\n    return dbInstance;\n  } catch (error: any) {\n    console.error('Failed to initialize database:', error?.message || String(error));\n    throw error;\n  }\n}\n\nexport async function getDatabase() {\n  if (!dbInstance) {\n    return await initializeDatabase();\n  }\n  return dbInstance;\n}\n\nexport function getDatabaseSync() {\n  if (!dbInstance) {\n    throw new Error('Database not initialized. Call getDatabase() first.');\n  }\n  return dbInstance;\n}\n\n// Initialize database connection on module load\nlet initPromise: Promise<any> | null = null;\n\nexport function ensureDatabaseConnection() {\n  if (!initPromise) {\n    initPromise = initializeDatabase().catch(error => {\n      console.error('Database initialization failed:', error);\n      initPromise = null; // Reset so it can retry\n      throw error;\n    });\n  }\n  return initPromise;\n}","size_bytes":2040},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/admin/RagAdmin.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Brain, Database, Zap, RefreshCw, Play, BarChart3, Settings } from 'lucide-react';\nimport { useAuth } from '@/hooks/useAuth';\n\ninterface RagStats {\n  totalChunks: number;\n  totalQAs: number;\n  averageChunksPerQA: number;\n}\n\nexport default function RagAdmin() {\n  const { user } = useAuth();\n  const [stats, setStats] = useState<RagStats | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\n\n  // Check if user is admin\n  if (!user || user.role !== 'admin') {\n    return (\n      <div className=\"max-w-4xl mx-auto p-6\">\n        <Alert>\n          <AlertDescription>\n            You need admin privileges to access this page.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  const fetchStats = async () => {\n    try {\n      const response = await fetch('/api/rag/stats', {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setStats(data);\n      } else {\n        throw new Error('Failed to fetch stats');\n      }\n    } catch (error) {\n      setMessage({ type: 'error', text: 'Failed to fetch RAG system statistics' });\n    }\n  };\n\n  const initializeRagSystem = async () => {\n    setIsLoading(true);\n    setMessage(null);\n\n    try {\n      const response = await fetch('/api/rag/initialize', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n\n      if (response.ok) {\n        setMessage({ type: 'success', text: 'RAG system initialized successfully!' });\n        await fetchStats(); // Refresh stats\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to initialize RAG system');\n      }\n    } catch (error) {\n      setMessage({\n        type: 'error',\n        text: error instanceof Error ? error.message : 'Failed to initialize RAG system'\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const testRagSystem = async () => {\n    setIsLoading(true);\n    setMessage(null);\n\n    try {\n      const response = await fetch('/api/rag/test', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n\n      if (response.ok) {\n        setMessage({ type: 'success', text: 'RAG system test completed successfully!' });\n      } else {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to test RAG system');\n      }\n    } catch (error) {\n      setMessage({\n        type: 'error',\n        text: error instanceof Error ? error.message : 'Failed to test RAG system'\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchStats();\n  }, []);\n\n  return (\n    <div className=\"max-w-6xl mx-auto p-6\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center mb-4\">\n          <Brain className=\"h-8 w-8 text-blue-600 mr-3\" />\n          <h1 className=\"text-3xl font-bold text-gray-900\">RAG System Administration</h1>\n        </div>\n        <p className=\"text-gray-600\">\n          Manage and monitor the AI-powered search system for elder care knowledge base.\n        </p>\n      </div>\n\n      {message && (\n        <Alert className={`mb-6 ${message.type === 'success' ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}`}>\n          <AlertDescription className={message.type === 'success' ? 'text-green-800' : 'text-red-800'}>\n            {message.text}\n          </AlertDescription>\n        </Alert>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\">\n        {/* System Stats */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <BarChart3 className=\"h-5 w-5 mr-2 text-blue-600\" />\n              System Statistics\n            </CardTitle>\n            <CardDescription>\n              Current state of the RAG system\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {stats ? (\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-gray-600\">Total Chunks</span>\n                  <Badge variant=\"secondary\">{stats.totalChunks.toLocaleString()}</Badge>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-gray-600\">Total Q&As</span>\n                  <Badge variant=\"secondary\">{stats.totalQAs.toLocaleString()}</Badge>\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-gray-600\">Avg Chunks/QA</span>\n                  <Badge variant=\"secondary\">{stats.averageChunksPerQA.toFixed(1)}</Badge>\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-sm text-gray-500\">Loading statistics...</div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* System Status */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Database className=\"h-5 w-5 mr-2 text-green-600\" />\n              System Status\n            </CardTitle>\n            <CardDescription>\n              Current operational status\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Vector Store</span>\n                <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                  Active\n                </Badge>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Embeddings</span>\n                <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                  Ready\n                </Badge>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Search Index</span>\n                <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                  Indexed\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Settings className=\"h-5 w-5 mr-2 text-purple-600\" />\n              Quick Actions\n            </CardTitle>\n            <CardDescription>\n              Manage the RAG system\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <Button\n              onClick={initializeRagSystem}\n              disabled={isLoading}\n              className=\"w-full\"\n              variant=\"outline\"\n            >\n              <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n              Initialize System\n            </Button>\n            <Button\n              onClick={testRagSystem}\n              disabled={isLoading}\n              className=\"w-full\"\n              variant=\"outline\"\n            >\n              <Play className=\"h-4 w-4 mr-2\" />\n              Test System\n            </Button>\n            <Button\n              onClick={fetchStats}\n              disabled={isLoading}\n              className=\"w-full\"\n              variant=\"outline\"\n            >\n              <BarChart3 className=\"h-4 w-4 mr-2\" />\n              Refresh Stats\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* System Information */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Zap className=\"h-5 w-5 mr-2 text-yellow-600\" />\n              System Configuration\n            </CardTitle>\n            <CardDescription>\n              Current RAG system settings\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Embedding Model</span>\n                <span className=\"text-sm font-medium\">text-embedding-3-small</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Vector Dimension</span>\n                <span className=\"text-sm font-medium\">1536</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Chunk Size</span>\n                <span className=\"text-sm font-medium\">512 tokens</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Chunk Overlap</span>\n                <span className=\"text-sm font-medium\">50 tokens</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Search Results</span>\n                <span className=\"text-sm font-medium\">Top 5</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Similarity Threshold</span>\n                <span className=\"text-sm font-medium\">0.7</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Brain className=\"h-5 w-5 mr-2 text-blue-600\" />\n              Knowledge Base\n            </CardTitle>\n            <CardDescription>\n              Data sources and coverage\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Data Sources</span>\n                <span className=\"text-sm font-medium\">2 CSV files</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Primary Topics</span>\n                <span className=\"text-sm font-medium\">ADUs, Elder Care</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Content Type</span>\n                <span className=\"text-sm font-medium\">Q&A Format</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Last Updated</span>\n                <span className=\"text-sm font-medium\">Today</span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600\">Processing Status</span>\n                <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                  Complete\n                </Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Usage Instructions */}\n      <Card className=\"mt-6\">\n        <CardHeader>\n          <CardTitle>Usage Instructions</CardTitle>\n          <CardDescription>\n            How to use the RAG system administration panel\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div>\n              <h4 className=\"font-medium text-gray-900 mb-2\">Initialize System</h4>\n              <p className=\"text-sm text-gray-600\">\n                Use this to set up the RAG system for the first time or reinitialize after changes.\n                This will process all CSV data and create embeddings.\n              </p>\n            </div>\n            <div>\n              <h4 className=\"font-medium text-gray-900 mb-2\">Test System</h4>\n              <p className=\"text-sm text-gray-600\">\n                Run a test query to verify the system is working correctly and generating appropriate responses.\n              </p>\n            </div>\n            <div>\n              <h4 className=\"font-medium text-gray-900 mb-2\">Monitor Stats</h4>\n              <p className=\"text-sm text-gray-600\">\n                Keep track of system performance, data processing status, and usage metrics.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":13304},"client/src/components/SafetyWarning.tsx":{"content":"import { AlertTriangle, ExternalLink, Shield } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Dialog, \n  DialogContent, \n  DialogHeader, \n  DialogTitle \n} from \"@/components/ui/dialog\";\n\ninterface SafetyWarningProps {\n  open: boolean;\n  onClose: () => void;\n  url: string;\n}\n\nexport default function SafetyWarning({ open, onClose, url }: SafetyWarningProps) {\n  const handleProceed = () => {\n    if (url) {\n      window.open(url, '_blank', 'noopener,noreferrer');\n    }\n    onClose();\n  };\n\n  const getDomainFromUrl = (url: string) => {\n    try {\n      const domain = new URL(url).hostname;\n      return domain.replace('www.', '');\n    } catch {\n      return url;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <div className=\"flex items-center space-x-3 mb-4\">\n            <div className=\"w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center\">\n              <AlertTriangle className=\"w-6 h-6 text-amber-600\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-lg font-semibold text-gray-900\">\n                External Link Warning\n              </DialogTitle>\n              <p className=\"text-sm text-gray-500\">You're leaving our safe community</p>\n            </div>\n          </div>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          {url && (\n            <div className=\"bg-gray-50 rounded-lg p-3\">\n              <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                <ExternalLink className=\"w-4 h-4\" />\n                <span className=\"font-mono break-all\">{getDomainFromUrl(url)}</span>\n              </div>\n            </div>\n          )}\n          \n          <div className=\"space-y-3\">\n            <p className=\"text-gray-600\">\n              This link leads outside our community. Please verify the source before sharing any personal information. \n              Our community guidelines don't apply to external sites.\n            </p>\n            \n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n              <div className=\"flex items-start gap-2\">\n                <Shield className=\"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                <div className=\"text-sm text-blue-800\">\n                  <p className=\"font-medium mb-1\">Safety Reminder:</p>\n                  <ul className=\"text-xs space-y-1\">\n                    <li>â€¢ Never share personal contact information</li>\n                    <li>â€¢ Be cautious of requests for money or personal details</li>\n                    <li>â€¢ Verify credentials of any service providers</li>\n                    <li>â€¢ Report suspicious links to our moderation team</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex space-x-3 pt-2\">\n            <Button \n              variant=\"outline\" \n              onClick={onClose}\n              className=\"flex-1\"\n            >\n              Stay Here\n            </Button>\n            <Button \n              onClick={handleProceed}\n              className=\"flex-1 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700\"\n            >\n              Continue Anyway\n            </Button>\n          </div>\n          \n          <p className=\"text-xs text-gray-500 text-center\">\n            By continuing, you acknowledge that you understand the risks of visiting external websites.\n          </p>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":3683},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"server/services/rag/dataIngestion.ts":{"content":"import { parse } from 'csv-parse';\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\nimport { RagService } from './ragService';\nimport { EmbeddingConfig, SearchConfig } from './types';\n\nexport interface CsvQaData {\n  id: number;\n  question: string;\n  answer: string;\n  category?: string;\n  source: string;\n}\n\nexport class DataIngestionService {\n  private ragService: RagService;\n\n  constructor() {\n    const embeddingConfig: EmbeddingConfig = {\n      model: 'text-embedding-3-small',\n      dimension: 1536,\n      chunkSize: 512,\n      chunkOverlap: 50,\n    };\n\n    const searchConfig: SearchConfig = {\n      topK: 5,\n      similarityThreshold: 0.7,\n      includeMetadata: true,\n    };\n\n    this.ragService = new RagService(embeddingConfig, searchConfig);\n  }\n\n  /**\n   * Parse CSV file and return structured data\n   */\n  async parseCsvFile(filePath: string, source: string): Promise<CsvQaData[]> {\n    return new Promise((resolve, reject) => {\n      const results: CsvQaData[] = [];\n      let idCounter = 1;\n\n      const parser = parse({\n        columns: true,\n        skip_empty_lines: true,\n        trim: true,\n      });\n\n      parser.on('readable', () => {\n        let record;\n        while ((record = parser.read()) !== null) {\n          // Handle different CSV formats\n          const question = record.question || record.Question || '';\n          const answer = record.answer || record.Answer || '';\n          const category = record.category || record.Category || record.section || '';\n\n          if (question && answer) {\n            results.push({\n              id: idCounter++,\n              question: this.cleanText(question),\n              answer: this.cleanText(answer),\n              category: this.cleanText(category),\n              source,\n            });\n          }\n        }\n      });\n\n      parser.on('error', (err) => {\n        reject(err);\n      });\n\n      parser.on('end', () => {\n        resolve(results);\n      });\n\n      try {\n        const fileContent = readFileSync(filePath, 'utf-8');\n        parser.write(fileContent);\n        parser.end();\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  /**\n   * Clean and normalize text\n   */\n  private cleanText(text: string): string {\n    return text\n      .replace(/\\r\\n/g, '\\n')\n      .replace(/\\r/g, '\\n')\n      .replace(/\\t/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n  }\n\n  /**\n   * Load data from both CSV files\n   */\n  async loadAllCsvData(): Promise<CsvQaData[]> {\n    const dataDir = join(process.cwd(), 'data');\n\n    try {\n      // Load retirement QA data\n      const retirementData = await this.parseCsvFile(\n        join(dataDir, 'retirement_qa_results.csv'),\n        'retirement_qa_results.csv'\n      );\n\n      // Load improved QA data\n      const improvedData = await this.parseCsvFile(\n        join(dataDir, 'improved_qa_results_database.csv'),\n        'improved_qa_results_database.csv'\n      );\n\n      // Combine and deduplicate data\n      const combinedData = [...retirementData, ...improvedData];\n      const uniqueData = this.deduplicateData(combinedData);\n\n      console.log(`Loaded ${uniqueData.length} unique QA entries`);\n      console.log(`- Retirement data: ${retirementData.length} entries`);\n      console.log(`- Improved data: ${improvedData.length} entries`);\n      console.log(`- Duplicates removed: ${combinedData.length - uniqueData.length} entries`);\n\n      return uniqueData;\n    } catch (error) {\n      console.error('Error loading CSV data:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Remove duplicate entries based on question similarity\n   */\n  private deduplicateData(data: CsvQaData[]): CsvQaData[] {\n    const seen = new Set<string>();\n    const unique: CsvQaData[] = [];\n\n    for (const item of data) {\n      // Create a normalized key for comparison\n      const normalizedQuestion = item.question\n        .toLowerCase()\n        .replace(/[^\\w\\s]/g, '')\n        .replace(/\\s+/g, ' ')\n        .trim();\n\n      if (!seen.has(normalizedQuestion)) {\n        seen.add(normalizedQuestion);\n        unique.push(item);\n      }\n    }\n\n    return unique;\n  }\n\n  /**\n   * Initialize RAG system and load all data\n   */\n  async initializeAndLoadData(): Promise<void> {\n    try {\n      console.log('Initializing RAG system...');\n      await this.ragService.initialize();\n\n      console.log('Loading CSV data...');\n      const qaData = await this.loadAllCsvData();\n\n      console.log('Processing and storing data in vector store...');\n      await this.ragService.processAndStoreQaData(qaData);\n\n      console.log('Data ingestion completed successfully!');\n\n      // Get and display statistics\n      const stats = await this.ragService.getStats();\n      console.log('Vector store statistics:', stats);\n    } catch (error) {\n      console.error('Error during data ingestion:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Test the loaded data with a sample query\n   */\n  async testLoadedData(): Promise<void> {\n    try {\n      console.log('Testing RAG system with sample query...');\n      const testResult = await this.ragService.testRagSystem();\n\n      console.log('\\n=== RAG System Test Results ===');\n      console.log('Vector Store Stats:', testResult.stats);\n      console.log('\\nSample Query:', testResult.sampleQuery);\n      console.log('\\nGenerated Answer:', testResult.sampleResponse.answer);\n      console.log('\\nConfidence Score:', testResult.sampleResponse.confidence);\n      console.log('\\nSources Used:', testResult.sampleResponse.sources.length);\n\n      testResult.sampleResponse.sources.forEach((source, index) => {\n        console.log(`\\nSource ${index + 1}:`);\n        console.log(`- Score: ${source.score.toFixed(3)}`);\n        console.log(`- Question: ${source.chunk.metadata.question}`);\n        console.log(`- Source: ${source.source}`);\n      });\n    } catch (error) {\n      console.error('Error testing RAG system:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Clear the vector store\n   */\n  async clearVectorStore(): Promise<void> {\n    try {\n      await this.ragService.getVectorStore().clearVectorStore();\n    } catch (error) {\n      console.error('Error clearing vector store:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get the RAG service instance\n   */\n  getRagService(): RagService {\n    return this.ragService;\n  }\n}\n","size_bytes":6309},"client/src/components/Header.tsx":{"content":"import { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { Menu, X, User, LogOut, Settings, UserCheck, Shield, Brain, LayoutDashboard } from \"lucide-react\";\nimport lightbulbLogo from \"@assets/image_1749008518066.png\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger\n} from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { useUser, useClerk, SignInButton, SignUpButton } from \"@clerk/clerk-react\";\n\ninterface HeaderProps {\n  onSignupClick?: () => void;\n}\n\nexport default function Header({ onSignupClick }: HeaderProps) {\n  const { user, isSignedIn } = useUser();\n  const { signOut } = useClerk();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  \n  // Note: We'll need to sync user role from our database\n  const isAdmin = user?.publicMetadata?.role === 'admin';\n\n  const handleSignOut = () => {\n    signOut();\n  };\n\n  return (\n    <header className=\"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm\">\n      <div className=\"w-full\">\n        <div className=\"flex items-center h-16\">\n          {/* Logo and Tagline - Left Justified with 40px padding */}\n          <div className=\"flex items-center space-x-4 flex-shrink-0\" style={{ paddingLeft: '40px' }}>\n            <Link href=\"/landing\" className=\"flex items-center space-x-3\">\n              <div className=\"w-14 h-14 rounded-xl overflow-hidden bg-white flex items-center justify-center\">\n                <img\n                  src={lightbulbLogo}\n                  alt=\"AskEdith Community\"\n                  className=\"w-12 h-12 object-contain\"\n                />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-semibold text-gray-700\">AskEdith</h1>\n              </div>\n            </Link>\n            <div className=\"hidden lg:block text-gray-600 xl:text-sm lg:text-xs md:text-[10px] ml-4 leading-tight\">\n              <div>All Things Retirement.</div>\n              <div>All Things Care.</div>\n            </div>\n          </div>\n\n          {/* Mobile Navigation - Extra small fonts, no bold */}\n          <nav className=\"flex sm:hidden items-center justify-center space-x-1 flex-1 px-1\">\n            <Link href=\"/community\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-[10px]\">\n              Forums\n            </Link>\n            <Link href=\"/this-week-by\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-[10px]\">\n              News\n            </Link>\n            <Link href=\"/experts\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors flex items-center gap-0.5 text-[10px]\">\n              <UserCheck className=\"w-2.5 h-2.5\" />\n              Experts\n            </Link>\n          </nav>\n\n          {/* Small Mobile/Tablet Navigation - Very small, no bold */}\n          <nav className=\"hidden sm:flex md:hidden items-center justify-center space-x-2 flex-1 px-2\">\n            <Link href=\"/community\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-[11px]\">\n              Forums\n            </Link>\n            <Link href=\"/this-week-by\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-[11px]\">\n              News\n            </Link>\n            <Link href=\"/experts\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors flex items-center gap-1 text-[11px]\">\n              <UserCheck className=\"w-3 h-3\" />\n              Experts\n            </Link>\n          </nav>\n\n          {/* Tablet Navigation - Small fonts, no bold */}\n          <nav className=\"hidden md:flex lg:hidden items-center justify-center space-x-2 flex-1\">\n            <Link href=\"/community\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-xs\">\n              Forums\n            </Link>\n            <Link href=\"/this-week-by\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-xs\">\n              News\n            </Link>\n            <Link href=\"/experts\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors flex items-center gap-1 text-xs\">\n              <UserCheck className=\"w-3 h-3\" />\n              Experts\n            </Link>\n          </nav>\n\n          {/* Large Tablet Navigation - Small size, no bold */}\n          <nav className=\"hidden lg:flex xl:hidden items-center justify-center space-x-3 flex-1\">\n            <Link href=\"/community\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-sm\">\n              Forums\n            </Link>\n            <Link href=\"/this-week-by\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-sm\">\n              News\n            </Link>\n            <Link href=\"/experts\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors flex items-center gap-1 text-sm\">\n              <UserCheck className=\"w-4 h-4\" />\n              Experts\n            </Link>\n          </nav>\n\n          {/* Desktop Navigation - Full size, no bold */}\n          <nav className=\"hidden xl:flex items-center justify-center space-x-8 flex-1\">\n            <Link href=\"/community\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-lg\">\n              Forums\n            </Link>\n            <Link href=\"/this-week-by\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors text-lg\">\n              News\n            </Link>\n            <Link href=\"/experts\" className=\"text-gray-700 hover:text-askEdithTeal transition-colors flex items-center gap-2 text-lg\">\n              <UserCheck className=\"w-5 h-5\" />\n              Experts\n            </Link>\n          </nav>\n\n\n\n          {/* Founder's Letter Link - Much smaller on tablets */}\n          <div className=\"hidden lg:block mr-3 lg:mr-5\">\n            <Link href=\"/founders-letter\" className=\"text-gray-800 hover:text-askEdithTeal transition-colors xl:text-4xl lg:text-lg\" style={{ fontFamily: 'Tangerine, cursive', fontWeight: '700' }}>\n              Founder's Letter\n            </Link>\n          </div>\n\n          {/* User Actions */}\n          <div className=\"flex items-center space-x-3\" style={{ paddingRight: '40px' }}>\n            {isSignedIn && user ? (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"h-10 w-10 rounded-full\">\n                    <Avatar>\n                      <AvatarImage src={user.imageUrl || undefined} />\n                      <AvatarFallback>\n                        {user.firstName?.[0]}{user.lastName?.[0]}\n                      </AvatarFallback>\n                    </Avatar>\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56\">\n                  <div className=\"px-2 py-1.5\">\n                    <p className=\"text-sm font-medium\">{user.firstName} {user.lastName}</p>\n                    <p className=\"text-xs text-gray-500\">{user.emailAddresses[0]?.emailAddress}</p>\n                  </div>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem asChild>\n                    <Link href=\"/profile\">\n                      <User className=\"w-4 h-4 mr-2\" />\n                      Profile\n                    </Link>\n                  </DropdownMenuItem>\n                  <DropdownMenuItem asChild>\n                    <Link href=\"/dashboard\">\n                      <LayoutDashboard className=\"w-4 h-4 mr-2\" />\n                      Dashboard\n                    </Link>\n                  </DropdownMenuItem>\n                  <DropdownMenuItem asChild>\n                    <Link href=\"/settings\">\n                      <Settings className=\"w-4 h-4 mr-2\" />\n                      Settings\n                    </Link>\n                  </DropdownMenuItem>\n                  {isAdmin && (\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/admin/dashboard\">\n                        <Shield className=\"w-4 h-4 mr-2\" />\n                        Admin Dashboard\n                      </Link>\n                    </DropdownMenuItem>\n                  )}\n                  <DropdownMenuItem asChild>\n                    <Link href=\"/subscribe\">\n                      <UserCheck className=\"w-4 h-4 mr-2\" />\n                      Upgrade to Premium\n                    </Link>\n                  </DropdownMenuItem>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={handleSignOut}>\n                    <LogOut className=\"w-4 h-4 mr-2\" />\n                    Sign Out\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            ) : (\n              <div className=\"flex items-center space-x-2\">\n                <SignInButton mode=\"modal\">\n                  <Button variant=\"ghost\">\n                    Sign In\n                  </Button>\n                </SignInButton>\n                <SignUpButton mode=\"modal\">\n                  <Button className=\"bg-orange-500 hover:bg-orange-600 text-white text-sm\">\n                    Join Our Community\n                  </Button>\n                </SignUpButton>\n              </div>\n            )}\n\n            {/* Mobile Menu */}\n            <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"md:hidden\">\n                  <Menu className=\"w-5 h-5\" />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"right\" className=\"w-72\">\n                <div className=\"flex items-center justify-between mb-6\">\n                  <span className=\"text-lg font-semibold\">Menu</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    <X className=\"w-5 h-5\" />\n                  </Button>\n                </div>\n\n\n\n                {/* Mobile Navigation */}\n                <div className=\"space-y-4\">\n                  <Link\n                    href=\"/\"\n                    className=\"block text-gray-600 hover:text-purple-600 transition-colors\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Home\n                  </Link>\n\n                  <Link\n                    href=\"/categories\"\n                    className=\"block text-gray-600 hover:text-purple-600 transition-colors\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Categories\n                  </Link>\n                  <a\n                    href=\"#local-resources\"\n                    className=\"block text-gray-600 hover:text-purple-600 transition-colors\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Local Resources\n                  </a>\n                  <a\n                    href=\"#safety\"\n                    className=\"block text-gray-600 hover:text-purple-600 transition-colors\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Safety\n                  </a>\n                </div>\n\n                {!isSignedIn && (\n                  <div className=\"mt-6 pt-6 border-t space-y-3\">\n                    <SignInButton mode=\"modal\">\n                      <Button variant=\"outline\" className=\"w-full\">\n                        Sign In\n                      </Button>\n                    </SignInButton>\n                    <SignUpButton mode=\"modal\">\n                      <Button className=\"w-full bg-orange-500 hover:bg-orange-600 text-white\">\n                        Join Our Community\n                      </Button>\n                    </SignUpButton>\n                  </div>\n                )}\n              </SheetContent>\n            </Sheet>\n          </div>\n        </div>\n      </div>\n\n    </header>\n  );\n}\n","size_bytes":12161},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/AchievementNotification.tsx":{"content":"// components/AchievementNotification.tsx\nimport { useEffect, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useAuth } from '@/hooks/useAuth';\nimport { toast } from '@/hooks/use-toast';\n\ninterface Achievement {\n  id: number;\n  name: string;\n  description: string;\n}\n\ninterface UserAchievement {\n  id: number;\n  earnedAt: string;\n  achievement: Achievement;\n}\n\nexport function AchievementWatcher() {\n  const { user } = useAuth();\n  const [lastCheck, setLastCheck] = useState(Date.now());\n  \n  const { data: achievements } = useQuery<UserAchievement[]>({\n    queryKey: ['/api/users', user?.id, 'achievements'],\n    enabled: !!user?.id,\n    refetchInterval: 30000, // Check every 30 seconds\n  });\n  \n  useEffect(() => {\n    if (achievements && Array.isArray(achievements)) {\n      const newAchievements = achievements.filter((a: UserAchievement) => \n        new Date(a.earnedAt).getTime() > lastCheck\n      );\n      \n      newAchievements.forEach((achievement: UserAchievement) => {\n        toast({\n          title: \"Achievement Unlocked! ðŸ†\",\n          description: `${achievement.achievement.name}: ${achievement.achievement.description}`,\n          duration: 5000,\n        });\n      });\n      \n      if (newAchievements.length > 0) {\n        setLastCheck(Date.now());\n      }\n    }\n  }, [achievements, lastCheck]);\n  \n  return null;\n}","size_bytes":1373},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/pages/onboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useUser } from \"@clerk/clerk-react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Heart, Users, Sparkles, Info } from \"lucide-react\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\n// Schema for onboarding form - required fields based on user requirements\nconst onboardingSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  communityName: z.string().min(1, \"Community name is required\"),\n  username: z.string().min(1, \"Username is required\"),\n  city: z.string().min(1, \"City is required\"),\n  state: z.string().min(1, \"State is required\"),\n  timezone: z.string().optional(),\n  introduction: z.string().optional(),\n  isProfessional: z.boolean().default(false),\n  // Professional fields - conditional validation\n  company: z.string().optional(),\n  companyWebsite: z.string().url(\"Please enter a valid website URL\").optional().or(z.literal(\"\")),\n  companyPhone: z.string().optional(),\n  profession: z.string().optional(),\n  licenseNumber: z.string().optional(),\n  professionalAssociation: z.string().optional(),\n  // Appointment booking fields\n  allowBooking: z.boolean().default(false),\n  calendlyLink: z.string().url(\"Please enter a valid Calendly URL\").optional().or(z.literal(\"\")),\n  consultationRate: z.string().optional(),\n}).superRefine((data, ctx) => {\n  // Conditional validation: if user is professional, require professional fields\n  if (data.isProfessional) {\n    if (!data.company || data.company.trim() === \"\") {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Company/Organization is required for professionals\",\n        path: [\"company\"],\n      });\n    }\n    if (!data.profession || data.profession.trim() === \"\") {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Profession is required for professionals\",\n        path: [\"profession\"],\n      });\n    }\n    if (data.companyWebsite && data.companyWebsite.trim() !== \"\") {\n      try {\n        new URL(data.companyWebsite);\n      } catch {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: \"Please enter a valid website URL\",\n          path: [\"companyWebsite\"],\n        });\n      }\n    }\n    \n    // Validate Calendly link if appointment booking is enabled\n    if (data.allowBooking && (!data.calendlyLink || data.calendlyLink.trim() === \"\")) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Calendly link is required when appointment booking is enabled\",\n        path: [\"calendlyLink\"],\n      });\n    }\n    \n    if (data.calendlyLink && data.calendlyLink.trim() !== \"\") {\n      const trimmedLink = data.calendlyLink.trim();\n      if (!trimmedLink.startsWith(\"https://calendly.com/\")) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: \"Please enter a valid Calendly URL (must start with https://calendly.com/)\",\n          path: [\"calendlyLink\"],\n        });\n      }\n    }\n\n    // Validate consultation rate if appointment booking is enabled\n    if (data.allowBooking && (!data.consultationRate || data.consultationRate.trim() === \"\")) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Hourly consultation rate is required when appointment booking is enabled\",\n        path: [\"consultationRate\"],\n      });\n    }\n\n    if (data.consultationRate && data.consultationRate.trim() !== \"\") {\n      const rate = parseFloat(data.consultationRate.trim());\n      if (isNaN(rate) || rate < 50 || rate > 500) {\n        ctx.addIssue({\n          code: z.ZodIssueCode.custom,\n          message: \"Consultation rate must be between $50 and $500\",\n          path: [\"consultationRate\"],\n        });\n      }\n    }\n  }\n});\n\ntype OnboardingForm = z.infer<typeof onboardingSchema>;\n\n// Professional options for the dropdown\nconst PROFESSIONS = [\n  \"Registered Nurse (RN)\",\n  \"Licensed Practical Nurse (LPN)\",\n  \"Certified Nursing Assistant (CNA)\",\n  \"Social Worker\",\n  \"Physical Therapist\",\n  \"Occupational Therapist\",\n  \"Home Health Aide\",\n  \"Case Manager\",\n  \"Geriatrician\",\n  \"Psychologist\",\n  \"Counselor\",\n  \"Elder Law Attorney\",\n  \"Financial Planner\",\n  \"Other Healthcare Professional\",\n  \"Other Eldercare Professional\"\n];\n\n// US States for the dropdown\nconst US_STATES = [\n  { value: \"AL\", label: \"Alabama\" },\n  { value: \"AK\", label: \"Alaska\" },\n  { value: \"AZ\", label: \"Arizona\" },\n  { value: \"AR\", label: \"Arkansas\" },\n  { value: \"CA\", label: \"California\" },\n  { value: \"CO\", label: \"Colorado\" },\n  { value: \"CT\", label: \"Connecticut\" },\n  { value: \"DE\", label: \"Delaware\" },\n  { value: \"FL\", label: \"Florida\" },\n  { value: \"GA\", label: \"Georgia\" },\n  { value: \"HI\", label: \"Hawaii\" },\n  { value: \"ID\", label: \"Idaho\" },\n  { value: \"IL\", label: \"Illinois\" },\n  { value: \"IN\", label: \"Indiana\" },\n  { value: \"IA\", label: \"Iowa\" },\n  { value: \"KS\", label: \"Kansas\" },\n  { value: \"KY\", label: \"Kentucky\" },\n  { value: \"LA\", label: \"Louisiana\" },\n  { value: \"ME\", label: \"Maine\" },\n  { value: \"MD\", label: \"Maryland\" },\n  { value: \"MA\", label: \"Massachusetts\" },\n  { value: \"MI\", label: \"Michigan\" },\n  { value: \"MN\", label: \"Minnesota\" },\n  { value: \"MS\", label: \"Mississippi\" },\n  { value: \"MO\", label: \"Missouri\" },\n  { value: \"MT\", label: \"Montana\" },\n  { value: \"NE\", label: \"Nebraska\" },\n  { value: \"NV\", label: \"Nevada\" },\n  { value: \"NH\", label: \"New Hampshire\" },\n  { value: \"NJ\", label: \"New Jersey\" },\n  { value: \"NM\", label: \"New Mexico\" },\n  { value: \"NY\", label: \"New York\" },\n  { value: \"NC\", label: \"North Carolina\" },\n  { value: \"ND\", label: \"North Dakota\" },\n  { value: \"OH\", label: \"Ohio\" },\n  { value: \"OK\", label: \"Oklahoma\" },\n  { value: \"OR\", label: \"Oregon\" },\n  { value: \"PA\", label: \"Pennsylvania\" },\n  { value: \"RI\", label: \"Rhode Island\" },\n  { value: \"SC\", label: \"South Carolina\" },\n  { value: \"SD\", label: \"South Dakota\" },\n  { value: \"TN\", label: \"Tennessee\" },\n  { value: \"TX\", label: \"Texas\" },\n  { value: \"UT\", label: \"Utah\" },\n  { value: \"VT\", label: \"Vermont\" },\n  { value: \"VA\", label: \"Virginia\" },\n  { value: \"WA\", label: \"Washington\" },\n  { value: \"WV\", label: \"West Virginia\" },\n  { value: \"WI\", label: \"Wisconsin\" },\n  { value: \"WY\", label: \"Wyoming\" },\n];\n\nexport default function OnboardingPage() {\n  const { user: clerkUser } = useUser();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isProfessional, setIsProfessional] = useState(false);\n\n  const form = useForm<OnboardingForm>({\n    resolver: zodResolver(onboardingSchema),\n    defaultValues: {\n      firstName: clerkUser?.firstName || \"\",\n      lastName: clerkUser?.lastName || \"\",\n      communityName: \"\",\n      username: clerkUser?.username || \"\",\n      city: \"\",\n      state: \"\",\n      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n      introduction: \"\",\n      isProfessional: false,\n      company: \"\",\n      companyWebsite: \"\",\n      companyPhone: \"\",\n      profession: \"\",\n      licenseNumber: \"\",\n      professionalAssociation: \"\",\n      allowBooking: false,\n      calendlyLink: \"\",\n      consultationRate: \"\",\n    },\n  });\n\n  const completeProfileMutation = useMutation({\n    mutationFn: async (data: OnboardingForm) => {\n      return await apiRequest(\"POST\", \"/api/complete-profile\", data);\n    },\n    onSuccess: (updatedUser) => {\n      toast({\n        title: \"Welcome to CaregiversCommunity!\",\n        description: \"Your profile has been completed successfully.\",\n      });\n      // Update both query caches and redirect\n      queryClient.setQueryData([\"/api/user\"], updatedUser);\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile-complete\"] });\n      setLocation(\"/\"); // Redirect to home after completion\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Profile completion failed\",\n        description: error.message || \"Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: OnboardingForm) => {\n    completeProfileMutation.mutate(data);\n  };\n\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-orange-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-2xl\">\n        <CardHeader className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center\">\n              <Heart className=\"w-8 h-8 text-teal-600\" />\n            </div>\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-gray-800\">\n            Welcome to AskEdith!\n          </CardTitle>\n          <CardDescription className=\"text-lg\">\n            Help us personalize your experience by completing your profile\n          </CardDescription>\n        </CardHeader>\n\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              {/* Basic Information */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Users className=\"w-5 h-5 text-teal-600\" />\n                  <h3 className=\"text-lg font-semibold text-gray-800\">Basic Information</h3>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"firstName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>First Name *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"John\"\n                            {...field}\n                            data-testid=\"input-firstname\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"lastName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Last Name *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Doe\"\n                            {...field}\n                            data-testid=\"input-lastname\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"communityName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Your Community Name *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Choose a name others will see (e.g., CaringDaughter, Portland)\"\n                          {...field}\n                          data-testid=\"input-community-name\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div>\n                  <label className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\">\n                    Email Address\n                  </label>\n                  <Input\n                    value={clerkUser?.emailAddresses?.[0]?.emailAddress || \"\"}\n                    readOnly\n                    disabled\n                    className=\"bg-gray-100\"\n                    data-testid=\"input-email\"\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Username *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Your unique username\"\n                          {...field}\n                          data-testid=\"input-username\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Location Information */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Sparkles className=\"w-5 h-5 text-teal-600\" />\n                  <h3 className=\"text-lg font-semibold text-gray-800\">Location</h3>\n                  <span className=\"text-sm text-gray-500\">Helps connect you with local resources</span>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"city\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>City *</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"Portland\"\n                            {...field}\n                            data-testid=\"input-city\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"state\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>State *</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-state\">\n                              <SelectValue placeholder=\"Select state\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {US_STATES.map((state) => (\n                              <SelectItem key={state.value} value={state.value}>\n                                {state.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </div>\n\n              {/* Introduction */}\n              <div className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"introduction\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>What brings you to our community? (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Share a bit about your caregiving journey...\"\n                          className=\"resize-none\"\n                          rows={4}\n                          {...field}\n                          data-testid=\"textarea-introduction\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Professional Checkbox */}\n              <div className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"isProfessional\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md border border-teal-200 bg-teal-50 p-4\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={(checked) => {\n                            field.onChange(checked);\n                            setIsProfessional(!!checked);\n                          }}\n                          data-testid=\"checkbox-professional\"\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel className=\"text-sm font-medium text-teal-800\">\n                          I'm a healthcare or eldercare professional\n                        </FormLabel>\n                        <p className=\"text-xs text-teal-600\">\n                          Join as a verified expert with consultation capabilities ($100 verification fee)\n                        </p>\n                      </div>\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Professional Information - Only shown when checkbox is checked */}\n              {isProfessional && (\n                <div className=\"space-y-4 rounded-md border border-orange-200 bg-orange-50 p-4\">\n                  <div className=\"flex items-center gap-2 mb-4\">\n                    <Users className=\"w-5 h-5 text-orange-600\" />\n                    <h3 className=\"text-lg font-semibold text-orange-800\">Professional Information</h3>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"company\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company/Organization</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"Compassionate Care Services\"\n                              {...field}\n                              data-testid=\"input-company\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"companyWebsite\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Company Website</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"https://www.yourcompany.com\"\n                              {...field}\n                              data-testid=\"input-company-website\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"companyPhone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Company Phone</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder=\"(555) 123-4567\"\n                            {...field}\n                            data-testid=\"input-company-phone\"\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"profession\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Profession</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-profession\">\n                              <SelectValue placeholder=\"Select your profession\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {PROFESSIONS.map((profession) => (\n                              <SelectItem key={profession} value={profession}>\n                                {profession}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"licenseNumber\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>License Number (if applicable)</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"License #123456\"\n                              {...field}\n                              data-testid=\"input-license-number\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"professionalAssociation\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Professional Association</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder=\"National Association of...\"\n                              {...field}\n                              data-testid=\"input-professional-association\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {/* Appointment Booking Settings */}\n                  <div className=\"space-y-4 pt-4 border-t border-orange-300\">\n                    <FormField\n                      control={form.control}\n                      name=\"allowBooking\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                              className=\"data-[state=checked]:bg-teal-600 data-[state=checked]:border-teal-600 mt-1\"\n                              data-testid=\"checkbox-allow-booking-onboarding\"\n                            />\n                          </FormControl>\n                          <div className=\"space-y-1 leading-none\">\n                            <FormLabel>\n                              Allow appointment booking after verification\n                            </FormLabel>\n                            <p className=\"text-xs text-gray-500\">\n                              Enable clients to book paid consultation sessions with you\n                            </p>\n                          </div>\n                        </FormItem>\n                      )}\n                    />\n\n                    {form.watch('allowBooking') && (\n                      <>\n                        <FormField\n                          control={form.control}\n                          name=\"calendlyLink\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"flex items-center gap-2\">\n                                Calendly Link\n                                <TooltipProvider>\n                                  <Tooltip>\n                                    <TooltipTrigger asChild>\n                                      <Info className=\"h-4 w-4 text-gray-400 hover:text-gray-600 cursor-help\" />\n                                    </TooltipTrigger>\n                                    <TooltipContent>\n                                      <p>Your Calendly link for appointment scheduling (set up your Calendly account separately)</p>\n                                    </TooltipContent>\n                                  </Tooltip>\n                                </TooltipProvider>\n                              </FormLabel>\n                              <FormControl>\n                                <Input\n                                  placeholder=\"https://calendly.com/your-username\"\n                                  {...field}\n                                  data-testid=\"input-calendly-link-onboarding\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={form.control}\n                          name=\"consultationRate\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Hourly Consultation Rate (USD)</FormLabel>\n                              <FormControl>\n                                <Input\n                                  type=\"number\"\n                                  placeholder=\"150\"\n                                  min=\"50\"\n                                  max=\"500\"\n                                  {...field}\n                                  data-testid=\"input-consultation-rate\"\n                                />\n                              </FormControl>\n                              <p className=\"text-xs text-gray-500\">\n                                Set your hourly rate for consultation sessions ($50-$500)\n                              </p>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </>\n                    )}\n                  </div>\n\n                  {/* Professional Verification Notice */}\n                  <div className=\"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md\">\n                    <div className=\"flex items-start\">\n                      <div className=\"flex-shrink-0\">\n                        <Sparkles className=\"h-5 w-5 text-yellow-400\" />\n                      </div>\n                      <div className=\"ml-3\">\n                        <h4 className=\"text-sm font-medium text-yellow-800\">\n                          Professional Verification\n                        </h4>\n                        <p className=\"mt-1 text-sm text-yellow-700\">\n                          A $100 verification fee will be required to confirm your credentials and enable consultation features.\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Action Buttons */}\n              <div className=\"flex flex-col gap-3 pt-6\">\n                <Button\n                  type=\"submit\"\n                  className=\"w-full bg-teal-600 hover:bg-teal-700\"\n                  disabled={completeProfileMutation.isPending}\n                  data-testid=\"button-complete-profile\"\n                >\n                  {completeProfileMutation.isPending ? \"Completing...\" : \"Complete Profile\"}\n                </Button>\n\n              </div>\n\n              <p className=\"text-sm text-gray-500 text-center\">\n                Your email is managed securely by Clerk and cannot be changed here.\n                <br />\n                Visit your account settings to update email preferences.\n              </p>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":29126},"server/middleware/rateLimiter.ts":{"content":"import rateLimit from 'express-rate-limit';\n\n// Rate limiter for login attempts\nexport const loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // Limit each IP to 5 requests per windowMs\n  message: 'Too many login attempts from this IP, please try again after 15 minutes',\n  standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers\n  legacyHeaders: false, // Disable the `X-RateLimit-*` headers\n  skipSuccessfulRequests: true, // Don't count successful requests\n});\n\n// Rate limiter for registration\nexport const registrationLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  max: 3, // Limit each IP to 3 registration requests per hour\n  message: 'Too many accounts created from this IP, please try again after an hour',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Rate limiter for password reset requests\nexport const passwordResetLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  max: 3, // Limit each IP to 3 password reset requests per hour\n  message: 'Too many password reset requests from this IP, please try again after an hour',\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// General API rate limiter\nexport const apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // Limit each IP to 100 requests per windowMs\n  message: 'Too many requests from this IP, please try again later',\n  standardHeaders: true,\n  legacyHeaders: false,\n});","size_bytes":1465},"client/src/components/GraphQLStatsDemo.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { graphqlRequest, GET_COMMUNITY_STATS, GET_CATEGORIES, type CommunityStats, type Category } from '@/lib/graphql';\nimport { Users, MessageSquare, TrendingUp, Calendar } from 'lucide-react';\n\nexport function GraphQLStatsDemo() {\n  const [stats, setStats] = useState<CommunityStats | null>(null);\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [usingGraphQL, setUsingGraphQL] = useState(false);\n\n  const fetchWithGraphQL = async () => {\n    setLoading(true);\n    setError(null);\n    setUsingGraphQL(true);\n    \n    try {\n      // Fetch community stats via GraphQL\n      const statsResponse = await graphqlRequest<{ communityStats: CommunityStats }>({\n        query: GET_COMMUNITY_STATS\n      });\n      \n      if (statsResponse.data) {\n        setStats(statsResponse.data.communityStats);\n      }\n\n      // Fetch categories via GraphQL\n      const categoriesResponse = await graphqlRequest<{ categories: Category[] }>({\n        query: GET_CATEGORIES\n      });\n      \n      if (categoriesResponse.data) {\n        setCategories(categoriesResponse.data.categories);\n      }\n      \n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'GraphQL request failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchWithREST = async () => {\n    setLoading(true);\n    setError(null);\n    setUsingGraphQL(false);\n    \n    try {\n      // Fetch community stats via REST API\n      const statsResponse = await fetch('/api/stats');\n      if (!statsResponse.ok) {\n        throw new Error(`HTTP Error: ${statsResponse.status}`);\n      }\n      const statsData = await statsResponse.json();\n      setStats(statsData);\n\n      // Fetch categories via REST API\n      const categoriesResponse = await fetch('/api/categories');\n      if (!categoriesResponse.ok) {\n        throw new Error(`HTTP Error: ${categoriesResponse.status}`);\n      }\n      const categoriesData = await categoriesResponse.json();\n      setCategories(categoriesData);\n      \n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'REST request failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Load with REST by default\n  useEffect(() => {\n    fetchWithREST();\n  }, []);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* API Comparison Header */}\n      <Card className=\"border-blue-200 bg-blue-50 dark:bg-blue-950 dark:border-blue-800\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            API Integration Demo\n            <Badge variant={usingGraphQL ? \"default\" : \"secondary\"}>\n              {usingGraphQL ? \"GraphQL\" : \"REST API\"}\n            </Badge>\n          </CardTitle>\n          <CardDescription>\n            Compare GraphQL vs REST API performance for fetching community data\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex gap-2\">\n            <Button \n              onClick={fetchWithGraphQL} \n              disabled={loading}\n              variant={usingGraphQL ? \"default\" : \"outline\"}\n            >\n              {loading && usingGraphQL ? \"Loading...\" : \"Use GraphQL\"}\n            </Button>\n            <Button \n              onClick={fetchWithREST} \n              disabled={loading}\n              variant={!usingGraphQL ? \"default\" : \"outline\"}\n            >\n              {loading && !usingGraphQL ? \"Loading...\" : \"Use REST API\"}\n            </Button>\n          </div>\n          {error && (\n            <div className=\"mt-4 p-3 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 rounded-md\">\n              <p className=\"text-red-700 dark:text-red-300 text-sm\">Error: {error}</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Community Stats */}\n      {stats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Users</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.totalUsers}</div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Posts</CardTitle>\n              <MessageSquare className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.totalPosts}</div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Comments</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.totalComments}</div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Posts This Week</CardTitle>\n              <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{stats.postsThisWeek}</div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Categories Preview */}\n      {categories.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Discussion Categories</CardTitle>\n            <CardDescription>\n              Showing {categories.length} categories fetched via {usingGraphQL ? \"GraphQL\" : \"REST API\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {categories.slice(0, 6).map((category) => (\n                <div\n                  key={category.id}\n                  className=\"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors\"\n                >\n                  <div\n                    className=\"w-3 h-3 rounded-full flex-shrink-0\"\n                    style={{ backgroundColor: category.color }}\n                  />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium truncate\">{category.name}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {category.postCount || 0} posts\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n            {categories.length > 6 && (\n              <p className=\"text-sm text-muted-foreground mt-4\">\n                And {categories.length - 6} more categories...\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Technical Details */}\n      <Card className=\"border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800\">\n        <CardHeader>\n          <CardTitle className=\"text-green-800 dark:text-green-200\">\n            GraphQL Implementation Status\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-sm space-y-2\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n            <span>GraphQL server running at /graphql endpoint</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n            <span>Type-safe GraphQL schema with 150+ fields</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n            <span>Resolvers for nested data relationships</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n            <span>Session-based authentication integration</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n            <span>Both GraphQL and REST APIs available</span>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":8947},"client/src/pages/ExpertApplicationPaymentFixed.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { uploadFile } from \"@/lib/supabase\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { supabase } from \"@/lib/supabase\";\nimport { CheckCircle, Clock, XCircle, UserCheck, FileText, Upload, DollarSign, CreditCard, Linkedin } from \"lucide-react\";\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\n// Load Stripe\nif (!import.meta.env.VITE_STRIPE_PUBLIC_KEY) {\n  throw new Error('Missing required Stripe key: VITE_STRIPE_PUBLIC_KEY');\n}\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY);\n\nconst expertApplicationSchema = z.object({\n  profession: z.string().min(2, \"Profession is required\"),\n  expertiseArea: z.string().min(5, \"Please describe your areas of expertise\"),\n  yearsOfExperience: z.number().min(1, \"Years of experience must be at least 1\").max(50, \"Please enter a realistic number\"),\n  credentials: z.string().min(10, \"Please provide your credentials and qualifications\"),\n  bio: z.string().min(50, \"Please provide a detailed bio (at least 50 characters)\"),\n  licenseNumber: z.string().min(1, \"License number is required\"),\n  company: z.string().min(2, \"Company/Organization name is required\"),\n  companyAddress: z.string().min(10, \"Company address is required\"),\n  companyWebsite: z.string().url(\"Please enter a valid company website URL\").optional().or(z.literal(\"\")),\n  companyEmail: z.string().email(\"Please enter a valid company email\"),\n  websiteUrl: z.string().url(\"Please enter a valid website URL\").optional().or(z.literal(\"\")),\n  linkedinUrl: z.string().url(\"Please enter a valid LinkedIn URL\").optional().or(z.literal(\"\")),\n  blogUrl: z.string().url(\"Please enter a valid blog URL\").optional().or(z.literal(\"\")),\n  booksUrl: z.string().url(\"Please enter a valid books/publications URL\").optional().or(z.literal(\"\")),\n  articlesUrl: z.string().url(\"Please enter a valid articles URL\").optional().or(z.literal(\"\")),\n  consultationRate: z.number().min(50, \"Minimum consultation rate is $50/hour\").max(500, \"Maximum rate is $500/hour\"),\n  consultationEnabled: z.boolean().default(true),\n  reasonForApplying: z.string().min(20, \"Please explain why you want to become a verified expert\"),\n  importFromLinkedIn: z.boolean().default(false),\n});\n\ntype ExpertApplicationForm = z.infer<typeof expertApplicationSchema>;\n\n// Simplified payment form that creates payment intent on demand\nconst PaymentForm = ({ applicationData, profileImage, licenseFile, onSuccess }: { \n  applicationData: ExpertApplicationForm;\n  profileImage: File | null;\n  licenseFile: File | null;\n  onSuccess: () => void;\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!stripe || !elements || !user) {\n      toast({\n        title: \"Error\",\n        description: \"Payment system not ready. Please refresh and try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      // Get card element\n      const card = elements.getElement(CardElement);\n      if (!card) {\n        throw new Error('Card element not found');\n      }\n\n      // Create payment method\n      const { error: pmError, paymentMethod } = await stripe.createPaymentMethod({\n        type: 'card',\n        card,\n      });\n\n      if (pmError) {\n        throw pmError;\n      }\n\n      // Upload files first if they exist\n      let profileImageUrl: string | undefined;\n      let licenseFileUrl: string | undefined;\n\n      if (profileImage) {\n        console.log('Uploading profile image...');\n        const { url, error } = await uploadFile(profileImage, user.id, 'profile');\n        if (error) throw new Error(`Profile image upload failed: ${error}`);\n        profileImageUrl = url || undefined;\n      }\n\n      if (licenseFile) {\n        console.log('Uploading license file...');\n        const { url, error } = await uploadFile(licenseFile, user.id, 'license');\n        if (error) throw new Error(`License file upload failed: ${error}`);\n        licenseFileUrl = url || undefined;\n      }\n\n      // Submit application with payment method\n      const response = await apiRequest('POST', '/api/experts/apply-with-payment-method', {\n        ...applicationData,\n        profileImageUrl,\n        licenseFileUrl,\n        paymentMethodId: paymentMethod.id\n      });\n\n      const result = await response.json();\n\n      if (result.requiresAction && result.clientSecret) {\n        // Handle 3D Secure\n        const { error: confirmError } = await stripe.confirmCardPayment(result.clientSecret);\n        if (confirmError) {\n          throw confirmError;\n        }\n      }\n\n      toast({\n        title: \"Success!\",\n        description: \"Your expert application and payment have been processed.\",\n      });\n      onSuccess();\n\n    } catch (error: any) {\n      console.error(\"Payment error:\", error);\n      toast({\n        title: \"Payment Failed\",\n        description: error.message || \"Unable to process payment. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div className=\"bg-teal-50 border border-teal-200 rounded-lg p-4\">\n        <div className=\"flex items-center gap-2 mb-2\">\n          <DollarSign className=\"h-5 w-5 text-teal-600\" />\n          <h3 className=\"font-semibold text-teal-800\">Expert Verification Fee</h3>\n        </div>\n        <p className=\"text-teal-700 text-sm mb-3\">\n          A one-time $100 verification fee ensures the quality and authenticity of our expert community.\n        </p>\n        <div className=\"text-2xl font-bold text-teal-800\">$100.00</div>\n      </div>\n\n      <div className=\"p-4 border rounded-lg\">\n        <CardElement \n          options={{\n            style: {\n              base: {\n                fontSize: '16px',\n                color: '#424770',\n                '::placeholder': {\n                  color: '#aab7c4',\n                },\n              },\n              invalid: {\n                color: '#9e2146',\n              },\n            },\n          }}\n        />\n      </div>\n      \n      <Button \n        type=\"submit\" \n        disabled={!stripe || isProcessing} \n        className=\"w-full\"\n        size=\"lg\"\n      >\n        {isProcessing ? (\n          <>\n            <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n            Processing...\n          </>\n        ) : (\n          <>\n            <CreditCard className=\"w-4 h-4 mr-2\" />\n            Pay $100 & Submit Application\n          </>\n        )}\n      </Button>\n    </form>\n  );\n};\n\nexport default function ExpertApplicationPaymentFixed() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [step, setStep] = useState<'form' | 'payment' | 'success'>('form');\n  const [applicationData, setApplicationData] = useState<ExpertApplicationForm | null>(null);\n  const [profileImage, setProfileImage] = useState<File | null>(null);\n  const [licenseFile, setLicenseFile] = useState<File | null>(null);\n\n  // Check if user already has an expert verification\n  const { data: existingApplication, isLoading: checkingExisting } = useQuery({\n    queryKey: ['/api/experts/my-application'],\n    enabled: !!user?.id,\n    retry: false,\n    queryFn: async () => {\n      const res = await apiRequest('GET', '/api/experts/my-application');\n      if (res.status === 404) {\n        return null;\n      }\n      return res.json();\n    }\n  });\n\n  const form = useForm<ExpertApplicationForm>({\n    resolver: zodResolver(expertApplicationSchema),\n    defaultValues: {\n      profession: \"\",\n      expertiseArea: \"\",\n      yearsOfExperience: 5,\n      credentials: \"\",\n      bio: \"\",\n      licenseNumber: \"\",\n      company: \"\",\n      companyAddress: \"\",\n      companyWebsite: \"\",\n      companyEmail: \"\",\n      websiteUrl: \"\",\n      linkedinUrl: \"\",\n      blogUrl: \"\",\n      booksUrl: \"\",\n      articlesUrl: \"\",\n      consultationRate: 150,\n      consultationEnabled: true,\n      reasonForApplying: \"\",\n      importFromLinkedIn: false,\n    },\n  });\n\n  const onFormSubmit = (data: ExpertApplicationForm) => {\n    setApplicationData(data);\n    setStep('payment');\n  };\n\n  const onPaymentSuccess = () => {\n    setStep('success');\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <UserCheck className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to apply for expert verification status.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (checkingExisting) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  if (existingApplication) {\n    const status = existingApplication.verificationStatus;\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3\">\n              {status === 'pending' && <Clock className=\"h-6 w-6 text-yellow-500\" />}\n              {status === 'approved' && <CheckCircle className=\"h-6 w-6 text-green-500\" />}\n              {status === 'rejected' && <XCircle className=\"h-6 w-6 text-red-500\" />}\n              Expert Verification Status\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-gray-600\">Current Status:</span>\n                <Badge variant={\n                  status === 'pending' ? 'default' :\n                  status === 'approved' ? 'default' :\n                  'destructive'\n                } className={\n                  status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\n                  status === 'approved' ? 'bg-green-100 text-green-800' :\n                  ''\n                }>\n                  {status === 'pending' && 'Under Review'}\n                  {status === 'approved' && 'Verified Expert'}\n                  {status === 'rejected' && 'Application Rejected'}\n                </Badge>\n              </div>\n              \n              {status === 'pending' && (\n                <p className=\"text-gray-600\">\n                  Your application is currently under review. We'll notify you via email once a decision has been made, typically within 3-5 business days.\n                </p>\n              )}\n              \n              {status === 'approved' && (\n                <div className=\"space-y-4\">\n                  <p className=\"text-gray-600\">\n                    Congratulations! You're now a verified expert. You can start accepting consultations.\n                  </p>\n                  <Button onClick={() => window.location.href = '/dashboard'}>\n                    Go to Dashboard\n                  </Button>\n                </div>\n              )}\n              \n              {status === 'rejected' && existingApplication.reviewNotes && (\n                <div className=\"bg-red-50 p-4 rounded-lg\">\n                  <p className=\"text-red-800 font-medium mb-2\">Feedback from our review team:</p>\n                  <p className=\"text-red-700\">{existingApplication.reviewNotes}</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'payment') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n        <div className=\"max-w-2xl mx-auto\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5\" />\n                Complete Your Expert Verification\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <Elements stripe={stripePromise}>\n                <PaymentForm \n                  applicationData={applicationData!} \n                  profileImage={profileImage}\n                  licenseFile={licenseFile}\n                  onSuccess={onPaymentSuccess} \n                />\n              </Elements>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'success') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-2xl mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-4 text-green-500\" />\n            <h2 className=\"text-3xl font-semibold mb-4\">Application Submitted Successfully!</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Thank you for your payment and application. Our team will review your credentials and get back to you within 3-5 business days.\n            </p>\n            <div className=\"flex gap-4 justify-center\">\n              <Button onClick={() => window.location.href = '/'}>\n                Return to Home\n              </Button>\n              <Button variant=\"outline\" onClick={() => window.location.href = '/dashboard'}>\n                View Dashboard\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // The form would go here, but for this test we'll just show the payment step\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-4\">Apply for Expert Verification</h1>\n          <p className=\"text-lg text-gray-600 max-w-2xl mx-auto\">\n            Join our trusted community of verified experts and start earning through consultations. \n            One-time $100 verification fee ensures quality and authenticity.\n          </p>\n        </div>\n        \n        <Card>\n          <CardContent className=\"p-8\">\n            <p className=\"text-gray-600 text-center\">Application form would go here...</p>\n            <Button \n              onClick={() => {\n                setApplicationData({\n                  profession: \"Financial Planner\",\n                  expertiseArea: \"Retirement planning and wealth management\",\n                  yearsOfExperience: 10,\n                  credentials: \"CFP, ChFC\",\n                  bio: \"I help families plan for a secure retirement with over 10 years of experience in wealth management and financial planning.\",\n                  licenseNumber: \"CFP123456\",\n                  company: \"Retirement Planning Associates\",\n                  companyAddress: \"123 Main St, Suite 100, Anytown, USA 12345\",\n                  companyWebsite: \"https://example.com\",\n                  companyEmail: \"info@example.com\",\n                  websiteUrl: \"\",\n                  linkedinUrl: \"\",\n                  blogUrl: \"\",\n                  booksUrl: \"\",\n                  articlesUrl: \"\",\n                  consultationRate: 150,\n                  consultationEnabled: true,\n                  reasonForApplying: \"I want to help more families achieve their retirement goals through personalized guidance.\",\n                  importFromLinkedIn: false,\n                });\n                setStep('payment');\n              }} \n              className=\"mx-auto block mt-8\"\n            >\n              Proceed to Payment (Test)\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":17120},"client/src/pages/FoundersLetter.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport SearchHeader from \"@/components/SearchHeader\";\nimport DynamicDiscussionTopicsSidebar from \"@/components/DynamicDiscussionTopicsSidebar\";\n\nexport default function FoundersLetter() {\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/categories/hierarchy\"],\n    staleTime: 30 * 60 * 1000,\n  });\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <SearchHeader title=\"Founder's Letter\" showActionButtons={false} />\n\n      <div className=\"flex\">\n        {/* Sidebar */}\n        <DynamicDiscussionTopicsSidebar />\n\n        {/* Main Content */}\n        <div className=\"flex-1 p-8\">\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"bg-white rounded-lg shadow-sm p-8\">\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-8 text-center\">\n                A Letter from Our Founder\n              </h1>\n\n              <div className=\"prose prose-lg max-w-none text-gray-700 leading-relaxed space-y-6\">\n                <p>Dear Community Members,</p>\n\n                <p>\n                  When I first envisioned AskEdith, it was born from a deeply\n                  personal placeâ€”watching my own family navigate the complex\n                  world of caregiving and retirement planning. Like so many of\n                  you, I found myself searching for reliable information,\n                  support, and most importantly, a community that truly\n                  understood the challenges we face.\n                </p>\n\n                <p>\n                  The statistics are staggering: over 53 million Americans are\n                  currently providing care for an adult family member or friend,\n                  and millions more are approaching retirement with uncertainty\n                  about their future. Yet despite these numbers, finding\n                  trustworthy guidance and genuine community support often feels\n                  impossible.\n                </p>\n\n                <p>\n                  That's why we created this spaceâ€”not just as another website,\n                  but as a true community where your experiences matter, your\n                  questions are welcomed, and your wisdom is valued. Here,\n                  you'll find expert guidance from verified professionals,\n                  curated resources from trusted sources, and most importantly,\n                  connection with others who share your journey.\n                </p>\n\n                <p>\n                  Whether you're researching memory care options for a parent,\n                  planning your own retirement, or simply looking for someone\n                  who understands the emotional weight of caregiving decisions,\n                  you belong here. Every forum discussion, every expert\n                  consultation, and every piece of curated content is designed\n                  with your real-world needs in mind.\n                </p>\n\n                <p>\n                  We believe that informed decisions lead to better outcomes,\n                  and that no one should have to navigate these important life\n                  transitions alone. Our platform combines the wisdom of lived\n                  experience with professional expertise, creating a resource\n                  that's both comprehensive and deeply human.\n                </p>\n\n                <p>\n                  As we continue to grow and evolve, your feedback shapes every\n                  decision we make. This community belongs to all of us, and\n                  together, we're building something that truly makes a\n                  difference in people's lives.\n                </p>\n\n                <p>\n                  Thank you for being part of this journey. Thank you for\n                  sharing your stories, asking important questions, and\n                  supporting one another. And thank you for trusting us to be a\n                  part of your story.\n                </p>\n\n                <p className=\"mt-8\">With deep gratitude and warm regards,</p>\n\n                <div className=\"mt-8 border-t pt-6\">\n                  <div className=\"text-2xl font-semibold text-gray-900 mb-2\">\n                    Elias Papasavvas\n                  </div>\n                  <div className=\"text-lg text-gray-600\">\n                    Founder & CEO, AskEdith Community\n                  </div>\n                  <div className=\"mt-4 text-sm text-gray-500\">\n                    Former family caregiver, retirement planning advocate, and\n                    believer in the power of community\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4787},"client/src/components/RagSearch.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { Search, Loader2, ExternalLink, Info } from \"lucide-react\";\nimport ReactMarkdown from \"react-markdown\";\n\ninterface RagSearchResult {\n  paragraphs: string[];\n  confidence: number;\n  sources: Array<{\n    question: string;\n    content: string;\n    score: number;\n    source: string;\n  }>;\n  totalSources: number;\n}\n\nexport function RagSearch() {\n  const [query, setQuery] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [result, setResult] = useState<RagSearchResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [visibleParagraphs, setVisibleParagraphs] = useState<number>(0);\n  const [paragraphVisibility, setParagraphVisibility] = useState<{\n    [key: number]: boolean;\n  }>({});\n\n  const handleSearch = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!query.trim()) return;\n\n    setIsLoading(true);\n    setError(null);\n    setResult(null);\n    setVisibleParagraphs(0);\n    setParagraphVisibility({});\n\n    try {\n      const response = await fetch(\"/api/rag-search-stream\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ query: query.trim() }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to search\");\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      let fullContent = \"\";\n      let metadata: any = null;\n      let currentParagraphs: string[] = [];\n      let buffer = \"\"; // Buffer for incomplete chunks\n\n      if (reader) {\n        while (true) {\n          const { done, value } = await reader.read();\n\n          if (done) break;\n\n          const chunk = decoder.decode(value, { stream: true });\n          buffer += chunk;\n\n          // Split by lines but keep incomplete lines in buffer\n          const lines = buffer.split(\"\\n\");\n          buffer = lines.pop() || \"\"; // Keep the last (potentially incomplete) line in buffer\n\n          for (const line of lines) {\n            if (line.startsWith(\"data: \")) {\n              try {\n                const jsonStr = line.slice(6);\n                // Skip empty lines\n                if (!jsonStr.trim()) continue;\n\n                // Attempt to parse JSON with better error handling\n                let data;\n                try {\n                  data = JSON.parse(jsonStr);\n                } catch (firstParseError) {\n                  // If JSON parsing fails, try to clean the string and parse again\n                  console.warn(\n                    \"First JSON parse failed, attempting to clean:\",\n                    firstParseError,\n                  );\n                  try {\n                    // Replace problematic Unicode characters\n                    const cleanedJson = jsonStr\n                      .replace(/Ã¢â‚¬â„¢/g, \"'\") // Replace smart apostrophe\n                      .replace(/Ã¢â‚¬Å“/g, '\"') // Replace smart quote open\n                      .replace(/Ã¢â‚¬/g, '\"') // Replace smart quote close\n                      .replace(/Ã¢â‚¬\"/g, \"-\") // Replace em dash\n                      .replace(/Ã¢â‚¬\"/g, \"-\"); // Replace en dash\n                    data = JSON.parse(cleanedJson);\n                  } catch (secondParseError) {\n                    console.error(\n                      \"Failed to parse JSON after cleaning:\",\n                      secondParseError,\n                    );\n                    console.error(\"Original line:\", jsonStr);\n                    continue; // Skip this line and continue processing\n                  }\n                }\n\n                if (data.type === \"heartbeat\") {\n                  // Ignore heartbeat messages - they're just to establish connection\n                  continue;\n                } else if (data.type === \"metadata\") {\n                  metadata = data;\n                } else if (data.type === \"content\") {\n                  fullContent += data.content;\n\n                  // Split content by newlines to detect paragraphs\n                  const newParagraphs = fullContent\n                    .split(\"\\n\")\n                    .filter((p) => p.trim());\n\n                  // If we have more paragraphs than before, update\n                  if (newParagraphs.length > currentParagraphs.length) {\n                    currentParagraphs = newParagraphs;\n                    setResult({\n                      paragraphs: [...currentParagraphs],\n                      confidence: metadata?.confidence || 0,\n                      sources:\n                        metadata?.sources?.map((source: any) => ({\n                          question: source.chunk.metadata.question,\n                          content:\n                            source.chunk.chunkText.substring(0, 200) + \"...\",\n                          score: source.score,\n                          source: source.source,\n                        })) || [],\n                      totalSources: metadata?.sources?.length || 0,\n                    });\n                  }\n                } else if (data.type === \"error\") {\n                  throw new Error(data.error || \"Streaming error\");\n                } else if (data.type === \"end\") {\n                  // Final cleanup - make sure all content is included\n                  const finalParagraphs = fullContent\n                    .split(\"\\n\")\n                    .filter((p) => p.trim());\n                  if (finalParagraphs.length > 0) {\n                    setResult((prev) =>\n                      prev\n                        ? {\n                            ...prev,\n                            paragraphs: finalParagraphs,\n                          }\n                        : null,\n                    );\n                  }\n                  break;\n                }\n              } catch (parseError) {\n                console.error(\"Error parsing streaming data:\", parseError);\n              }\n            }\n          }\n        }\n\n        // Process any remaining buffer content\n        if (buffer.trim() && buffer.startsWith(\"data: \")) {\n          try {\n            const jsonStr = buffer.slice(6);\n            if (jsonStr.trim()) {\n              let data;\n              try {\n                data = JSON.parse(jsonStr);\n              } catch (firstParseError) {\n                console.warn(\"Final buffer parse failed:\", firstParseError);\n                const cleanedJson = jsonStr\n                  .replace(/Ã¢â‚¬â„¢/g, \"'\")\n                  .replace(/Ã¢â‚¬Å“/g, '\"')\n                  .replace(/Ã¢â‚¬/g, '\"')\n                  .replace(/Ã¢â‚¬\"/g, \"-\")\n                  .replace(/Ã¢â‚¬\"/g, \"-\");\n                data = JSON.parse(cleanedJson);\n              }\n\n              // Handle final data chunk\n              if (data.type === \"content\") {\n                fullContent += data.content;\n                const finalParagraphs = fullContent\n                  .split(\"\\n\")\n                  .filter((p) => p.trim());\n                if (finalParagraphs.length > 0) {\n                  setResult((prev) =>\n                    prev\n                      ? {\n                          ...prev,\n                          paragraphs: finalParagraphs,\n                        }\n                      : null,\n                  );\n                }\n              }\n            }\n          } catch (bufferError) {\n            console.error(\"Error processing final buffer:\", bufferError);\n          }\n        }\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"An error occurred\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Trigger fade-in for new paragraphs as they arrive\n  useEffect(() => {\n    if (!result) return;\n\n    // When new paragraphs arrive during streaming, fade them in\n    if (result.paragraphs.length > visibleParagraphs) {\n      setVisibleParagraphs(result.paragraphs.length);\n\n      // Trigger fade-in for the new paragraph after a short delay\n      const newParagraphIndex = result.paragraphs.length - 1;\n      setTimeout(() => {\n        setParagraphVisibility((prev) => ({\n          ...prev,\n          [newParagraphIndex]: true,\n        }));\n      }, 50); // Small delay to ensure DOM is updated\n    }\n  }, [result?.paragraphs.length, visibleParagraphs]);\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          AI-Powered Q&A Search\n        </h1>\n        <p className=\"text-gray-600\">\n          Ask questions about ADUs, elder care, and retirement planning. Our AI\n          will search through our knowledge base and provide detailed answers\n          with sources.\n        </p>\n      </div>\n\n      <form onSubmit={handleSearch} className=\"mb-8\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-3 h-5 w-5 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n            placeholder=\"Ask a question about ADUs, elder care, or retirement planning...\"\n            className=\"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n            disabled={isLoading}\n          />\n          <button\n            type=\"submit\"\n            disabled={isLoading || !query.trim()}\n            className=\"absolute right-2 top-2 px-4 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              \"Search\"\n            )}\n          </button>\n        </div>\n      </form>\n\n      {error && (\n        <div className=\"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg\">\n          <div className=\"flex items-center\">\n            <Info className=\"h-5 w-5 text-red-500 mr-2\" />\n            <span className=\"text-red-700\">{error}</span>\n          </div>\n        </div>\n      )}\n\n      {result && (\n        <div \n          className=\"max-h-96 overflow-y-auto border border-gray-200 rounded-lg p-6 bg-white\"\n          style={{ \n            scrollbarWidth: 'thin',\n            scrollbarColor: '#cbd5e1 #f1f5f9'\n          }}\n        >\n          <div className=\"space-y-6\">\n            {/* Answer */}\n            <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-semibold text-gray-900\">Answer</h2>\n                <div className=\"flex items-center space-x-2\">\n                  <span className=\"text-sm text-gray-500\">Confidence:</span>\n                  <span\n                    className={`px-2 py-1 rounded-full text-xs font-medium ${\n                      result.confidence > 0.8\n                        ? \"bg-green-100 text-green-800\"\n                        : result.confidence > 0.6\n                          ? \"bg-yellow-100 text-yellow-800\"\n                          : \"bg-red-100 text-red-800\"\n                    }`}\n                  >\n                    {(result.confidence * 100).toFixed(0)}%\n                  </span>\n                </div>\n              </div>\n              <div>\n                {result.paragraphs.map((paragraph, index) => (\n                  <div\n                    key={`paragraph-${index}`}\n                    style={{\n                      marginBottom: \"20px\",\n                      padding: \"10px\",\n                      backgroundColor: '#f9f9f9',\n                      fontSize: \"1.1rem\",\n                      lineHeight: \"1.7\"\n                    }}\n                  >\n                    <ReactMarkdown>{paragraph}</ReactMarkdown>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Sources */}\n          <div className=\"bg-white border border-gray-200 rounded-lg p-6 hidden\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              Sources ({result.totalSources})\n            </h3>\n            <div className=\"space-y-4\">\n              {result.sources.map((source, index) => (\n                <div\n                  key={index}\n                  className=\"border border-gray-100 rounded-lg p-4\"\n                >\n                  <div className=\"flex items-start justify-between mb-2\">\n                    <h4 className=\"font-medium text-gray-900\">\n                      {source.question}\n                    </h4>\n                    <div className=\"flex items-center space-x-2\">\n                      <span className=\"text-xs text-gray-500\">Score:</span>\n                      <span className=\"text-xs font-medium text-blue-600\">\n                        {(source.score * 100).toFixed(0)}%\n                      </span>\n                    </div>\n                  </div>\n                  <p className=\"text-sm text-gray-600 mb-2\">{source.content}</p>\n                  <div className=\"flex items-center text-xs text-gray-500\">\n                    <ExternalLink className=\"h-3 w-3 mr-1\" />\n                    Source: {source.source}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Example Queries */}\n      {!result && !isLoading && (\n        <div className=\"mt-8\">\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n            Example Questions\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {[\n              \"What is an ADU and how can it be used for elder care?\",\n              \"How much does it typically cost to build an ADU?\",\n              \"What are the zoning requirements for ADUs?\",\n              \"How can I make an ADU accessible for someone with mobility issues?\",\n              \"What are the maintenance responsibilities for an ADU?\",\n              \"How does living in an ADU affect government benefits?\",\n            ].map((example, index) => (\n              <button\n                key={index}\n                onClick={() => setQuery(example)}\n                className=\"text-left p-3 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors\"\n              >\n                <p className=\"text-sm text-gray-700\">{example}</p>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":14479},"server/services/userSync.ts":{"content":"import { createClerkClient } from \"@clerk/express\";\nimport { storage } from \"../storage\";\nimport { UpsertUser, UserRole } from \"@shared/schema\";\n\n// Initialize Clerk client\nconst clerkClient = createClerkClient({\n  secretKey: process.env.CLERK_SECRET_KEY!,\n});\n\nexport interface ClerkUserData {\n  id: string;\n  firstName?: string | null;\n  lastName?: string | null;\n  emailAddress?: string;\n  imageUrl?: string;\n  username?: string | null;\n}\n\n/**\n * Syncs a Clerk user with our database\n * Creates a new user if they don't exist, or updates existing user data\n */\nexport async function syncUserWithDatabase(clerkUserId: string): Promise<any> {\n  try {\n    // First, check if user already exists in our database\n    let dbUser = await storage.getUser(clerkUserId);\n    \n    // Fetch user data from Clerk to check for metadata updates\n    console.log(`Fetching user data from Clerk for: ${clerkUserId}`);\n    const clerkUser = await clerkClient.users.getUser(clerkUserId);\n    \n    if (!clerkUser) {\n      throw new Error(`User not found in Clerk: ${clerkUserId}`);\n    }\n\n    // Check if user should be an expert based on Clerk metadata\n    const clerkMetadata = clerkUser.publicMetadata as any;\n    const isExpert = clerkMetadata?.isExpert === true || clerkMetadata?.role === \"expert\";\n    \n    if (dbUser) {\n      console.log(`User ${clerkUserId} already exists in database`);\n      \n      // Check if role needs to be updated based on Clerk metadata\n      const shouldBeExpert = isExpert;\n      const currentRole = dbUser.role;\n      const expectedRole = shouldBeExpert ? \"expert\" : \"user\";\n      const expectedProfileType = shouldBeExpert ? \"tree\" : \"daisy\";\n      \n      if (currentRole !== expectedRole || dbUser.defaultProfileType !== expectedProfileType) {\n        console.log(`Updating user ${clerkUserId} role from ${currentRole} to ${expectedRole}`);\n        \n        // Update user with new role and profile type\n        const updatedUser = await storage.upsertUser({\n          ...dbUser,\n          role: expectedRole,\n          defaultProfileType: expectedProfileType,\n          updatedAt: new Date(),\n        });\n        \n        return updatedUser;\n      }\n      \n      return dbUser;\n    }\n\n    // Extract data from Clerk user (already fetched above)\n    const primaryEmail = clerkUser.emailAddresses.find(\n      email => email.id === clerkUser.primaryEmailAddressId\n    )?.emailAddress;\n\n    // Create username from email or use Clerk username\n    const username = clerkUser.username || \n                    primaryEmail?.split('@')[0] || \n                    `user_${clerkUserId.slice(-8)}`;\n    \n    // Prepare user data for our database\n    const userData: UpsertUser = {\n      id: clerkUserId,\n      username: username,\n      email: primaryEmail,\n      firstName: clerkUser.firstName,\n      lastName: clerkUser.lastName,\n      profileImageUrl: clerkUser.imageUrl,\n      // Set password to a placeholder since we're using Clerk auth\n      password: \"clerk_managed_auth\",\n      role: isExpert ? \"expert\" as UserRole : \"user\" as UserRole,\n      emailVerified: clerkUser.emailAddresses.some(email => \n        email.verification?.status === \"verified\"\n      ),\n      defaultProfileType: isExpert ? \"tree\" : \"daisy\",\n    };\n\n    console.log(`Creating new user in database:`, { \n      id: userData.id, \n      username: userData.username, \n      email: userData.email \n    });\n\n    // Create user in our database\n    const newUser = await storage.upsertUser(userData);\n    \n    console.log(`Successfully synced user ${clerkUserId} with database`);\n    return newUser;\n    \n  } catch (error) {\n    console.error(`Failed to sync user ${clerkUserId}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Updates user metadata in Clerk (e.g., role information)\n */\nexport async function updateClerkUserMetadata(\n  clerkUserId: string, \n  metadata: { role?: UserRole; [key: string]: any }\n): Promise<void> {\n  try {\n    await clerkClient.users.updateUserMetadata(clerkUserId, {\n      publicMetadata: {\n        ...metadata,\n      },\n    });\n    \n    console.log(`Updated Clerk metadata for user ${clerkUserId}:`, metadata);\n  } catch (error) {\n    console.error(`Failed to update Clerk metadata for ${clerkUserId}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Gets user from database and ensures it's synced with Clerk\n */\nexport async function getUserWithSync(clerkUserId: string): Promise<any> {\n  let dbUser = await storage.getUser(clerkUserId);\n  \n  if (!dbUser) {\n    // User doesn't exist, sync from Clerk\n    dbUser = await syncUserWithDatabase(clerkUserId);\n  }\n  \n  return dbUser;\n}","size_bytes":4581},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/pages/MyBookings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Calendar, Clock, User, DollarSign, MessageSquare } from \"lucide-react\";\nimport { format } from \"date-fns\";\n\nexport default function MyBookings() {\n  const { user } = useAuth();\n  const [filter, setFilter] = useState<'all' | 'upcoming' | 'past'>('all');\n\n  const { data: bookings = [], isLoading } = useQuery({\n    queryKey: ['/api/consultations/my-bookings'],\n    enabled: !!user,\n  });\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center p-6\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardContent className=\"text-center p-8\">\n            <User className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n            <h2 className=\"text-2xl font-semibold mb-4\">Login Required</h2>\n            <p className=\"text-gray-600 mb-6\">\n              Please log in to view your bookings.\n            </p>\n            <Button onClick={() => window.location.href = '/auth'}>\n              Sign In\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-teal-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading your bookings...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const now = new Date();\n  const filteredBookings = bookings.filter(booking => {\n    const bookingDate = new Date(booking.scheduledAt);\n    if (filter === 'upcoming') return bookingDate >= now;\n    if (filter === 'past') return bookingDate < now;\n    return true;\n  });\n\n  const getStatusBadge = (status: string, scheduledAt: string) => {\n    const isUpcoming = new Date(scheduledAt) >= now;\n    \n    if (status === 'cancelled') {\n      return <Badge variant=\"destructive\">Cancelled</Badge>;\n    } else if (status === 'completed') {\n      return <Badge variant=\"default\">Completed</Badge>;\n    } else if (isUpcoming) {\n      return <Badge variant=\"secondary\">Upcoming</Badge>;\n    } else {\n      return <Badge variant=\"outline\">Past</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-teal-50 to-coral-50 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">My Consultations</CardTitle>\n            <CardDescription>\n              View and manage your booked consultations\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* Filter Tabs */}\n            <div className=\"flex gap-2 mb-6\">\n              <Button\n                variant={filter === 'all' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilter('all')}\n              >\n                All ({bookings.length})\n              </Button>\n              <Button\n                variant={filter === 'upcoming' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilter('upcoming')}\n              >\n                Upcoming ({bookings.filter(b => new Date(b.scheduledAt) >= now).length})\n              </Button>\n              <Button\n                variant={filter === 'past' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => setFilter('past')}\n              >\n                Past ({bookings.filter(b => new Date(b.scheduledAt) < now).length})\n              </Button>\n            </div>\n\n            {/* Bookings List */}\n            {filteredBookings.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Calendar className=\"h-16 w-16 mx-auto mb-4 text-gray-400\" />\n                <p className=\"text-gray-600 mb-4\">\n                  {filter === 'upcoming' ? 'No upcoming consultations' : \n                   filter === 'past' ? 'No past consultations' : \n                   'No consultations booked yet'}\n                </p>\n                <Button onClick={() => window.location.href = '/experts'}>\n                  Browse Experts\n                </Button>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {filteredBookings.map((booking) => (\n                  <Card key={booking.id} className=\"border hover:shadow-md transition-shadow\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start justify-between mb-4\">\n                        <div>\n                          <h3 className=\"font-semibold text-lg mb-1\">\n                            Consultation with {booking.expert?.firstName && booking.expert?.lastName \n                              ? `${booking.expert.firstName} ${booking.expert.lastName}`\n                              : booking.expert?.name || 'Expert'}\n                          </h3>\n                          {getStatusBadge(booking.bookingStatus, booking.scheduledAt)}\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-gray-500\" />\n                          <span>{format(new Date(booking.scheduledAt), 'MMMM d, yyyy')}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Clock className=\"h-4 w-4 text-gray-500\" />\n                          <span>\n                            {format(new Date(booking.scheduledAt), 'h:mm a')} ({booking.duration} min)\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <DollarSign className=\"h-4 w-4 text-gray-500\" />\n                          <span>${(booking.totalAmount / 100).toFixed(2)}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <MessageSquare className=\"h-4 w-4 text-gray-500\" />\n                          <span className=\"text-gray-600\">\n                            {booking.notes || 'No notes added'}\n                          </span>\n                        </div>\n                      </div>\n\n                      {booking.bookingStatus === 'scheduled' && new Date(booking.scheduledAt) > now && (\n                        <div className=\"mt-4 pt-4 border-t\">\n                          <p className=\"text-sm text-gray-600 mb-2\">\n                            Join link will be sent via email 30 minutes before the consultation\n                          </p>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":7325}},"version":2}